# StackOverflow 问答 14077000-14077999

# android - Android：无效（脏）

> ID：14077008
> 
> 赞同：10
> 
> 时间：2012-12-28T23:20:05.497
> 
> 标签：android, android-canvas, invalidation

看起来Android真的不喜欢`invalidate (Rect dirty)`，它用于使画布的一部分无效。当我使画布的一部分（如下图绿色）无效并且需要同时重绘画布的`ToggleButton` *外部时，以红色显示的整个区域都将被擦除！*似乎 Android 只是使包含需要重绘的两个区域的联合的最小矩形内的所有内容无效，即使其中一个区域位于我要使其无效的画布的视图之外。

这是标准行为吗？如果是这样，为什么有人会使用部分失效？

![在此处输入图像描述](../Images/3aaea2127168f10ef674d3470149d5c1.png)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2013-04-24T15:50:17.660

Android 有一个名为`ViewRootImpl`. 此类由您在屏幕上看到的每个窗口所拥有（术语窗口在这里有点混乱，因此对于这个解释，窗口是主要活动的布局，顶部没有任何对话框或弹出窗口）。这个布局一直在被遍历，这意味着 Android 只是在等待这个窗口有一个脏矩形并绘制它。由于此窗口可能包含许多视图（按钮等），因此它会遍历所有视图并询问每个视图是否需要重绘。每个视图都返回一个脏矩形`ViewRootImpl`，所有这些矩形都连接到一个最后重绘的大矩形。

为什么这样做？好吧，`ViewRootImpl`要求`WindowManagerService`一个`Canvas`人借鉴。这意味着`Canvas`每次遍历时，一个窗口中的所有视图实际上都共享一个。

至于你的问题，如果只有一个特定`View`的有一个脏矩形，那么只会绘制那个脏矩形，但是由于另一个视图也有一个，所以脏矩形包含两者。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-08-16T09:31:59.457

此问题是由硬件加速引起的。您必须在活动中禁用它才能使用`invalidate(dirty rect)`. 要在您的活动中禁用硬件加速，请打开清单文件并添加：

```
android:hardwareAccelerated="false" 
```

现在您可以使用`invalidate(dirty rect)`.

# objective-c - 如果在 catch 块中抛出异常，是否会执行 finally 块？

> ID：14077010
> 
> 赞同：3
> 
> 时间：2012-12-28T23:20:22.190
> 
> 标签：objective-c, exception-handling

> **可能重复：**
> [在objective-c中返回后，代码最终会运行吗？](https://stackoverflow.com/questions/2969018/does-code-in-finally-get-run-after-a-return-in-objective-c)

考虑这个Objective C伪代码块：

```
NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];

@try {
    throw [[NSException alloc] init];
}
@catch (NSException *e) {
    throw e;
}
@finally {
    [pool drain];
} 
```

游泳池会被排干吗？还是块`throw`中的`@catch`使该代码无法访问？我觉得游泳池*应该*被排干，但我无法以一种或另一种方式找到有关它的文档。

是的，我可以编写一些代码并对其进行测试，但目前这是不可行的。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:37:49.050

[是的（文档）](https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Exceptions/Tasks/RaisingExceptions.html#//apple_ref/doc/uid/20000058-BBCCFIBF)。

> 与本地@catch 异常处理程序关联的@finally 块在@throw 导致调用下一个更高的异常处理程序之前执行。

在这种情况下，有关内存管理的进一步说明，请参阅链接文档页面的最底部。你在你的例子中是“好的”，因为异常本身并没有作为你在 finally 块中耗尽的池的一部分自动释放。但是如果没有人释放它，您可能会泄漏该异常。

（但在某些情况下，异常生命周期似乎有些模糊，请参阅：[@catch 块中捕获的对象的生命周期是什么？](https://stackoverflow.com/questions/8364834/what-is-the-lifecycle-of-an-object-caught-in-a-catch-block)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-28T23:28:00.330

来自[https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Exceptions/Tasks/HandlingExceptions.html](https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/Exceptions/Tasks/HandlingExceptions.html)：

`@finally — Defines a block of related code that is subsequently executed whether an exception is thrown or not.`

但它没有说明 catch 块中的异常。这听起来合乎逻辑，这个例外不会被咳嗽。

我制作了简单的程序来检查：

```
import <Foundation/Foundation.h>

int main(int argc, char **argv)
{
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init] ;

    int result = 0  ;

    @try {
            @throw [NSException exceptionWithName:@"Exception" reason:@"@try" userInfo:nil];
    }
    @catch (id exception) {
            @throw [NSException exceptionWithName:@"Exception" reason:@"@catch" userInfo:nil];
    }
    @finally {
            NSLog(@"Finally");
    }

    [pool release]  ;
    return result   ;
} 
```

只需编译并执行：

```
$ gcc -framework Foundation -fobjc-exceptions test.m
$ ./a.out 
2012-12-29 00:39:21.667 a.out[86205:707] *** Terminating app due to uncaught exception 'Exception', reason: '@catch'
*** First throw call stack:
(
    0   CoreFoundation                      0x00007fff8e3050a6 __exceptionPreprocess + 198
    1   libobjc.A.dylib                     0x00007fff8e56e3f0 objc_exception_throw + 43
    2   a.out                               0x0000000107d48d47 main + 359
    3   libdyld.dylib                       0x00007fff90b4e7e1 start + 0
)
libc++abi.dylib: terminate called throwing an exception
Abort trap: 6 
```

# javascript - 获取函数调用者名称时遇到问题（arguments.callee.caller 不起作用）

> ID：14077011
> 
> 赞同：3
> 
> 时间：2012-12-28T23:21:00.990
> 
> 标签：javascript

我在这里阅读了有关如何使用堆栈溢出的大量帖子

```
arguments.callee.caller or arguments.callee.caller.toString() 
```

如果你做一个简单的搜索，你可以找到一堆关于这个的帖子。

所以，我决定自己试试这个！但是，我想在 javascript 对象中找到函数的名称，但它似乎返回的是函数内部的代码，而不是实际的函数名称。

这是 jsFiddle：http: [//jsfiddle.net/4Cp5Z/18/](http://jsfiddle.net/4Cp5Z/18/)。

总而言之，我制作了一个新应用程序，然后调用`app.testFunction`. `testFunction()`电话`receiver()`，我希望`var name`等于`testFunction`

```
app = function() {

    this.testFunction = function() {

        this.receiver();

    };

    this.receiver = function() {

        var name = this.receiver.caller.toString();
        // this.receiver.caller.name outputs nothing...

    };
}; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:23:03.730

您的示例中的所有函数都没有名称。他们都是匿名的。您分配给它们的变量和/或属性具有名称，但函数没有。对于具有真实名称的函数，`function`关键字和左括号后有一个名称：

```
// Declaration
function nameIsHere() {
}

// Expression -- but beware of these ("named function expressions"), see below
var f = function nameIsHere() {
}; 
```

（请注意，如果您使用命名函数表达式，IE8 和更早版本会[创建**两个**单独的函数。）](http://blog.niftysnippets.org/2010/09/double-take.html)

`arguments.callee`在对该函数的调用中、在支持它的引擎上以及如果您没有使用严格模式时，可以为您提供对该函数对象的引用。请注意，它会对性能产生*重大*影响（在某些引擎上是一个数量级），并且在严格模式下是不允许的。

`arguments.callee.caller`为您提供对调用当前函数的函数的引用（如果您不在严格模式下）。它没有给你它的名字，而是一个实际的参考。

`Function#toString`规范中没有指定行为，但在所有主要的桌面浏览器上，它为您提供了函数源代码的*一些*表示。（这不一定适用于移动和小众浏览器。）但再次注意，这是非标准的，并且因浏览器而异（例如，有些返回源代码相当逐字，包括注释；其他返回反编译表示他们编译的函数）。

许多（但不是全部）引擎都支持非标准`Function#name`属性，它为您提供函数的真实名称（如果有的话）。但同样，它从未被标准化，甚至在 ES5 中也没有，而且你的函数没有名称。

# php - 如何检测机器人垃圾邮件表单并记录 IP 和输入？

> ID：14077012
> 
> 赞同：2
> 
> 时间：2012-12-28T23:20:59.940
> 
> 标签：php, javascript, spam-prevention

大家好，社区，

我有一个流量不错的网站，在我分析了 AWStats 中的一些日志后，我发现有很多机器人会在我的搜索表单中用坏词（性、年轻......等）向我的搜索表单发送垃圾邮件。这是一个问题，因为每次搜索都会产生一个标签云。

我安装了一个反 ddos​​ 脚本（在 CentOS 上），但它不符合我的需要，并且杀死了一些搜索引擎 IP（这非常糟糕）。

搜索垃圾邮件来自太多 IP，所以我不能简单地将它们添加到拒绝 IP 列表中。一个好的解决方案是监控所有 POST 并将它们记录到带有搜索词 + IP 地址的 txt 文件中。

这是我网站的网络表单：

```
<form action="<?= _domain ?>/search.php" method="get">
  <input type="text" name="q" value="<?=$q?>" id="query" /> 
  <select name="cat" style="margin-top: 5px;font-size: 16px;">
    <option value="all">All Files</option>
    <?php list_categories('dropdown', $cat); ?>
  </select>
  <input type="submit" value="Search" id="submit" /><br />
</form> 
```

有人知道可以以这种方式帮助我的javascript代码或类似的东西吗？

非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:48:04.990

我见过的一个聪明的解决方案是包含一个“蜜罐”输入框并将其 CSS 显示值设置为无。如果那个盒子里有任何东西，你就知道它是一个脚本。此外，为字段的真实名称使用真正晦涩难懂的东西，并传入一个您可以在提交时验证的令牌。例如：

```
<input type="text" name="zsdifhs" value="<?= $q ?>" id="zsdifhs" />
<input type="text" name="q" value="<?= $tok ?>"
    id="query" style="display:none;" /> 
```

或者可能将其设置为页面的背景颜色；如果那是白色的，例如：

```
<input type="text" name="zsdifhs" value="<?= $q ?>" id="zsdifhs" />
<input type="text" name="q" value="<?= $tok ?>"
    id="query" style="font-size: 1pt; color: white;" /> 
```

或者将其设置为一些不可见的边距，例如：

```
<input type="text" name="zsdifhs" value="<?= $q ?>" id="zsdifhs" />
<input type="text" name="q" value="<?= $tok ?>"
    id="query" style="margin-left: 9000px;" /> 
```

在处理脚本中，如果`$_POST['q']`设置为除了您传入的令牌之外的任何内容，您就知道它几乎肯定已被脚本修改。为避免检测，您还可以使用 javascript 来更改 CSS 显示状态，如果您觉得自己很聪明，您甚至可以做一些花哨的事情，例如返回一个带有虚假结果的静态页面（这非常有效），而不是实际处理查询而不是返回错误或访问被拒绝的页面，脚本可能会检测到，从而允许攻击者检查错误并调整他们的脚本。

# regex - 替换格式化数字中的前导空格

> ID：14077014
> 
> 赞同：2
> 
> 时间：2012-12-28T23:21:09.553
> 
> 标签：regex, r, format

我想用一个`\phantom{...}`命令替换一串格式化数字中的前导空格，其中`...`的长度与前导空格的长度相同。我能做的是：

```
x <- c(1, 1., 0.230, 10.1, 1000, 10000.12)
y <- format(round(x, 2), nsmall=2, big.mark="\\\\,", big.interval=3L)
gsub(" ", "\\\\phantom{ }", y) 
```

但是，我宁愿有一个`\phantom{}`合适的长度（比如`\phantom{ }`几个`\phantom{ }`.

**更新**

基于 Arun 的解决方案，我构建了这个函数来格式化数字`R`以在 LaTeX 表格中对齐：

```
tabAlign <- function(x, nsmall=0L, digits=NULL,
                     flag.before="\\\\phantom{", flag.after="}", embrace="$",
                     big.mark="\\\\,", big.interval=3L, ...)
{
    x <- if(!is.null(digits)) round(x, digits=digits) else x
    x <- format(x, nsmall=nsmall, big.mark=big.mark, big.interval=big.interval, ...)
    x <- sub("^([ ]+)", paste0(flag.before, "\\1", flag.after), x) 
    paste0(embrace, x, embrace) 
} 
```

现在，让我们用它做一些有用的事情。`tabAlign(x)`给出：

```
[1] "$\\phantom{       }1.00$" "$\\phantom{       }1.00$"
[3] "$\\phantom{       }0.23$" "$\\phantom{      }10.10$"
[5] "$\\phantom{ }1\\,000.00$" "$10\\,000.12$" 
```

将此复制并粘贴到 LaTeX 文件中会发现对齐不正确。原因是`big.mark`。这会保留`nchar(big.mark)=3`空格（在`R`字符串中）。但是，在 LaTeX 中，这占用的空间要少得多，因此数字不再完全对齐。因此，理想情况下，该`sub()`命令必须`nchar(big.mark)`考虑（对于任何给定的`big.mark`）。

**更新 2**

这是另一个更新，现在考虑了来自 DWin 的提示。

```
tabAlign <- function(x, nsmall=0L, digits=NULL,
                     flag="\\\\phantom{\\1}", embrace="$",
                     big.mark="\\\\,", big.interval=3L, ...)
{
    ## round (if digits is not NULL)
    x <- if(!is.null(digits)) round(x, digits=digits) else x
    ## determine those with/without big.mark (idea from prettyNum())
    y <- format(x, nsmall=nsmall, trim=TRUE)
    y.sp <- strsplit(y, ".", fixed=TRUE)
    B <- sapply(y.sp, `[`, 1L)
    ind.w.big.mark <- grep(paste0("[0-9]{", big.interval+1L, ",}"), B)
    ind.wo.big.mark <- setdiff(1:length(y), ind.w.big.mark)
    ## format the numbers
    x <- format(x, nsmall=nsmall, big.mark=big.mark, big.interval=big.interval, ...)
    ## substitute spaces
    z <- character(l <- length(x))
    n <- nchar(big.mark)
    for(i in seq_len(l)){
        z[i] <- if(i %in% ind.wo.big.mark) sub("^([ ]+)", paste0(flag, big.mark), x[i])
                else sub("^([ ]+)", flag, x[i])
    }
    ## embrace
    paste0(embrace, z, embrace)
} 
```

唯一缺少的部分是不是替换零件`\phantom`中的所有空格`if()`，而是替换空格的数量 - `n`，其中`n <- nchar(big.mark)`。如何在 中指定`sub()`？

**更新 3**

这是一个解决方案（但不太优雅......见下文）：

```
tabAlign <- function(x, nsmall=0L, digits=NULL,
                     flag="\\\\phantom{\\1}", embrace="$",
                     big.mark="\\\\,", big.mark2="\\,", big.interval=3L, ...)
{
    ## round (if digits is not NULL)
    x <- if(!is.null(digits)) round(x, digits=digits) else x
    ## determine those with/without big.mark (idea from prettyNum())
    y <- format(x, trim=TRUE)
    y.sp <- strsplit(y, ".", fixed=TRUE)
    B <- sapply(y.sp, `[`, 1L)
    w.big.mark <- grep(paste0("[0-9]{", big.interval+1L, ",}"), B)
    wo.big.mark <- setdiff(1:length(y), w.big.mark)
    ## format the numbers
    x. <- if(length(wo.big.mark) > 0 && length(w.big.mark) > 0) {
        ## format but trim
        y <- format(x, trim=TRUE, nsmall=nsmall, big.mark=big.mark, big.interval=big.interval, ...)
        ## paste big.mark to all numbers without big.mark
        y[wo.big.mark] <- paste0(big.mark2, y[wo.big.mark])
        format(y, justify="right")
    } else { # either all numbers have big.mark or not
        format(x, nsmall=nsmall, big.mark=big.mark, big.interval=big.interval, ...)
    }
    z <- sub("^([ ]+)", flag, x.)
    ## embrace
    paste0(embrace, z, embrace)
}

x <- c(1, 1., 0.230, 10.1, 1000, 10000.12)
tabAlign(x)
tabAlign(x[1:4])
tabAlign(x[5:6]) 
```

如果我们只能指定`big.mark`（而不是指定`big.mark2`）会更好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:29:01.513

这能解决问题吗？最好显示所需的输出（在测试表达式时确保输出）。感谢 DWin 的建议（见评论）。

```
sub("^([ ]+)", "\\\\phantom{\\1}", y) 
```

`(`and捕获匹配模式（这`)`是从字符串开头开始的一堆连续空格），并且可以使用 . 插入捕获的组`\\1`。如果您有多个括号，则可以插入每个捕获的组，并从 \1 到 \9 进行反向引用。

# php - 从字符串的开头/结尾删除单引号/双引号，仅当它们包含它时

> ID：14077018
> 
> 赞同：0
> 
> 时间：2012-12-28T23:21:26.647
> 
> 标签：php, regex

我正在尝试在 PHP 中使用正则表达式从字符串的开头和结尾去除单引号或双引号，但如果它们存在于字符串的每一端，我们只想删除它们。这样，用作度量的引号就不会丢失。

例如：

```
"3' 7"" - would remove quotes
3' 7" - would not remove 
```

我可以很容易地用逻辑来做到这一点`substr`，`trim`但我很想用正则表达式一次完成。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:29:53.710

要替换单引号或双引号并确保它们必须匹配：

```
preg_replace('/^([\'"])(.*)\\1$/', '\\2', $value); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:24:57.077

```
preg_replace('/^"(.*)"$/', '$1', '"3' 7""'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-28T23:26:25.027

```
preg_replace('/^"(.*)"$/', '$1', '"3\' 7""'); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-28T23:38:47.043

执行此操作的正则表达式方法是捕获引用，然后稍后再引用它。引号内的内容也应该被捕获，以便可以用作替换：

```
$x = array('3\' 7"', '\'3\' 7"\'', '"3\' 7""');
foreach ($x as $y)
    echo preg_replace('/^(["\'])(.*)\\1$/', '$2', $y), '<br>';
die; 
```

现在，正则表达式的方式还可以，但是“手动”做可能会更容易理解和将来维护：

```
function remove_quotes($string)
{
    $length = strlen($string);

    if ($length > 2)
    {
        foreach (array('\'', '"') as $quote)
        {
            if ($string[0] === $quote && $string[$length-1] === $quote)
            {
                $string = substr($string, 1, -1);
                break;
            }
        }
    }
    return $string;
}
$x = array('3\' 7"', '\'3\' 7"\'', '"3\' 7""');
foreach ($x as $y)
    echo remove_quotes($y), '<br>';
die; 
```

# android-activity - 使用 LocalBroadcastManager 对活动的意图服务

> ID：14077025
> 
> 赞同：0
> 
> 时间：2012-12-28T23:22:09.910
> 
> 标签：android-activity, broadcastreceiver, intentservice

我一直在尝试使用 LocalBroadcastManager，但它似乎不起作用。基本上我希望我的 intentService 在运行时广播一个意图。然后，我希望我的活动在用户积极使用活动时接收广播。

我尝试按照此处的说明进行操作： [如何使用 LocalBroadcastManager？](https://stackoverflow.com/questions/8802157/how-to-use-localbroadcastmanager)

但由于某种原因它不起作用。我没有得到任何被调用的接收者的日志条目。

这是我的代码的相关部分：

```
public class MainActivity extends Activity {
  // Debug log tag
  private static final String tag = "PhoneControlMainActivity";

  // Broadcast receiver
  PhoneControlBroadcastReceiver receiver;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    // Register the receiver with the local broadcast manager
    receiver = new PhoneControlBroadcastReceiver();
    LocalBroadcastManager.getInstance(this).registerReceiver(receiver, new IntentFilter(PhoneControlBroadcastReceiver.SERVICE_OUTPUT));

    // Start IntentService
    try {
      serviceName = startService(new Intent(this, PhoneControlIntentService.class));
    }
    catch(SecurityException e)
    {
      Log.d(tag,"SecurityException occured when starting IntentService: "+ e.getMessage());
      return;
    }

    if(serviceName != null) {
      Log.d(tag,"serviceName NOT NULL");
    }
    else {
      Log.d(tag,"serviceName NULL");
    }
  }
}

public class PhoneControlIntentService extends IntentService  {
  public PhoneControlIntentService() {
    super("PhoneControlIntentService");
  }

  @Override
  protected void onHandleIntent(Intent intent) {    
    Intent msgIntent = new Intent(PhoneControlBroadcastReceiver.SERVICE_OUTPUT);
    msgIntent.putExtra("message", "This is my message!");
    LocalBroadcastManager.getInstance(this).sendBroadcast(msgIntent);
  }
}

public class PhoneControlBroadcastReceiver extends BroadcastReceiver{   
  // Action
  public static final String SERVICE_OUTPUT = "com.axr0284.phonecontrol.SERVICE_OUTPUT";

  @Override
  public void onReceive(Context context, Intent intent) {
    Log.d(tag,"onReceive called");      
  }
} 
```

任何帮助将不胜感激？谢谢阿米什

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-09-01T12:11:36.740

LocalBroadcastManager 不能在它自己的进程之外广播。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T18:41:04.567

这是我做错了什么，我`service`在`AndroidManifest.xml`这行中的声明

`android:process=":PhoneControlIntentService_process"`

```
<service
    android:name=".PhoneControlIntentService" 
    android:label="@string/IntentService_name"
    android:process=":PhoneControlIntentService_process"**
    android:exported="false"/> 
```

这应该`service`作为一个单独的进程启动。我想它以某种方式阻止了正确`localBroadcastManager`发送`intent`。我不太明白，但是当我删除那条线时，它开始工作了。

# ruby-on-rails - 处理多参数赋值和rails 3.2 key-value store

> ID：14077035
> 
> 赞同：2
> 
> 时间：2012-12-28T23:23:42.217
> 
> 标签：ruby-on-rails, ruby-on-rails-3.2

我现在第一次在一个名为`Applicant`.

（我想保存序列化的申请对象，因为它稍后会发送到外部应用程序并且它只是保存为本地备份。）

申请者模型有一个“生日”属性。

```
store :data, accessors: [ ..., :birthday ] 
```

日期字段的表单助手将属性拆分为日/月/年的多个字段。

通常在分配参数时，ActiveRecord 会自动将它们重新组合在一起。

但是当使用键值存储时，事实并非如此，我得到了一个异常：

```
ActiveRecord::MultiparameterAssignmentErrors Exception: 1 error(s) on assignment of multiparameter attributes 
```

我可以将生日（1i）生日（2i）生日（3i）参数放在控制器中，但这并不是我真正想做的。有更好的方法吗？

谢谢

# ember.js - 使用实际的 DOM 元素作为视图

> ID：14077038
> 
> 赞同：2
> 
> 时间：2012-12-28T23:23:51.483
> 
> 标签：ember.js

假设我有这样的事情：

```
<footer>
    <div id="home">
        Lorem ipsu 1 ...
    </div>
    <div id="about">
        Lorem ipsu 2 ...
    </div>
    <div id="plans">
        Lorem ipsu 3 ...
    </div>
</footer> 
```

是否可以创建一个视图，而不是根据模板创建新元素，而是使用三个现有 DOM 元素之一？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T08:27:37.373

简短的回答是否定的，而冗长的回答是无关紧要的，因为为视图创建模板的一个原因是，您可以将上下文（默认为关联的控制器）附加到它，并使上下文属性发生的动态变化反映在看法。当连接到`{{outlet}}`. 因此，对于您的示例，如果“home”、“about”和“plans”是您的应用程序的三个不同状态，那么您将设置您的模板，如下所示：

**模板：**

```
<script type="text/x-handlebars" data-template-name="application">
    <footer>
        <!--Your application template goes here-->
        {{outlet}}
    </footer>
</script>
<script type="text/x-handlebars" data-template-name="home">
    <!--Your home template goes here-->
</script>
<script type="text/x-handlebars" data-template-name="about">
    <!--Your about template goes here-->
</script>
<script type="text/x-handlebars" data-template-name="plans">
    <!--Your plans template goes here-->
</script> 
```

# c++ - 如何将“全屏”按钮添加到最右侧的标题栏？

> ID：14077042
> 
> 赞同：1
> 
> 时间：2012-12-28T23:24:27.293
> 
> 标签：c++, python, qt, pyqt, pyside

大多数 Mac 应用程序（包括 Chrome 浏览器等第三方应用程序）都带有“全屏”图标，位于标题栏的最右侧。

我想做同样的事情。

我已经做了一些研究，但我找不到如何显示/隐藏此按钮或如何修改标题栏本身。

不可能吗？我需要一个完整的自定义标题栏吗？我不想这样做以免失去默认窗口管理器的特权。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-31T14:30:34.480

看看**Qt 项目**对
[如何处理标题栏中的事件并更改其颜色等有什么看法？](http://qt-project.org/faq/answer/how_can_i_handle_events_in_the_titlebar_and_change_its_color_etc)

> 标题栏属于操作系统，我们无法控制那个。您可以创建自己的标题栏，但请注意，这需要一些工作。为了创建自己的标题栏，然后创建一个 QWidget [doc.qt.nokia.com] 子类，其中包含三个工具按钮，除了窗口的移动之外，它们还处理关闭、最小化和最大化事件。

# postgresql - 使用带有 clojure 的 windows 设置本地 PostgreSQL 实例？

> ID：14077044
> 
> 赞同：0
> 
> 时间：2012-12-28T23:24:34.660
> 
> 标签：postgresql, heroku, clojure

我正在尝试遵循此教程[https://devcenter.heroku.com/articles/clojure-web-application](https://devcenter.heroku.com/articles/clojure-web-application)。不过，在设置本地 postgresql 数据库进行测试的最初步骤中，我遇到了一些困难。

第一个问题是在 windows shell 中运行“postgres -D pg”会导致“不允许具有管理权限的用户执行 PostgreSQL”的错误。为了得到一个回合，我尝试运行 pg_ctl start -D .\ 。我认为它有效，除了它无法访问“postgresql.conf”文件。

运行“creatdb 呼喊者”也不起作用，所以我运行了“createdb -U postgres 呼喊者”。但是现在当我尝试启动 lein repl 时，我得到了这个错误：

```
$lein repl
Could not find artifact postgresql:postgresql:pom:8.4-702.qdbc4 in central (http://repo1.maven.org/maven2
Could not find artifact postgresql:postgresql:pom:8.4-702.qdbc4 in clojars (https://clojars.org/repo/)
Could not find artifact postgresql:postgresql:jar:8.4-702.qdbc4 in central (http://repo1.maven.org/maven2
Could not find artifact postgresql:postgresql:jar:8.4-702.qdbc4 in clojars (https://clojars.org/repo/)
Check :dependencies and :repositories for typos.
It's possible the specified jar is not in any repository.
If so, see "Free-floating Jars" under http://j.mp/repeatability
Exception in thread "Thread-1" clojure.lang.ExceptionInfo: Could not resolve dependencies {:exit-code 1}
        at clojure.core$ex_info.invoke(core.clj:4227)
        at leiningen.core.classpath$get_dependencies.doInvoke(classpath.clj:128)
        at clojure.lang.RestFn.invoke(RestFn.java:425)
        at clojure.lang.AFn.applyToHelper(AFn.java:163)
        at clojure.lang.RestFn.applyTo(RestFn.java:132)
        at clojure.core$apply.invoke(core.clj:605)
        at leiningen.core.classpath$resolve_dependencies.doInvoke(classpath.clj:144)
        at clojure.lang.RestFn.invoke(RestFn.java:425)
        at leiningen.core.eval$prep.invoke(eval.clj:60)
        at leiningen.core.eval$eval_in_project.invoke(eval.clj:220)
        at leiningen.repl$start_server.doInvoke(repl.clj:65)
        at clojure.lang.RestFn.invoke(RestFn.java:470)
        at leiningen.repl$repl$fn__1788.invoke(repl.clj:145)
        at clojure.lang.AFn.applyToHelper(AFn.java:159)
        at clojure.lang.AFn.applyTo(AFn.java:151)
        at clojure.core$apply.invoke(core.clj:601)
        at clojure.core$with_bindings_STAR_.doInvoke(core.clj:1771)
        at clojure.lang.RestFn.invoke(RestFn.java:425)
        at clojure.lang.AFn.applyToHelper(AFn.java:163)
        at clojure.lang.RestFn.applyTo(RestFn.java:132)
        at clojure.core$apply.invoke(core.clj:605)
        at clojure.core$bound_fn_STAR_$fn__3984.doInvoke(core.clj:1793)
        at clojure.lang.RestFn.invoke(RestFn.java:397)
        at clojure.lang.AFn.run(AFn.java:24)
        at java.lang.Thread.run(Unknown Source) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T03:36:44.687

看起来您的 project.clj 文件可能没有指定正确的依赖项。这是一个简短的示例项目，它具有工作依赖项，可以与之进行比较：

项目.clj：

```
(defproject hello "0.1.0-SNAPSHOT"
  :description "FIXME: write description"
  :url "http://example.com/FIXME"
  :license {:name "Eclipse Public License"
            :url "http://www.eclipse.org/legal/epl-v10.html"}
  :dependencies [[org.clojure/clojure "1.4.0"]
                 [org.clojure/java.jdbc "0.2.3"]
                 [postgresql/postgresql "8.4-702.jdbc4"]]) 
```

这适用于repl。

```
user> (require '[clojure.java.jdbc :as sql])
nil

user> (def pgsqldb {:subprotocol "postgresql"                                                              
                    :subname "//127.0.0.1:5432/dbname"                                                    
                    :user "postgres"                                                                       
                    :password "...."})
#'user/pgsqldb
user> (sql/with-connection pgsqldb )
nil

user> (sql/with-connection pgsqldb 
         (sql/with-query-results rs ["SELECT * 
                                      FROM information_schema.tables 
                                      WHERE table_type = 'BASE TABLE' 
                                        AND table_schema = 'public' 
                                      ORDER BY table_type, table_name"] 
           (count rs)))
50 
```

# css - 为什么这两层不并排浮动？

> ID：14077045
> 
> 赞同：1
> 
> 时间：2012-12-28T23:24:37.170
> 
> 标签：css

我试图让两个 div 并排显示，我什至将它们浮动到没有运气。这是为什么？

```
<div class="popup-container">
  <div class="popup-header">
      <div class="popup-image-holder"></div>

    <div class="image-titles">Content for  class "image-titles" Goes Here</div>
  </div>
</div>

.popup-container {
    padding: 0px;
    width: 764px;
}
.popup-header {
    background-color: #000;
    padding: 21px;
    height: 243px;
    width: 100%;
    overflow: hidden; /* add this to contain floated children */
}
.popup-image-holder {
    float; left;
    background-color: #FFF;
    height: 165px;
    width: 165px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    -khtml-border-radius: 3px;
    border-radius: 3px;
    padding-top: 5px;
    padding-left: 5px;
}
.image-titles {
    float: left;
    height: 100%;
    width: 300px;
    background-color: #666;
} 
```

谢谢编辑：[JsFiddle](http://jsfiddle.net/kyskv/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T23:29:23.810

尝试至少将“显示”属性设置为最外面的容器。

例如： 根据需要将其添加到其他元素中。 `.popup-container { ***display: block;*** padding: 0px; width: 764px; }`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:30:49.113

嗯。你打错了；而不是：在`popup-image-holder`div 中试试这个

```
 .popup-image-holder {
float: left;
background-color: #FFF;
height: 165px;
width: 165px;
-moz-border-radius: 3px;
-webkit-border-radius: 3px;
-khtml-border-radius: 3px;
border-radius: 3px;
padding-top: 5px;
padding-left: 5px;
} 
```

[在这里](http://jsfiddle.net/kyskv/1/)摆弄

# eclipse - 当我启动 WindowBuilder GWT 时 Eclipse 崩溃

> ID：14077047
> 
> 赞同：1
> 
> 时间：2012-12-28T23:24:38.037
> 
> 标签：eclipse, gwt

在 GWT 文件中打开 WindowBuilder 时出现 Eclipse 错误 -> 崩溃（Linux）：

```
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  SIGSEGV (0xb) at pc=0x00007f59e6ac65a0, pid=25322, tid=140026564249344
#
# JRE version: 7.0_09-b30
# Java VM: OpenJDK 64-Bit Server VM (23.2-b09 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# C  [libwebkitgtk-1.0.so.0+0x14245a0]  void WTF::freeOwnedGPtr<_GdkEvent>(_GdkEvent*)+0x15df0
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try "ulimit -c unlimited" before starting Java again
#
# If you would like to submit a bug report, please include
# instructions on how to reproduce the bug and visit:
#   https://bugs.launchpad.net/ubuntu/+source/openjdk-7/
# The crash happened outside the Java Virtual Machine in native code.
# See problematic frame for where to report the bug. 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T09:12:50.413

Windowbuilder 与 64 位不兼容。这是一个已知的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T20:10:35.377

我已经用一些技巧在 Fedora 17-64 位上设置了它：

1.  从终端运行“sudo yum install webkitgtk”命令。
2.  转到“eclipse.ini”文件并在该文件末尾添加“-Dorg.eclipse.swt.browser.UseWebKitGTK=true”。

请参阅[此](http://saeedzarinfam.blogspot.com/2012/12/how-can-we-run-swt-browser-inside.html)链接。

# java - 字符串到参数

> ID：14077051
> 
> 赞同：0
> 
> 时间：2012-12-28T23:24:52.890
> 
> 标签：java

假设我有一个像`function arg1 arg2 "arg3 is long"`.

我怎样才能获得的输出

```
String[0] = "function"
String[1] = "arg1"
String[2] = "arg2"
String[3] = "arg is long" 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T23:29:26.720

这个[问题](https://stackoverflow.com/questions/367706/is-there-a-good-command-line-argument-parser-for-java)的答案有许多选项供您探索，但它们是为真正的命令行参数量身定制的。

*   [Apache Commons CLI](http://commons.apache.org/cli/)
*   [JSAP](http://www.martiansoftware.com/jsap/)
*   [Args4J](http://args4j.kohsuke.org)
*   [指挥官](http://jcommander.org)
*   [用Scanner](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html)自己动手。

# php - Symfony 1.4，Doctrine：如何获得最新的“加入”记录？

> ID：14077053
> 
> 赞同：0
> 
> 时间：2012-12-28T23:24:55.267
> 
> 标签：php, symfony1, doctrine, symfony-1.4

一个用户有更多的任务，1:N 连接。

视觉上：

```
admin
 task1 2011/01/01 00:00:01
 task2 2011/01/01 00:00:04
 task3 2011/01/01 00:00:02
user2
 task1 2011/03/01 00:01:01
 task2 2011/03/01 00:01:04
 task3 2011/03/01 00:01:02 
```

[（请参阅我上一个问题](https://stackoverflow.com/q/14071955/569101)的架构）

如何离开加入用户和最后一个“任务”，而不是全部获得？

问题是我不知道如何用纯 SQL 来做......我在这里看到了一些例子，但它们不起作用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T13:37:55.483

如果我们认为您在[前面的问题](https://stackoverflow.com/q/14071955/569101)`$user_id`中根据您的模式在里面有用户 ID ，您可以试试这个：

```
$q = Doctrine_Query::create()
    ->select('u.*, t.*')
    ->from('User u')
    ->leftJoin('u.Task t')
    ->where('t.id IN (SELECT t2.id FROM Task t2 WHERE t2.owner_id = ? ORDER BY t2.id DESC LIMIT 1)', array($user_id));
$res = $q->execute(); 
```

这是Doctrine[中子查询的文档。](http://doctrine.readthedocs.org/en/latest/en/manual/dql-doctrine-query-language.html#subqueries)

# sql-server - JOIN ON subselect 返回我想要的，但是当 subselect 返回 NULL 时，周围的 select 缺少记录

> ID：14077064
> 
> 赞同：0
> 
> 时间：2012-12-28T23:26:27.090
> 
> 标签：sql-server, tsql

我有一个表，我在其中存储具有 Created_On 日期和 Last_Updated_On 日期的记录。每条新记录都将使用 Created_On 写入，并且每次后续更新都会使用相同的 Created_On 写入一个新行，但更新的是 Last_Updated_On。

我正在尝试设计一个查询以返回每个查询的最新行。我所拥有的看起来像这样：

```
SELECT 
   t1.[id] as id,
   t1.[Store_Number] as storeNumber,
   t1.[Date_Of_Inventory] as dateOfInventory,
   t1.[Created_On] as createdOn,
   t1.[Last_Updated_On] as lastUpdatedOn
FROM [UserData].[dbo].[StoreResponses] t1 
JOIN (
      SELECT 
         [Store_Number], 
         [Date_Of_Inventory], 
         MAX([Created_On]) co, 
         MAX([Last_Updated_On]) luo 
      FROM [UserData].[dbo].[StoreResponses] 
      GROUP BY [Store_Number],[Date_Of_Inventory]) t2
   ON 
      t1.[Store_Number] = t2.[Store_Number] 
      AND t1.[Created_On] = t2.co 
      AND t1.[Last_Updated_On] = t2.luo 
      AND t1.[Date_Of_Inventory] = t2.[Date_Of_Inventory]
WHERE t1.[Store_Number] = 123 
ORDER BY t1.[Created_On] ASC 
```

子选择工作正常...我看到 X 行，按 Store_Number 和 Date_Of_Inventory 分组，其中一些的 luo (Last_Updated_On) 值为 NULL。但是，子选择中 luo 为空的那些行不会出现在整体结果中。换句话说，我在子选择中得到 6 个结果，我在整体结果中只得到 2 个，而且只有 Last_Updated_On 不为 NULL 的那些行。

因此，作为测试，我写了以下内容：

```
SELECT 1 WHERE NULL = NULL 
```

并没有得到任何结果，但是，当我运行时：

```
SELECT 1 WHERE 1 = 1 
```

我得到了 1 的结果。好像 SQL Server 没有将 NULL 与 NULL 相关联。

我怎样才能解决这个问题？当两个值都为 NULL 时，为什么两个字段不进行比较？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:00:35.470

默认情况下不启用 ANSI Null 比较；NULL 不等于 NULL。您可以通过提示启用此功能（如果您的业务案例和 NULL 的数据库设计使用需要此功能）：

```
SET ansi_nulls off 
```

另一种基本的转身使用：

```
ON ((t1.[Store_Number] = t2.[Store_Number])  OR 
(t1.[Store_Number] IS NULL AND t2.[Store_Number] IS NULL)) 
```

执行你的 POC：

```
SET ansi_nulls off
SELECT 1 WHERE NULL = NULL 
```

回报：

```
1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:47:28.037

您可以使用 Coalesce（假设 Store_Number 是整数的示例）

```
 ON 
      Coalesce(t1.[Store_Number],0) = Coalesce(t2.[Store_Number],0) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T00:56:40.117

这也有效：

```
AND EXISTS (SELECT t1.Store_Number INTERSECT SELECT t2.Store_Number) 
```

# html - Webkit 浏览器没有填满 div

> ID：14077065
> 
> 赞同：0
> 
> 时间：2012-12-28T23:26:33.443
> 
> 标签：html, css, webkit

我的代码：

```
<html>
  <head></head>
  <body>
    <div style="position: relative; border:1px black solid; background-color:#00a2e8; min-width: 100px; min-height: 100px; width: 1px; height: 1px">
      <table border="1" style="width:100%; height: 100%;">
        <tr><td style="vertical-align: middle">abc</td></tr>
      </table>
    </div>
  </body>
</html> 
```

在 Firefox 中，它显示得很好，表格填满了整个 div，表格内容垂直居中。

如果我在基于 Webkit 的浏览器上显示它，表格不会填满整个 div，导致标签垂直对齐到顶部。在基于 Webkit 的浏览器上，如何使表格扩展到整个 div？

更具体地说，我对 Android 浏览器很感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:41:29.517

对于您的情况，我通常会使用`position:absolute;height:100%;`内部元素。但这对表格不起作用，所以我曾经`display:block`让它像普通的 DIV 一样显示。似乎运作良好。

[**工作示例**](http://jsfiddle.net/4fCDc/1/)

```
<html>
  <head></head>
  <body>
    <div style="border:1px black solid; background-color:#00a2e8; min-width:100px; min-height:100px;height:100px;width:100px;">
      <table style="display:block;border:1px solid red;height:100%;">
          <tr><td style="vertical-align: center;">abc sdfs dfs df sdf sd fsd fsd fsdf sds dfs df </td></tr>

      </table>
    </div>
  </body>
</html>​ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:43:47.507

通过设置`td` **高度**，您可以获得：

[http://jsfiddle.net/d7kfR/](http://jsfiddle.net/d7kfR/)

**这是你需要的吗？**

# objective-c - 从命令行或以任何其他自动化方式启动 Instruments.app

> ID：14077070
> 
> 赞同：0
> 
> 时间：2012-12-28T23:27:17.230
> 
> 标签：objective-c, xcode, instruments

我想知道是否有任何关于从命令行运行 Instruments 应用程序的信息，或者以其他方式在外部以某种自动化方式启动应用程序。

我知道“仪器”命令行工具，但它似乎静默运行 Instruments/DTrace 并将信息收集到日志文件中——这不是我想要做的。我想模仿——本质上——当你按下配置文件按钮时 Xcode 会做什么。启动仪器 GUI 并将其附加到给定的给定进程 ID，以便坐在 Mac 前面的用户可以与应用程序交互，查看它收集的数据等。

Xcode 做到了，所以肯定有某种 API 吗？

谢谢，马克

# wpf - UserControl Canvas.Left 绑定不起作用

> ID：14077073
> 
> 赞同：1
> 
> 时间：2012-12-28T23:27:35.953
> 
> 标签：wpf, binding, canvas, user-controls

所以问题是这样的。我需要设置 Canvas.Top 和 Canvas.Left 的 UserControl，但这些属性是从 ViewModel 绑定的。为简单起见，让我们为用户控件提供此代码，后面没有代码：

```
<UserControl x:Class="BadBinding.MyUserControl"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         Canvas.Left="{Binding ElementName=slider, Path=Value}"
         >
 <Grid Width="100" Background="Red">
    <Slider x:Name="slider" Minimum="100" Maximum="250" />
 </Grid>
</UserControl> 
```

而这个主窗口的代码：

```
<Window x:Class="BadBinding.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="MainWindow" Height="350" Width="525"
    xmlns:local="clr-namespace:BadBinding"
    >
  <Canvas>
    <local:MyUserControl />
  </Canvas>
</Window> 
```

我不知道为什么绑定不起作用。当您将 Canvas.Left 直接设置为某个值时，一切都很好，并且将用户控件的内容直接写入主窗口。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:59:23.380

我认为它是因为它`UserControl`是在添加到之前构造的，`Canvas`并且因为`Canvas.Left`它是一个附加属性，它可能无法正确解析。

尝试使用`Reference`绑定。

```
<UserControl x:Class="BadBinding.MyUserControl"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         Canvas.Left="{Binding Source={x:Reference Name=slider}, Path=Value}"
         >
 <Grid Width="100" Background="Red">
    <Slider x:Name="slider" Minimum="100" Maximum="250" />
 </Grid>
</UserControl> 
```

注意：您可能会收到编译警告，但它仍会编译。

但我认为最好的选择是在你的用户控件上创建一个属性来绑定值，这也可以。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T06:52:40.097

我尝试了很多，`Bindings`但它也对我有用..所以如果你想去，`EventHandler`那么下面的解决方法可能会帮助你..

删除`Bindings`并添加事件处理程序到`ValueChanged`事件

在您的***MyUserControl.xaml***

```
<UserControl x:Class="BadBinding.MyUserControl"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
 <Grid Width="100" Background="Red">
    <Slider x:Name="slider" Minimum="100" Maximum="250" ValueChanged="slider1_ValueChanged" />
 </Grid>
</UserControl> 
```

在您的***MyUserControl.xaml.cs***

```
private void slider1_ValueChanged(object sender, RoutedPropertyChangedEventArgs<double> e)
{
     Canvas.SetLeft(this, slider1.Value);            
} 
```

我试过这个并为我工作，如果你发现任何问题，请告诉我..

# java - 多个字符类型的单个正则表达式

> ID：14077074
> 
> 赞同：1
> 
> 时间：2012-12-28T23:27:40.503
> 
> 标签：java, regex

我正在寻找一个用于断言任何长度的字符串（实际上是密码）具有的*单个 java 正则表达式：*

*   至少 2 个小写字母
*   至少 2 个大写字母
*   至少 2 个数字字符
*   至少 1 个字符不是字母或数字

用于匹配，例如：

```
password.matches("some regex"); 
```

这里的“重要”部分是字符类型必须*不止一种*。我发现的其他问题是关于“至少一个”，而不是“至少两个”的字符类型。

它可以通过多个 match() 调用来完成，但正则表达式将被外部化为单个字符串，因此它需要一次调用`matches()`.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-28T23:37:57.100

理论上，您可以按照以下方式使用模式：

`(?=.*[A-Z].*[A-Z])(?=.*[a-z].*[a-z])(?=.*\\d.*\\d)(?=.*[^A-Za-z\\d]).*`

但是，对于实际用途，我宁愿坚持正确的编程，而不是依赖像这样的正则表达式。

# binary - SimpleDB 可以存储二进制属性吗？

> ID：14077076
> 
> 赞同：1
> 
> 时间：2012-12-28T23:28:11.913
> 
> 标签：binary, nosql, amazon-simpledb

[SimpleDB](http://aws.amazon.com/simpledb/) (Amazon AWS)可以存储二进制属性吗？我熟悉 1024 字节/属性的最大大小。用例将压缩字符串存储为属性，并使用 SimpleDB 一次查找多个键。更具体地说：一次查询多个项目键，同时请求为每个项目键返回相同的列。

是否支持这个（在 SimpleDB 中存储二进制属性）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-30T21:13:03.413

DynamoDB 对二进制数据类型和您想使用的数据类型有更好的支持。

# ruby-on-rails - 在 rails 3.2.9 中运行 bundle install 时在 activereocrd-3.2.9.gem 中找不到元数据

> ID：14077081
> 
> 赞同：0
> 
> 时间：2012-12-28T23:28:23.433
> 
> 标签：ruby-on-rails, activerecord, bundle

我是 Rails 的新手。在 Windows 7 上工作，64 位。通过 RailsInstaller 安装了我的环境。当然最新版本。创建新项目（将 gem 文件保留为默认值）并运行 bundle install 时，出现错误

```
gem::package::FormatError: no metadata found in 
D:/RailsInstaller/Ruby1.9.3/bin/cashe/activereocrd-3.2.9.gem
and error occurrend while installing activerecord (3.2.9), and bubndler cannot continue.
Make sure that gem install activerecord -v '3.2.9' succeeds before building. 
```

我尝试运行 gem install activerecord ..按照指示仍然捆绑安装不起作用，我无法运行 rails 服务器。（导轨）

将应用程序 gem 文件中的 rails 版本更改为 3.2.8 而不是 3.2.9 时，一切似乎都正常工作，并且 rails 服务器成功运行。怎么了？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-28T22:43:53.090

我卸载了 railsinstaller 和所有其他剩余文件夹。重新安装 railsinstaller。问题解决了。

# javascript - JavaScript div 排序脚本错误（切换下面两个 div 的顺序）

> ID：14077086
> 
> 赞同：0
> 
> 时间：2012-12-28T23:29:03.760
> 
> 标签：javascript, list, web, onclick

代码：

[http://jsfiddle.net/s4UQP/](http://jsfiddle.net/s4UQP/)

^ 这是查看代码以及它如何与 div 一起使用的最佳方式

但无论如何，这里是代码：

```
function move(from, to) {

document.getElementById('progress').innerHTML = '...';

from = parseInt(from,10);
to = parseInt(to,10);

tbc = document.getElementById(from);
before = document.getElementById(to);
containr = document.getElementById('alldivs');

neworder = 'Order: <select><option onclick="move(' + to + ',1)">1</option><option onclick="move(' + to + ',2)">2</option><option onclick="move(' + to + ',3)">3</option></select> <br><a href="#" onclick="move(' + to + ',' + (to - 1) + ')">Send up</a> | <a href="#" onclick="move(' + to + ',' + (to + 1) + ')">Send down</a><br><a href="#" onclick="move(' + to + ',1)">Bring to front (#1)</a> | <a href="#" onclick="move(' + to + ',4)">Send to back (#4)</a>';

document.getElementById(from).getElementsByClassName('order')[0].innerHTML = neworder;

document.getElementById(from).getElementsByClassName('number')[0].innerHTML = to;

tempdiv = document.createElement('div');
tmphtml = document.getElementById(from).innerHTML;
tempdiv.className = 'holder';
tempdiv.innerHTML = tmphtml;

n = 0;
npieces = 4;

if (from < to) {
    nochanges = to - from;
    fromone = from + 1;
    //alert(n+' '+to+' '+fromone);
    for (n = fromone; n <= to; n++) {

        //alert('down');
        idnum = parseInt(document.getElementById(n).id,10);
        //alert(idnum);
        document.getElementById(n).getElementsByClassName('number')[0].innerHTML = (idnum - 1);
        alert(document.getElementById(n).id);
        document.getElementById(n).id = (idnum - 1);

        //alert('down '+idnum+' to '+(idnum-1));
    }

}

if (from > to) {
    nochanges = from - to;
    totone = to + 1;

    for (n = to; n < from; n++) {
        //alert('n is '+n+' going to '+to+' ends at '+totone);
        //alert('up');
        idnum = parseInt(document.getElementById(n).id,10);
        //alert(idnum);
        document.getElementById(n).getElementsByClassName('number')[0].innerHTML = (idnum + 1);
        alert(document.getElementById(n).id);
        document.getElementById(n).id = (idnum + 1);

        //alert('up '+idnum+' to '+(idnum+1));
    }

}

//tempdiv.id = 'span'+to;
if (from > to) {
    containr.insertBefore(tempdiv, before);
}

if (from < to) {
    before = to + 1;
    containr.insertBefore(tempdiv, document.getElementById(before));
}

tbc.parentNode.removeChild(tbc);

tempdiv.id = to;

document.getElementById('progress').innerHTML = 'done';

} 
```

当您向上或向下移动一个块（或 div）时，该脚本会起作用，但是当您尝试移动不同的块（例如顶部的块）时，它只会在其下方的前两个块周围切换。谁能给我任何建议？

我不知道是因为脚本完成的顺序，还是其他原因。这让我困惑了一段时间，如果有人能仔细阅读并给我一些建议，我将不胜感激。

（我不想用 jQuery 编写代码，这实际上只是我试图通过编写代码来学习更多 JavaScript。如果它不是最有效、最安全的，无论如何，它仍然只是我试图自学的东西JavaScript。）

感谢您的阅读。（请不要编辑 JS Fiddle 本身，而是在此处发布任何编辑/改进。谢谢。）

[编辑：我并不是真的在写陈词滥调的科幻小说，它们只是示例 div，因为我想不出更好的东西]

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T12:04:12.690

在语句中`neworder =...`，您更改`onclick`函数的值，但您只对即将移动的块执行此操作。问题是其他块也改变了位置。例如，如果您单击块 2 的“发送”，则块 2 会向上移动到位置 1，块 1 会向下移动到位置 2。但只有块 2 上的事件处理程序会相应更新。因此，下次您单击（最初的）块 1 时，它将无法正常运行。

一种解决方案是在每次移动其中一个时更新所有受影响的块上的事件处理程序。例如，调用一个函数`updateEventHandlers(blockNumber)`并为所有受影响的块调用它。

然而，依靠 ID 来指示块的位置，然后在移动后摆弄 ID 会导致各种混乱。最好保留一个数组或字典来记录块的位置，或者在每次要移动它们时循环它们以确定它们在 DOM 中的位置。

例如，下面的代码使用后一种方法提供了 moveup、movedown 和 moveto 函数（它找到元素在 DOM 中的位置，并将其与之前或之后的持有者交换）。( [JSFIDDLE](http://jsfiddle.net/mcWRb/4/) )

```
function E(id) { return document.getElementById(id);}
var holders = document.getElementsByClassName('holder');
function moveup(id) {
    for (var i = 0; i < holders.length - 1; i++) {
        // Find the holder before the one we're interested in
        if (holders[i + 1] == E(id)) {
            // Swap their positions
            E('alldivs').insertBefore(E(id), holders[i]);
            break;
        }
    }
    resetNumbers();
}
function movedown(id) {
    for (var i = 1; i < holders.length; i++) {
        // Find the holder after the one we're interested in
        if (holders[i - 1] == E(id)) {
            // Swap their positions
            E('alldivs').insertBefore(holders[i], E(id));
            break;
        }
    }
    resetNumbers();
}
function moveto(id, position) {
    if (position == holders.length) {  // move to end
        E('alldivs').appendChild(E(id));
    }
    else {                       // move before another holder
        E('alldivs').insertBefore(E(id), holders[position - 1]);
    }
    resetNumbers();
}
function resetNumbers() {
    // Reset all the numbers to reflect their current position
    var numbers = document.getElementsByClassName('number');
    for (var i = 0; i < numbers.length; i++) {
        numbers[i].innerHTML = i + 1;
    }
}​ 
```

其他几点：

*   单击`select`原始代码中的 s 最初不会执行任何操作，因为在移动元素之一之前没有为其分配事件处理程序
*   `</div>`html 末尾缺少一个
*   `var`使用代码中的某处声明变量是一种很好的做法
*   appendChild 和 insertBefore 在将节点追加/插入到新位置之前，从 DOM 中的当前位置移除节点，因此无需显式移除元素。
*   拥有 moveup 和 movedown 函数比只拥有 moveto 更好，后者需要您将当前、前面和后面的位置插入到 html 中，并在每次移动块时刷新它们。

# javascript - 镜像（和更改）输入字段 jquery

> ID：14077088
> 
> 赞同：0
> 
> 时间：2012-12-28T23:29:13.460
> 
> 标签：javascript, jquery

> **可能重复：**
> [用破折号替换空格并使用javascript使所有字母小写](https://stackoverflow.com/questions/1983648/replace-space-with-dash-and-make-all-letters-lower-case-using-javascript)

我有这段代码可以将输入字段镜像到另一个

```
$('#name').bind('keypress blur', function() {
    $('#slug').val($(this).val());
}); 
```

完美的！但是假设我需要对其进行镜像并进行一些更改。如果`#name`' 的 价值 是`My New Value`, 我 希望`#slug`' 的 价值 是`my-new-value`.

所以我猜我会在那里通过什么函数来使文本小写并用连字符替换空格？另外，这是最好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:32:24.307

可能重复[用破折号替换空格并使用javascript使所有字母小写](https://stackoverflow.com/questions/1983648/replace-space-with-dash-and-make-all-letters-lower-case-using-javascript)

```
$('#name').on('keypress blur', function() {
    var val = $(this).val();
    val = val.replace(/\s+/g, '-').toLowerCase();
    $('#slug').val(val);
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:32:21.477

您可以使用[`.toLowerCase()`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/String/replace)和的组合[`.replace()`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/String/replace)。

```
$(this).val().toLowerCase().replace(/[ ]/g, "-") 
```

# python - opencv - 相机 0 不工作

> ID：14077092
> 
> 赞同：0
> 
> 时间：2012-12-28T23:29:47.647
> 
> 标签：python, opencv, dependencies, webcam

我在 hp touchsmart 600 上运行 windows 7 64 位（32 位 python）。不久前我卸载然后重新安装了 opencv 2.4.3。在卸载和重新安装之间，我卸载了一些我认为没有被使用的程序。现在 opencv 仅在 opencv 能够正确访问我的网络摄像头之前显示黑屏。

但是，如果我使用摄像头 2（即 cam = create_capture(2,...)），opencv 能够正确使用我的网络摄像头。为什么camera 0突然停止工作？它是否以某种方式变成了摄像头 2，或者我是否可以卸载 opencv 访问我的网络摄像头所需的依赖项？此外，即使我只有一个网络摄像头，使用摄像头 1 和 3 也可以。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2016-10-18T06:43:25.117

摄像头 0 指向您的默认摄像头驱动程序，摄像头 1 指向您的辅助驱动程序，摄像头 2 指向您的第三个驱动程序，依此类推。

这意味着即使使用单个相机硬件，您也可以拥有多个可以访问它的驱动程序。

假设您的主凸轮驱动程序（可能由 HP 提供）在卸载过程中损坏。这意味着当您调用相机 0 时，您正在实例化 HP 驱动程序（现在已损坏），这会给您一个黑屏。

但是，由于您的摄像头硬件不受影响，二级和三级摄像头驱动程序也不受影响，因此当您访问摄像头 1 时，您的辅助摄像头驱动程序会正确流式传输实时源。

如果您没有第三个摄像头驱动程序，则摄像头 2 将指向辅助驱动程序。因此，如果没有驱动程序与摄像头 2 关联，则摄像头 2 将调用与摄像头 1 对应的驱动程序

# php - 用 facebook 查询结果更新 mysql 表

> ID：14077094
> 
> 赞同：2
> 
> 时间：2012-12-28T23:30:00.890
> 
> 标签：php, mysql

我有一张桌子，在那里我得到了 Facebook 事件 ID。

```
id    event_id    attendings
 1    12345678 
```

我将获取 event_id 并将其放入查询中：

```
$query = 'https://graph.facebook.com/fql?q=SELECT+attending_count+FROM+event+WHERE+eid='.$event_id.'&access_token='.$params1['access_token'];
$result = file_get_contents($query);
$obj = json_decode($result, true);
foreach ($obj['data'] as $item) { 
$attend = $item['attending_count'];
} 
```

现在我将使用 $attend 更新 event_id = 12345678 的表出席

问题是：我怎样才能用我表中的所有行来做到这一点

谢谢

对不起我的拼写，英语不是我的母语。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T23:38:56.953

`attending_count`您可以使用单个 FQL 查询获取所有所需的值，然后在结果的循环内更新现有表：

```
define('FB_FQL_API', 'https://graph.facebook.com/fql?');

$dbh = new PDO("mysql:dbname=$dbname", $username, $password);
$dbh->setAttribute(PDO::ATTR_EMULATE_PREPARES, FALSE);
$dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

$qry = $dbh->query('
  SELECT GROUP_CONCAT(event_id)
  FROM   my_table
');

$upd = $dbh->prepare('
  UPDATE my_table
  SET    attendings = :attend
  WHERE  event_id   = :event
');

$fql = '
  SELECT eid, attending_count
  FROM   event
  WHERE  eid IN ('.$qry->fetchColumn().')
';

$url = FB_FQL_API . http_build_query([
  'q'            => trim(preg_replace('/\s+/', ' ', $fql)),
  'access_token' => $params1['access_token']
]);

$res = json_decode(file_get_contents($url));

foreach ($res->data as $event) $upd->execute([
  ':attend' => $event->attending_count,
  ':event'  => $event->eid
]); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:46:17.543

看起来您需要在一个大循环中完成这一切，因为您必须为每个事件执行 facebook API 调用。

因此，第一步是使用您选择使用的任何 MySQL 库从表中获取所有结果。查询将是：

```
SELECT id, event_id FROM table; 
```

假设当您遍历结果集时，您将数据分配给这样的数组：

```
$array[$row['id']] = $row['event_id']; 
```

现在，您将像这样循环遍历该数组：

```
foreach($array as $db_id => $event_id) {
    // your facebook code here

    // update the database with your library of choice using this query
    UPDATE table SET attendings = $attending WHERE id = $db_id
} 
```

# amazon-web-services - AWS Elastic Beanstalk，运行 cronjob

> ID：14077095
> 
> 赞同：95
> 
> 时间：2012-12-28T23:30:22.703
> 
> 标签：amazon-web-services, cron, crontab, amazon-elastic-beanstalk

我想知道是否有办法设置一个 cronjob/task 每分钟执行一次。目前，我的任何实例都应该能够运行此任务。

这是我在配置文件中尝试做的但没有成功：

```
container_commands:
  01cronjobs:
    command: echo "*/1 * * * * root php /etc/httpd/myscript.php" 
```

我不确定这是否是正确的方法

有任何想法吗？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2013-03-05T20:50:17.063

## 这就是我向 Elastic Beanstalk 添加 cron 作业的方式：

在应用程序的根目录下创建一个名为 .ebextensions 的文件夹（如果该文件夹尚不存在）。然后在 .ebextensions 文件夹中创建一个配置文件。我将使用 example.config 进行说明。然后将其添加到 example.config

```
container_commands:
  01_some_cron_job:
    command: "cat .ebextensions/some_cron_job.txt > /etc/cron.d/some_cron_job && chmod 644 /etc/cron.d/some_cron_job"
    leader_only: true 
```

这是 Elastic Beanstalk 的 YAML 配置文件。确保将其复制到文本编辑器中时，文本编辑器使用空格而不是制表符。否则，当您将其推送到 EB 时，您会收到 YAML 错误。

所以它的作用是创建一个名为 01_some_cron_job 的命令。命令按字母顺序运行，因此 01 确保它作为第一个命令运行。

然后该命令获取名为 some_cron_job.txt 的文件的内容，并将其添加到 /etc/cron.d 中名为 some_cron_job 的文件中。

然后该命令更改 /etc/cron.d/some_cron_job 文件的权限。

leader_only 键确保该命令仅在被视为领导者的 ec2 实例上运行。而不是在您可能正在运行的每个 ec2 实例上运行。

然后在 .ebextensions 文件夹中创建一个名为 some_cron_job.txt 的文件。你将把你的 cron 作业放在这个文件中。

例如：

```
# The newline at the end of this file is extremely important.  Cron won't run without it.
* * * * * root /usr/bin/php some-php-script-here > /dev/null 
```

因此，这个 cron 作业将以 root 用户身份在每天每一小时的每一分钟运行，并将输出丢弃到 /dev/null。/usr/bin/php 是 php 的路径。然后将 some-php-script-here 替换为您的 php 文件的路径。这显然是假设您的 cron 作业需要运行 PHP 文件。

此外，请确保 some_cron_job.txt 文件在文件末尾有一个换行符，就像评论说的那样。否则 cron 将无法运行。

**更新：** 当 Elastic Beanstalk 扩展您的实例时，此解决方案存在问题。例如，假设您有一个正在运行 cron 作业的实例。您的流量会增加，因此 Elastic Beanstalk 最多可将您扩展到两个实例。leader_only 将确保您在两个实例之间只运行一个 cron 作业。您的流量会减少，而 Elastic Beanstalk 会将您缩减为一个实例。但是，Elastic Beanstalk 不会终止第二个实例，而是终止作为领导者的第一个实例。您现在没有运行任何 cron 作业，因为它们只在第一个终止的实例上运行。 **请参阅下面的评论。**

**更新 2：** 请从以下评论中明确说明：AWS 现在具有防止自动实例终止的保护。只需在您的领导者实例上启用它，您就可以开始了。– Nicolás Arévalo 2016 年 10 月 28 日在 9:23

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2015-02-25T12:48:29.463

# 这是现在（2015+）的官方方式。请先尝试一下，这是目前最简单且最可靠的方法。

根据当前的文档，可以在他们所谓的[工作层上](http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features-managing-env-tiers.html#worker-periodictasks)**运行定期任务**。

引用文档：

> AWS Elastic Beanstalk 支持在运行预定义配置的环境中对工作线程环境层执行定期任务，该配置的解决方案堆栈在容器名称中包含“v1.2.0”。您必须创建一个新环境。

同样有趣的是关于*cron.yaml*的部分：

> 要调用定期任务，您的应用程序源包必须在根级别包含一个 cron.yaml 文件。该文件必须包含有关您要安排的定期任务的信息。使用标准 crontab 语法指定此信息。

**更新：**我们能够完成这项工作。以下是我们经验中的一些重要问题（Node.js 平台）：

*   使用*cron.yaml*文件时，请确保您拥有最新[的 awsebcli](https://pypi.python.org/pypi/awsebcli/3.2.2)，因为旧版本将无法正常工作。
*   创造新环境也很重要（至少在我们的例子中是这样），而不仅仅是克隆旧环境。
*   如果您想确保您的 EC2 Worker Tier 实例支持 CRON，请通过 ssh 进入它 ( `eb ssh`)，然后运行`cat /var/log/aws-sqsd/default.log`​​. 它应该报告为`aws-sqsd 2.0 (2015-02-18)`. 如果您没有 2.0 版本，则在创建环境时出现问题，您需要按上述方式创建新环境。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2013-01-01T13:44:04.373

关于 jamieb 的响应，正如 alrdinleal 所提到的，您可以使用“leader_only”属性来确保只有一个 EC2 实例运行 cron 作业。

引自[http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/customize-containers-ec2.html](http://docs.amazonwebservices.com/elasticbeanstalk/latest/dg/customize-containers-ec2.html)：

> 你可以使用leader_only。一个实例被选为 Auto Scaling 组中的领导者。如果 leader_only 值设置为 true，则该命令仅在标记为领导者的实例上运行。

我试图在我的 eb 上实现类似的事情，所以如果我解决它会更新我的帖子。

**更新：**

好的，我现在有使用以下 eb 配置的工作 cronjobs：

```
files:
  "/tmp/cronjob" :
    mode: "000777"
    owner: ec2-user
    group: ec2-user
    content: |
      # clear expired baskets
      */10 * * * * /usr/bin/wget -o /dev/null http://blah.elasticbeanstalk.com/basket/purge > $HOME/basket_purge.log 2>&1
      # clean up files created by above cronjob
      30 23 * * * rm $HOME/purge*
    encoding: plain 
container_commands:
  purge_basket: 
    command: crontab /tmp/cronjob
    leader_only: true
commands:
  delete_cronjob_file: 
    command: rm /tmp/cronjob 
```

本质上，我使用 cronjobs 创建了一个临时文件，然后将 crontab 设置为从临时文件中读取，然后删除临时文件。希望这可以帮助。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2014-07-17T18:08:25.770

如上所述，建立任何 crontab 配置的根本缺陷是它只发生在部署时。随着集群自动扩展，然后又缩减，最好也成为第一个关闭的服务器。此外，不会有故障转移，这对我来说至关重要。

我做了一些研究，然后与我们的 AWS 客户专家交谈，以提出想法并验证我提出的解决方案。您可以使用[OpsWorks](http://aws.amazon.com/documentation/opsworks/)完成此操作，尽管这有点像用房子杀死苍蝇。也可以将[Data Pipeline 与 Task Runner](http://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/dp-using-task-runner.html)一起使用，但这限制了它可以执行的脚本的能力，并且我需要能够运行 PHP 脚本，并且可以访问整个代码库。您还可以在 ElasticBeanstalk 集群之外专门使用一个 EC2 实例，但随后您将无法再进行故障转移。

所以这就是我想出的，这显然是非常规的（正如 AWS 代表评论的那样），可能被认为是一种 hack，但它可以工作并且在故障转移方面很可靠。我选择了使用 SDK 的编码解决方案，我将在 PHP 中展示它，尽管您可以使用任何您喜欢的语言执行相同的方法。

```
// contains the values for variables used (key, secret, env)
require_once('cron_config.inc'); 

// Load the AWS PHP SDK to connection to ElasticBeanstalk
use Aws\ElasticBeanstalk\ElasticBeanstalkClient;

$client = ElasticBeanstalkClient::factory(array(
    'key' => AWS_KEY,
    'secret' => AWS_SECRET,
    'profile' => 'your_profile',
    'region'  => 'us-east-1'
));

$result = $client->describeEnvironmentResources(array(
    'EnvironmentName' => AWS_ENV
));

if (php_uname('n') != $result['EnvironmentResources']['Instances'][0]['Id']) {
    die("Not the primary EC2 instance\n");
} 
```

因此，逐步了解它以及它是如何运行的......您可以像通常在每个 EC2 实例上一样从 crontab 调用脚本。每个脚本在开头都包含这个（或者在我使用它时，每个脚本都包含一个文件），它建立一个 ElasticBeanstalk 对象并检索所有实例的列表。它只使用列表中的第一个服务器，并检查它是否与自己匹配，如果匹配，它会继续，否则它会死掉并关闭。我检查过，返回的列表似乎是一致的，从技术上讲，它只需要保持一分钟左右的一致，因为每个实例都执行预定的 cron。如果它确实发生了变化，那也没关系，因为它再次只与那个小窗口相关。

这绝不是优雅的，但适合我们的特定需求 - 这不是增加额外服务的成本或必须拥有专用的 EC2 实例，并且在发生任何故障时将进行故障转移。我们的 cron 脚本运行维护脚本，这些脚本被放置到 SQS 中，并且集群中的每个服务器都帮助执行。如果它符合您的需要，至少这可能会给您一个替代选择。

-戴维

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-09-26T08:23:49.993

我与 AWS 支持代理进行了交谈，这就是我们如何让它为我工作的方式。2015年解决方案：

使用 your_file_name.config 在 .ebextensions 目录中创建一个文件。在配置文件中输入：

```
文件：
  “/etc/cron.d/cron_example”：
    模式：“000644”
    所有者：根
    组：根
    内容：|
      * * * * * 根 /usr/local/bin/cron_example.sh

  “/usr/local/bin/cron_example.sh”：
    模式：“000755”
    所有者：根
    组：根
    内容：|
      #!/bin/bash

      /usr/local/bin/test_cron.sh || 出口
      echo "Cron 在 "`date` >> /tmp/cron_example.log 运行
      # 现在执行只能在 1 个实例上运行的任务 ...

  “/usr/local/bin/test_cron.sh”：
    模式：“000755”
    所有者：根
    组：根
    内容：|
      #!/bin/bash

      METADATA=/opt/aws/bin/ec2-元数据
      INSTANCE_ID=`$METADATA -i | awk '{打印 $2}'`
      地区=`$元数据-z | awk '{print substr($2, 0, length($2)-1)}'`

      # 找到我们的 Auto Scaling 组名称。
      ASG=`aws ec2 describe-tags --filters "Name=resource-id,Values=$INSTANCE_ID" \
        --region $REGION --输出文本 | awk '/aws:autoscaling:groupName/ {print $5}'`

      # 查找组中的第一个实例
      FIRST=`aws 自动缩放 describe-auto-scaling-groups --auto-scaling-group-names $ASG \
        --region $REGION --输出文本 | awk '/InService$/ {打印 $4}' | 排序 | 头-1`

      # 测试它们是否相同。
      [“$FIRST”=“$INSTANCE_ID”]

命令：
  rm_old_cron：
    命令：“rm *.bak”
    cwd：“/etc/cron.d”
    忽略错误：真

```

该解决方案有两个缺点：

1.  在后续部署中，Beanstalk 将现有的 cron 脚本重命名为 .bak，但 cron 仍将运行它。您的 Cron 现在在同一台机器上执行两次。
2.  如果您的环境扩展，您将获得多个实例，所有实例都运行您的 cron 脚本。这意味着您的邮件截图被重复，或者您的数据库档案被重复

解决方法：

1.  确保任何创建 cron 的 .ebextensions 脚本也会在后续部署中删除 .bak 文件。
2.  有一个帮助脚本，它执行以下操作： -- 从元数据获取当前实例 ID -- 从 EC2 标签获取当前 Auto Scaling 组名称 -- 获取该组中的 EC2 实例列表，按字母顺序排序。-- 从该列表中获取第一个实例。-- 将第 1 步中的实例 ID 与第 4 步中的第一个实例 ID 进行比较。然后您的 cron 脚本可以使用此帮助程序脚本来确定它们是否应该执行。

警告：

*   用于 Beanstalk 实例的 IAM 角色需要 ec2:DescribeTags 和 autoscaling:DescribeAutoScalingGroups 权限
*   从中选择的实例是 Auto Scaling 显示为 InService 的实例。这并不一定意味着它们已完全启动并准备好运行您的 cron。

如果您使用默认 beanstalk 角色，则无需设置 IAM 角色。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-06-24T21:58:40.477

如果您使用的是 Rails，则可以使用[ever-elasticbeanstalk gem](https://github.com/dignoe/whenever-elasticbeanstalk)。它允许您在所有实例或仅一个实例上运行 cron 作业。它每分钟检查一次以确保只有一个“leader”实例，如果没有，它将自动将一台服务器提升为“leader”。这是必需的，因为 Elastic Beanstalk 在部署期间仅具有领导者的概念，并且可能在扩展时随时关闭任何实例。

**更新** 我改用 AWS OpsWorks 并且不再维护这个 gem。如果您需要的功能超出了 Elastic Beanstalk 基础知识中的可用功能，我强烈建议您切换到 OpsWorks。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2012-12-31T19:06:34.940

您真的不想在 Elastic Beanstalk 上运行 cron 作业。由于您将拥有多个应用程序实例，这可能会导致竞争条件和其他奇怪的问题。实际上，我[最近在博客上写过这个](http://www.jamiebegin.com/migrating-to-aws-developers-checklist/)（页面下方的第 4 或第 5 个提示）。[简短版本：根据应用程序，使用 SQS 之类的作业队列或iron.io 之](http://www.iron.io)类的第三方解决方案。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-02-24T11:25:35.390

## 2017：如果你使用 Laravel5+

*你只需要 2 分钟来配置它：*

*   创建工人层
*   安装 laravel-aws-worker

    `composer require dusterio/laravel-aws-worker`

*   将 cron.yaml 添加到根文件夹：

> 将 cron.yaml 添加到应用程序的根文件夹（这可以是您的存储库的一部分，或者您可以在部署到 EB 之前添加此文件 - 重要的是此文件在部署时存在）：

```
version: 1
cron:
 - name: "schedule"
   url: "/worker/schedule"
   schedule: "* * * * *" 
```

## 而已！

`App\Console\Kernel`现在将执行您的所有任务

详细说明和解释：[https ://github.com/dusterio/laravel-aws-worker](https://github.com/dusterio/laravel-aws-worker)

如何在 Laravel 中编写任务：[https ://laravel.com/docs/5.4/scheduling](https://laravel.com/docs/5.4/scheduling)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-03-27T13:11:03.657

使用`files`代替的更易读的解决方案`container_commands`：

```
文件：
  “/etc/cron.d/my_cron”：
    模式：“000644”
    所有者：根
    组：根
    内容：|
      # 覆盖默认电子邮件地址
      MAILTO="example@gmail.com"
      # 每五分钟运行一次 Symfony 命令（作为 ec2-user）
      */10 * * * * ec2-user /usr/bin/php /var/app/current/app/console do:something
    编码：普通
命令：
  # 删除 Elastic Beanstalk 创建的备份文件
  clear_cron_backup：
    命令：rm -f /etc/cron.d/watson.bak

```

请注意，该格式与通常的 crontab 格式不同，因为它指定了运行命令的用户。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-03-16T16:40:56.473

我2018年的1分钱

这是正确的方法（使用`django/python`和`django_crontab`应用程序）：

在`.ebextensions`文件夹内创建一个像这样的文件`98_cron.config`：

```
files:
  "/tmp/98_create_cron.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/sh
      cd /
      sudo /opt/python/run/venv/bin/python /opt/python/current/app/manage.py crontab remove > /home/ec2-user/remove11.txt
      sudo /opt/python/run/venv/bin/python /opt/python/current/app/manage.py crontab add > /home/ec2-user/add11.txt 

container_commands:
    98crontab:
        command: "mv /tmp/98_create_cron.sh /opt/elasticbeanstalk/hooks/appdeploy/post && chmod 774 /opt/elasticbeanstalk/hooks/appdeploy/post/98_create_cron.sh"
        leader_only: true 
```

它需要`container_commands`代替`commands`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-10-20T05:05:14.663

当新的领导者出现时，有人想知道leader_only 的自动缩放问题。我似乎不知道如何回复他们的评论，但请参阅此链接：[http ://blog.paulopoiati.com/2013/08/25/running-cron-in-elastic-beanstalk-auto-scaling-环境/](http://blog.paulopoiati.com/2013/08/25/running-cron-in-elastic-beanstalk-auto-scaling-environment/)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-12-29T14:02:17.463

来自亚马逊的最新示例是最简单和最有效的（周期性任务）：

[https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features-managing-env-tiers.html](https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/using-features-managing-env-tiers.html)

您可以在其中创建一个单独的工作层来执行您的任何 cron 作业。创建 cron.yaml 文件并将其放在您的根文件夹中。我遇到的一个问题（在 cron 似乎没有执行之后）是发现我的 CodePipeline 无权执行 dynamodb 修改。基于此，在 IAM -> 角色 -> yourpipeline 下添加 FullDynamoDB 访问并重新部署（弹性 beantalk）后，它运行良好。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-05-26T14:45:04.623

所以我们已经为此苦苦挣扎了一段时间，在与 AWS 代表讨论后，我终于想出了我认为最好的解决方案。

使用带有 cron.yaml 的工作层绝对是最简单的解决方法。但是，文档没有明确说明的是，这会将作业置于您用于实际运行作业的 SQS 队列的*末尾。*如果您的 cron 作业对时间敏感（很多都是），这是不可接受的，因为它取决于队列的大小。一种选择是使用完全独立的环境来运行 cron 作业，但我认为这太过分了。

其他一些选项（例如检查您是否是列表中的第一个实例）也不理想。如果当前的第一个实例正在关闭过程中怎么办？

实例保护也可能带来问题 - 如果该实例被锁定/冻结怎么办？

重要的是要了解 AWS 本身如何管理 cron.yaml 功能。有一个 SQS 守护进程使用 Dynamo 表来处理“领导选举”。它频繁地写入这张表，如果当前的leader短时间内没有写入，下一个实例将接替成为leader。这是守护进程决定哪个实例将作业触发到 SQS 队列的方式。

我们可以重新利用现有功能，而不是尝试重写我们自己的功能。你可以在这里看到完整的解决方案：[https ://gist.github.com/dorner/4517fe2b8c79ccb3971084ec28267f27](https://gist.github.com/dorner/4517fe2b8c79ccb3971084ec28267f27)

那是在 Ruby 中，但您可以轻松地将其调整为具有 AWS 开发工具包的任何其他语言。本质上，它检查当前领导者，然后检查状态以确保其处于良好状态。它将循环直到有一个处于良好状态的当前领导者，如果当前实例是领导者，则执行作业。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-08-25T23:49:28.330

以下是解决方案的完整说明：

[http://blog.paulopoiati.com/2013/08/25/running-cron-in-elastic-beanstalk-auto-scaling-environment/](http://blog.paulopoiati.com/2013/08/25/running-cron-in-elastic-beanstalk-auto-scaling-environment/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-04-22T17:32:26.830

根据[user1599237](https://stackoverflow.com/a/24810602/2404541)的回答原则，您让 cron 作业在所有实例上运行，但是在作业开始时确定是否应该允许它们运行，我提出了另一个解决方案。

我没有查看正在运行的实例（并且必须存储您的 AWS 密钥和秘密），而是使用我已经从所有实例连接到的 MySQL 数据库。

**它没有缺点，只有优点：**

*   没有额外的实例或费用
*   坚如磐石的解决方案 - 没有双重执行的机会
*   可扩展 - 随着您的实例扩展和缩减自动工作
*   故障转移 - 在实例发生故障时自动工作

或者，您也可以使用通常共享的文件系统（例如通过 NFS 协议的[AWS EFS ）而不是数据库。](https://aws.amazon.com/efs/)

以下解决方案是在 PHP 框架[Yii](https://www.yiiframework.com/)中创建的，但您可以轻松地将其调整为其他框架和语言。异常处理程序`Yii::$app->system`也是我自己的一个模块。用你正在使用的任何东西替换它。

```
/**
 * Obtain an exclusive lock to ensure only one instance or worker executes a job
 *
 * Examples:
 *
 * `php /var/app/current/yii process/lock 60 empty-trash php /var/app/current/yii maintenance/empty-trash`
 * `php /var/app/current/yii process/lock 60 empty-trash php /var/app/current/yii maintenance/empty-trash StdOUT./test.log`
 * `php /var/app/current/yii process/lock 60 "empty trash" php /var/app/current/yii maintenance/empty-trash StdOUT./test.log StdERR.ditto`
 * `php /var/app/current/yii process/lock 60 "empty trash" php /var/app/current/yii maintenance/empty-trash StdOUT./output.log StdERR./error.log`
 *
 * Arguments are understood as follows:
 * - First: Duration of the lock in minutes
 * - Second: Job name (surround with quotes if it contains spaces)
 * - The rest: Command to execute. Instead of writing `>` and `2>` for redirecting output you need to write `StdOUT` and `StdERR` respectively. To redirect stderr to stdout write `StdERR.ditto`.
 *
 * Command will be executed in the background. If determined that it should not be executed the script will terminate silently.
 */
public function actionLock() {
    $argsAll = $args = func_get_args();
    if (!is_numeric($args[0])) {
        \Yii::$app->system->error('Duration for obtaining process lock is not numeric.', ['Args' => $argsAll]);
    }
    if (!$args[1]) {
        \Yii::$app->system->error('Job name for obtaining process lock is missing.', ['Args' => $argsAll]);
    }

    $durationMins = $args[0];
    $jobName = $args[1];
    $instanceID = null;
    unset($args[0], $args[1]);

    $command = trim(implode(' ', $args));
    if (!$command) {
        \Yii::$app->system->error('Command to execute after obtaining process lock is missing.', ['Args' => $argsAll]);
    }

    // If using AWS Elastic Beanstalk retrieve the instance ID
    if (file_exists('/etc/elasticbeanstalk/.aws-eb-system-initialized')) {
        if ($awsEb = file_get_contents('/etc/elasticbeanstalk/.aws-eb-system-initialized')) {
            $awsEb = json_decode($awsEb);
            if (is_object($awsEb) && $awsEb->instance_id) {
                $instanceID = $awsEb->instance_id;
            }
        }
    }

    // Obtain lock
    $updateColumns = false;  //do nothing if record already exists
    $affectedRows = \Yii::$app->db->createCommand()->upsert('system_job_locks', [
        'job_name' => $jobName,
        'locked' => gmdate('Y-m-d H:i:s'),
        'duration' => $durationMins,
        'source' => $instanceID,
    ], $updateColumns)->execute();
    // The SQL generated: INSERT INTO system_job_locks (job_name, locked, duration, source) VALUES ('some-name', '2019-04-22 17:24:39', 60, 'i-HmkDAZ9S5G5G') ON DUPLICATE KEY UPDATE job_name = job_name

    if ($affectedRows == 0) {
        // record already exists, check if lock has expired
        $affectedRows = \Yii::$app->db->createCommand()->update('system_job_locks', [
                'locked' => gmdate('Y-m-d H:i:s'),
                'duration' => $durationMins,
                'source' => $instanceID,
            ],
            'job_name = :jobName AND DATE_ADD(locked, INTERVAL duration MINUTE) < NOW()', ['jobName' => $jobName]
        )->execute();
        // The SQL generated: UPDATE system_job_locks SET locked = '2019-04-22 17:24:39', duration = 60, source = 'i-HmkDAZ9S5G5G' WHERE job_name = 'clean-trash' AND DATE_ADD(locked, INTERVAL duration MINUTE) < NOW()

        if ($affectedRows == 0) {
            // We could not obtain a lock (since another process already has it) so do not execute the command
            exit;
        }
    }

    // Handle redirection of stdout and stderr
    $command = str_replace('StdOUT', '>', $command);
    $command = str_replace('StdERR.ditto', '2>&1', $command);
    $command = str_replace('StdERR', '2>', $command);

    // Execute the command as a background process so we can exit the current process
    $command .= ' &';

    $output = []; $exitcode = null;
    exec($command, $output, $exitcode);
    exit($exitcode);
} 
```

这是我正在使用的数据库架构：

```
CREATE TABLE `system_job_locks` (
    `job_name` VARCHAR(50) NOT NULL,
    `locked` DATETIME NOT NULL COMMENT 'UTC',
    `duration` SMALLINT(5) UNSIGNED NOT NULL COMMENT 'Minutes',
    `source` VARCHAR(255) NULL DEFAULT NULL,
    PRIMARY KEY (`job_name`)
) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-05-15T03:12:10.830

如果您想在 PHP 中执行此操作，这是一个修复程序。您只需要 .ebextensions 文件夹中的 cronjob.config 就可以让它像这样工作。

```
files:
  "/etc/cron.d/my_cron":
    mode: "000644"
    owner: root
    group: root
    content: |
        empty stuff
    encoding: plain
commands:
  01_clear_cron_backup:
    command: "rm -f /etc/cron.d/*.bak"
  02_remove_content:
    command: "sudo sed -i 's/empty stuff//g' /etc/cron.d/my_cron"
container_commands:
  adding_cron:
    command: "echo '* * * * * ec2-user . /opt/elasticbeanstalk/support/envvars && /usr/bin/php /var/app/current/index.php cron sendemail > /tmp/sendemail.log 2>&1' > /etc/cron.d/my_cron"
    leader_only: true 
```

envvars 获取文件的环境变量。您可以如上所述在 tmp/sendemail.log 上调试输出。

希望这对某人有所帮助，因为它肯定对我们有所帮助！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-08-10T20:23:08.907

> 要控制 Auto Scaling 是否可以在缩减时终止特定实例，请使用实例保护。您可以在 Auto Scaling 组或单个 Auto Scaling 实例上启用实例保护设置。当 Auto Scaling 启动实例时，该实例会继承 Auto Scaling 组的实例保护设置。您可以随时更改 Auto Scaling 组或 Auto Scaling 实例的实例保护设置。

[http://docs.aws.amazon.com/autoscaling/latest/userguide/as-instance-termination.html#instance-protection](http://docs.aws.amazon.com/autoscaling/latest/userguide/as-instance-termination.html#instance-protection)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-08-22T09:25:11.710

如果需要通过 cron 运行 php 文件并且设置了任何 NAT 实例，那么我有另一个解决方案，那么您可以将 cronjob 放在 NAT 实例上并通过 wget 运行 php 文件。

# ruby-on-rails - Rails rake 中止！无法将哈希转换为字符串

> ID：14077097
> 
> 赞同：1
> 
> 时间：2012-12-28T23:31:06.570
> 
> 标签：ruby-on-rails, ruby, ruby-on-rails-3

好的，我有这个工作，我不确定我可以改变什么以使`rake db:create`现在不工作。我跑去`rake db:drop`删除我的数据库，这样我就可以从头开始，现在`rake db:create`遇到了问题。

下面是我的堆栈跟踪。我不确定如何解决此问题。

```
$ rake db:create --trace
** Invoke db:create (first_time)
** Invoke db:load_config (first_time)
** Invoke rails_env (first_time)
** Execute rails_env
** Execute db:load_config
** Execute db:create
rake aborted!
can't convert Hash into String
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/mysql2-0.3.11/lib/mysql2/client.rb:44:in `connect'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/mysql2-0.3.11/lib/mysql2/client.rb:44:in `initialize'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/mysql2_adapter.rb:17:in `new'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/mysql2_adapter.rb:17:in `mysql2_connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:304:in `new_connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:323:in `checkout_new_connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:265:in `block (2 levels) in checkout'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:261:in `loop'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:261:in `block in checkout'
/Users/TomCaflisch/.rvm/rubies/ruby-1.9.3-p327/lib/ruby/1.9.1/monitor.rb:211:in `mon_synchronize'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:260:in `checkout'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:162:in `connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_pool.rb:409:in `retrieve_connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_specification.rb:115:in `retrieve_connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/connection_adapters/abstract/connection_specification.rb:89:in `connection'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/railties/databases.rake:86:in `rescue in create_database'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/railties/databases.rake:54:in `create_database'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/activerecord-3.1.8/lib/active_record/railties/databases.rake:42:in `block (2 levels) in <top (required)>'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:227:in `call'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:227:in `block in execute'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:222:in `each'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:222:in `execute'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:166:in `block in invoke_with_call_chain'
/Users/TomCaflisch/.rvm/rubies/ruby-1.9.3-p327/lib/ruby/1.9.1/monitor.rb:211:in `mon_synchronize'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:159:in `invoke_with_call_chain'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/task.rb:152:in `invoke'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:141:in `invoke_task'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:99:in `block (2 levels) in top_level'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:99:in `each'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:99:in `block in top_level'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:108:in `run_with_threads'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:93:in `top_level'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:71:in `block in run'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:158:in `standard_exception_handling'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/lib/rake/application.rb:68:in `run'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/gems/rake-10.0.2/bin/rake:37:in `<top (required)>'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/bin/rake:19:in `load'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/bin/rake:19:in `<main>'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/bin/ruby_noexec_wrapper:14:in `eval'
/Users/TomCaflisch/.rvm/gems/ruby-1.9.3-p327@famnfo/bin/ruby_noexec_wrapper:14:in `<main>'
Tasks: TOP => db:create 
```

数据库.yml

```
# SQLite version 3.x
#   gem install sqlite3
#
#   Ensure the SQLite 3 gem is defined in your Gemfile
#   gem 'sqlite3'
development:
  adapter: mysql2
  encoding: utf8
  database: FamNFo_development

  # local
  username: root
  password: 

  # server
  # username: famnfo_dev
  # password: Panther89!1

  # local
  socket: /tmp/mysql.sock

  # server
  # socket: /var/lib/mysql/mysql.sock 

# Warning: The database defined as "test" will be erased and
# re-generated from your development database when you run "rake".
# Do not set this db to the same as development or production.
test:
  adapter: mysql2
  encoding: utf8
  database: FamNFo_test
  # local
  # username: root
  # password: 

  # server
  username: root
  password: 

  # local
   socket: /tmp/mysql.sock

  # server
  #socket: /var/lib/mysql/mysql.sock 

production:
  adapter: mysql2
  encoding: utf8
  database: FamNFo_production
  # local
  # username: root
  # password: 

  # server
  username: myusername
  password: mypassword

  # local
  # socket: /tmp/mysql.sock

  # server
  socket: /var/lib/mysql/mysql.sock 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:14:16.360

当 YAML 文件中的键之前有额外的前导空格时，它会被解释为子键，因此上面的键被解释为哈希而不是字符串。因此，在测试部分之前删除多余的空间`socket`应该可以解决问题。

# php - 将定价表简化为多种不同格式？

> ID：14077100
> 
> 赞同：0
> 
> 时间：2012-12-28T23:31:27.467
> 
> 标签：php, sql, xml, excel

在我的公司，我们有一个 Excel 主定价表，我们会不断更新。但是，我们在 InDesign、Excel、我们的网站（带有 MYSQL 数据库）和第 3 方网站上有营销材料。每个月我们都会更新我们的价格，我们必须手动更新所有价格，这需要大量工作，并且容易出错。

我相信今天有这么多东西，有一种方法可以从我们的主表中简化所有这些，所以我们只需要更新主表，其余的可以自动更新..

任何人都可以为我提出一个解决方案，或者至少是一个好的方向吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:50:34.180

我会采取的方法是将主表移动到数据库中。这将允许我创建一个简单的基于 Web 的 gui，它使用 Web 服务和基于角色的身份验证。Web 服务将生成 xml、csv 等。这将进一步允许集中管理定价，从而防止流氓经理/销售人员损害公司的底线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:49:10.617

我不同意 Woot4Moo 的建议，但业务现实（成本、经验、持续维护）可能会阻止您将 Excel 用作主价目表。幸运的是，Excel 作为简单查询的 ODBC 兼容数据源可以正常工作。

假设 Excel 主工作表位于可访问的位置（即在共享网络驱动器上，而不是某人的 PC 上），您可以从 MySQL、Excel 和 InDesign 创建 ODBC 连接以提取数据。第三方网站可能会更困难，因为它们无法访问您的网络（即使您迁移到内部 RDBMS 也是如此，尽管您可以创建 API）。

有关 Excel 连接字符串的示例，请参见[此处](http://www.connectionstrings.com/excel)和[此处](http://www.connectionstrings.com/excel-2007)。

# xcode - 为 iPhone 4 和 5 开发还需要@2x？

> ID：14077105
> 
> 赞同：3
> 
> 时间：2012-12-28T23:32:10.580
> 
> 标签：xcode, iphone-5

如果只开发 3.5 和 4 英寸的视网膜屏幕，我还需要 foo@2x.png 吗？或者我可以只做 foo.png

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T02:42:50.327

如果您的应用仅适用于 Retina 显示器，那么您只需要 @2x 图像而不是常规图像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-28T23:38:00.563

简短的回答，是的，建议您使用普通图像和高分辨率图像。在 Retina 设备上，它会自动获取您图像的 @2x.png 版本。

如果不可用，则它将拍摄低分辨率图片。

# oracle - 使用 VS2010 连接到 Oracle 数据库（在 VMware Linux RedHat 5.4 上）

> ID：14077108
> 
> 赞同：0
> 
> 时间：2012-12-28T23:32:38.223
> 
> 标签：oracle, vmware

我有win7 home basic，在我的VMware上我有linux red hat 5.4。我在那个 linux 上创建了 oracle 数据库。

我在问：我可以从我的 win7 端将那个 oracle 数据库连接到 VS2010 吗？

那可能吗 ？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T13:17:08.177

虚拟机内部的 Oracle 可以接受连接。确保允许 vm 上的网络设置并且 Linux 防火墙接受对 Oracle 数据库的请求（端口已打开）。我假设您启动了数据库和侦听器，并且您正确设置和使用了 Oracle 客户端（ODBC、OCI、...）

# c# - 骨干网和mvc

> ID：14077109
> 
> 赞同：0
> 
> 时间：2012-12-28T23:32:46.937
> 
> 标签：c#, asp.net-mvc, backbone.js, model, controller

我有一个 Backbone 项目，其中有以下模型，我想将其传递给 .NET 以进行数据库更新。

```
var myList = Backbone.Model.extend({

    // Default attributes for the todo item.
    defaults: function () {
        return {
            Name: "Default name"
        };
    },

    url: "/my/myList",

    "sync": mySyncFunction,

    // Ensure that each todo created has `title`.
    initialize: function () {
        if (!this.get("Name")) {
            this.set({ "Name": this.defaults.Name });
        }
    }
}); 
```

使用以下内容覆盖同步

```
function mySyncFunction(method, model, options) {
    if (method == 'GET') {

        options.url = model.url;
    }
    else if (method == "create") {

        options.url = model.url+"Post";
    }
    else {

        options.url = model.url;
    }

    Backbone.emulateJSON = true

    return Backbone.sync(method, model, options);
} 
```

创建新项目时，它使用我假设的 model.url+"Post" 并且 model.get("Name") 包含正确的数据。执行了正确的部分并创建了数据库中的条目，但名称为空。

虽然当 .NET 控制器处理帖子时，名称不再包含任何数据。

我的控制器代码如下所示。

```
 public class myController : Controller
    {

        public ActionResult myList()
        {

            List<myCore.myList> l = new List<myCore.myList>();
            l = myCore.myList.ListAll();
            return Json(l, JsonRequestBehavior.AllowGet);

        }

        [HttpPost]
        public ActionResult myListPost(myCore.myList doc)
        {

            doc.AccountGuid = Guid.NewGuid();

            Boolean created = doc.Create();

            return Json(doc);
        }

        [HttpPut]
        public ActionResult myListPut(myCore.myList doc)
        {

            myCore.myList doc1 = new myCore.myList();
            doc1.AccountGuid = Guid.Empty;
            doc1.Name = "testPut";
            Boolean created = doc1.Create();

            return Json(doc1);
        }

        [HttpDelete]
        public ActionResult myListDelete(myCore.myList doc)
        {
            //DeleteDoc(id);
            myCore.myList doc1 = new myCore.myList();
            doc1.id = Guid.NewGuid();
            doc1.AccountGuid = Guid.Empty;
            doc1.Name = "testDelete";
            Boolean created = doc1.Create();

            return Json(doc1);
        }
    } 
```

谁能告诉我如何将模型/类数据输入控制器。

myList 类看起来像这样。

```
public class myList
        {
            Guid _id = Guid.Empty;
            String _name = String.Empty;
            Guid _accountGuid = Guid.Empty;
            public Guid id
            {
                get { return _id; }
                set { _id = value; }
            }

            public String Name
            {
                get { return _name; }
                set { _name = value; }
            }

            public Guid AccountGuid
            {
                get { return _accountGuid; }
                set { _accountGuid = value; }
            }
} 
```

**更新**

现在看起来它在删除 Backbone.emulateJSON = true 后可以工作

虽然我仍然无法让我的删除部分工作。它出现了 404 错误。只有 Post and Get 有效。

它在控制器中看起来像这样。

```
[ActionName("myList")]
    [HttpDelete]
    public ActionResult myListDelete(myCore.myList doc)
    {

        doc.Name += "-DELETE";

        return Json(doc);
    } 
```

**更新**

也想出了那个。

[ASP.NET 处理 PUT/DELETE 动词](https://stackoverflow.com/questions/11155528/asp-net-handle-put-delete-verbs)

尽管我似乎可以传递任何模型或参数以删除数据库中的正确条目。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T03:12:22.773

将您的默认设置更改为

```
defaults: {
     Name: "Default name"
}, 
```

# algorithm - 有效地将相似的数字组合在一起

> ID：14077110
> 
> 赞同：0
> 
> 时间：2012-12-28T23:32:54.807
> 
> 标签：algorithm, math, language-agnostic, statistics, cluster-analysis

> **可能重复：**
> [一维数数组聚类](https://stackoverflow.com/questions/11513484/1d-number-array-clustering)

我有一个数字数组，例如`[1, 20, 300, 45, 5, 60, 10, 270, 3]`. 什么是基于接近度将这些数字分组在一起的有效算法？在这种情况下，我希望像`[1, 3, 5]`,`[20, 45, 60]`和`[270, 300]`。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:02:03.863

您所问的最难的部分是如何实际定义接近度。您希望输出来自`[5,10,15,20]`什么？会是与 for 相同的分组`[500,1000,1500,2000]`吗？

怎么样`[1,2,3,5,7,8,9]`？应该是一组还是三组？（或两个？）。
怎么样`[1,2,3,5,7,8,9,1075,4000]`？1075 和 4000 会组合在一起吗？较小数字的分组是否会因样本中的较大数字而改变？

这个问题是整个机器学习领域都在问的问题：[聚类分析](http://en.wikipedia.org/wiki/Cluster_analysis) 也许这个[相关的问题](https://stackoverflow.com/questions/6147466/what-clustering-algorithm-to-use-on-1-d-data)会有所帮助？

我认为您想要的是[K-means 聚类](http://en.wikipedia.org/wiki/K-means_clustering)（在相关问题中有助于链接到），但您需要知道要将数据分成多少组才能使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-28T23:51:50.757

这可能是大材小用，但您可能想研究**[层次聚类算法](http://en.wikipedia.org/wiki/Hierarchical_clustering)**。这些算法将值组合成一个层次结构，您可以从中轻松提取最佳的 k 个集群。凝聚聚类可能是这些方法中最容易实现的，并且根据经验，它往往会产生非常好的聚类。

希望这可以帮助！

# python - 如何查找变量中的字节数？

> ID：14077112
> 
> 赞同：1
> 
> 时间：2012-12-28T23:33:08.130
> 
> 标签：python

> **可能重复：**
> [如何确定 Python 中对象的大小？](https://stackoverflow.com/questions/449560/how-do-i-determine-the-size-of-an-object-in-python)

如果我这样做，在 C 中

```
USHORT x;
ULONG y;
ULONGLONG yy;

printf("%d %d %d\n", sizeof(x), sizeof(y), sizeof(yy)) 
```

输出：2 4 8

如果我要如何在 Python 中得到它

```
valByte = 0x16
valWord = 0x1234
valDWord = 0x12345678
val64Word = 0x1234567887654321 
```

我期望的输出应该是 1, 2, 4, 8

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-28T23:55:16.383

在 Python3 中有 bit_length 方法：

```
>>> import math

>>> math.ceil(0x16.bit_length()/8)
1
>>> math.ceil(0x1234.bit_length()/8)
2
>>> math.ceil(0x12345678.bit_length()/8)
4
>>> math.ceil(0x1234567887654321.bit_length()/8)
8 
```

在 Python2.7 中，`long`整数也有`bit_length`方法：

```
>>> (10**20).bit_length()
67

>>> x = 123
>>> long(x).bit_length()
7 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-28T23:44:00.060

您可以使用`sys.getsizeof`，但结果可能很烦人，因为整数可以是最小值。

例如，在我的 64 位 PC 中，所有变量的大小都是 24 字节。

# java - 如何让安卓相机预览保持专注？

> ID：14077113
> 
> 赞同：2
> 
> 时间：2012-12-28T23:33:29.367
> 
> 标签：java, android, focus, android-camera

我对 Android 很陌生，因此代码不是来自我，因为我只是用它来学习。
我要制作的应用程序必须显示相机预览。我在表面上有相机的预览，但它没有聚焦。作为一种解决方法，我制作了一个可运行文件，它每 750 毫秒调用一次自动对焦。

我想知道如何才能使它变得更好，因为每当我调用自动对焦时，预览都会模糊，直到再次对焦。

感谢您的任何帮助。

```
import android.app.Activity;
import android.hardware.Camera;
import android.hardware.Camera.AutoFocusCallback;
import android.os.Bundle;
import android.os.Handler;
import android.util.Log;
import android.view.SurfaceHolder;
import android.view.SurfaceView;
import android.widget.Toast;

public class Draw extends Activity {
    private SurfaceView preview = null;
    private SurfaceHolder previewHolder = null;
    private Camera camera = null;
    private boolean inPreview = false;
    private boolean cameraConfigured = false;
    private Handler handler = new Handler();;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.draw);

        preview = (SurfaceView) findViewById(R.id.preview);
        previewHolder = preview.getHolder();
        previewHolder.addCallback(surfaceCallback);

        final Runnable r = new Runnable() {
            @Override
            public void run() {
                camera.autoFocus(autoFocusCallback);
                handler.postDelayed(this, 1000);
            }
        };
        handler.postDelayed(r, 750);
    }

    private AutoFocusCallback autoFocusCallback = new AutoFocusCallback() {

        @Override
        public void onAutoFocus(boolean autoFocusSuccess, Camera arg1) {
        }
    };

    @Override
    public void onResume() {
        super.onResume();

        camera = Camera.open();
        startPreview();
    }

    @Override
    public void onPause() {
        if (inPreview) {
            camera.stopPreview();
        }

        camera.release();
        camera = null;
        inPreview = false;

        super.onPause();
    }

    private Camera.Size getBestPreviewSize(int width, int height, Camera.Parameters parameters) {
        Camera.Size result = null;

        for (Camera.Size size : parameters.getSupportedPreviewSizes()) {
            if (size.width <= width && size.height <= height) {
                if (result == null) {
                    result = size;
                } else {
                    int resultArea = result.width * result.height;
                    int newArea = size.width * size.height;

                    if (newArea > resultArea) {
                        result = size;
                    }
                }
            }
        }
        return (result);
    }

    private void initPreview(int width, int height) {
        if (camera != null && previewHolder.getSurface() != null) {
            try {
                camera.setPreviewDisplay(previewHolder);
            } catch (Throwable t) {
                Log.e("KritzelKunst-surfaceCallback", "Exception in setPreviewDisplay()", t);
                Toast.makeText(Draw.this, t.getMessage(), Toast.LENGTH_LONG).show();
            }

            if (!cameraConfigured) {
                Camera.Parameters parameters = camera.getParameters();
                Camera.Size size = getBestPreviewSize(width, height, parameters);

                if (size != null) {
                    parameters.setPreviewSize(size.width, size.height);
                    camera.setParameters(parameters);
                    cameraConfigured = true;
                }
            }
        }
    }

    private void startPreview() {
        if (cameraConfigured && camera != null) {
            camera.startPreview();
            inPreview = true;
        }
    }

    SurfaceHolder.Callback surfaceCallback = new SurfaceHolder.Callback() {
        @Override
        public void surfaceCreated(SurfaceHolder holder) {
            // no-op -- wait until surfaceChanged()
        }

        @Override
        public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {
            initPreview(width, height);
            startPreview();
        }

        @Override
        public void surfaceDestroyed(SurfaceHolder holder) {
            // no-op
        }
    };
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-04-15T14:15:43.293

尝试添加

```
<uses-feature android:name="android.hardware.camera.autofocus" /> 
```

在你的清单中。

# java - Android中的同时多个套接字端口连接

> ID：14077117
> 
> 赞同：1
> 
> 时间：2012-12-28T23:34:08.603
> 
> 标签：java, android, sockets, client-server, wifi

我想知道使用基于 Android 的应用程序的套接字将多个客户端连接到服务器的最佳方式是什么。基本上，我有一个服务器移动应用程序和多个需要使用 WiFi/Ad-hoc 连接到服务器的客户端（未知数，可能是 200）。信息流主要是从服务器到客户端的文本消息，但客户端也会向服务器发送数据。我正在寻找关于：

1.  建立和管理新连接并持续监听新连接
2.  网络架构/协议
3.  获取已连接客户端列表并在客户端断开连接时更新的方法

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2012-12-28T23:57:44.403

我强烈建议使用[Netty](http://netty.io)库（它应该可以在 android 上运行），因为它可以很好地高效地完成这项任务，并且具有良好的文档和示例（有几乎可以满足您的需求的示例）。它使以异步方式实现此客户端/服务器架构变得简单，无需大量手动低级工作。

但我不确定在 android 上运行具有 200 个连接的服务器是一个好主意：即使性能足够（在顶级 android 设备上），它也将是一个真正的电池消耗器。如果可能的话，我建议考虑将所有这些连接处理转移到服务器端。

# image - 如何有效地从 png 流/文件中读取位图和元数据？

> ID：14077118
> 
> 赞同：1
> 
> 时间：2012-12-28T23:34:20.053
> 
> 标签：image, bitmap, png, metadata

我需要使用 [PNGJ] (http://code.google.com/p/pngj/) 库从 PNG 输入流中解码位图和元数据。问题是解码元数据会推进流，然后我不能使用 bitmap = BitmapFactory.decodeStream()。

自己创建位图是可以的，但是如果我需要使用插值来缩放位图，我宁愿使用 BitmapFactory。要使用它，每次我必须使用 PNGJ 获取元数据和使用 BitmapFactory 获取位图时，我都必须创建 InputStream 的副本。从单个 PNGJ 调用（至少对于最常见的 ARGB_8888 格式）返回元数据和位图会很好。

简而言之，我必须复制要由 Java 库使用的流，这看起来很浪费。返回位图将是一种解决方案。

```
 // register an auxilary chunk name 
    PngChunk.factoryRegister(ThumbNailProvider.chunkID, chunkPROP.class); 

    // reader for the stream
    PngReader pngr = new PngReader(inStream, "debug label PNG reader");
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    PngWriter pngw = new PngWriter(outputStream, pngr.imgInfo);

    // copy pre-data chunks
    pngw.copyChunksFirst(pngr, ChunkCopyBehaviour.COPY_ALL_SAFE);

    // copy image data
    for (int row = 0; row < pngr.imgInfo.rows; row++) {
        ImageLine l1 = pngr.readRow(row);
        pngw.writeRow(l1, row);
    }

    // copy after-data chunks
    pngw.copyChunksLast(pngr, ChunkCopyBehaviour.COPY_ALL); 

    pngr.end(); // close inStream but not its copy
    pngw.end(); // close out stream

    // save a copy of the stream for Java Libraries;
    data.inputStream = new ByteArrayInputStream(outputStream.toByteArray());

    // read the chunk
    ChunksList chunkList = pngr.getChunksList();
    PngChunk chunk = chunkList.getById1(L2ThumbNailProvider.chunkID);
    if (chunk != null) {
    ... 
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T16:03:38.423

这就是有两个独立的流消费者的问题，比如说`Class1.parse(inputStream)`，`Class2.decode(inputStream)`我们希望他们消费同一个流；如果我们无法控制消费者如何吃流，它就没有简单优雅的解决方案（[例如）。](https://stackoverflow.com/questions/11334963/concurrent-processing-of-single-inputstream-with-independent-consumers)

简单的解决方案，但不是很优雅 - 并且可能不切实际 - 是：关闭并重新打开流（如果我们从网络流中读取，则不可行），将完整的流内容缓冲到内存中，或临时文件。

在您的具体情况下，我能想到的替代方案是：

[1）让PNGJ消费和解码数据并自己创建位图，用setPixels()](http://developer.android.com/reference/android/graphics/Bitmap.html#setPixels%28int%5B%5D,%20int,%20int,%20int,%20int,%20int,%20int%29)填充像素。除其他不便外，这还需要您进行正确的颜色转换。

2) 使用 PngReader 作为 InputFilterStream，使其只解析元数据并将完整的流传递给消费者。目前，如果不对 PNGJ 代码进行调整，这是不可能的。我会看一下，如果实现此功能，我将在此处发布。

# ruby - 如何让 Aruba 扩展通配符

> ID：14077119
> 
> 赞同：0
> 
> 时间：2012-12-28T23:34:44.090
> 
> 标签：ruby, tdd, cucumber, aruba

我正在编写一个简单的命令行 gem。

执行实际工作的库是使用 rspec 开发的，并且到目前为止有效。

我正在尝试使用 Aruba/Cucumber 测试命令行部分，但我遇到了一些奇怪的行为。

只是为了测试这个，我有一个二进制文件`puts ARGV`，我有测试文件`tmp/aruba`

当我运行时，我会`bundle exec gem_name tmp/aruba/*.*`看到 shell 扩展文件名的列表。

现在我的功能文件有：

```
Given files to work on       # I set up files in tmp/aruba in this step
When I run `gem_name *.*`    # standard step
Then the output should contain "Wibble" 
```

最后一步显然会失败，但它向我展示了预期与实际输出之间的差异。而不是看到一个shell扩展文件名列表，我得到的只是`"*.*"`

因此，我只能拥有一个可以按预期工作的应用程序，但我无法通过测试。我可以使用“ *.* ”并从那里生成文件列表，但是我正在编写额外的生产代码只是为了让应用程序在测试中工作——我认为这不是正确的方法。而这一切都是因为外壳扩展没有发生。

如果您查看我的个人资料，您会发现 Ruby 不是我的主要包，请随时指出我可能错过的任何资源，但这只是我遗漏了什么，或者有人知道的预期行为如何解决？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T05:06:39.523

在对[Aruba 源代码](https://github.com/cucumber/aruba/tree/master/lib/aruba)进行了一些挖掘之后，我发现该`When I run`步骤最终出现在如下代码块中：

```
def run!(&block)
  @process = ChildProcess.build(*shellwords(@cmd))
  ...
  begin
    @process.start
    ... 
```

进一步挖掘到[这里](https://github.com/jarib/childprocess/blob/master/lib/childprocess/unix/fork_exec_process.rb#L6)[`ChildProcess`](https://github.com/jarib/childprocess)结束：

```
def launch_process
  ...
  begin
    exec(*@args)
    ... 
```

这就是问题所在。`exec`当参数列表被拆分为多个数组元素时，不进行 shell 扩展：

> 如果给 exec 一个参数，则该参数将被视为在执行之前受外壳扩展影响的行。如果给定了多个参数，则第二个和后续参数作为参数传递给 command 而没有 shell 扩展。

但是玩`shellwords`了一下我们发现：

```
Shellwords.shellwords('gem_name *.*')
=> ["gem_name", "*.*"]                   # No good
Shellwords.shellwords('"gem_name *.*"')
=> ["gem_name *.*"]                      # Aha! 
```

因此，解决方案**可能**很简单：

```
When I run `"gem_name *.*"` 
```

如果这不起作用，那么你很不走运。我建议您手动扩展文件名，因为您在这里并没有真正测试 shell 扩展 - 我们知道这是有效的：您正在测试多个参数。

因此，您应该改为：

```
When I run `gem_name your_file1 your_file2 your_file3` 
```

# .net - 是否可以反序列化 xml 文件中的十六进制数字？

> ID：14077121
> 
> 赞同：0
> 
> 时间：2012-12-28T23:34:52.650
> 
> 标签：.net, xml, hex, deserialization

为了清楚起见，我们希望用十六进制数字（标记 =“0x2000”）表示 XML 属性，但是 .NET XML 反序列化一点也不喜欢它……

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:17:00.337

可能的？是的，这是可能的。有效的？取决于您要验证的架构。

# c# - 清空对象的所有引用

> ID：14077124
> 
> 赞同：1
> 
> 时间：2012-12-28T23:35:08.003
> 
> 标签：c#

我有一个类`Simple`，其中包含一个整数，`number`。使用此代码：

```
Simple b = new Simple();
List<Simple> list = new List<Simple>();
list.Add(b);
b.number = 6;
b = null;
Debug.WriteLine("The value of b is " + b);
Debug.WriteLine("And the value of the clown in the list is " + list[0].number); 
```

调试返回`The value of b is`和`And the value of the clown in the list is 6`.

我可以假设通过添加`b`到`list`, 然后存储对的引用`b`。然后，通过清空`b`，`list`仍然包含对曾经存在的对象的引用，`b`因此可以打印出 的值`number`。

但是，如果我可以更改的成员`b`并通过存储在列表中的引用反映该成员，那么为什么不`b = null`反映 的值`list[0]`？我只能假设这与价值和参考有关。

帮助任何人？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-28T23:39:50.927

`b`并且`list[0]`都是引用内存中相同位置的变量。当您设置时`b = null`，您正在设置`b`对 的引用`null`。`list[0]`仍然指向内存中的原始位置并且没有改变。

当您更改 , 的属性时`b`（例如`b.A`），您实际上是在说

> 获取 b 指向的任何对象并更新属性 A。

当您访问`A`via`list[0]`时，您是在说

> 去获取 list[0] 指向的任何内容，然后获取 A 属性。

编辑：作为另一个例子，如果`b = someObject`和`list[0] = someObject`，设置`b = someOtherObject`不会改变`list[0]`......`list[0]`仍然指向`someObject`。

因此，要回答您的问题，您必须将它们都引用的对象设置为“null” `b = null`。`list[0] = null`但是，即使这样，也不会像你想要的那样做。所要做的就是使内存中的对象成为孤立对象，并允许`Garbage Collector`它在遇到它时对其进行清理。

# wpf - 在 wpf 或 winform 中修改或创建 SaveFile 对话框

> ID：14077125
> 
> 赞同：0
> 
> 时间：2012-12-28T23:35:09.023
> 
> 标签：wpf, winforms, savefiledialog

对于我的应用程序，我想使用 SaveFile 对话框。在 SaveFile 对话框上，我只想让用户选择位置来保存和隐藏文件名并保存为类型。我如何实现这一目标？我还能使用 Microsoft.Win32 中的保存文件对话框吗？或者我已经创建了自己的对话窗口。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:43:58.757

我相信文件对话框可能是您想要的。它只让用户选择一个文件夹。然后，您可以自己命名文件。

```
Dim fb As New FolderBrowserDialog
fb.Description = "Select the Folder"
fb.RootFolder = Environment.SpecialFolder.MyComputer
Dim dlgResult As DialogResult = fb.ShowDialog()

If dlgResult = Windows.Forms.DialogResult.OK Then
    savefolder = fb.SelectedPath
End If 
```

你去吧。

# jquery - 如何在通过ajax提交输入按钮时显示模式弹出窗口

> ID：14077126
> 
> 赞同：0
> 
> 时间：2012-12-28T23:35:09.160
> 
> 标签：jquery, ajax, modal-dialog

当用户单击输入按钮时，它会将某些值传递给数据库。但是，在此完成之前，我需要通过 ajax 添加一个确认对话框。

```
<input type="button" class="finished" value="Next &raquo;" id="Save" />
 <div id="save-modal" class="modal-dialog">
    <div>
      <a href="#close" title="Close" class="close">X</a>
      <h2>Done!</h2>
      <p>You just updated your profile.<br />Here is your new information!</p>
    </div>
 </div>​ 
```

这个 div 默认是隐藏的：

```
 .modal-dialog {
                position: fixed;
                font-family: Arial, Helvetica, sans-serif;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                background: rgba(0,0,0,0.8);
                z-index: 99999;
                opacity:0;
                color: white;
                -webkit-transition: opacity 400ms ease-in;
                -moz-transition: opacity 400ms ease-in;
                transition: opacity 400ms ease-in;
                pointer-events: none;
            }
            .modal-dialog:target {
                opacity:1;
                pointer-events: auto;
            }

            .modal-dialog > div {
                width: 230px;
                position: relative;
                margin: 10% auto;
                padding: 16px 20px 21px 20px;
                border-radius: 4px;
                background: #003c62;
                border: 2px white solid;
                box-shadow: inset 0 0 17px 3px rgba(127, 219, 248, .34) ,1px 1px 19px white;
            }
            modal-dialog h2 {
                font: 14px sans-serif;
                text-transform: uppercase;
            }
            .modal-dialog p {
                color: white;
                text-shadow: none;
                text-transform: none;
                font-size: 14px;
            }
            .close {
                background: #1E2D5C;
                color: white;
                line-height: 24px;
                position: absolute;
                right: -12px;
                text-align: center;
                top: -10px;
                width: 26px;
                text-decoration: none;
                font-weight: bold;
                border: 1px solid #666;
                border-radius: 12px;
                box-shadow: 1px 1px 3px #000;
            }

            .close:hover { background: #00d9ff; } 
```

​ 并且应该使用 $ajax() 来完成

```
$("#Save").click(function () {
    $.ajax({
        url: baseUrl + '/Folder',
        type: 'POST',
        data: JSON.stringify(values),
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        error: function (xhr) {
            alert('Error: ' + xhr.statusText);
        },
        success: function (data) {
            $('#save-modal').html(data);
        },
        async: true
    });
}); 
```

如果单击`<a href="#save-modal">Modal</a>`，该模式可以正常工作，但我不想使用它。

我在`success:`此功能的一部分中缺少什么`ajax()`以使其正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T00:13:19.107

仔细看，通过将 opacity 设置为 0 来隐藏模态，将其放入成功回调中：

```
 $("#save-modal").css("opacity",1); 
```

**编辑：**

有关 AJAX 请求的更新示例，请参见此处 [http://jsfiddle.net/xVDte/25/](http://jsfiddle.net/xVDte/25/)

在 CSS 中，我添加了一个类：

```
.modal-dialog.show{
    opacity:1;
    pointer-events:auto;
} 
```

然后为成功回调和关闭按钮添加和删除显示类

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:19:09.043

如果您的 AJAX 请求的数据类型是 JSON，这意味着您的成功方法的数据参数应该是对象而不是字符串。您需要解析代码中的对象并从包含它的任何对象成员中提取 HTML。或者，如果处理此 ajax 请求的 PHP（或 ASP）文件返回原始 HTML，请更改您的 dataType:'html'。

```
success : function(data)
{
    // Use Chrome or Firefox and you can view this in the debug console.
    console.log(data);

    // We will assume that data.content is the HTML to fill the modal with.
    $("#save-modal").html(data.content);
}, 
```

[http://api.jquery.com/jQuery.ajax/](http://api.jquery.com/jQuery.ajax/)

# html - IIS 7 出站规则不重写 HTML href

> ID：14077127
> 
> 赞同：2
> 
> 时间：2012-12-28T23:35:20.083
> 
> 标签：html, iis-7, rules, outbound

**我正在尝试使用 outboundrule 重写 html 响应，但它不起作用：这是我的入站和出站规则：**

```
 <rules>             
    <rule name="IE56 Do not gzip js and css" stopProcessing="false">
            <match url="\.(css|js|emz|jpg|htm|html)" />
            <action type="None" />
            <serverVariables>
             <set name="HTTP_ACCEPT_ENCODING" value="" />
               </serverVariables>
    </rule>

<rule name="Route the requests for eserver" patternSyntax="ECMAScript">
    <match url="^eServer/(.*)" />
    <conditions logicalGrouping="MatchAny">
               <add input="{CACHE_URL}" pattern="^(https?)://" />
    </conditions>
    <action type="Rewrite" url="{C:1}://mckyesvr/eServer/{R:1}" />
    <serverVariables>
               <set name="HTTP_ACCEPT_ENCODING" value="" />
    </serverVariables>
    </rule>

      <outboundRules>               
    <rule name="ReverseProxyOutboundRule1" preCondition="ResponseIsHtml1">
     <match filterByTags="A, Area, Base, Form, Frame, Head, IFrame,Img,    Input, Link, Script" pattern="^http(s)?://mckyesvr/eServer/(.*)" ignoreCase="true" />
        <conditions>
                       <add input="{URL}" pattern="/PageLoader" negate="true" />
        </conditions>
        <action type="Rewrite" value="/eServer/{R:2}" />
</rule>

<rule name="ReverseProxyOutboundRule8" preCondition="ResponseIsHtml1">
<match pattern="http://mckyesvr/eServer/PageLoader.asp?Page=Process_Safety.dsp"/>
<action type="Rewrite" value="/eServer/PageLoader.asp?Page=Process_Safety.dsp" />
</rule> 
```

**它们与几乎所有 HTML 响应完美配合，除了具有这种 HTML 响应形式的响应：**

```
 "<html xmlns:v="urn:schemas-microsoft-com:vml"
    xmlns:o="urn:schemas-microsoft-com:office:office"
    xmlns:x="urn:schemas-microsoft-com:office:excel"
    xmlns="http://www.w3.org/TR/REC-html40"> 
```

**.......等等，这是我要重写的部分：** **<_a href="http://mckyesvr/eServer/PageLoader.asp?Page=Process_Safety.dsp" target="_parent">Go Back过程安全--------**

**我已经尝试更改压缩，更改出站规则，移动一千个参数，但直到现在还没有解决，我不知道为什么会发生这种情况，只是上面指出的 HTML 响应，它看起来像是编码的因为 Outboundrules 没有抓住它。**

# css - 应用关键帧动画时变换缩放元素

> ID：14077128
> 
> 赞同：0
> 
> 时间：2012-12-28T23:35:21.157
> 
> 标签：css, animation, transform, css-animations

我有一个元素具有 css3 动画并应用了关键帧，但我仍然想缩放这个元素。但似乎因为**transform translate**已经应用于动画**transform scale**不起作用

例如：假设我有 4 个云（div 元素）从右到左移动，我希望这些云具有不同的比例

```
.x1 {
  -webkit-animation-name: moveclouds;
  -moz-animation-name: moveclouds;
  animation-name: moveclouds;

  -webkit-animation-duration: 170s;
  -moz-animation-duration: 170s;
  animation-duration: 170s;

  -webkit-animation-timing-function: linear;
  -moz-animation-timing-function: linear;
  animation-timing-function: linear;

  -webkit-animation-iteration-count: infinite;
  -moz-animation-iteration-count: infinite;
  animation-iteration-count: infinite;

  -webkit-transform: scale(0.79);
  -moz-transform: scale(0.79);
  -ms-transform: scale(0.79);
  -o-transform: scale(0.79);
  transform: scale(0.79);
}
.x2{ ...}
.x3{...}
.x4{...}

@keyframes moveclouds {
  from {
    transform: translateX(2400px);
    /* note: I'm using vendor prefixes, I just want to simplified it here */
  }

  to {
    transform: translateX(-200px);
  }
} 
```

动画效果很好，不能缩放

**问题：**有人知道如何执行规模吗？

我正在使用此示例[http://thecodeplayer.com/walkthrough/pure-css3-animated-clouds-background](http://thecodeplayer.com/walkthrough/pure-css3-animated-clouds-background)但对其进行了一些调整（请参阅关键帧差异）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T03:53:27.347

设置 CSS 属性时，必须设置该属性的完整值。因此，在您的示例中，您希望使用多种类型的变换（translateX 和比例）设置 TRANSFORM 属性。您必须在单个属性上设置所有转换。删除当前的 SCALE 样式，然后执行以下操作（使用供应商前缀）。是的......你会有重复。这是复杂的 CSS3 属性值的一个缺点。

```
@keyframes moveclouds {
  from {
    transform: translateX(2400px) scale(0.79);
    /* note: I'm using vendor prefixes, I just want to simplified it here */
  }

  to {
    transform: translateX(-200px) scale(0.79);
  }
} 
```

为了进一步扩展，如果您有一个具有多个背景图像的元素：

```
.some-div {
    background-image: url("img1.png"), url("img2.png");
} 
```

并且您想更改`img2.png`为`img3.png`悬停时，您必须：

```
.some-div:hover {
    background-image: url("img1.png"), url("img3.png");
} 
```

# jquery - 除非您单击“X”按钮，否则如何显示 qTip 气球

> ID：14077129
> 
> 赞同：1
> 
> 时间：2012-12-28T23:35:23.570
> 
> 标签：jquery, cookies, qtip2, jquery-cookie

我有下一个代码

```
 if ($.cookie('show-tooltip') != "false") {
        $('#logo')
            .qtip({
                content: {
                    text: 'some text', 
                    title: {
                        text: '',
                        button: true
                    }
                },
                show: {
    event: false,
    ready: true
},
                position: {
                    my: 'bottom left', 
                    at: 'top left', 
                       adjust: {
                         x: 80,
                         y: 30
                        }
                        },
        events: {
            hide: function() {
                $.cookie('show-tooltip', false);
                console.log( $.cookie('show-tooltip') )
            }
        },       
                style: {
                    classes: 'qtip-shadow qtip-dark'
                }
            });

}
}); ​ 
```

我有一些问题：

1.如果我通过徽标前面的点击箭头，qTip 气球（希望它保持打开）关闭。

2\. 仅在单击 X（关闭按钮）时无法关闭：我想让它在每次刷新页面时重新打开，除非您之前单击过 X 按钮。

有人可以指导我吗？

# php - 在我的 Root 错误日志中，我收到了这个错误 - PHP Catchable fatal error

> ID：14077130
> 
> 赞同：1
> 
> 时间：2012-12-28T23:35:23.467
> 
> 标签：php

PHP Catchable 致命错误：第 23 行 /home//public_html/modules/mod_yoo_login/helper.php 中的类 stdClass 的对象无法转换为字符串

```
 if($itemid =  $params->get($type))
    {

        $menu =& JSite::getMenu();
        $item = $menu->getItem($itemid);echo "<br>";
        $url = JRoute::_($item->link.'&Itemid='.$itemid, false);
    }
    else
    {
        $url = JURI::base(true);
    }

    return base64_encode($url);
}

function getType()
{
    $user = & JFactory::getUser();
    return (!$user->get('guest')) ? 'logout' : 'login';
} 
```

}

# google-analytics - 出站链接的 Google Analytics 事件跟踪不起作用

> ID：14077133
> 
> 赞同：1
> 
> 时间：2012-12-28T23:35:35.433
> 
> 标签：google-analytics

我和一个朋友从几天开始就一直在努力让事件跟踪工作，但我们就是无法让它工作。如果您能看一看并尝试提供帮助，那对我来说将意味着整个世界。谢谢。

你可以自己看一下代码，网址是[http://www.meinAuslandssemester.com](http://www.meinAuslandssemester.com)。我们要做的是将传出的亚马逊链接作为一个事件进行跟踪（侧边栏、页脚和登陆页面下方的蓝色按钮）。

标头中的代码如下所示：

```
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37237070-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript';     
ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +     '.google-analytics.com/u/ga_debug.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<script type="text/javascript">
function recordOutboundLink(link, category, action) {
try {
var myTracker=_gat._getTrackerByName();
_gaq.push(['myTracker._trackEvent', category , action ]);
setTimeout('document.location = "' + link.href + '"', 100)
}catch(err){}
}
</script> 
```

第一部分只是常规跟踪代码，而第二部分是 Google 建议跟踪出站链接的。

登陆页面上的链接是：<”a class="mainbutton" style="padding: 6px 60px 6px 60px;" onclick="recordOutboundLink(this, 'RekordOutbndLnks', 'ausland.com');return false;" href="http://www.amazon.de/gp/reader/1481174193/?tag=simmenfl-21">Das erste Kapitel gratis lesen"

由于所有这些都不起作用，我们还尝试了一个不同的版本，目前在侧边栏和页脚中：<"a class="sidebarbutton" href="http://www.amazon.de/dp/B00ARLDGD0/?tag =simmenfl-21" onclick="_gaq.push(['_trackEvent', 'ExternalLinks', 'Amazon','SidebarKindle']);return false;">Kindle 版：9,99€ 

不幸的是，版本 1 或 2 都不起作用，我们就是找不到问题所在。有任何想法吗？忘记最后链接中a之前的“，我只是添加了这些以便显示代码。不能做得更好对不起！:)

非常感谢您的帮助，我们最终放弃了:(

相关链接：

[http://support.google.com/analytics/bin/answer.py?hl=en&answer=1136920](http://support.google.com/analytics/bin/answer.py?hl=en&answer=1136920)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:05:38.630

版本 2 将不起作用，因为在链接之前不会执行 GA 异步代码，这就是 google 示例中 setTimeout 延迟的原因。

至于版本 1，不幸的是，谷歌示例需要进行一些调整才能使用 - 请参阅[为什么谷歌分析不跟踪任何事件？](https://stackoverflow.com/questions/10203819/why-is-google-analytics-not-tracking-any-events)- 即尝试更换

```
var myTracker=_gat._getTrackerByName();
_gaq.push(['myTracker._trackEvent', category , action ]); 
```

和

```
_gaq.push(['_trackEvent', category , action ]); 
```

# entity-framework - 如何更新孩子并在 EF 中以一对多关系插入新孩子

> ID：14077136
> 
> 赞同：2
> 
> 时间：2012-12-28T23:36:03.127
> 
> 标签：entity-framework, one-to-many, foreign-key-relationship

我在 ItemPrice 和 ItemPriceHistory 类之间有一对多的关系，我的映射如下：

```
public class ItemPrice 
{
    public long ID {get; set;}
    public List<ItemPriceHistory> ItemPriceHistories { get; set; }

    public ItemPrice()
    {
       ItemPriceHistories = new List<ItemPriceHistory>();
    }
}

public class ItemPriceHistory
{
    public ItemPrice ItemPrice { get; set; }
    public long ID {get; set;}
    public bool IsCurrent { get; set; }
}

modelBuilder.Entity<ItemPriceHistory>()
            .HasRequired(h => h.ItemPrice)
            .WithMany(p => p.ItemPriceHistories)
            .Map(h => h.MapKey("ItemPrice_ID")); 
```

我正在尝试更新以前的 ItemPriceHistory 条目并尝试添加一个新的 ItemPriceHistory 条目。

```
 var dbItemPrice = repo.Std.Get<ItemPrice>()
                                    .SingleOrDefault(c => c.ID == id);                

            if (dbItemPrice == null)
            {
                return Request.CreateResponse(HttpStatusCode.NotFound);
            }                

            //query for matching ItemPriceHistory
            var dbPriceHistories = repo.Std.Get<ItemPriceHistory>()
                                    .Include(h=>h.ItemPrice, repo.Std)
                                    .Where(h => h.ItemPrice.ID == ItemPrice.ID)
                                    .OrderByDescending(h => h.ModifiedDate);

            #region new history entry

            var newHistoryEntry = new ItemPriceHistory();
            newHistoryEntry.IsCurrent = true;
            newHistoryEntry.ItemPrice = dbItemPrice;

            //copy the current pirce list and update it with new history entry
            var currentPriceHistoryList = dbPriceHistories.ToList();
            currentPriceHistoryList.ForEach(h => { h.IsCurrent = false; });
            currentPriceHistoryList.Add(newHistoryEntry);

            //new price list
            var newHistoryList = new List<ItemPriceHistory>();
            currentPriceHistoryList.ForEach(h => newHistoryList.Add(new ItemPriceHistory
                                            {
                                                ItemPrice = h.ItemPrice,
                                                IsCurrent = h.IsCurrent,
                                            }
                                    ));
            #endregion

            //delete current price histories
            dbItemPrice.ItemPriceHistories.Clear(); 

            // add histories to database
            newHistoryList.ForEach(h => dbItemPrice.ItemPriceHistories.Add(h));

            Context.SaveChanges(); 
```

当它调用 SaveChanges() 时，我收到以下错误：

> {“保存不为其关系公开外键属性的实体时发生错误。EntityEntries 属性将返回 null，因为无法将单个实体标识为异常源。通过公开可以更轻松地在保存时处理异常实体类型中的外键属性。有关详细信息，请参阅 InnerException。"}
> 
> InnerException: {“来自‘ItemPriceHistory_ItemPrice’AssociationSet 的关系处于‘已删除’状态。给定多重约束，相应的‘ItemPriceHistory_ItemPrice_Source’也必须处于‘已删除’状态。”}

我不想删除我的`ItemPrice_Source`. 我只想删除当前`ItemPriceHistories`并更新以前的`ItemPriceHistories`并添加新`ItemPriceHistory`条目。如何安全地更新`ItemPriceHistory`条目以及新`ItemPriceHistory`条目？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T11:07:08.107

我使用了一个应该适合您的 STD 通用存储库类的示例。看起来你正在使用这种模式。

你有没有尝试过类似的东西

```
 public virtual IQueryable<T> GetList(Expression<Func<T, bool>> predicate, bool withTracking = false)
    {
        if (withTracking)
            return QuerySet.Where(predicate);
        return QuerySet.Where(predicate).AsNoTracking();
    }

//    then
var iph_list = RepItemPriceHist.GetList(h=>h.ItemPrice.Id == VarID)

 //  psuedo code... foreach history entity entitity.Iscurrent = false; 
```

所以现在这些实体应该由 statemanager 更改和管理。添加新条目....

```
// add histories to database
          newHistoryList.ForEach(h => dbItemPrice.ItemPriceHistories.Add(h));
 Context.SaveChanges(); 
```

我不明白您为什么需要**清除**集合您是否更新现有记录并添加新记录？祝你好运

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T15:17:40.020

你不能只加载`ItemPrice` *包括*所有当前`ItemPriceHistories`的，然后将`IsCurrent`这些历史的标志设置为`false`并添加一个新的历史`IsCurrent = true`吗？更改跟踪应该更新当前历史并将新的历史插入数据库：

```
var dbItemPrice = repo.Std.Get<ItemPrice>()
    .Include(i => i.ItemPriceHistories, repo.Std)
    .SingleOrDefault(i => i.ID == id);                

if (dbItemPrice == null)
    return Request.CreateResponse(HttpStatusCode.NotFound);

foreach (var history in dbItemPrice.ItemPriceHistories)
    history.IsCurrent = false;

dbItemPrice.ItemPriceHistories.Add(new ItemPriceHistory { IsCurrent = true });

Context.SaveChanges(); 
```

# java - 使用 IAudioEndpointVolume

> ID：14077138
> 
> 赞同：0
> 
> 时间：2012-12-28T23:36:38.643
> 
> 标签：java, c++, c, java-native-interface

我是 C++ 新手，但我想知道如何使用 IAudioEndpointVolume 接口获取系统音量信息。我不知道我需要包含和使用什么。我已经看过这里[http://msdn.microsoft.com/en-us/library/aa964574.aspx](http://msdn.microsoft.com/en-us/library/aa964574.aspx)但它没有帮助，因为我对 c++ 了解不够，我这样做的原因实际上是为了一个 java java中的本机接口项目。我正在使用 Windows 7。请帮助谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-28T23:43:38.453

IAudioEndpointVolume 是一个 COM 接口，您显然可以在 C++ 中使用它，但它不限于 C++。

在讨论 JNI 之前（尤其是如果您没有太多的 C 或 C++ 经验），我很想寻找一个 Java/COM 桥。您可能可以在这里找到一些信息：[如何选择 Java-COM 桥接器？](https://stackoverflow.com/questions/3547587/how-to-choose-a-java-com-bridge)

# php - PHP：仅解析命名空间的 xml

> ID：14077139
> 
> 赞同：6
> 
> 时间：2012-12-28T23:36:53.907
> 
> 标签：php, xml, parsing, dom

我正在尝试解析这样的数据：

```
<vin:layout name="Page" xmlns:vin="http://www.example.com/vin">
    <header>
        {someText}
        <div>
            <!-- some invalid xml code -->
            <aas>
            <nav class="main">
                <vin:show section="Menu" />
            </nav>
        </div>
    </header>
</vin:layout> 
```

如何在 PHP 中解析这样的数据？

我尝试了 DOM，但它不起作用，因为根元素内的 xml 格式错误。我可以告诉解析器，没有`vin`命名空间的一切都是文本吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-30T20:53:31.167

我可能会在上面扔一种 Tagsoup 解析器。可以阅读您的格式的东西，除了这些缺陷看起来还不错。没有什么东西会在文本上阻碍简单的基于正则表达式的扫描器。我`Tagsoup`只用你得到的四种节点类型给我打电话：开始标签、结束标签、文本和评论。对于标签，您需要了解它们的 Tagname 和 NamespacePrefix。只是为了方便起见，它的名称类似于 XML/HTML，但实际上这都是“你自己的”，所以不要将这些术语延伸到任何标准。

更改没有命名空间前缀的每个标签（开始或结束）的用法可能如下所示（`$string`包含您在问题中拥有的数据）：

```
$scanner = new TagsoupIterator($string);

$nsPrefix = 'vin';

foreach ($scanner as $node) {
    $isTag  = $node instanceof TagsoupTag;
    $isOfNs = $isTag && $node->getTagNsPrefix() === $nsPrefix;
    if ($isTag && !$isOfNs) {
        $node = strtr($node, ['&' => '&amp;', '<' => '&lt;']);
    }
    echo $node;
} 
```

输出：

```
<vin:layout name="Page" xmlns:vin="http://www.example.com/vin">
    &lt;header>
        {someText}
        &lt;div>
            <!-- some invalid xml code -->
            &lt;aas>
            &lt;nav class="main">
                <vin:show section="Menu" />
            &lt;/nav>
        &lt;/div>
    &lt;/header>
</vin:layout> 
```

提取命名空间的某个标记内的所有内容的用法可能如下所示：

```
$scanner = new TagsoupIterator($string);
$parser  = new TagsoupForwardNavigator($scanner);

$startTagWithNsPrefix = function ($namespace) {

    return function (TagsoupNode $node) use ($namespace) {

        /* @var $node TagsoupTag */
        return $node->getType() === Tagsoup::NODETYPE_STARTTAG
            && $node->getTagNsPrefix() === $namespace;
    };
};

$start = $parser->nextCondition($startTagWithNsPrefix('vin'));
$tag   = $start->getTagName();
$parser->next();
echo $html = implode($parser->getUntilEndTag($tag)); 
```

输出：

```
<header>
    {someText}
    <div>
        <!-- some invalid xml code -->
        <aas>
        <nav class="main">
            <vin:show section="Menu" />
        </nav>
    </div>
</header> 
```

下一部分是替换`$string`. 由于 Tagsoup 提供二进制偏移量和长度，这很容易（我通过 SimpleXML 快捷方式有点脏）：

```
$xml = substr($string, 0, $start->getEnd()) . substr($string, $parser->getOffset());
$doc = new SimpleXMLElement($xml);
$doc[0] = $html;
echo $doc->asXML(); 
```

输出：

```
<vin:layout xmlns:vin="http://www.example.com/vin" name="Page">
    &lt;header&gt;
        {someText}
        &lt;div&gt;
            &lt;!-- some invalid xml code --&gt;
            &lt;aas&gt;
            &lt;nav class="main"&gt;
                &lt;vin:show section="Menu" /&gt;
            &lt;/nav&gt;
        &lt;/div&gt;
    &lt;/header&gt;
</vin:layout> 
```

根据具体需求，这将需要更改实施。例如，这个不允许将相同的标签放在一起。它不会把你赶出去，但它不会处理这个问题。不知道你是否有这种情况，如果有，你需要添加一些打开/关闭计数器，导航器类可以很容易地扩展，甚至提供两种结束标签查找方法。

此处给出的示例使用了您可以在此要点中看到的 Tagsoup：[https ://gist.github.com/4415105](https://gist.github.com/4415105)

# heroku - 在 Heroku 上升级到 postgres

> ID：14077145
> 
> 赞同：11
> 
> 时间：2012-12-28T23:37:59.783
> 
> 标签：heroku, postgresql-9.2

以最少的停机时间将 Heroku Postgres 生产数据库升级到 9.2 的推荐方法是什么？是否可以使用追随者，或者我们应该采取 pgbackups/snapshots 路线？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-03-05T14:01:25.127

在[9.4 中的逻辑追随者](https://twitter.com/MattRogish/status/279625792877641730)之前，您必须转储和恢复（出于 Craig 描述的原因）。您可以使用 pgbackups:transfer 简化此操作。直接传输比转储和恢复要快，但要知道您没有要保留的快照。

下面的脚本基本上是 Heroku 的[Using PG Backups to Upgrade Heroku Postgres Databases](https://devcenter.heroku.com/articles/upgrade-heroku-postgres-with-pgbackups) ，并修改了[pgbackups:transfer](https://github.com/heroku/heroku-pg-extras#pgbackupstransfer)。（如果你有多个实例，比如说一个登台服务器，在每个 Heroku 行添加“-a”或“--remote”来指定哪个服务器。）

```
# get the pgbackups plugin
heroku plugins:install git://github.com/heroku/heroku-pg-extras.git

# provision new db
heroku addons:add heroku-postgresql:crane --version=9.2

# wait for it to come online, make note of new color
heroku pg:wait

# prevent new data from arriving during dump
heroku ps:scale worker=0 web=0
heroku maintenance:on

# copy over the DB. could take a while.
heroku pgbackups:transfer OLDCOLOR NEWCOLOR

# promote new database as default for DATABASE_URL
heroku pg:promote NEWCOLOR

# start everything back up and test
heroku ps:scale worker=N web=N
heroku maintenance:off
heroku open

# remove old database
heroku addons:remove HEROKU_POSTGRESQL_OLDCOLOR 
```

请注意，如果您比较它们之间的数据大小，由于 9.2 中的效率，新的可能要小得多。（我的 9.2 大约是 9.1 的 70%。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-31T05:22:33.830

Heroku 追随者是，AFAIK，只是 PostgreSQL 流复制服务器。这意味着您不能跨版本使用它们，您必须拥有二进制兼容的数据库。

与普通 PostgreSQL 相同的技术应该适用，只是您可能无法`pg_upgrade`在 Heroku 上使用。这需要以托管数据库的系统上的用户身份访问 shell（ssh 等）`postgres`，所以我怀疑 Heroku 上是否有可能，除非他们提供了`pg_upgrade`为您运行的工具。我找不到太多这方面的信息。

您可能不得不考虑使用 Slony-I、Bucardo 或其他基于触发器的复制解决方案来进行升级，除非您能找到`pg_upgrade`在 Heroku 数据库实例上运行的方法。一般的想法是你设置一个新的 9.2 实例，使用 Slony 将数据从 9.1 实例克隆到其中，然后一旦它们完全同步，你就停止 9.1 实例，删除 Slony 触发器，并将客户端切换到9.2 实例。

搜索有关“postgresql 低停机时间升级 slony”等的更多信息，看看你的进展如何。

# file-transfer - Samba 通过 Explorer 读取速度非常慢，但通过 Firefox 可以

> ID：14077147
> 
> 赞同：2
> 
> 时间：2012-12-28T23:38:26.667
> 
> 标签：file-transfer, samba, smb, fileserver, mapped-drive

我有一个运行 Ubuntu 12.04 和 Samba 3.6.3 的文件服务器。Samba 共享映射到 Windows 8 机器上的驱动器。

将测试文件复制到本地驱动器（这里是 SSD 而不是瓶颈）时，通过资源管理器执行此操作时速度非常慢。通过 Internet Explorer 下载文件时也同样慢。然而，当通过 Firefox 下载时（通过输入文件 URI），它的速度是 10 倍以上，如下图所示。

这里发生了什么？我知道 Samba 并不快，但我认为在处理大量小文件时通常是这种情况，当它的请求逻辑非常低效时。测试文件为 826 MB。

![Samba 读取速度](../Images/5e3317bd0610aed7fc97147a24436bd9.png)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T00:08:10.787

删除 smb.conf（Samba 配置文件）中的自定义“套接字选项”行为我解决了这个问题。

现在似乎最好将该选项留空，因为它会自行计算最佳值。Firefox 似乎要么使用它自己的 SMB 协议设置，要么忽略 Samba 服务器设置的那些。

# c++ - cv:::Mat 克隆 Segfault

> ID：14077150
> 
> 赞同：3
> 
> 时间：2012-12-28T23:38:48.610
> 
> 标签：c++, qt, opencv

克隆`cv::Mat`. 调用了两个函数，并在`m_mask`我的类的成员变量（不是指针）上工作：

设置掩码：

```
void SetMask(QImage mask)
{
    if(!mask.isNull() && mask.depth() == 1)
    {
        std::cout << "Mask width: " << mask.width() << " and mask height: " << mask.height() << std::endl << std::flush;
        if(mask.width() != m_mask.cols || mask.height() != m_mask.rows)
            m_mask.create(mask.height(), mask.width(), CV_8UC1);

        if(m_mask.data == 0)
            std::cout << "MALLOC FAILED" << std::endl << std::flush;

        //Copy data here

        cv::imshow("OpenCV Image", m_mask);
    }
    else
        m_mask = cv::Scalar(0);
} 
```

然后使用掩码：

```
QString MaskToXML()
{
    QString xml_out;
    if(!m_mask.empty())
    {
        cv::Mat workspace = m_mask.clone(); //Clone our mask - SEGFAULT HERE

        //Run the contour code
        std::vector< std::vector<cv::Point> > contours;
        cv::findContours(workspace, contours, CV_RETR_LIST, CV_CHAIN_APPROX_SIMPLE);

        //do stuff
    }
    return xml_out;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-01-15T19:57:04.817

我有一个堆损坏......从现在开始对我来说一般的经验法则......如果 cv::Mat 是段错误，我在某个地方损坏了堆。

编辑：通过“某处”，我的意思是你可以放心地假设 cv::Mat 是正确的并且它使用的函数是正确的。您可以放心地假设您正在自己的某个地方破坏内存，可能是您的指针或数据结构之一。

# java - 将矩阵变换应用于 BoundingBox

> ID：14077152
> 
> 赞同：8
> 
> 时间：2012-12-28T23:39:02.560
> 
> 标签：java, android, opengl-es, collision-detection, libgdx

我有一个模型矩阵，我正在跟踪我的世界中网格的位置。每次调用时`glRotate()`，`glTranslate()`我都有相应的调用，`modelMatrix.rotate()`并且`modelMatrix.translate()`似乎工作正常。

现在我需要更新与我的每个模型关联的边界框。我在 libGDX 框架中工作，在[此处找到](http://libgdx.badlogicgames.com/nightlies/docs/api/com/badlogic/gdx/math/collision/BoundingBox.html)`BoundingBox`的类中，有一种方法可以让我将矩阵应用于边界框，但值没有正确更新，我认为这可能是我正在尝试的方式应用它。有任何想法吗？`mul()`

这是我的相关代码：

```
gl.glPushMatrix();

// Set the model matrix to the identity matrix
modelMatrix.idt();

// Update the orbit value of this model
orbit = (orbit + ORBIT_SPEED * delta) % 360;
gl.glRotatef(orbit, 1.0f, 1.0f, 0);

// Update the model matrix rotation
modelMatrix.rotate(1.0f, 1.0f, 0, orbit);

// Move the model to it's specified radius
gl.glTranslatef(0, 0, -ORBIT_DISTANCE);

// Update the model matrix translation
modelMatrix.translate(0, 0, -ORBIT_DISTANCE);

// Update the bounding box
boundingBox.mul(modelMatrix);

if (GameState.DEBUG)
{
    renderBoundingBox(gl, delta);
}

// Bind the texture and draw
texture.bind();
mesh.render(GL10.GL_TRIANGLES);

gl.glPopMatrix(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-05-27T15:59:30.313

计算矩阵乘法的顺序很重要。你能用 ModelMatrix * Box 代替吗？我认为这就是问题所在。

# c# - StackFrame 在发布模式下的行为不同

> ID：14077153
> 
> 赞同：10
> 
> 时间：2012-12-28T23:39:12.210
> 
> 标签：c#, .net

这是我的代码：

```
public class UserPreferences
{
    /// <summary>
    /// The EMail signature.
    /// </summary>
    [UserPreferenceProperty(Category = "Email", DefaultValue = "My default value")]
    public static string Signature
    {
        get
        {
            return UserPreferenceManager.GetValue();
        }

        set
        {
            UserPreferenceManager.SetValue(value);
        }
    }
}

public static string GetValue()
{
    if (((VTXPrincipal)Thread.CurrentPrincipal).VTXIdentity.OperatorID == null)
    {
        throw new Exception("Missing Operator ID");
    }

    string value = string.Empty;

    var frame = new StackFrame(1);  ***** <------ problem here.....

    var property = frame.GetMethod();
    var propertyname = property.Name.Split('_')[1];
    var type = property.DeclaringType;   ***** <------ problem here.....
    if (type != null)
    {
        var userPreference = typeof(UserPreferences).GetProperty(propertyname).GetCustomAttributes(true).FirstOrDefault() as UserPreferencePropertyAttribute;

        if (userPreference != null)
        {
            string category = userPreference.Category;
            string description = propertyname;
            value = GetValue(category, description, ((VTXPrincipal)Thread.CurrentPrincipal).VTXIdentity.OperatorID);
            if (value == null)
            {
                // always return something
                return userPreference.DefaultValue;
            }
        }
        else
        {
            throw new Exception("Missing User Preference");
        }
    }

    return value;
} 
```

在 GetValue 方法中，StackFrame 在发布模式和调试模式下的工作方式不同。

在调试模式下，我正确地将属性名称作为签名

但在发布模式下，属性名称为 GetUserPreferenceValueTest，因为这是作为客户端进行调用的测试方法。

因此，我的代码在调试模式下工作，但在发布模式下失败。

```
Q. How can I use StackFrame properly so it works in Debug vs. Release modes. 

Q. Is there any other way to get calling property name and related information at run time? 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T00:30:29.763

我曾经回答过类似的问题，请[在此处阅读我的回答](https://stackoverflow.com/a/6552237/458193)。

简而言之，这是一个非常糟糕的设计决策，因为您的方法是一个伪君子——它与不同的调用者说话不同，但没有公开告诉它。你的 API*永远不*应该依赖谁调用它。`yield`此外，由于 lambdas和等语言特性，编译器可能会以意想不到的方式破坏堆栈跟踪`await`，因此即使这在发布模式下工作，它肯定会在某一天破坏。

您正在有效地构建一个复杂的间接机制，而不是使用为将信息传递给方法而**设计**的语言特性——<strong>方法参数。

为什么要使用属性？你在别处读过它们吗？

如果您这样做，并且您不想重复`"Email"`作为`GetValue`调用的参数和属性值，则可以考虑将属性传递`Expression<>`给`GetValue`，这将提取属性。这类似于您的解决方案，但它是明确的：

```
[UserPreferenceProperty(Category = "Email", DefaultValue = "My default value")]
public string Signature
{
    get { return GetValue (prefs => prefs.Signature); }
    set { SetValue (prefs => prefs.Signature, value); }
} 
```

[这个答案显示了如何实现这一点。](https://stackoverflow.com/a/1560950/458193)

我看到你正在检查`Thread.CurrentPrincipal`你的代码。同样，这不是一个非常好的做法，因为对于客户端代码来说，访问属性会导致异常并不*明显。*对于支持您的代码的人来说，这将是一场调试噩梦（相信我，[您的代码可能会在生产中运行多年，在您转移到另一个项目之后很久](http://www.johndcook.com/blog/2012/12/19/more-on-the-lindy-effect/)）。

相反，您应该为您的设置类构造函数创建`VTXIdentity` **一个参数。**这将确保调用代码**知道**您在此级别上强制执行安全性，并且根据定义知道从哪里获取此令牌。**此外，这允许您在知道有问题时立即**抛出异常，而不是在访问某些属性时。这将帮助维护人员更早地发现错误——就像编译错误比运行时错误更好一样。

[最后，虽然这是一个有趣的练习，但在 C# 中存储和读取配置](http://www.google.com/search?q=store+configuration+c%23)有很多高性能且经过测试的解决方案。为什么你认为你需要重新发明轮子？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-12-29T00:55:04.063

假设您的问题在讨论您是否可以只使用另一个库而不是滚动自己的库的讨论中幸存下来......如果您发现自己使用 C# 5 &.NET 4.5，请查看[CallerMemberName](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.callermembernameattribute.aspx)属性。使用 CallerMemberName 您可以将 GetValue() 方法签名修改为

```
public static string GetValue([CallerMemberName] string callerName = "") 
```

然后，该属性可以不带参数调用 GetValue()，您将根据需要将属性名称传递给 GetValue()。

# php - PHP的explode/implode的时间复杂度

> ID：14077154
> 
> 赞同：3
> 
> 时间：2012-12-28T23:39:12.393
> 
> 标签：php, algorithm, time-complexity

如果知道 PHP 用于爆炸/内爆函数的算法以及它们的时间复杂度是多少，我很感兴趣？

先感谢您。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-12-28T23:59:47.693

在[`string.c`](https://github.com/php/php-src/blob/master/ext/standard/string.c)你可以看到算法。它从大约[1021 行](https://github.com/php/php-src/blob/master/ext/standard/string.c#L1021)开始..

```
 if (p2 == NULL) {
    add_next_index_stringl(return_value, p1, Z_STRLEN_P(str), 1);
    } else {
    do {
        add_next_index_stringl(return_value, p1, p2 - p1, 1);
        p1 = p2 + Z_STRLEN_P(delim);
    } while ((p2 = php_memnstr(p1, Z_STRVAL_P(delim), Z_STRLEN_P(delim), endp)) != NULL &&
             --limit > 1);

    if (p1 <= endp)
        add_next_index_stringl(return_value, p1, endp-p1, 1);
    } 
```

它只是一个循环所以我称之为**复杂`O(N)`性**。并仔细检查代码。它扫描字符串并将结果添加到`return_value`. 所以是的。**其线性**。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-29T09:37:36.953

**简答：**对于单字节分隔符，`explode`的时间复杂度在Ο( *N* ‍)；但是对于多字节分隔符，它的时间复杂度是Ο( *N‍* <sup>2)。

`implode`显然在Ο( *N* ‍) 中，因为它只是将各个部分粘合在一起。

**扩展答案：**的[基本算法`explode`](https://github.com/php/php-src/blob/master/ext/standard/string.c#L1009)是在字符串中搜索*分隔符的出现并将包含的子**字符串*复制到一个新数组中。

要在*string中查找**分隔符*的位置，它使用[内部函数](https://github.com/php/php-src/blob/master/Zend/zend_operators.h#L249)（只是 的别名）。对于单个字节，它只是调用进行线性搜索（因此在 Ο( *N* ) 中）。*[`zend_memnstr`](https://github.com/php/php-src/blob/master/Zend/zend_operators.h#L249)`php_memnstr``zebd_memnstr``memchr`*

 **但是对于长于一个字节的*定界符*`memchr`值，它会调用来搜索*定界符*在*字符串中的第一个字节的位置，测试**定界符*的最后一个字节是否存在于*字符串*中的预期位置，并调用`memcmp`来检查它们之间的字节。所以它基本上检查*分隔符*是否包含在任何可能位置的*字符串中。*这听起来已经很像 Ο( *N* ‍<sup>2)。

现在让我们看一下该算法的最坏情况，其中模式的第一个和最后一个字节都适合，但倒数第二个不适合，例如：

```
string:     aaaabaaaa
delimiter:  aaaaaa

aaaabaaaa
aaaaXa      (1+1+5)
 aaaX?a     (1+1+4)
  aaX??a    (1+1+3)
   aX???a   (1+1+2) 
```

A`X`表示不匹配`memcmp`和`?`未知字节。括号中的值是统一度量的时间复杂度。这将总结为

> Σ (2+ *i* ) for *i*从*M* -floor( *N* /2) 到 ceil( *N* /2)

或者

> ( *N* -‍<em>M+1)·2 + Σ *i* - Σ *j*对于*i*从 1 到 ceil( *N* /2), *j*从 1 到*M* - floor( *N* /2)-1。

由于 Σ *i* for *i*从 1 到*N*可以表示为*N* ·( *N* +1)/2 = ( *N* ² + *N* )/2，我们也可以写成：

> ( *N* -‍<em>M+1)·2 + (ceil( *N* /2) ² +ceil( *N* /2))/2 - (( *M* -floor( *N* /2)-1) ² +( *M* -地板( *N* /2)-1))/2

为简单起见，我们假设*N*和*M*总是偶数，所以我们可以省略 'ceil's 和 'floor's：

> ( *N* -‍<em>M+1)·2 + (( *N* /2+1) ² + *N* /2+1)/2 - (( *M* -‍<em>N/2-1) ² +( *M* -‍<em>N/2)-1)/2
> = ( *N* -<em>M+1)·2 + *N* ² /8+3· *N* /4+1 - (( *M* -‍<em >N/2-1) ² +( *M* -‍<em>N/2)-1)/2

此外，我们可以向上估计值：*N* -‍<em>M < *N*和*M* -‍<em>N/2-1 < *N*。因此我们得到：

> *N* ·2 + *N* ² /8+3· *N* /4+1 - ( *N* ² + *N* )/2
> < *N* ·2 + *N* ² +4· *N* - *N* ² + *N*

这证明`explode`了多字节分隔符在Ο( *N* ² ) 中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-29T00:00:17.263

根据 GitHub 上的 PHP 资源，它是线性的。你可以`explode()` [在这里查看](https://github.com/php/php-src/blob/master/ext/standard/string.c#L1009)。**

# jsf - 未执行 commandLink 操作

> ID：14077155
> 
> 赞同：3
> 
> 时间：2012-12-28T23:39:18.083
> 
> 标签：jsf, jsf-2

我有以下 XHTML：

```
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">
    <head>
        <title>TODO supply a title</title>
    </head>
    <body>
        <f:metadata>
            <f:viewParam id="productCV" name="productName" value="#{productBean.product}"
                         converter="#{productConverter}" required="true"/>
        </f:metadata>

        <ui:composition template="/templates/mastertemplate.xhtml">
            <!-- Define the page title for this page-->
            <ui:define name="pageTitle">
                <h:outputFormat value="#{msgs.productPageTitle}">
                    <f:param value="#{productBean.product.description}"/>
                </h:outputFormat>
            </ui:define>

            <!-- Pass the categoryName parameter to the sidebar so the category of this product is highlighted-->
            <ui:param name="categoryName" value="#{productBean.product.categoryName}"/>

            <ui:define name="content">
                <!-- If productconversion failed, show this error-->
                <h:message id="error" for="productCV" style="color: #0081c2;" rendered="#{productBean.product == null}" />

                <!-- If productconversion succeeded show the product page-->
                <h:panelGroup rendered="#{productBean.product != null}">
                    <p>#{productBean.product.description} #{productBean.product.categoryName}</p>
                    <h:form>
                        <h:commandLink action="#{cartBean.addItemToCart(productBean.product)}">
                            <f:ajax event="action" render=":cart :cartPrice" />
                            <h:graphicImage value="resources/img/addToCart.gif"/>
                        </h:commandLink>
                    </h:form>
                </h:panelGroup>
            </ui:define>
        </ui:composition>
    </body>
</html> 
```

在顶部，我接受一个字符串作为 GET 参数，我通过转换器运行它然后获取一个`Product`对象，我将它放在 中`productBean.product`，该 bean 具有`Product`属性的 setter 和 getter，仅此而已。

然后我使用这个对象来显示信息等。这很好。我还`commandLink`使用 AJAX 将其添加到我的购物车中。`ProductBean`如果我在，这将拒绝工作`RequestScope`，当我把它放进去时，`SessionScope`它会起作用，但只会添加产品 1 次。

据我所知，这应该是直截了当的`RequestScope`，我不明白为什么它可以与`SessionScope`.

我已经阅读了[这篇](https://stackoverflow.com/questions/2118656/hcommandlink-hcommandbutton-is-not-being-invoked)文章，但我认为我没有违反任何这些规则。

为了完整起见，这是我的`ProductBean`：

```
import be.kdg.shop.model.stock.Product;
import java.util.logging.Logger;
import javax.enterprise.context.RequestScoped;
import javax.inject.Named;

@Named
@RequestScoped
public class ProductBean {

    private static final Logger logger = Logger.getLogger(ProductBean.class.getName());
    private Product product;

    public ProductBean() {}

    public Product getProduct() {
        return product;
    }

    public void setProduct(Product product) {
        this.product = product;
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-12-29T03:25:56.527

您的 bean 是请求范围的。因此，bean 实例的生命周期与单个 HTTP 请求-响应周期一样长。

当第一次请求带有表单的页面时，会创建一个新的 bean 实例，该实例接收一个具体`product`属性作为视图参数。在生成并发送相关响应后，bean 实例被丢弃，因为它是请求的结束。

提交表单时，实际上会触发一个新的 HTTP 请求，因此会创建一个新的 bean 实例，其中所有属性都设置为默认值，包括`product`属性。这种方式`#{productBean.product}`适用`null`于整个请求。命令链接的父组件的`rendered`属性将评估`false`。因此，命令链接动作永远不会被解码。这与[未调用的 commandButton/commandLink/ajax 操作/侦听器方法的第 5 点相匹配，或者](https://stackoverflow.com/questions/2118656/hcommandlink-hcommandbutton-is-not-being-invoked/2120183#2120183)您已经找到的输入值未更新，但显然并没有真正理解。

解决方案是将 bean 放在视图范围内。只要您与同一个 JSF 视图交互（提交/回发），视图范围的 bean 就存在。标准的 JSF 提供[`@ViewScoped`](http://docs.oracle.com/javaee/6/api/javax/faces/bean/ViewScoped.html)了这个。当您使用 CDI 而不是 JSF 来管理 bean 时，最好的选择是 CDI [`@ConversationScoped`](http://docs.oracle.com/javaee/6/api/javax/enterprise/context/ConversationScoped.html)。这是相对笨拙的（您必须自己开始和结束范围），因此一些 CDI 扩展，例如提供 a 的[MyFaces CODI](http://myfaces.apache.org/extensions/cdi/)`@ViewAccessScoped`可能更有用。

### 也可以看看：

*   [如何选择合适的bean范围？](https://stackoverflow.com/questions/7031885/how-to-choose-the-right-bean-scope/7031941#7031941)

# jquery - Ajax Post 刷新一个 div

> ID：14077164
> 
> 赞同：1
> 
> 时间：2012-12-28T23:40:25.643
> 
> 标签：jquery, ajax

我正在使用 AJAX 并发送帖子。在响应 200 Ok 我可以看到我能够看到我想要的 div。但是该数据已被替换但正在附加。你能指导我如何调试这些类型的问题并修复它们。

```
request.done(function(response) {
alert('Loaded.');
$('#data1').html(response);
}); 
```

我可以看到“已加载”警报即将到来。这样就完成了。在萤火虫上，我可以看到 200 OK 的数据。

1) #data1 是一个 Javascript 模板。因此，我正在尝试更新该模板，该模板将触发表中的数据并全部进行修改。

数据是：

```
<divid='data1'>
<script> ...................</script>
</div> 
```

所以我看到数据正在更新。但旧数据没有被删除。我试过：也用那个替换，它只是附加页面而不是替换它

=

这个 Div 是一个 Javascript 模板。所以这个 div 为：

```
<div id='data1'><script> .....</script></div> 
```

1.  在我的浏览器上，数据总是在更新而不是被替换。
2.  一个更基本的问题，如果我得到回复，那就是附加数据。当我看到视图源时，甚至显示显示示例 20 个条目。它只显示 10 个初始条目，当收到响应时使用 Ajax，源不会被修改吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:05:41.630

它应该是

```
request.done(function(response) {
 alert('Loaded.');
 $('#data1').html(response);
 }); 
```

并且标记 hsa 也是一个错字，以便与良好的标记更加内联

```
<div="data1">
  <script> ...................</script>
</div>
 <!-- use / instead of \ to close tags--> 
```

干杯

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-01T09:42:01.530

```
<div=data1>
<script> ...................</script>
</div> 
```

不是有效的 HTML。它应该是：

```
<div id='data1'>
<script> ...................</script>
</div> 
```

您缺少`id=`属性的一部分。

# cursor - 在文本编辑器中突出显示垂直列光标？

> ID：14077165
> 
> 赞同：2
> 
> 时间：2012-12-28T23:40:43.417
> 
> 标签：cursor, editor, indentation, highlight

我正在寻找一个基本的文本编辑器或现有编辑器的插件，它可以突出显示整个当前列或光标的垂直位置，类似于突出显示整个当前选定行或行的常用选项。

我认为这对缩进代码非常有用。

有谁知道我在哪里可以找到这样的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-08-10T14:22:22.610

我完全了解您在寻找什么并且自己想要它。我使用 Notepad++（基于 Scintilla），但似乎没有像他们为“突出显示当前行”提供的方式*那样*提供“突出显示当前列”选项。

我查看了插件架构和演示插件包。我提出了一个概念证明 - 非常基本，肯定有问题，它使用长线边缘列指示器作为当前光标列的“突出显示”。不是最好的解决方案，因为如果您使用边缘指示器，您会“丢失”它。

GitHub上的源代码：

[https://github.com/vinsworldcom/nppColHighlight](https://github.com/vinsworldcom/nppColHighlight)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-15T02:30:50.370

[**记事本++**](http://notepad-plus-plus.org/)

它基于[Scintilla](http://www.scintilla.org/)库，它完全实现了您所描述的功能，基本上突出显示了一个矩形区域。

为此，请按住`Alt`+`Left Mouse`或`Alt`+ `Shift`+`Arrow Keys`进行选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-11-18T20:53:56.160

如果你还没有找到这样的编辑器，PSPad 编辑器有这个功能。链接：[https](https://www.pspad.com/) ://www.pspad.com/ 请看附件截图（不用担心我截图中的编辑器语言，英文（和其他几种语言）也可以）。 [带有显示当前光标位置的垂直线的 PSPad 编辑器](https://i.stack.imgur.com/JI5cC.png)

# c# - 如何从 html/css 样式字符串（即：Futura、Verdana、Arial）在 C# winforms 控件（例如 TextBox）中设置 FontFamily

> ID：14077168
> 
> 赞同：2
> 
> 时间：2012-12-28T23:41:15.630
> 
> 标签：c#, winforms, fonts

有没有办法在 C# 中设置将接受逗号分隔的字体列表的 Windows 窗体控件的字体？我想要类似于浏览器如何解释 CSS 字体系列的东西，直到它找到安装在计算机上的第一个字体。

例子：

```
string fontList = "Obscure Font1, Obscure Font2, Verdana"
textBox1.Font = new Font( FontFamilyFromHtml(fontList), FontStyle.Bold); 
```

.NET 中是否有任何内置内容，或者您​​是否需要创建一种将字符串拆分为逗号的方法，然后为每个字体测试已安装的字体列表，直到找到匹配项？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:54:19.363

没有开箱即用的 API 调用，因此您必须拆分字符串并搜索已安装的字体。

这是一个使用[InstalledFontCollection](http://msdn.microsoft.com/en-us/library/system.drawing.text.installedfontcollection.aspx)来做到这一点的实现：

```
private FontFamily FindFontByCSSNames(string cssNames)
{
    string[] names = cssNames.Split(',');
    System.Drawing.Text.InstalledFontCollection installedFonts = new System.Drawing.Text.InstalledFontCollection();
    foreach (var name in names)
    {

        var matchedFonts = from ff in installedFonts.Families where ff.Name == name.Trim() select ff;

        if (matchedFonts.Count() > 0)
            return matchedFonts.First();
    }

    // No match, return a default
    return new FontFamily("Arial");
} 
```

# javascript - 每个绑定的多个模型绑定和调试数据

> ID：14077174
> 
> 赞同：0
> 
> 时间：2012-12-28T23:42:29.280
> 
> 标签：javascript, knockout.js

我使用以下语法将三个视图模型绑定附加到单个页面：

```
ko.applyBindings(new SomeViewModel(), document.getElementById("some-id-element")); 
```

我想在测试页面时进行数据转储以观察模型状态。在我走多模型路线之前，我使用以下内容查看页面底部的页面模型数据。

```
<pre data-bind="text: ko.toJSON($root, null, 2)"></pre> 
```

自然，现在 $root 上下文已被移入特定元素，仅使用 $root 就不会返回任何内容。我很难理解如何定位每个单独的视图模型，以便查看每个视图的特定数据。

我尝试将新模型分配为全局变量

```
testVar = new SomeViewModel();
ko.applyBindings(testVar, document.getElementById("some-id-element")); 
```

并使用了以下示例：

```
<pre data-bind="text: ko.toJSON(testVar, null, 2)"></pre>
<pre data-bind="text: ko.toJSON(testVar.$root, null, 2)"></pre>
<pre data-bind="text: ko.toJSON($element.some-id-element, null, 2)"></pre> 
```

这些测试中的任何一个都不会返回任何内容

由于我显然不了解这里的范围，我希望有人可以教育我我缺少什么。

谢谢你，

卡里。

*编辑拼写。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:26:39.880

您可以将调试字段绑定到视图模型的组合：

```
ko.applyBindings({vm1: vm1, vm2: vm2, vm3: vm3},
    document.getElementById("debug")); 
```

```
<div id="debug">
    <pre data-bind="text: ko.toJSON(vm1, null, 2)"></pre>
    <pre data-bind="text: ko.toJSON(vm2, null, 2)"></pre>
    <pre data-bind="text: ko.toJSON(vm3, null, 2)"></pre>
</div> 
```

[​http://jsfiddle.net/MizardX/jxM9f/](http://jsfiddle.net/MizardX/jxM9f/)

或者，您应该能够访问全局变量。（假设它们确实是全局变量）

[http://jsfiddle.net/MizardX/2Y6DF/](http://jsfiddle.net/MizardX/2Y6DF/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T15:03:34.023

我更喜欢创建处理 ko.toJSON 方法的辅助函数。然后我在调用助手的视图模型上放置一个 ko.computed。这样我可以将视图模型上的 ko.computed 绑定到视图并显示它。如果我有多个视图模型绑定到一个视图，我可以使用标准绑定在同一页面上为每个视图模型显示一个。

```
<pre data-bind="text: debugInfo"></pre> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:37:45.223

语法是

```
<div data-bind="text: ko.toJSON($root)"></div>​ 
```

[请参阅http://jsfiddle.net/photo_tom/eY9w8/9/](http://jsfiddle.net/photo_tom/eY9w8/9/)中的示例。如果单击任何列，则可以看到输出更改。

# html - 在 bash 中从 html 中提取 td/tr？

> ID：14077175
> 
> 赞同：1
> 
> 时间：2012-12-28T23:42:32.123
> 
> 标签：html, bash, web-scraping, html-table

我得到了[http://www.cpubenchmark.net/cpu_list.php](http://www.cpubenchmark.net/cpu_list.php)页面，我想提取给定 CPU 的名称、排名和基准分数。

示例（“英特尔酷睿 i5”）：

```
Intel Core i5-3450 @ 3.10GHz - Score: 3333 - Rank: 1
Intel Core i5-3450S @ 2.80GHz - Score: 2222 - Rank: 2
Intel Core i5-2380P @ 3.10GHz - Score: 1111 - Rank: 3
... 
```

我怎么能在 bash 中做到这一点？试图从类似的东西开始（没有 cpu 过滤 - 不知道它是如何工作的）：

```
#!/bin/sh
curl http://www.cpubenchmark.net/cpu_list.php | grep '^<TR><TD>' \
| sed \
    -e 's:<TR>::g'  \
    -e 's:</TR>::g' \
    -e 's:</TD>::g' \
    -e 's:<TD>: :g' \
| cut -c2- >> /home/test.txt 
```

输出是这样的：

```
<A HREF="cpu_lookup.php?cpu=686+Gen&amp;id=1495">686 Gen</A> 288 1559 NA NA
<A HREF="cpu_lookup.php?cpu=AMD+A10-4600M+APU&amp;id=10">AMD A10-4600M APU</A> 3175 388 NA NA
<A HREF="cpu_lookup.php?cpu=AMD+A10-4655M+APU&amp;id=11">AMD A10-4655M APU</A> 3017 406 NA NA 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:13:59.423

如果你想下载一个额外的程序，你可以使用我的[Xidel](http://videlibri.sourceforge.net/xidel.html)：

所有 CPU：

```
xidel http://www.cpubenchmark.net/cpu_list.php -e '//table[@id="cputable"]//tr/concat(td[1], " - Score: ", td[2], " - Rank: ", td[3])' 
```

那些以英特尔开头的...：

```
xidel http://www.cpubenchmark.net/cpu_list.php -e '//table[@id="cputable"]//tr[starts-with(td[1], "Intel Core i5")]/concat(td[1], " - Score: ", td[2], " - Rank: ", td[3])' 
```

它甚至可以对它们进行排名（以前从未使用过该功能）：

```
xidel http://www.cpubenchmark.net/cpu_list.php -e 'for $row in //table[@id="cputable"]//tr[starts-with(td[1], "Intel Core i5")] order by $row/td[3] return $row/concat(td[1], " - Score: ", td[2], " - Rank: ", td[3])' --extract-kind=xquery 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:38:56.610

严格针对当前页面格式量身定制的 bash 解决方案：

```
#! /bin/bash

function nextcell
{
    cell=${line%%</TD>*}
    # remove closing link tag if any
    cell=${cell%</?>}
    cell=${cell##*>}
    line=${line#*</TD>}
}

while read line
do
    if [[ ! "$line" =~ cpu_lookup.php ]]
    then
        continue
    fi
    nextcell
    echo -n "$cell"
    nextcell
    echo -n " - Score: $cell"
    nextcell
    echo " - Rank: $cell"
done 
```

# html - 解释时间戳

> ID：14077176
> 
> 赞同：0
> 
> 时间：2012-12-28T23:42:35.503
> 
> 标签：html, json

我试图解释一系列代表时间的数字，以便我可以在不久的将来将它们更改为不同的数字。135671800有多长？每个是什么意思？是 DD:HH:MM:SS 吗？

```
{"next_timestamp":1356751800,"next_duration":9000,"next_title":"Saturday Night","next_description":"Hearing and Healing"} 
```

解释结果的原始 javascript 是：

```
else if (typeof data.next_timestamp !== "undefined") {
        seconds_till = data.next_timestamp - (new Date().getTime() / 1000);
        days = Math.floor((seconds_till % 31536000) / 86400);
        hours = Math.floor((seconds_till % 86400) / 3600);
        minutes = Math.floor((seconds_till % 3600) / 60);
        seconds = Math.floor(seconds_till % 60);
        return intervalId = setInterval(function() {
          if (--seconds < 0) {
            seconds = 59;
            if (--minutes < 0) {
              minutes = 59;
              if (--hours < 0) {
                hours = 23;
                  if (--days < 0) {
                days = 365;
                }
              }
            }
          } 
```

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:04:50.930

如果您使用的是标准时间戳，则可以只使用 Javascript Date 对象。

[https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Date](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Date)

```
var date = new Date(/* timestamp * 1000 here */);
var day = date.getDay();
var month = date.getMonth();
var year = date.getFullYear(); 
```

不知道你的间隔是什么，但如果你想把这个倒数到 0...

```
// Assume that date still exists.
time = date.getTime() / 1000;
time--;
date = new Date(time * 1000);
day = date.getDay();
month = date.getMonth();
year = date.getFullYear(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-28T23:49:16.333

它是“纪元”（自 1970 年 1 月 1 日午夜协调世界时 (UTC) 以来经过的秒数）的秒数。实际上 2012 年 12 月 29 日星期六 03:30:00 GMT

在此处查看实时计数器 [http://www.epochconverter.com/](http://www.epochconverter.com/)

更多关于 UNIX 时间[http://en.wikipedia.org/wiki/Unix_time](http://en.wikipedia.org/wiki/Unix_time)

# ruby - Ruby：如何使用 sprintf() 在数字字符串前面添加零

> ID：14077180
> 
> 赞同：11
> 
> 时间：2012-12-28T23:43:00.267
> 
> 标签：ruby, string

我想将邮政编码规范化为 5 位数长，用零替换任何缺失的字符，如下所示：

```
"95616" >> "95616"
"854"  >> "00854"
"062" >> "00062"
"0016" >> "00016" 
```

我试过像这样`sprintf("%05s", zipcode)`和那样 使用 sprintf `sprintf("%0.5d", zipcode)`。两者都给出了错误的答案。使用`s`：

```
"95616" >> "95616"
"854"   >> "  854"
"062"   >> "  062"
"0016"  >> " 0016" 
```

这是正确的字符数，但使用空格，而不是零。

使用`d`：

```
"95616" >> "95616"
"854"   >> "00854"
"062"   >> "00050"
"0016"  >> "00014" 
```

在这种情况下， sprintf() 的正确用途是什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-12-28T23:51:35.610

不要折磨自己`sprintf`：

```
puts "123".rjust(5, '0') # => 00123 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-12-28T23:58:56.463

您对 sprintf 的使用很好。您的问题是 062（和 0016）是八进制的（任何以 0 开头的整数也是如此），并且在转换为 base10 时变为 50。

解决方案是在 0 到达您的 Ruby 应用程序之前摆脱它。假设它是一个字符串（因为您的示例显示字符串），您可以执行以下操作：

```
"062".gsub /^0/, '' 
```

然后继续填充和打印格式。

另一种方法是如果您知道它以 0 开头，则*故意将其打印为八进制：*

```
"%05o" % 062 # => "00062" 
```

当然，如果您可以控制输入，最好的办法是确保人们不会通过输入您不期望的数字来破坏您的代码。例如。

```
"%05s" % 0xff0055 # => 16711765
"%05x" % 0xff0055 # => "ff0055" 
```

检查输入将问题从格式化问题变为验证问题，预防胜于治疗。

（古怪的 % 语法是`printf`/的糖`sprintf`）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-12-29T00:05:08.370

你想要 %05d。也 String#% 作为快捷方式：

```
"%05d" % "123" #=> 00123 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-29T09:58:58.683

whirlwin 的解决方案在我看来是一个有效的（一般填充）解决方案。只需使用 max 改进它：

```
zipcode.insert 0, '0' * ([5 - zipcode.length, 0].max) 
```

要检查它：

```
az = ["95616", "854", "062", "0016", '1', '123456']
az.collect {|zipcode| zipcode.insert 0, '0' * (5 - zipcode.length) }

$ ruby -w t.rb
t.rb:2:in `*': negative argument (ArgumentError) 
```

添加 max 以应对负值：

```
az = ["95616", "854", "062", "0016", '1', '123456']
az.collect {|zipcode| zipcode.insert 0, '0' * ([5 - zipcode.length, 0].max) }
p az

$ ruby -w t.rb
["95616", "00854", "00062", "00016", "00001", "123456"] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-28T23:51:29.077

虽然这种方法实际上不使用`sprintf`，但它应该在 1 行代码中解决您的问题：

```
zipcode.insert 0, '0' * (5 - zipcode.length) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-29T10:05:56.120

谢谢大家的意见。我希望了解更多关于 sprintf 的信息，特别是在解决方案中使用 sprintf，所有的想法都非常有帮助。我最终想出了一个针对我的问题的 hacky 解决方案，它似乎很灵活而且还没有被提及，所以我想我会发布它。

正如我所提到的，`sprintf("%05s", zipcode)`如果数字字符串不够长，将返回空格而不是零，但它确实返回了正确数量的空格 - 所以我只是将 a 链接`gsub`到末尾以用零替换空格。

```
sprintf("%05s", zipcode).gsub!(" ", "0") 
```

如果此解决方案有任何重大问题，请告诉我。我已经对其进行了测试，到目前为止它似乎有效。

# javascript - 对象过滤方法数组中的 THIS 关键字

> ID：14077185
> 
> 赞同：2
> 
> 时间：2012-12-28T23:43:53.187
> 
> 标签：javascript, arrays, this

我不知道为什么会出现此错误：

错误是：无法获得“0”的值：对象为空或未定义

这是我的代码：

```
var Box = function(width, height, type){
var top = 0,
    right = 0;
this.width = width;
this.height = height;
this.position = {
    top: top,
    right: right,
    set: function(top, right){
        this.top = top;
        this.right = right;
    }
};
this.type = type;
this.area = this.width * this.height;
this.className = "box_" + this.width + "_" + this.height;};

    var box01 = new Box(2, 2, "slideShow");
    var box02 = new Box(2, 1, "clinics");
    var box03 = new Box(1, 2, "articles");
    var box04 = new Box(1, 1, "news");
    var box05 = new Box(2, 1, "news");
    var box06 = new Box(2, 1, "clinics");

    var boxArray = [];
    boxArray.push(box01);
    boxArray.push(box02);
    boxArray.push(box03);
    boxArray.push(box04);
    boxArray.push(box05);
    boxArray.push(box06);

var BoxUtility = function(parentId) {
this.parentId = parentId;
this.boxList = Array.prototype.pop.apply(arguments);
Object.defineProperties(this, {
    totalArea: {
        get: function(){
            var x = 0;
            for(var i = 0, len = this.boxList.length; i <= len - 1; i++){
                x = x + this.boxList[i].area;
            };
            return x;
        }
    },
});};

BoxUtility.prototype.positionCalculateMasonry = function(preDefinedRows, firstColumnWidth, restColumnWidth, itemIndex){
var firstColumnArea = preDefinedRows * firstColumnWidth,
    restColumnArea = preDefinedRows * restColumnWidth,
    firstColumnAreaRemained = firstColumnArea,
    restColumnAreaRemained = restColumnArea,
    Position = function(top, right){
        this.top = top;
        this.right = right;
        this.restFirstWidth = firstColumnWidth - right;
        this.restSecondWidth = restColumnWidth - right;
    },
    firstPosition = new Position(0, 0),
    positionStack = [],
    boxStack = [],
    indexStack = [];

positionStack.push(firstPosition);

for(var i = itemIndex, len = this.boxList.length; i <= len - 1; i++){
    if(this.boxList[i].area <= firstColumnAreaRemained){
        var temp = positionStack.filter(function(el){
            return (el.restFirstWidth >= this.boxList[i].width);
        });
    } else {

    };
};};

var x = new BoxUtility(clinica ,boxArray);
x.positionCalculateMasonry(5, 3, 2, 0); 
```

我在这里收到此错误：

```
return (el.restFirstWidth >= this.boxList[i].width); 
```

我相信它关于在过滤方法中传递 this 关键字

有什么帮助吗？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-28T23:52:14.323

```
BoxUtility.prototype.positionCalculateMasonry = function(preDefinedRows, firstColumnWidth, restColumnWidth, itemIndex){
var firstColumnArea = preDefinedRows * firstColumnWidth,
    restColumnArea = preDefinedRows * restColumnWidth,
    firstColumnAreaRemained = firstColumnArea,
    restColumnAreaRemained = restColumnArea,
    Position = function(top, right){
        this.top = top;
        this.right = right;
        this.restFirstWidth = firstColumnWidth - right;
        this.restSecondWidth = restColumnWidth - right;
    },
    firstPosition = new Position(0, 0),
    positionStack = [],
    boxStack = [],
    indexStack = [],
    that = this;

positionStack.push(firstPosition);

for(var i = itemIndex, len = this.boxList.length; i <= len - 1; i++){
    if(this.boxList[i].area <= firstColumnAreaRemained){
        var temp = positionStack.filter(function(el){
            return (el.restFirstWidth >= that.boxList[i].width);
        });
    } else {

    };
};}; 
```

海报代码的问题是上下文在回调中不可用。添加的是一个变量'that'来保存上下文。然后使用闭包将上下文传递给回调。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:51:55.517

关键字将根据`this`它被调用的上下文引用不同的对象。

简单地说，错误表示`boxList`没有在引用的对象内*定义*`this`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-28T23:55:06.477

`filter`函数内部的`this`含义与外部不同，因为函数本身就是一个对象方法。

您需要将外部存储在另一个变量中，然后通过闭包`this`将其传递给函数：`filter`

```
// Outside the for loop
var that=this;
...
// Inside filter()
return el.restFirstWidth >= that.boxList[i].width; 
```

# mysql - 作为 LEFT JOIN 语句的一部分，返回过去 30 天内的项目的 count()

> ID：14077189
> 
> 赞同：1
> 
> 时间：2012-12-28T23:44:16.953
> 
> 标签：mysql, sql, left-join

我当前的 SQL 看起来像这样 -

```
SELECT i.id, 
       i.name,
       i.description,
       c.name campaign,
       count(h.id) hits
FROM items i 
LEFT JOIN campaigns c ON c.id = i.campaignid
LEFT JOIN links l ON l.itemid = i.id
LEFT JOIN hits h ON h.linkid = l.id
GROUP BY i.id 
```

我想对此进行修改，以便返回带有 h.id 的 count() 的第 6 列，但仅包括过去 30 天的“命中”。因此，假设总共有 100 次“点击”，过去 30 天内有 50 次，那么第 5 列将是 100，第 6 列将是 50。

抱歉，如果我的描述很罗嗦...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-28T23:51:09.870

```
SELECT i.id, 
       i.name,
       i.description,
       c.name campaign,
       count(h.id) hits,
       COUNT( CASE WHEN h.hitdate >= CURDATE() - INTERVAL 29 DAY
                     THEN h.hitdate 
                     ELSE NULL
              END
            ) AS last_30_days_hits
FROM ... 
```

您可以使用更短的（但不一定更快）：

```
 SUM( h.hitdate >= CURDATE() - INTERVAL 29 DAY )
         AS last_30_days_hits 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-28T23:53:45.617

您应该可以添加一个where子句吗？类似于...的东西

```
WHERE DATE_SUB(CURDATE(),INTERVAL 30 DAY) <= h.hitdate 
```

h.hitdate 将是命中记录的日期时间字段。如果您使用时间戳，只需计算 h.hitdate >= (time() - 2592000) 的位置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:40:41.320

您可以在 ON 子句或 WHERE 子句中添加 30 天过滤器，如下所示：

```
LEFT JOIN hits h ON h.linkid = l.id AND h.hitdate >= DATE_SUB(CURDATE(),INTERVAL 30 DAY) 
```

或者

```
WHERE h.hitdate >= DATE_SUB(CURDATE(),INTERVAL 30 DAY) 
```

# java - 登录后 Spring MVC 控制器重定向到某个 URL

> ID：14077190
> 
> 赞同：4
> 
> 时间：2012-12-28T23:44:43.033
> 
> 标签：java, spring-mvc, thymeleaf

我有一个带有如下处理程序的 Spring MVC 控制器：

```
@RequestMapping(value = "/account/login", method = RequestMethod.GET)
public String login() {
    return "login";
}

@RequestMapping(value = "/account/login", method = RequestMethod.POST, params = "login")
public String login(@RequestParam(value = "username") String username, 
        @RequestParam(value = "password") String password) {

    // do authentication
    return "home";
} 
```

login.html 页面中的表单 POST 到 account/login（相同的 url）。我希望在身份验证之后，我将用户重定向到我的应用程序的主页，以便他`www.mywebappexample.com`在地址栏中看到而不是`www.mywebappexample.com/account/login`. 当我从登录方法返回字符串时，它会呈现正确的 html，但我没有要显示的 URL。我该如何重定向？

**编辑：**我必须在我的控制器返回字符串前加上`redirect:`. 如果您有一个子类 UrlBasedViewResolver [UrlBasedViewResolver](http://static.springsource.org/spring/docs/2.0.x/api/org/springframework/web/servlet/view/UrlBasedViewResolver.html)的视图解析器，则此方法有效。Thymeleaf 的视图解析器没有这样做，但它确实具有行为 -> [ThymeleafViewResolver](http://www.thymeleaf.org/apidocs/thymeleaf-spring3/2.0.8/org/thymeleaf/spring3/view/ThymeleafViewResolver.html)。这是我的 servlet-context.xml（我使用的是百里香）：

```
<bean id="templateResolver"
      class="org.thymeleaf.templateresolver.ServletContextTemplateResolver">
    <property name="prefix" value="/WEB-INF/"/>
    <property name="suffix" value=".html"/>
    <property name="templateMode" value="HTML5"/>
</bean>

<bean id="templateEngine" class="org.thymeleaf.spring3.SpringTemplateEngine">
    <property name="templateResolver" ref="templateResolver"/>
</bean>

<bean id="viewResolver" class="org.thymeleaf.spring3.view.ThymeleafViewResolver">
    <property name="templateEngine" ref="templateEngine"/>
    <property name="order" value="1"/>
</bean> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-12-28T23:50:32.263

您可以在标签中使用重定向，而不是在浏览器窗口中更新 URL：

```
return "redirect:home"; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-28T23:52:35.343

检查身份验证是否成功，然后使用请求调度程序转发请求

```
RequestDispatcher rd = servletContext.getRequestDispatcher("/pathToResource");
 rd.forward(request, response); 
```

# angularjs - AngularJS 表单项验证属性之前 标签

> ID：14077192
> 
> 赞同：0
> 
> 时间：2012-12-28T23:45:15.390
> 
> 标签：angularjs

这是AngularJS中的正常行为吗？与 FORM 相关并在 FORM（或 INPUT）标记之前引用的 ng-class 表达式只有在该表单元素的验证状态发生更改时才正确计算（尝试在小提琴中输入有效的电子邮件）。三个相同的 H2-s 在标签前显示不同的表达式计算，在电子邮件输入编辑后显示正确的值（注意 {{TestForm.Email.$valid}} 在两种情况下都显示正确的值）：

JSFiddle：http: [//jsfiddle.net/nEzpS/26/](http://jsfiddle.net/nEzpS/26/)

```
HTML:
<div ng-controller="TestController">

    <h2 class="someInitialClass" ng-class="TestForm.Email.$valid && 'classOK' || 'classError'">Email field validation result is <b>{{TestForm.Email.$valid}}</b></h1>

    <form name="TestForm" ng-submit="formSubmit()">

         <input type="email" class="input-xlarge" maxlength="100"
                             name="Email" 
                             ng-model="Client.Email" 
                             ng-required="true" ng-maxlength="100"
        >

    </form>

    <h2 class="someInitialClass" ng-class="TestForm.Email.$valid && 'classOK' || 'classError'">Email field validation result is <b>{{TestForm.Email.$valid}}</b></h1>

    <br/><br/>

    <ul ng-repeat="FormItem in TestForm">
        <li>{{$index}} {{FormItem.$error}}
        </li>
    </ul>

    <br/><br/>

</div>

JS:
function TestController($scope) {

}​
​
CSS:
.someInitialClass {
    font-family: Helvetica;
}

.classError {
    color:red;
}

.classOK {
    color: green;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T06:41:11.493

这有点奇怪。

要获得基于表单状态的表单验证消息的一致行为，您可能需要对表单使用 ngPristine 检查。[像这样](http://jsfiddle.net/mahbub/nEzpS/27/)

```
 <h2 class="someInitialClass" ng-class="!TestForm.$pristine && (TestForm.Email.$valid && 'classOK' || 'classError')">Email field validation result is <b>{{TestForm.Email.$valid}}</b></h2> 
```

要更好地了解表单状态的工作原理，请参阅 Benjamin [Lesh 的帖子](http://www.benlesh.com/2012/11/angular-js-form-validation.html)

顺便说一句，到目前为止，还没有 API 可以将表单设置为原始状态。它在 1.2 的路线图上

# html - 列表的父子之间的宽度，以及垂直居中的父级

> ID：14077194
> 
> 赞同：0
> 
> 时间：2012-12-28T23:45:20.527
> 
> 标签：html, css, html-lists

我不知道我应该如何解释，但我想在项目 1 和 2 之间自动调整区域（空间）的宽度。我不确定它是 ul 还是 li ....

我还想将项目 1 垂直化到其子项的中心。我尝试了很多方法来处理 CSS，但我无法找到一个好的解决方案。请帮助和建议。

现在就像

```
-----                                                     -------
| P |              I want to be like this  ->             |  C  |
-----                                                     -------
     -----                                     -------    -------
     | C |                                     |  P  |    |  C  |
     -----                                     -------    -------
     -----                                                -------
     | C |                                                |  C  |
     -----                                                -------
     -----
     | C |
     -----  
                         the width of P will auto change 
```

CSS

```
.div {
    border: 1px solid #666;
    overflow: hidden;
    display: table;
    height: 30px;
    width: 100px;
}
ul{
    list-style:none;    
} 
```

HTML

```
<ul>
  <li>
    <div class="div">Item 1</div>
<ul>
  <li>
    <div class="div">Item 1.1</div>
</li>
<li>
  <div class="div">Item 1.2</div>
</li>
<li>
  <div class="div">Item 1.3</div>
</li>
<li>
  <div class="div">Item 1.4</div>
</li>
</ul>
</li>
<li>
  <div class="div">Item 2</div>
</li>
<li>
  <div class="div">Item 3</div>
</li>
<li>
  <div class="div">Item 4</div>
</li>
</ul> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T02:22:42.557

认为小提琴只是一个近似的。但是看看这个。[http://jsfiddle.net/nQvEW/138/](http://jsfiddle.net/nQvEW/138/)

我所做的是，我认为第一个 li 元素是类 parent 的父元素，并且我将它们相对于主页定位。

```
.parent {
position:relative;
} 
```

其次，我考虑了父元素内部的 ul，并将其相对于父 li（由父 li 和子 ul 元素组成）定位，并适当地应用了 left 属性。

```
.parent ul{
position:relative;
left:20%;
} 
```

第三，我将父元素内的 div 元素定位为相对于父元素是绝对的。你可以稍微调整一下，最高百分比。这实际上很重要，因为父元素需要向下移动以保持子元素的边距。对于理想情况，顶部属性值应该是 50%。

```
.parent .div {
position:absolute;
top:40%;
} 
```

​</p>

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:03:05.830

处理这个的方法很多。在您的示例中，您并没有真正表达整体宽度，所以假设您希望 P 和 C 都在一起。

```
<div class="containBoth" style="width:500px;">
  <div class="c" style="float:right;width:300px;">
    <ul>
    <li>c</li>
    <li>c</li>
  </ul>
 </div>

<div class="p" style="margin-right:20px">
    P 
</div>
</div><!-- close containBoth--> 
```

当然，我使用内联样式来提高速度。您应该像我一样分配课程并将实际的 css 放在一张表中。我只是在这里给你看。请记住，当您将某些内容向右浮动时，它需要在 html 文档中排在第一位，即 content/div/etc 以便于使用。

# drupal - 创建公共个人资料页面 drupal

> ID：14077201
> 
> 赞同：2
> 
> 时间：2012-12-28T23:46:33.060
> 
> 标签：drupal, drupal-modules, user-management

谁能告诉我在 Drupal 中是否可以实现以下目标（对于新手）

我想创建一个人们必须填写才能成为我网站成员的注册表单。

注册后，我希望他们能够登录并编辑他们的公共“个人资料”页面，如果可能的话，他们可以从预定义列表中选择多个项目（即使用复选框），所选项目在他们的公共个人资料页面上可见.

我还想要一个用于他们的个人资料页面照片的照片上传工具。

是否有任何 Drupal 模块等可以帮助我实现这一目标？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T23:59:29.457

您需要使用配置文件模块。 [这个问题](https://drupal.stackexchange.com/questions/5835/user-registration-module-for-drupal)与您的问题非常接近。您可以使用答案 :) 此外，有关所有详细信息，请查看[文档](http://drupal.org/documentation/modules/profile)。它已经在内容表中回答了您的问题；）

玩得开心！

# embedded - FIQ 和 IRQ 混合使用导致内核冻结，为什么？

> ID：14077203
> 
> 赞同：0
> 
> 时间：2012-12-28T23:46:49.733
> 
> 标签：embedded, arm, irq

3 个中断使能，1 个 UART 到 IRQ（串行端口），Timer1 到 IRQ（控制闪烁的 LED），Timer0 到 FIQ（生成输出步进信号）。

第一个 FIQ 处理程序为空：

```
void FIQ_HANDLER(void) __fiq
{
   if(FIQSTA & TIMER0)
   {
        T0CLR = 0;
        break;
   }
} 
```

IRQ 处理程序：

```
void IRQ_HANDLER(void) __irq
{
   if(IRQSTA & TIMER1)
   {
        T1CLR = 0;
        MAKE_LED_FLASH();
        break;
   }
   if(IRQSTA & UART)
   {
        BLAH_BLAH_BLAH();
        break;
   }
} 
```

上面的代码运行良好，LED 闪烁、UART 响应和其他功能都很好。但是在我向 FIQ 处理程序添加了一些代码之后，主要是设置一个计数器（uint16）并让 IO 变为高/低：

```
void FIQ_HANDLER(void) __fiq
    {
       if(FIQSTA & TIMER0)
       {
            if(cts>0)
            {
                IO_BLAH_BLAH_BLAH();
                cts--;
            }
            T0CLR = 0;
            break;
       }
    } 
```

CPU 将在启动后几秒钟（约 2 秒）锁定自身，然后 LED 停止闪烁，UART 无响应。甚至变量 cts 在开始时也设置为 0（因此无法输入 if()）。

我首先认为这可能是因为 timer0 设置得太快（这样更多的 FIQ 堆叠在一起而更少被清除）。所以我将 timer0 设置为不那么频繁。而且..好吧，启动时似乎没问题，LED一直闪烁......但是如果我通过串行端口（UART）发送一些字符，系统会立即再次锁定。-_-！怎么了？

请，如果我错过了要写在这里的任何重要信息，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T16:16:03.397

也许一个堆栈溢出并破坏了另一个堆栈。检查您是否已正确初始化 FIQ、IRQ 和其他堆栈，并且您已为每个堆栈保留足够的内存。

# php - 字符串/数组检查php

> ID：14077204
> 
> 赞同：0
> 
> 时间：2012-12-28T23:46:50.030
> 
> 标签：php, arrays, find, offset

如何检查数组的前 2 个字符是否为 0x？这是一个例子：

```
$hex = "0xFFFF";
if($hex[0:2].find('0x')==0)
{
print("0x Found.");
}
else
{
print("0x Not Found.");
} 
```

任何人都可以创建一个可行的替代方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T23:49:49.360

```
$hex = '0xFFFF';
if ($hex[0].$hex[1] == '0x')
{
    print("0x Found.");
}
else
{
    print("0x Not Found.");
} 
```

无需使用任何功能。有关它的用法，请参阅此[页面](http://php.net/manual/en/language.types.string.php#example-80)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:50:53.320

如果`$hex`是一个字符串，这很容易

```
if (strpos($hex, '0x') === 0) {
    print("0x Found.");
} else {
    print("0x Not Found.");
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-28T23:50:59.157

使用`strnicmp`（[手册](http://php.net/manual/en/function.strcmp.php)）看起来不错。

```
$hex = '0xFFFF';
if (strnicmp($hex, '0x', 2) == 0)
{
    print("0x Found.");
}
else
{
    print("0x Not Found.");
} 
```

`$hex`在var的开头查找不敏感的 '0x' 字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T00:15:19.810

您可以将[字符串字符作为数组访问](http://php.net/manual/en/language.types.string.php#example-80)以获取第一个和第二个索引并检查它们是否为 0 和 x。

```
<?php
$hex = array("0xFFF","5xFFF","0xDDD");
$len = count($hex);
$msg = "";
for ($i = 0; $i < $len; $i++) {
    if ($hex[$i][0] == "0" && $hex[$i][1] == "x") {
        $msg .= $hex[$i] . ' starts with 0x!' . "\n";
    }
}
echo ($msg);
?> 
```

# c - 共享内存矩阵乘法内核

> ID：14077206
> 
> 赞同：2
> 
> 时间：2012-12-28T23:47:16.737
> 
> 标签：c, cuda, parallel-processing, gpu, shared-memory

我正在尝试实现 CUDA C Programming Guide 中概述的基于共享内存的矩阵乘法内核。以下是内核：

```
 __global__ void matrixMultiplyShared(float * A, float * B, float * C,
                     int ARows, int AColumns,
                     int BRows, int BColumns,
                     int CRows, int CColumns) {
     float * CSub = &C[CColumns * 16 * blockIdx.y + 16 * blockIdx.x];
     float CValue = 0;
 for (int k = 0; k < (AColumns / 16); ++k) {
         float * ASub =  &A[AColumns * 16 * blockIdx.y + 16 * k];
         float * BSub = &B[AColumns*16*k + 16*blockIdx.y];
         __shared__ float As[16][16];
         __shared__ float Bs[16][16];
         As[threadIdx.y][threadIdx.x] = ASub[threadIdx.y*AColumns+threadIdx.x];
         Bs[threadIdx.y][threadIdx.x] = BSub[threadIdx.y*AColumns+threadIdx.x];
         __syncthreads();
         for (int n = 0; n < 16; ++n)
        CValue += As[threadIdx.y][n] * Bs[n][threadIdx.x];
         __syncthreads();
     }
     CSub[threadIdx.x*CColumns+threadIdx.y]=CValue;
 } 
```

虽然以下是对内核的调用：

```
 dim3 dimBlock(16, 16, 1);
 dim3 dimGrid;
 dimGrid.x = (CColumns + dimBlock.x - 1)/dimBlock.x;
 dimGrid.y = (CRows + dimBlock.y - 1)/dimBlock.y;
 matrixMultiplyShared<<<dimGrid , dimBlock>>>(deviceA , deviceB , deviceC , ARows , AColumns, BRows ,BColumns , CRows , CColumns); 
```

不幸的是，这似乎会产生不正确的结果。

任何帮助/解释将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2013-01-04T22:17:37.557

您的内核中至少有 2 个基本错误，两者都相对微不足道。你有这个：

```
 float * BSub = &B[AColumns*16*k + 16*blockIdx.y]; 
```

你应该使用这个：

```
 float * BSub = &B[AColumns*16*k + 16*blockIdx.x]; 
```

你有这个：

```
 CSub[threadIdx.x*CColumns+threadIdx.y]=CValue; 
```

你应该使用这个：

```
 CSub[threadIdx.y*CColumns+threadIdx.x]=CValue; 
```

这应该允许您在以下条件下获得基本正确性：

1.  方阵
2.  矩阵尺寸可被平铺尺寸整除

修正方阵限制并不难。修复 tile 维度的维度限制需要对内核进行相当大的更改，以便：

1.  不处理超出范围的元素
2.  使用适合“边界”区域的值正确填充您的共享内存区域

由于您的代码不理解任何这些，我不确定您是否在询问它并选择不专门解决这些问题。

我能够将您的代码的以下改编作为一个基本示例：（请注意，为了减少代码大小，我已经放弃了通常的[CUDA 错误检查](https://stackoverflow.com/questions/14038589/what-is-the-canonical-way-to-check-for-errors-using-the-cuda-runtime-api)。请不要将此用作代表性示例良好的编码。进行适当的错误检查。我的回答不是解释良好的 CUDA 错误检查，而是展示一个算法正确的例子。）

```
#include <stdio.h>
#include <math.h>
#define TILE_DIM 16
#define DIMX 256
#define DIMY 256
#define RES 0.1

__global__ void matrixMultiplyShared(float * A, float * B, float * C,
                     int ARows, int AColumns,
                     int BRows, int BColumns,
                     int CRows, int CColumns) {
     float CValue = 0;
     if (((blockIdx.y * blockDim.y + threadIdx.y)< CRows) && ((blockIdx.x * blockDim.x + threadIdx.x) < CColumns)) {
       for (int k = 0; k < (AColumns / TILE_DIM); ++k) {
         float * ASub =  &A[AColumns * TILE_DIM * blockIdx.y + TILE_DIM * k];
         float * BSub = &B[AColumns*TILE_DIM*k + TILE_DIM*blockIdx.x];
         __shared__ float As[TILE_DIM][TILE_DIM];
         __shared__ float Bs[TILE_DIM][TILE_DIM];
         As[threadIdx.y][threadIdx.x] = ASub[threadIdx.y*AColumns+threadIdx.x];
         Bs[threadIdx.y][threadIdx.x] = BSub[threadIdx.y*AColumns+threadIdx.x];
         __syncthreads();
         for (int n = 0; n < TILE_DIM; ++n)
         CValue += As[threadIdx.y][n] * Bs[n][threadIdx.x];
         __syncthreads();
       }
       C[((blockIdx.y * blockDim.y + threadIdx.y)*CColumns)+(blockIdx.x*blockDim.x)+threadIdx.x]=CValue;
     }
 }

void matrixMultiplyCPU(float * A, float * B, float * C,
                     int ARows, int AColumns,
                     int BRows, int BColumns,
                     int CRows, int CColumns) {
  for (int i = 0; i<ARows; i++)
    for (int j=0; j<BColumns; j++){
      float Ctemp = 0.0;
      for (int k=0; k<AColumns; k++)
        Ctemp += A[i*AColumns + k] * B[k*BColumns+j];
      C[i*CColumns+j] = Ctemp;
      }

}
int main(){
 int CColumns = DIMY, CRows=DIMX, AColumns=DIMY, ARows=DIMX, BColumns=DIMY, BRows=DIMX;
 dim3 dimBlock(TILE_DIM, TILE_DIM, 1);
 dim3 dimGrid;
 dimGrid.x = (CColumns + dimBlock.x - 1)/dimBlock.x;
 dimGrid.y = (CRows + dimBlock.y - 1)/dimBlock.y;
 float *deviceA, *deviceB, *deviceC;
 float hostA[DIMY][DIMX];
 float hostB[DIMY][DIMX];
 float hostC[DIMY][DIMX];
 float hostCp[DIMY][DIMX];
 for (int x = 0; x<DIMX; x++)
   for (int y = 0; y<DIMY; y++) {
     hostA[y][x] = rand()/(float)RAND_MAX;
     hostB[y][x] = rand()/(float)RAND_MAX;
     }
  cudaMalloc((void **)&deviceA, DIMX*DIMY*sizeof(float));
  cudaMalloc((void **)&deviceB, DIMX*DIMY*sizeof(float));
  cudaMalloc((void **)&deviceC, DIMX*DIMY*sizeof(float));
  cudaMemcpy(deviceA, hostA, DIMX*DIMY*sizeof(float), cudaMemcpyHostToDevice);
  cudaMemcpy(deviceB, hostB, DIMX*DIMY*sizeof(float), cudaMemcpyHostToDevice);
  matrixMultiplyShared<<<dimGrid , dimBlock>>>(deviceA , deviceB , deviceC , ARows , AColumns, BRows ,BColumns , CRows , CColumns);
  cudaMemcpy(hostC, deviceC, DIMX*DIMY*sizeof(float), cudaMemcpyDeviceToHost);
  matrixMultiplyCPU(&(hostA[0][0]) , &(hostB[0][0]) , &(hostCp[0][0]) , ARows , AColumns, BRows ,BColumns , CRows , CColumns);

 for (int y = 0; y<DIMY; y++)
   for (int x = 0; x<DIMX; x++)
     if (fabs(hostCp[y][x] - hostC[y][x]) > RES)
       {
       printf("Error at offset y=%d,x=%d, CPU = %f, GPU = %f\n", y, x, hostCp[y][x], hostC[y][x]);
       return 1;
       }
 printf("Finished!\n");
 return 0;
} 
```

# ruby-on-rails - Rails 匹配路由错误

> ID：14077209
> 
> 赞同：2
> 
> 时间：2012-12-28T23:47:38.187
> 
> 标签：ruby-on-rails, ruby-on-rails-3.2

我正在尝试生成一个人可以在电子邮件中单击的取消订阅链接。这是我的路线的样子：

```
match "/unsubscribe/:email/:token" => "mailing_list_recipients#destroy", :as => :unsubscribe 
```

当我运行时`rake routes`，我得到：

```
unsubscribe GET /unsubscribe/:email/:token(.:format) mailing_list_recipients#destroy 
```

我什至可以这样做：

```
unsubscribe_url(mailing_list_recipient.email, mailing_list_recipient.token) 
```

输出：

```
http://localhost:3000/unsubscribe/hello@hello.com/f99e3af9bd959c6c8f3882a6e10e354e 
```

但是，当我尝试访问此 URL 时，出现以下错误：

```
No route matches [GET] "/unsubscribe/schroppl@gmail.com/6458f6a714d81a9cdd1cd1133dd65f0d" 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-30T22:48:01.520

正如评论中所说，您应该简单地对电子邮件地址进行 url 编码

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T03:50:06.457

问题在于电子邮件地址：schroppl@gmail.com **。**

您必须编写适配器。将点替换为另一个符号，例如“！” （如果您仍然需要 URL 字符串中的电子邮件）：

代码可能是这样的：

```
# Recipient:

def email_for_url
  email.gsub(/\./,"!")
end

def self.search_by_email(url_email)
  find_by_email(url_email.gsub(/\!/,"."))
end 
```

所以你可以使用：

```
unsubscribe_url(mailing_list_recipient.email_for_url, mailing_list_recipient.token)

Recipient.search_by_email(params[:email]) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-30T18:36:12.113

您需要对电子邮件地址进行编码，这可以通过多种方式进行。

```
# ERB in your view
<%=u unsubscribe_url(mailing_list_recipient.email, mailing_list_recipient.token) %>

# Using Rack::Utils
Rack::Utils.escape(unsubscribe_url(mailing_list_recipient.email, mailing_list_recipient.token))

# Using URI::escape
URI::escape(unsubscribe_url(mailing_list_recipient.email, mailing_list_recipient.token)) 
```

这将更改您的网址

```
http://localhost:3000/unsubscribe/hello@hello.com/f99e3af9bd959c6c8f3882a6e10e354e 
```

到

```
http://localhost:3000/unsubscribe/hello%40hello.com/f99e3af9bd959c6c8f3882a6e10e354e 
```

# javascript - javascript在一台服务器上工作，在另一台服务器上不起作用

> ID：14077212
> 
> 赞同：0
> 
> 时间：2012-12-28T23:48:29.373
> 
> 标签：javascript, windows-server-2008-r2

我在一台 Windows Server 2008 上运行 Javascript，而在另一台 Windows Server 2008 上托管的确切脚本无法正常工作。

web.config 或服务器其他地方是否有任何配置。

它在这个 URL 中工作得很好：http://www.fnjansms.com/testsms.aspx

代码正在使用：

```
 <script language="javascript">
    var still;
        function textCounter(field)
        {
            var validChars = true;
            var inputText = field.value;
            inputText = inputText.toLowerCase();
            for(i = 0; i < inputText.length; i++)
            {
                if(inputText.charAt(i) != "a" && inputText.charAt(i) != "b" && inputText.charAt(i)      !=                      "c" && inputText.charAt(i) != "d" && inputText.charAt(i) != "e" && inputText.charAt(i) != "f" &&                        inputText.charAt(i) != "g" && inputText.charAt(i) != "h" && inputText.charAt(i) != "i" &&                       inputText.charAt(i) != "j" && inputText.charAt(i) != "k" && inputText.charAt(i) != "l" &&                       inputText.charAt(i) != "m" && inputText.charAt(i) != "n" && inputText.charAt(i) != "o" &&                       inputText.charAt(i) != "p" && inputText.charAt(i) != "q" && inputText.charAt(i) != "r" &&                       inputText.charAt(i) != "s" && inputText.charAt(i) != "t" && inputText.charAt(i) != "u" &&                       inputText.charAt(i) != "v" && inputText.charAt(i) != "w" && inputText.charAt(i) != "x" &&                       inputText.charAt(i) != "y" && inputText.charAt(i) != "z" && inputText.charAt(i) != " " &&                       inputText.charAt(i) != "0" && inputText.charAt(i) != "1" && inputText.charAt(i) != "2" &&                       inputText.charAt(i) != "3" && inputText.charAt(i) != "4" && inputText.charAt(i) != "5" &&                       inputText.charAt(i) != "6" && inputText.charAt(i) != "7" && inputText.charAt(i) != "8" &&                       inputText.charAt(i) != "9" && inputText.charAt(i) != "\r" && inputText.charAt(i) != "\n" &&                         inputText.charAt(i) != "!" && inputText.charAt(i) != "\"" && inputText.charAt(i) != "#" &&                      inputText.charAt(i) != "$" && inputText.charAt(i) != "%" && inputText.charAt(i) != "^" &&                       inputText.charAt(i) != "&" && inputText.charAt(i) != "'" && inputText.charAt(i) != "(" &&                       inputText.charAt(i) != ")" && inputText.charAt(i) != "*" && inputText.charAt(i) != "+" &&                       inputText.charAt(i) != "," && inputText.charAt(i) != "-" && inputText.charAt(i) != "." &&                       inputText.charAt(i) != "/" && inputText.charAt(i) != "@" && inputText.charAt(i) != "~" &&                       inputText.charAt(i) != "_" && inputText.charAt(i) != "|" && inputText.charAt(i) != ":" &&                       inputText.charAt(i) != ";" && inputText.charAt(i) != "<" && inputText.charAt(i) != "=" &&                       inputText.charAt(i) != ">" && inputText.charAt(i) != "?" && inputText.charAt(i) != "[" &&                       inputText.charAt(i) != "]" && inputText.charAt(i) != "{" && inputText.charAt(i) != "}")                         {validChars = false; invalChar = inputText.charAt(i)};
    }

    if (validChars == true)
    {
        document.aspnetForm.<%=hidUnicode.ClientId%>.value = 0;

    if (field.value.length = 459)
    {
            field.value = field.value.substring(0, 459);
    }
        still = 459 - field.value.length;
        //counting messages
        if (field.value.length <= 160)
        {   
        document.aspnetForm.<%=messagecount.ClientId%>.value='1';               
        }
        else if (field.value.length <= 306)
        {
        document.aspnetForm.<%=messagecount.ClientId%>.value='2';       
        }
        else if (field.value.length <= 459)
        {
        document.aspnetForm.<%=messagecount.ClientId%>.value='3';
        }
        ///////////////
        document.aspnetForm.note.value=' English, you have '+still+' letter .';
    } else
    {
        document.aspnetForm.<%=hidUnicode.ClientId%>.value = 1;
if (field.value.length = 200)
    {
            field.value = field.value.substring(0, 200);
    }
        still = 201 - field.value.length;
        //counting messages
        if (field.value.length <= 69)
        {
        document.aspnetForm.<%=messagecount.ClientId%>.value='1';               
        }
        else if (field.value.length <= 133)
        {
        document.aspnetForm.<%=messagecount.ClientId%>.value='2';       
        }
        else if (field.value.length <= 200)
        {
        document.aspnetForm.<%=messagecount.ClientId%>.value='3';
        }
        ///////////////
        document.aspnetForm.note.value=' Arabic, you have '+still+' letter .';

    }

}

        function Trim(str)
        {
            //trim leding spaces
            while(true)
            {
                if(str.charAt(0) == ' ')
                    str = str.substr(1);
                else
                break;
            }
            //trim trailing spaces
            while(true)
            {
                if(str.charAt(str.length-1) == ' ')
                    str = str.substr(0,str.length-1);
                else
                    break;
             }
             return(str);
        }
    //-->
</script> 
```

# sql - 当评估的子查询值为数组时，在子查询中使用 IN 语句

> ID：14077214
> 
> 赞同：2
> 
> 时间：2012-12-28T23:49:00.823
> 
> 标签：sql, arrays, select, subquery

我正在尝试选择符合客户偏好的产品（即他们喜欢的颜色），但是当子查询中评估的值是数组时，我无法创建 IN 语句。

为了简化问题，我只包括了几个字段，但是每个客户都有几百个字段，其中大约一半是数组，并且有 apx. 每个产品的字段数量相同。

如果选择了一种以上的颜色，则此查询不起作用：

```
$result = mysql_query("SELECT * FROM products WHERE color IN 
(SELECT colors_love FROM style WHERE style.user_id=$user_id)") 
```

我也尝试像这样爆炸数组：

```
while ($row = mysql_fetch_array($result)) {
$colors_love = explode(',', $row['colors_love']);
echo $row['product_name']. ", ". $row['style']. ",". $row['color']. ", ". $row['price'];
} 
```

由于这产生了相同的结果，我假设这不是问题，或者在查询中使用它之前需要对其进行分解——我不太确定该怎么做。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:28:38.510

使用 EXISTS 执行以下操作：

```
SELECT * FROM products WHERE EXISTS
(SELECT 1 FROM style 
WHERE FIND_IN_SET(products.color,style.colors_love)>0 and style.user_id=$user_id) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-19T04:03:53.617

在可能的情况下，使用直接连接而不是 IN 或 EXISTS 或 FIND_IN_SET 之类的函数总是更好的性能和实践。以下查询无需使用 IN 或 EXISTS 或其他函数即可实现您的目标：

```
SELECT
    products.*
FROM
    products
INNER JOIN
    (SELECT style.colors_love
    FROM style
    WHERE style.user_id = $user_id) AS fave_colors ON 
        fave_colors.colors_love = products.color 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-12-29T00:29:08.113

听起来您正试图向客户展示客户已经声明她/他喜欢的颜色的产品列表 (colors_love)。

这是伪代码，但是这个结构可能会得到你想要的，而不用担心你的数组会爆炸：

```
select 
    customers.cust_id, customers.fav_color, products.id, products.name
from
    customers
        inner join products
            on customers.fav_color = products.color 
```

# c# - 形成锚/码头

> ID：14077216
> 
> 赞同：0
> 
> 时间：2012-12-28T23:49:29.720
> 
> 标签：c#, wpf, anchor

好吧，这听起来好像我没有做任何研究，但我做了。我有这个表格：

![在此处输入图像描述](../Images/83ebf6b97d635df256d4f3198bd055aa.png)

我想通过动态添加标签和文本框将它用于我想要的任何数量的玩家，这没问题。但是我发现中间的空间非常乏味。如何根据我拥有的组件数量将组件设置为打包。我记得使用 Java，有一种方法可以打包组件，但 C# 中似乎没有这样的东西。我研究了锚和码头，但我希望也许有更简单的方法？

如果没有，你建议我怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T02:11:17.450

您可以尝试使用[UniformGrid](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.uniformgrid%28v=VS.85%29.aspx)（默认情况下可能不包含在您的 Visual Studio 工具箱中，但您可以手动添加它）。例如，您的 XAML 代码可能是这样的：

```
<UniformGrid HorizontalAlignment="Center" Name="uniformGrid1" VerticalAlignment="Stretch" Width="200" Columns="1" /> 
```

向*UniformGrid*添加控件的代码是：

```
TextBox tb = new TextBox();
tb.Width = 100;
tb.Height = 26;
Label lbl = new Label();
lbl.Content = "Player:";
Canvas canvas = new Canvas();
Canvas.SetLeft(lbl, 10);
Canvas.SetTop(lbl, 5);
Canvas.SetLeft(tb, 60);
Canvas.SetTop(tb, 5);
canvas.Children.Add(lbl);
canvas.Children.Add(tb);
uniformGrid1.Children.Add(canvas); 
```

顺便说一句，我认为你的字体颜色应该是白色的（或者其他对比度更好的）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T10:19:52.913

我将创建一个包含“PlayerNo”（Int32）和“PlayerName”（String）等属性的类。我们称这个类为“PlayerInfo”。

其次，我将创建一个 PlayerInfo 的 ObservableCollection 并在那里添加玩家数量。我们称它为玩家。我将为所有属性创建依赖属性，以便我可以在 XAML 中使用我的类，并 inegrit INotifyPropertyChanged 以便 UI 自动更新。

```
this.Players = new ObservableCollection<PlayerInfo>();
this.Players.Add(new PlayerInfo() { PlayerNo=0, PlayerName=null });
this.Players.Add(new PlayerInfo() { PlayerNo=1, PlayerName=null });
this.Players.Add(new PlayerInfo() { PlayerNo=2, PlayerName=null }); 
```

然后，我将在 XAML 中创建一个 ItemsPresenter 控件，该控件具有从 ItemsSource 到模型类中 Players 属性的绑定。您甚至可以根据上一轮的玩家等填写“PlayerName”等。我通过将其设置为“null”来说明它（这当然不是必需的，只是说明性的）

```
<ItemsControl ItemsSource="{Binding Path=Players, Mode=OneWay}">
  <ItemsControl.ItemsPanel>
    <StackPanel Orientation="Vertical" />
  </ItemsControl.ItemsPanel>
  <ItemsControl.ItemTemplate>
    <DataTemplate>
      <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
        <TextBlock Text="Player" />
        <TextBlock Text="{Binding Path=PlayerNo, Mode=OneWay}" Margin="10,0,20,0" />
        <TextBox Text="{Binding Path=PlayerName, Mode=TwoWay}" Width="200" />
      </StackPanel>
    </DataTemplate>
  <ItemsControl.ItemTemplate>
</ItemsControl> 
```

对于 ItemsPresenter 类，我将创建一个 ItemTemplate，其中包含一个显示“Player”后跟“PlayerId”编号的 TextBlock。我会使用一个 TextBox，它具有从 Text 属性到项目的“PlayerName”属性的绑定。

这样，我将几乎没有代码隐藏和 XAML。这是一个简单的解决方案。而且我还会准备好所有播放器的详细信息。

# json - 如何在 Haskell 中解析 JSON 中的不确定数据？

> ID：14077219
> 
> 赞同：1
> 
> 时间：2012-12-28T23:49:38.640
> 
> 标签：json, parsing, haskell

[我在json_answer](https://stackoverflow.com/questions/2089194/example-of-how-to-parse-exiftool-json-output-in-haskell?answertab=active#tab-top "一个 JSON 答案") （Text.JSON 包）中使用了答案，并且我有一个通用的 json Haskell 数据类型。为某些数据定义自定义的Haskell数据类型是可以的，但是如果我要解析的数据不确定，

例如，如果我从某些 API 得到响应 A，那么这次该字段是“类别”：

```
[JSObject (JSONObject {fromJSObject = [("category",JSString (JSONString {fromJSString = "photo"}))]})] 
```

下一次，“地址”：

```
[JSObject (JSONObject {fromJSObject = [("address",JSString (JSONString {fromJSString = "http://www.example.com"}))]})] 
```

或者其他一些不确定的字段，通用的json类型可能是嵌套的。

如何从 json 数据类型中提取它？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-31T22:33:20.550

我使用`Data.Aeson`了图书馆，它解决了我的问题。

`decode`in`Data.Aeson`可以产生`Maybe Value`结果。我使用模式匹配从`Maybe Value`结果中提取值，如下所示：

```
json2Array :: Maybe Value -> Array
json2Array (Just (Array anArray)) = anArray

arrayValue2Object :: Value -> Object
arrayValue2Object (Object anObject) = anObject 
```

在 Data.Aeson 中，`Object`构造函数是 的同义词，`HashMap Text Value`因此我可以使用 Data.HashMap.Lazy/Strict 来提取我需要的值。

这种方法可能不好，但它确实帮助了我。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T05:22:28.643

只需查看 的文档[`Text.JSON`](http://hackage.haskell.org/packages/archive/json/latest/doc/html/Text-JSON.html)，这样的内容可能对您有用：

```
import Text.JSON

data Foo = Category String
         | Address String
         deriving (Show)

toJSO = JSObject . toJSObject

instance JSON Foo where
    showJSON (Category s) = toJSO [("category", showJSON s)]
    showJSON (Address s)  = toJSO [("address",  showJSON s)]
    readJSON (JSObject obj) = case o of
      [("category", JSString s)] -> Ok $ Category $ fromJSString s
      [("address",  JSString s)] -> Ok $ Address  $ fromJSString s
      where
        o = fromJSObject obj 
```

基本上这就是说：如果 JSON 对象只有一个“类别”字段，那么它就是一个类别，“地址”也是如此。要真正完成这项工作，您需要在 case 和 readJSON 中添加另一个子句以指示“解析”错误。

然后解析你的例子，你会这样做：

```
decode "some-JSON-here" :: Result [Foo] 
```

由于这个例子，它神奇地起作用：

```
JSON a => JSON [a] 
```

可能有更好的方法可以做到这一点，但这对我有用，而且看起来很简单。

# jsf - 在 JSF 复合组件中分配参数

> ID：14077221
> 
> 赞同：0
> 
> 时间：2012-12-28T23:49:41.883
> 
> 标签：jsf, jsf-2, facelets, composite-component

我试图弄清楚是否可以通过 JSF 复合组件将值传递到支持 bean。所以如果我有这样的界面

```
<composite:interface>
    <composite:attribute name="commentList"/>
</composite:interface> 
```

然后我可以将 commentList 的值分配给支持 bean 以对其进行一些处理吗？

额外的问题：我可以创建一个本地化到这个组件的 bean 吗？即，有没有一种方法可以创建一个不与该组件的其他实例冲突的 bean？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:02:09.737

`componentType`您可以拥有一个通过属性绑定的所谓的支持组件：

```
<composite:interface componentType="someComposite"> 
```

和

```
@FacesComponent("someComposite")
public class SomeComposite extends UINamingContainer {
    // ...
} 
```

是的，每个复合实例显然都有自己的支持组件实例。

以下是一些更具体的现实世界示例：

*   [我们的`[composite-component]`维基页面](https://stackoverflow.com/tags/composite-component/info)
*   [如何防止多个复合组件在 JSF 页面上自行重置？](https://stackoverflow.com/questions/13702370/how-to-prevent-multiple-composite-components-reset-themselves-on-a-jsf-page/13703438#13703438)
*   [如何使用 JSF 2.0 复合组件实现动态列表？](https://stackoverflow.com/questions/6358066/how-to-implement-a-dynamic-list-with-a-jsf-2-0-composite-component/6358272#6358272)

# css - 继续 CSS 选择器名称

> ID：14077224
> 
> 赞同：0
> 
> 时间：2012-12-28T23:50:13.820
> 
> 标签：css

我需要连续使用 css 选择器名称。例如。

```
eng1, eng2, eng3 ...... eng100 {
   display: block;
   width:100px;
   height:20px;
} 
```

有没有办法提到像数组类型的css？谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-28T23:55:37.163

如果这是生成类的情况，您可以使用属性选择器：

```
*[class^="eng"] {
    // styles
} 
```

您*可以*使用 Sass 创建一长串类似的选择器，但除非您*确实*需要支持不了解属性选择器的旧浏览器，否则我不会推荐它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-28T23:56:05.867

您可以使用[CSS3 子字符串匹配选择器之一](http://www.w3.org/TR/selectors/#attribute-substrings)

```
[class^="eng"]{
   display: block;
   width:100px;
   height:20px;
} 
```

这将匹配所有具有以“eng”开头的类属性的元素

* * *

**重要的**

如果您在该类之前的同一元素上有其他类，`eng??`它将失败。

例如

```
<div class="someother eng5">..</div> 
```

将**不**匹配，因为选择器将整个类属性检查为字符串。

# django - TastyPie 资源和返回 JSON 对象的 Django 视图有什么区别？

> ID：14077228
> 
> 赞同：1
> 
> 时间：2012-12-28T23:50:50.093
> 
> 标签：django, tastypie

当我可以从 Django 视图返回 JSON 时，为什么还要使用 TastyPie？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T02:41:09.230

返回 JSON 只是其中的一角。

如果您不使用美味派，您必须自己做一些事情：

*   过滤/搜索
*   排序
*   轻松构建 JSON 响应
*   认证/授权
*   缓存
*   节流
*   序列化

资源：[http ://django-tastypie.readthedocs.org/en/latest/toc.html](http://django-tastypie.readthedocs.org/en/latest/toc.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T02:53:51.200

有趣的是，我昨天在 TastyPie 上观看了 djangocon 演示，在这里： [http ://blip.tv/djangocon/building-apis-in-django-with-tastypie-5572790](http://blip.tv/djangocon/building-apis-in-django-with-tastypie-5572790)

5 点 44 分，演讲者如你所说的那样回答你的问题，请看一看！

我想答案是：当然你可以使用 JSON，只是 TastyPie 会处理响应头，允许选择序列化格式等，这将有助于RESTful API。通过几个视图，实现自定义行为会很简单，但在设计复杂系统时，使用 TastyPie 自动化流程可以节省时间。无论如何，为什么已经完成的工作？如果您不厌倦网络研讨会，请查看演示文稿，我相信这很有趣！

# django - Django Haystack Whoosh 后端和部分搜索

> ID：14077236
> 
> 赞同：2
> 
> 时间：2012-12-28T23:51:44.960
> 
> 标签：django, django-haystack

我正在使用 django haystack 1.27。我可以搜索。那太棒了。但是我如何搜索部分单词？

例如：

搜索后： ORM, OR, EM

词：洛雷姆

结果：LOREM

search_indexes.py

```
class NewsIndex(SearchIndex):
    text = CharField(document=True, use_template=True)
    date = DateTimeField(model_attr='creation_date')
    def get_model(self):
        return News

    def index_queryset(self):
        return self.get_model().objects.get_published_models(TOWN, News)

site.register(News, NewsIndex) 
```

视图.py

```
def search(request):
    order = self.request.GET.get("order", None)
    sqs = SearchQuerySet()
    if order:
        ...
        sqs = sqs.order_by(order + "date")

    search_template = SearchView(template='general/search.html',
                                 searchqueryset=sqs)(request) 
```

订购并不困难。

我认为搜索索引引擎包括部分搜索：/。Whoosh 是否支持此功能？我已经测试过：自动完成功能，但“EM”没有结果，只是“LOR”。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-02-28T13:03:19.107

尝试使用`NgramField`而不是`CharField`.

它将生成所有可能`Ngrams`的索引。
使用的缺点`NgramField`是使索引文件变得非常大。
我的大小为 2MB，仅用于 24 条记录。

您可能想`EdgeNgramField`改用。它排除了许多可能性。

例如：

数据：'文档'

使用 NgramField：
查询：'ocument' 结果：'documentation'

使用 EdgeNgramField：
查询：'ocument' 结果：无

# postgresql - Postgresql 查找跨 n 个数组的交集

> ID：14077240
> 
> 赞同：1
> 
> 时间：2012-12-28T23:52:00.093
> 
> 标签：postgresql, postgresql-9.2

> **可能重复：**
> [PostGreSQL 中多个数组的交集](https://stackoverflow.com/questions/7020264/intersection-of-multiple-arrays-in-postgresql)

我正在尝试识别 Pg 9.2 数据库中多个 (>2) 数组中的公共元素。数据结构如下：

ID 标题数组
1 title1 {a,b,c,d,...}
2 title2 {z,y,a,d,...}
3 title3 {d,a,p,q,...}
n 。 …………

从上面的示例中，SELECT 应该返回 {a,d} 作为每个数组的公共元素。

我已经将这用于 2 个数组作为测试用例，使用：

...
select array_agg(e)
from (
select unnest(arr1) from cte_1
intersect
select unnest(arr2) from cte_2
) as dt(e)),
...

但是无法使其与 RECURSIVE CTE 一起正常工作。在网上和各种 Joe Celko 书籍/片段中找到了一些有用的示例。

我能想到的最好的就是这篇使用自定义函数的帖子：

[PostgreSQL中多个数组的交集](https://stackoverflow.com/questions/7020264/intersection-of-multiple-arrays-in-postgresql)

但似乎应该有一种方法可以通过 RECURSIVE 或其他技术来实现这一点。

有任何想法吗？

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:43:59.347

如果您只需要无空值之间的交集`int[]`，这可能很有用。对不起，如果不是这样，但你没有在你的问题中说清楚。

```
CREATE EXTENSION intarray;

SELECT ARRAY[1,2,3]::int[] & ARRAY[3,4,5]::int[] & ARRAY[1,3,5,7]::int[] as intersection;
intersection 
--------------
{3}
(1 row) 
```

这是完整的[intarray contrib 模块文档](http://www.postgresql.org/docs/current/static/intarray.html)。

**编辑**： [这是一个类似的问题](https://stackoverflow.com/questions/756871/postgres-function-to-return-the-intersection-of-2-arrays)，可能有用的答案。我会先尝试用户[depesz 的](https://stackoverflow.com/users/80168/depesz)建议。

# python - Scrapy spider 无缘无故提前完成

> ID：14077242
> 
> 赞同：2
> 
> 时间：2012-12-28T23:52:11.100
> 
> 标签：python, screen-scraping, scrapy

我有一个scrapy spider (code at this [gist](https://gist.github.com/da1b487b2d7790b6f954) )，它似乎运行良好，除了它突然无缘无故停止的事实。当它停止时，日志文件的最后一位是：

```
2012-12-28 23:42:04+0000 [church] DEBUG: Crawled (200) <GET http://www.achurchnearyou.com/cogges-st-mary/> (referer: http://www.achurchnearyou.com/clifton-reynes-st-mary-the-virgin/)
2012-12-28 23:42:04+0000 [church] DEBUG: Scraped from <200 http://www.achurchnearyou.com/cogges-st-mary/>
    {'archdeaconry': u'OXFORD',
     'archdeaconry_id': u'271',
     'benefice': u'Cogges and S Leigh',
     'benefice_id': u'27',
     'deanery': u'WITNEY',
     'deanery_id': u'27109',
     'legal_name': u'Cogges',
     'parish_id': u'270245'}
2012-12-28 23:42:04+0000 [church] DEBUG: Redirecting (301) to <GET http://www.achurchnearyou.com//> from <GET http://www.achurchnearyou.com/venue.php?V=0083>
2012-12-28 23:42:04+0000 [church] INFO: Closing spider (finished) 
```

蜘蛛是否有任何理由可能会在重定向 URL 后直接完成它？有趣的是，我有一些自定义的 DownloaderMiddleware 会捕获这样的重定向并创建一个新请求（基本上我正在尝试的一些 URL 将重定向到主页，我想忽略这些并创建一个不同的 URL ）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-03-18T04:47:30.240

出色地..

查看了您的代码（看起来很干净），但我认为错误更简单（仍然不知道您为什么从初始 id = 63 开始..）

但是逆向工程你的任务。简单的答案是：

1.  id 为 83 的“教区”不存在或有错误。

如果你去[http://www.achurchnearyou.com/send_message.php?venue_id=82](http://www.achurchnearyou.com/send_message.php?venue_id=82)它工作。但如果尝试[http://www.achurchnearyou.com/send_message.php?venue_id=83](http://www.achurchnearyou.com/send_message.php?venue_id=83)

（注意 id 82 与 83）

如果其他功能，教区的名称“消失”相同。

您获得重定向的原因是，CMS/网站没有显示未找到的 404 文件，而是将您重定向到主页。

# php - php array_push 导致服务器 500

> ID：14077244
> 
> 赞同：1
> 
> 时间：2012-12-28T23:52:14.337
> 
> 标签：php, array-push

有没有另一种方法来编写这个数组循环代码。当我运行我似乎无法理解的代码时，我似乎收到了服务器 500 错误。它特别出现在 array_push 行上。任何有关在不使用 array_push 的情况下重写语句的帮助指导都会对我有所帮助。

```
$PaymentOrderItems = array();

foreach($resultBookings->getRecords() as $key=>$record_row) {
   $Item = array(
    'name' => $record_row->getField('Start_date'),
    'desc' => $record_row->getField('Description'),
    'amt' => $record_row->getField('Price_per_week'),
   );
   array_push($PaymentOrderItems, $Item); //this line is the culprit - if I comment this this out
} 
```

非常感谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-28T23:55:22.590

`)`在你的 foreach 末尾缺少一个：

```
foreach($resultBookings->getRecords() as $key=>$record_row { 
```

变成：

```
foreach($resultBookings->getRecords() as $key=>$record_row) { 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T01:15:26.667

代码看起来很好。我假设您已经验证了结果集合的有效性？

如果不是，那么听起来可能与结果有关。数据结构是否按您的预期返回？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-28T23:56:15.943

[array_push() 手册](http://php.net/manual/en/function.array-push.php)已经解释说它具有与以下相同的效果：

```
$PaymentOrderItems[] = $Item; 
```

# c++ - 带有接口的 std::list 内存泄漏

> ID：14077248
> 
> 赞同：2
> 
> 时间：2012-12-28T23:52:54.527
> 
> 标签：c++, memory-leaks, interface, virtual, abstract-class

我遇到了 std::list 和内存泄漏问题：

```
class AbstractObject
{
    public:
        virtual void Say() = 0;
}
class RealObject : public AbstractObject
{
    public:
        virtual void Say() { cout << "Real Obj Says..." << endl; } //Do I need the "virtual" keyword here too?
}
class AnotherRealObject : public AbstractObject
{
    public:
        virtual void Say() { cout << "Another Real Obj Says..." << endl; } //Do I need the "virtual" keyword here too?
}
class PackOfObjects
{
    public:
        std::list<AbstractObject*> objects; //list of pointers because it doesn't let me create a list of an abstract class
        void Say()
        {
            for(std::list<AbstractObject*>::iterator obj = objects.begin(); obj != objects.end(); obj++)
            {
                (*obj)->Say();
            }
        }
}
int _tmain(int argc, _TCHAR* argv[])
{
    PackOfObjs myObjs;

    RealObject objA;
    myObjs.objects.push_back(&objA); //This adds 1 memory leak
    AnotherRealObject objB;
    myObjs.objects.push_back(&objB); //This adds another 1 memory leak

    _gettch();
    _CrtDumpMemoryLeaks();
    return 0;
} 
```

仅声明了 PackOfObjs，我已经有 2 个内存泄漏，如果我删除 std::list，它们就会消失，并且对于我添加到列表中的每个地址，它们都会增加 1。我尝试清除列表和一些在清除之前删除所有指向的 obj 的代码，但至少 2 个内存泄漏仍然存在。

由于我没有使用任何**新**的（甚至没有在我添加的元素上），我猜测列表本身会创建一些变量并且不删除它们，我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-28T23:55:24.620

运行时`_CrtDumpMemoryLeaks()`，内部分配的所有对象`main`仍然存在。你打电话`_CrtDumpMemoryLeaks()`太早了。相反，试试这个：

```
int _tmain(int argc, _TCHAR* argv[])
{
    {
        PackOfObjs myObjs;

        RealObject objA;
        myObjs.objects.push_back(&objA); //This adds 1 memory leak
        AnotherRealObject objB;
        myObjs.objects.push_back(&objB); //This adds another 1 memory leak

        // <- all memory used by the list is freed here
    }
    _gettch();
    _CrtDumpMemoryLeaks();
    return 0;
} 
```

我似乎记得推荐的调用方式`_CrtDumpMemoryLeaks`是在全局对象的析构函数中。对于其他全局对象来说，这可能还为时过早，但至少在其中创建的所有对象`main`都已经被销毁。

```
struct memory_leak_dumper
{
    ~memory_leak_dumper(){ _CrtDumpMemoryLeaks(); }
};
memory_leak_dumper _dumper; // this is a global object 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:00:17.180

要检查内存泄漏，您应该使用：

_CrtSetDbgFlag(_CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF);

在你的主要开始

泄漏将在程序退出时检查，现在您在对象仍在堆栈上时检查它们，因此您没有泄漏。

如果您使用虚拟方法，则应该添加虚拟析构函数，尽管在您的情况下它不会导致内存泄漏，但如果您的列表将包含动态分配的对象，那么 AbstractObject 中的虚拟析构函数将是强制性的。

至于你的问题：

"//我这里也需要"virtual"关键字吗？"

是的，只要您的 list<> 是基类指针类型

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:01:31.040

为了扩展[K-ballo 的答案](https://stackoverflow.com/a/14077265/673730)，技术上`_CrtDumpMemoryLeaks`检查堆上的对象。虽然您没有直接在堆上分配任何东西，但`std::list`（以及为此动态管理内存的所有容器）都可以 - 否则动态大小将不是一个选项。

所以不，从技术上讲没有泄漏，但是在您调用时`_CrtDumpMemoryLeaks`，动态分配的内存仍在使用中，尚未被释放（尚未）。

按照建议将包含`std::list`在单独的范围内`{ ... }`或调用`_CrtDumpMemoryLeaks`全局对象的析构函数应该不会显示任何泄漏。

# iphone - 清除 iOS 应用程序的 SDWebImage 中的缓存

> ID：14077251
> 
> 赞同：0
> 
> 时间：2012-12-28T23:53:21.910
> 
> 标签：iphone, ios, caching, sdwebimage

掌心。我一直在使用 Github 图像下载器来显示远程图像。[这是 SDWebImage](https://github.com/rs/SDWebImage)。我已经玩了一个半小时，显然我完全迷路了，如果有人能帮助我解决这个问题，我将永远感激不尽。

所以基本上，在框架的 SDImageCache.h 文件中，它设置为缓存图像一周。如果您尝试频繁更新图像，这是有问题的，因为如果图像已被缓存，则不会下载。

在 Stack Overflow 上，我发现很多人有同样的问题，但到目前为止，解决方案还没有奏效。幸运的是，提出这个问题的人发布了他清空图像缓存的解决方案：调用“[SDWebImageManager.sharedManager.imageCache clearMemory]”。

我将该方法放在我的主视图控制器的 .m 文件中，希望它会在调用图像后清除缓存，以便更新。没有骰子。我也在 ViewDidLoad 之前尝试过，希望它能清除图像并启动下载。又没有运气了。

关于我做错了什么有什么建议吗？如果有帮助，这是我的实现文件的屏幕截图！这让我发疯了。谢谢！

[http://i.imgur.com/pETYL.png](http://i.imgur.com/pETYL.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-22T02:47:47.827

只是跟进以防有人发现此搜索。要解决此问题，您需要确保将完整的 SDWebImage 包移动到您的框架文件夹中。

此时，您可以找到一个 WebImageCache.m 文件并根据您的特定缓存需求对其进行定制。

此外，如果您在 Github 上查看同一个项目，您实际上可以安装一个“清除缓存”栏，该栏使用 SDWebImageManager 使用户能够清除缓存。在我的特定情况下，这非常有用。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-05-21T14:57:58.670

我不知道早在 2012 年或 2013 年，但今天你可以简单地调用传递你想要的选项，例如`SDWebImageRefreshCached`（尊重 HTTP 标头并刷新图像，即使它已经被缓存或使用相同的 URL）或`SDWebImageCacheMemoryOnly`（确实不缓存到磁盘，只缓存到内存）

例子：

```
NSString *string = @"http://example.com/image.jpg";
[self.customImageView setImageWithURL:[NSURL URLWithString:string]
                     placeholderImage:nil
                              options:SDWebImageRefreshCached
                             progress:nil
                            completed:nil] 
```

# jquery - fancybox 在一页 (aaa.html) 上显示前进按钮，而在另一页上不显示

> ID：14077253
> 
> 赞同：0
> 
> 时间：2012-12-28T23:54:02.623
> 
> 标签：jquery, fancybox

我的名字是 Piet Hazewinkel，我创建了一个关于法国一个小村庄的网站，但我对 Fancybox 有疑问。我制作了一个带有 2 张图片的测试页 (www.francetastique.eu/aaa.html)，以用 fancybox 展示。它工作正常。我希望它也适用于页面（www.francetastique.eu/fotofancy.html）。但它不起作用。我不知道我做错了什么。有没有人可以帮助我？非常感谢你的帮助。皮特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:33:52.567

Uncaught TypeError: Object [object Object] has no method 'fancybox'（来自 Chrome 调试器）

错误可能从第 8 行开始：Bad value X-UA-Compatible for attribute http-equiv on element meta。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T17:14:38.483

问题是加载了两个 jQuery 文件。删除一个后，它现在运行。感谢 JFK 和 rajesh 的回答。

# java - Hibernate自动删除多对多关系

> ID：14077256
> 
> 赞同：3
> 
> 时间：2012-12-28T23:54:26.137
> 
> 标签：java, hibernate, postgresql

我有一个应该是多对多（双向）的列表

这是过滤器类：

```
@ManyToMany(targetEntity=Serving.class)
@JoinTable(name = "BRIDGE_SERV_FILTER", joinColumns={
    @JoinColumn(name="filter_id")}, inverseJoinColumns={@JoinColumn(name="serving_id")})
private List<Serving> servings;
public List<Serving> getServing() { return this.servings; }
public void setServing(List<Serving> servings) { this.servings = servings; } 
```

这是服务类：

```
@ManyToMany(targetEntity=Filter.class)
    @JoinTable(name = "BRIDGE_SERV_FILTER", joinColumns={
        @JoinColumn(name="serving_id")}, inverseJoinColumns={@JoinColumn(name="filter_id")})
    private List<Filter> filters;
    public List<Filter> getFilters() { return filters;}
    public void setFilters(List<Filter> filters) { this.filters = filters;} 
```

然后我应该调用一些东西来从服务中获取所有过滤器，这就是我所做的（服务是服务类型）：

```
List<Filter> filters = serv.getFilters();

//iterate from all filter
for(Filter allf : allFilter)
{
    boolean mark_this = false;
    //..and matched the currently-iterated-all-filters with filter from
    //which the serving got
    for(com.pos.model.Filter f : filters)
    {
        //if matched, mark this current filter
        if (allf.getId().equals(f.getId()))
            mark_this = true;
    }
    tmodel.addRow(new Object[] { allf.getName(), mark_this });
} 
```

该方法在模型中定义，并且是静态的。因此，当表单加载时，它会调用 jTable.setTableModel(Filter.toTableModel(thisServing));

它读取并显示数据。然而，Hibernate 也调用了 delete：

```
Hibernate: select filter0_.filter_id as filter1_2_, filter0_.is_showable as is2_2_, filter0_.name as name2_ from DIM_FILTER filter0_ where is_showable=true
Hibernate: select filters0_.serving_id as serving1_4_1_, filters0_.filter_id as filter2_6_1_, filter1_.filter_id as filter1_2_0_, filter1_.is_showable as is2_2_0_, filter1_.name as name2_0_ from BRIDGE_SERV_FILTER filters0_ inner join DIM_FILTER filter1_ on filters0_.filter_id=filter1_.filter_id where filters0_.serving_id=?
Hibernate: delete from BRIDGE_SERV_FILTER where serving_id=? 
```

事实上，我根本不做任何删除，也不要求hibernate删除任何东西。可能会发生我不明白的事情......如何防止Hibernate被删除？还是我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T08:25:26.180

在代码中的某处，您必须清除服务的过滤器集合，或将此集合设置为空。Hibernate 使这种变化持久化。

另请注意，您的映射是错误的，这就是您看到奇怪行为的原因。您有两个不相关的单向ManyToMany，而不是双向ManyToMany，它们都使用相同的连接表。必须选择一侧作为另一侧的反面。例如，如果您希望过滤器端成为关联的所有者，则必须使用`mappedBy`属性将服务端标记为反向端：

```
class Filter {
    @ManyToMany
    @JoinTable(name = "BRIDGE_SERV_FILTER", joinColumns={
    @JoinColumn(name="filter_id")}, inverseJoinColumns={@JoinColumn(name="serving_id")})
    private List<Serving> servings;
}

class Serving {
    @ManyToMany(mappedBy = "servings")
    private List<Filter> filters;
} 
```

这在[文档](http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html_single/#collections-bidirectional)中有所描述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T14:24:22.637

这个问题其实从8天前就已经在我身上了，让我很无奈。

问题在于我如何获取列表（）。所以......如果你有双向关系，不要做这样的事情：

```
Long id = getIdFromCombo();
Serving s = (Serving) session.getId(Serving.class, id).uniqueResult(); 
```

当您同时初始化表单时：

```
Public theFormName(Menu m){
  this.menu = m;
} 
```

如果 Menu 将 Serving 设置为一对多，则最好不要针对会话查询 Serving 。最好在以下位置一一匹配：

```
Serving s;
for(int i=0; i<this.menu.getServings().size(); i++)
{
  if(equal code) s = menu.getServings().get(i);
} 
```

那么你应该不会遇到我上面列出的问题。这很奇怪。陷阱。我想知道是否有人遇到过这个问题。要么这是我的错，要么是一个错误，我不确定。

因为我仍然不明白为什么同时查询 Serving 类（通过 Session 的帮助）是错误的，所以有一个 menu.getServings() 也可以提供您的服务（但视角较少（因为你得到服务的地方是 serving.menu.id = menu.id），无论如何，没关系）

# ruby-on-rails - Rails - 每个模型的唯一 ID，而不是整个数据库

> ID：14077257
> 
> 赞同：1
> 
> 时间：2012-12-28T23:54:29.270
> 
> 标签：ruby-on-rails, database, ruby-on-rails-3

我有一个 User 模型和一个 Book 模型。一本书属于一个用户，一个用户有很多书。

在视图中，我通过执行显示用户在用户显示视图中创建的所有书籍

```
<% @user.books.each do |book| %>
  <%= book.id %> 
  <%= book.title %>
<% end %> 
```

但是`book.id`数据库中的所有书籍都有一个唯一的数字，而不仅仅是每个用户。我希望这个 id 对用户来说是唯一的，所以如果数据库中有 1,000 本书，而用户只有 3 本书，它会将 id 显示为 1、2 和 3（而不是像 476、239、105、 ETC。）。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:29:13.660

你可以做几件事......最快的方法是在循环之前包含一个计数器并增加它......如果你只需要每本书的唯一数字......

如果你真的需要 ids，你可以在你的 books 表中添加一个单独的字段，并通过在你的模型中计算它们来处理 id 数字......

另一种方法是添加另一个模型，例如 user_books 并构建一个包含 counter 字段的关联，查看[http://guides.rubyonrails.org/association_basics.html#polymorphic-associations](http://guides.rubyonrails.org/association_basics.html#polymorphic-associations)

希望能帮助到你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:31:35.933

好吧，如果只是为了显示目的，为什么不像这样添加一个计数器：

```
<% count = 1 %>
<% @user.books.each do |book| %>
  <%= count %>
  <% count += 1 %>      
  <%= book.title %>
<% end %> 
```

因此，您将拥有 <%= count %> 而不是 book.id

如果您想翻转它并从最新开始，那么这将起作用：

```
<% count = @user.books.length %>
<% @user.books.each do |book| %>
  <%= count %>
  <% count -= 1 %>      
  <%= book.title %>
<% end %> 
```

# android - LoginButton 请求好友列表权限，为什么？

> ID：14077262
> 
> 赞同：6
> 
> 时间：2012-12-28T23:55:19.267
> 
> 标签：android, facebook, facebook-login

我在 facebook sdk 中使用内置的 LoginButton 小部件，我没有对其进行任何更改，我只是将它包含在我的 xml 布局文件中，并且不调用`setSessionStatusCallback`其他任何东西。

但是，当我单击登录按钮时，facebook 说我要求提供基本信息和好友列表。我不希望获得查看用户朋友的权限，并且在查看了 LoginButton 的来源之后，它似乎也不应该询问，它的`permissions`字符串列表是空的。

这里发生了什么？

更新：按要求添加我的代码。

```
 final LoginButton facebook = (LoginButton) getView().findViewById(R.id.facebook_login);
    if(facebook != null){
            if(Utility.getMetadataApplicationId(getActivity()) != null){
                facebook.setVisibility(View.VISIBLE);
                facebook.setSessionStatusCallback(new StatusCallback() {

                    @Override
                    public void call(Session session, SessionState state, Exception exception) {
                        if(session.isOpened()){
                            showProgress(true);
                            Request.executeMeRequestAsync(session, new GraphUserCallback() {

                                @Override
                                public void onCompleted(GraphUser user, Response response) {
                                    Log.d("test", user.getId());
                                }
                            });
                        }
                    }
                });
            }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:28:28.823

询问基本信息+好友列表是应用可以请求的*最基本权限。*如果您不提供任何额外的读取权限，那么这两个权限是唯一会显示的权限，我不相信您可以删除它们。

我相信我们这样做是因为将您的应用程序与 Facebook 集成时，其内在原因是使您的应用程序具有社交性并为您的应用程序提供分发渠道。因此默认情况下会添加好友列表权限，因为您应该使用该权限来鼓励用户与他们的朋友共享您的应用程序，如果他们希望通过应用程序请求对话框等这样做的话。

# php - PHP为每个循环创建不相等的数组

> ID：14077272
> 
> 赞同：0
> 
> 时间：2012-12-28T23:56:19.040
> 
> 标签：php, mysql

我正在尝试使用 PHP 将 MySQL 表转换为数组。图片表中的每个商品 ID 至少有一个图片 ID，但图片 ID 的总数可能会有所不同。

图像表：

```
|Listing ID | Image ID |
|  1234     |     1    |
|  1234     |     2    |
|  1234     |     3    |
|  1235     |     1    |
|  1235     |     2    | 
```

本质上，我想将图像表转换为具有如下键值对的数组：

```
array([0] 1234 => /FilePath/1234-1::/FilePath/1234-2::/FilePath/1234-3, [1] 1235 => /FilePath/1235-1::/FilePath/1235-2, ...) 
```

我已经能够编写一些代码，在大多数情况下，它们可以完成这项任务。但是，也存在一些问题。

我的代码的主要问题是 $lid 数组和 $prod 数组不包含相同数量的元素（$prod 包含的元素比 $lid 多一个）。这让我感到莫名其妙，因为它们从同一个图像表中提取数据，因此应该具有相同数量的元素。

我的代码：

```
//Set document path
$target_path = realpath($_SERVER['DOCUMENT_ROOT']). "\mypath\image\uploads\\";
//Query to download all listing IDs in Markers table 
$query = $db->query("SELECT * FROM image");
while ($row = $query->fetch(PDO::FETCH_BOTH)) {
   $temp[] = $row;
}

foreach($temp as $i=>$v){
    $line = $target_path.$v['L_ListingID']."-".$v['L_ImageID'].".jpg";
    if($temp[$i]['L_ListingID']==$temp[$i+1]['L_ListingID']){
    //appending '::' to each string in the $prod array   
        $prod[] = $line."::";
    }else{
    // * will serve as the delimiter in the $prod array
        $prod[] = $line."*";
    //Add each listing ID into Listing Array 
        $lid[] = $v['L_ListingID'];
    } 
}

//Convert the array into a big string
$bigString = implode("", $prod);

//Chop up the big string into sections delimited by '*' and insert into 'prod' array
$prod = explode("*",$bigString);

//Combine $lid array with $prod array     
$combo = array_combine($lid, $prod); 
```

第二个问题是，每当运行 foreach 循环时，PHP 都会返回以下消息：

> 注意：未定义的偏移量：第 78 行 C:\mypath\getimage.php 中的 2789

第 2789 行是图像表中的最后一行，所以我认为这个错误提示可能与 $lid 和 $prod 元素个数相差 1 的事实有关。

任何建议都非常感谢。另外，如果您能想出一种更有效的方法来完成此任务，请告诉我。

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T00:08:10.433

对于问题：

> 注意：未定义的偏移量：第 78 行 C:\mypath\getimage.php 中的 2789

这是因为你正在做：

```
if($temp[$i]['L_ListingID']==$temp[$i+1]['L_ListingID']){ 
```

`$i+1`即使您`foreach`在最后一个元素上，您也需要。

您需要检查该`$i+1`密钥是否存在，将其替换为：

```
if(array_key_exists($i+1, $temp) && ($temp[$i]['L_ListingID']==$temp[$i+1]['L_ListingID'])){ 
```

对于“主要”问题，您的代码太复杂了。如果你开始摇动字符串和数组，那就有问题了。仅使用字符串或仅使用数组，但不能同时使用两者，这将更难维护。

```
$bigstring = '';
$lid = array()
foreach($temp as $i=>$v){
    $bigstring .= $target_path.$v['L_ListingID']."-".$v['L_ImageID'].".jpg";
    if(array_key_exists($i+1, $temp) && ($temp[$i]['L_ListingID']==$temp[$i+1]['L_ListingID'])) {
        $bigstring .= "::";
    }else{
        $bigstring .= "*";
    }
    if (!in_array($v['L_ListingID'], $lid)) {
      $lid[] = $v['L_ListingID'];
    }
} 
```

最后一件事：这是在对变量使用数组运算符之前初始化数组的好习惯。

```
$temp = array();
while ($row = $query->fetch(PDO::FETCH_BOTH)) {
   $temp[] = $row;
} 
```

否则，PHP 将抛出 E_NOTICEs。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:14:49.660

使用此算法，您必须为最后一行创建一个特殊情况（这会导致通知“未定义的偏移量”，如 Ninsuo 所示）。

以下算法应该构建您期望的数组：

```
$combo = array();
foreach($temp as $v){
    $line = $target_path.$v['L_ListingID']."-".$v['L_ImageID'].".jpg";
    $key  = $v['L_ListingID'];
    if (array_key_exists($key, $combo)) {
      // Append
      $combo[$key] .= '::' . $line;
    } else {
      // Create key
      $combo[$key] = $line;
    }
} 
```

# java - 如何在 JSF 应用程序中进行 JUnit 测试

> ID：14077273
> 
> 赞同：0
> 
> 时间：2012-12-28T23:56:29.733
> 
> 标签：java, jsf, jsf-2, junit

我想在构建期间创建一些 JUnit 测试。如何将 JSF 应用程序连接到数据库并进行测试 SQL 查询以测试代码？据我在 Netbeans 中看到的，可以在纯 Java 代码上完成简单的测试。我的大部分代码都是 SQL 查询，必须对其进行测试以获得正确的结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:03:34.240

您应该有一个单独的 DAO 层，它具有 sql 查询并且不依赖于 JSF，在这种情况下，您可以隔离测试以仅测试 SQL 查询。然后，您可以对生成和执行 SQL 的普通 java 类进行测试。我可以推荐一个嵌入式数据库和 liquibase（或类似的）来填充测试模式和数据预设。

# r - ggplot2 手动指定颜色和线型 - 重复图例

> ID：14077274
> 
> 赞同：9
> 
> 时间：2012-12-28T23:56:33.480
> 
> 标签：r, ggplot2, legend

我正在创建一个具有多种线型、颜色和填充区域的图。下面的代码生成两个图例（一个显示线型，另一个显示线色） - 我需要将它们组合成一个图例，同时显示线型和线色。[有第三个图例显示“填充”对象，但这很好]

我遵循了这里给出的方法： [Controlling line color and line type in ggplot legend](https://stackoverflow.com/questions/11344561/controlling-line-color-and-line-type-in-ggplot-legend) to try to get a single legend - 但最终出现了这种双重图例行为 - 我做错了什么？

```
library(ggplot2)
library(scales)
data = structure(list(Dates = structure(c(1351713600, 1351717200, 1351720800, 
  1351724400, 1351728000, 1351731600), class = c("POSIXct", "POSIXt"
  ), tzone = "MST"), CumHVAC_Def_Stoch_Min = c(146.4006, 146.6673, 
  146.9336, 147.1996, 147.4648, 147.5964), CumHVAC_Def_Stoch_1st = c(188.0087, 
  188.2753, 188.5416, 188.8077, 189.0729, 189.2045), 
  CumHVAC_Def_Stoch_Mean = c(204.7234, 204.9901, 205.2564, 205.5225, 205.7876, 205.9193), 
  CumHVAC_Def_Stoch_3rd = c(228.8813, 229.1476, 229.4135, 229.6793, 229.9442, 230.0757), 
  CumHVAC_Def_Stoch_Max = c(295.145, 295.4117, 295.6779, 295.944, 296.2092, 296.3408), 
  CumHVAC_Opt_Stoch_Min = c(112.4095, 112.6761, 112.9424, 113.2085, 113.4737, 113.6053), 
  CumHVAC_Opt_Stoch_1st = c(134.8893,135.156, 135.4223, 135.6883, 135.9535, 136.0851), 
  CumHVAC_Opt_Stoch_Mean = c(156.8854, 157.1521, 157.4184, 157.6845, 157.9496, 158.0813), 
  CumHVAC_Opt_Stoch_3rd = c(168.7301, 168.9971, 169.2636, 169.5299, 169.7953, 169.927), 
  CumHVAC_Opt_Stoch_Max = c(241.2483, 241.5151, 241.7814, 242.0476, 242.3128, 242.4444), 
  CumHVAC_Def_Dtrmn = c(188.7523,  189.0189, 189.2852, 189.5513, 189.8165, 189.9481), 

  CumHVAC_Opt_Dtrmn = c(86.8116,  87.0782, 87.3445, 87.6105, 87.8757, 88.0073),
  CS_Opt_Stoch = c(0,   0, 0, 0, 0, 0), CS_Opt_Dtrmn = c(0, 0, 0, 0, 0, 0), 
  CS_Default = c(0,   0, 0, 0, 0, 0)), .Names = c("Dates", "CumHVAC_Def_Stoch_Min", 
  "CumHVAC_Def_Stoch_1st", "CumHVAC_Def_Stoch_Mean", "CumHVAC_Def_Stoch_3rd",  
  "CumHVAC_Def_Stoch_Max", "CumHVAC_Opt_Stoch_Min", 
  "CumHVAC_Opt_Stoch_1st","CumHVAC_Opt_Stoch_Mean", "CumHVAC_Opt_Stoch_3rd", 
  "CumHVAC_Opt_Stoch_Max", "CumHVAC_Def_Dtrmn", "CumHVAC_Opt_Dtrmn", "CS_Opt_Stoch", 
  "CS_Opt_Dtrmn",    "CS_Default"), row.names = 691:696, class = "data.frame")

stochdefcolor = 'red'
stochoptcolor = 'green'
dtrmndefcolor = 'darkred'
dtrmnoptcolor = 'darkgreen'

eb09 <- aes(x = Dates, ymax = CumHVAC_Def_Stoch_3rd, ymin = CumHVAC_Def_Stoch_1st, fill="StochDef")
eb10 <- aes(x = Dates, ymax = CumHVAC_Opt_Stoch_3rd, ymin = CumHVAC_Opt_Stoch_1st, fill="StochOpt")
State = c('a','b','c','d','e','f','g','h');

ln1 <- aes(x=Dates,y=CumHVAC_Def_Stoch_Mean, color=State[1],linetype=State[1])
ln2 <- aes(x=Dates,y=CumHVAC_Opt_Stoch_Mean, color=State[2],linetype=State[2])
ln3 <- aes(x=Dates,y=CumHVAC_Def_Dtrmn,color=State[3],linetype=State[3])
ln4 <- aes(x=Dates,y=CumHVAC_Opt_Dtrmn,color=State[4],linetype=State[4])

ln5 <- aes(x=Dates,y=CumHVAC_Def_Stoch_Max,color=State[5],linetype=State[5])#,linetype = 2]
ln6 <- aes(x=Dates,y=CumHVAC_Def_Stoch_Min,color=State[6],linetype=State[6])#,linetype = 3)
ln7 <- aes(x=Dates,y=CumHVAC_Opt_Stoch_Max,color=State[7],linetype=State[7])#,linetype = 2)
ln8 <- aes(x=Dates,y=CumHVAC_Opt_Stoch_Min,color=State[8],linetype=State[8])#,linetype = 3)

quartz()
ggplot(data) + 
  geom_ribbon(eb09, alpha=0.4) +
  geom_ribbon(eb10, alpha=0.4) +
  geom_line(ln1,size=1) + 
  geom_line(ln2,size=1) + 
  geom_line(ln3,size=1) +
  geom_line(ln4,size=1) +
  geom_line(ln5,size=.7) +
  geom_line(ln6,size=.7) +
  geom_line(ln7,size=.7) +
  geom_line(ln8,size=.7) +
  xlab("X-lab") +
  ylab("Y-Lab") +
  opts(title = expression('Dummy Title'),
       panel.background = theme_rect(fill = "transparent"),
       panel.grid.minor = theme_blank(), 
       panel.grid.major = theme_blank(),
       plot.background = theme_rect(fill = "transparent")) + 
  scale_linetype_manual(values=c(1,1,1,1,2,3,2,3)) +      
  scale_colour_manual(name=c("Lines"),
                      values=c(stochdefcolor,
                               stochoptcolor,
                               dtrmndefcolor,
                               dtrmnoptcolor,
                               stochdefcolor,
                               stochdefcolor,
                               stochoptcolor,
                               stochoptcolor)) + 
  scale_fill_manual(name='1st-3rd Quartiles',
                    breaks=c('StochDef','StochOpt'),
                    values=c(stochdefcolor,stochoptcolor),
                    labels=c('Stoch DEF','Stoch OPT')) 
```

...因为我是新用户，所以我不能发布图像...

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-12-30T11:45:16.413

正如@joran 在评论中所说，您需要创建一个变量状态并将其绑定到`color`，`linetype`然后 ggplot 为您完成其余的工作。例如，这里的情节非常简单，因为您将数据放置在正确的形状中。

要操作您需要的数据，我建议您学习`plyr`和`reshape2`！

```
## I use your data 
## I melt my data 
library(reshape2)
measure.vars  <- colnames(dat)[c(1:12)][-c(1,3,5,10)]
mydata.melted <- melt(mydata, 
                      measure.vars= measure.vars, ## I don't use all the variables only
                                                                      States ones
                      id.vars='Dates')

states.list <- list('a','b','c','d','e','f','g','h')
names(states.list) <- measure.vars
mydata.melted$State <- NA
library(plyr)
mydata.melted <- ddply(mydata.melted,
                       .(variable),transform,
                       State=states.list[[unique(variable)]])
## I plot using the rights aes    

stochdefcolor = 'red'
stochoptcolor = 'green'
dtrmndefcolor = 'darkred'
dtrmnoptcolor = 'darkgreen'
library(ggplot2)
ggplot(subset(mydata.melted)) + 
  geom_line(aes(x=Dates,y=value,
                color=State,linetype=State))+
  scale_linetype_manual(values=c(1,1,1,1,2,3,2,3)) +  
  scale_size_manual(values =rep(c(1,0.7),each=4))+
  scale_color_manual(values=c(stochdefcolor,stochoptcolor,
                               dtrmndefcolor, dtrmnoptcolor,
                               stochdefcolor,stochdefcolor,
                               stochoptcolor,stochoptcolor)) 
```

![在此处输入图像描述](../Images/7c68193d9638968c143d00c97224259d.png)

# kineticjs - 节点的 KineticJS id

> ID：14077279
> 
> 赞同：1
> 
> 时间：2012-12-28T23:57:13.323
> 
> 标签：kineticjs

我正在使用 for() 语句创建矩形节点，现在我需要获取每个节点的引用。似乎有一些黑魔法来创建这些画布对象，因此很难访问没有 id 可引用的项目。有人可以解决这个问题或指出我正确的方向吗？

```
for(x=1;x<=8;x++)
  {

  var rect = new Kinetic.Rect({
    x: 300,
    y: 80+offset,
    width: 60,
    height: 20,
    fill: 'white',
    stroke: 'black',
    strokeWidth: 1,
    draggable: false
  });
rect.on('mouseover', function() {
    writeMessage(messageLayer, this.getY());
  });
  // add the shape to the layer
  layer.add(rect);

offset += 120; 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T16:31:45.867

您应该可以使用购买来访问它们中的每一个`layer.getChildren();`，这将返回所有这些，或者如果您知道需要`layer.getChildren()[0];`哪个，则将获得第一个。虽然我会给他们每个人一个名字，以使其更容易一些。

```
for(x=1;x<=8;x++)
{
  var rect = new Kinetic.Rect({
  name: 'rct'+x,
  x: 300,
  y: 80+offset,
  width: 60,
  height: 20,
  fill: 'white',
  stroke: 'black',
  strokeWidth: 1,
  draggable: false
  });
} 
```

然后你可以使用`layer.get('.rct3');`or `layer.get('.rct3')[0];`。

# qt - 在插槽运行期间刷新/更新 GUI

> ID：14077280
> 
> 赞同：2
> 
> 时间：2012-12-28T23:57:14.290
> 
> 标签：qt

GUI 元素的所有属性（文本、项目...）在插槽完成运行后都会更新，并且我有一个显示应用程序状态的小标签（即“正在刷新...”、“正在配置...” 、“正在扫描...”、“完成”等）在触发的插槽运行期间。

**如何在触发插槽后立即将标签的文本设置为“刷新...”之类的内容，并且在插槽几乎完成时将标签的文本更改为“完成”之类的内容？**

目前我正在通过发行来做到这一点

```
 ui->Status->setText("Refreshing ...");
    ...
    ui->Status->setText("Done"); 
```

在插槽内，但只有在插槽完成后才能看到更改，所以我从来没有看到“刷新......”。

对不起，如果这很容易，但我是 OOP 的新手，我一直在按顺序思考。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-07-11T15:22:05.380

这就是我当时最终做的事情。“qApp->processEvents();” 是关键。Repaint() 是不够的。

```
void Widget::SetStatus(QString status)
{
   ui->Status->setText(status);
   ui->Status->repaint();
   qApp->processEvents();
} 
```

# ruby-on-rails - 日文全文检索 RoR Postgresql

> ID：14077285
> 
> 赞同：1
> 
> 时间：2012-12-28T23:58:02.277
> 
> 标签：ruby-on-rails, postgresql, full-text-search

我试图让日文全文搜索在 postgresql 中工作。我发现了一些像acts_as_ludia和textsearch_ja这样的项目。但它们都接缝过时。有没有人有关于其他日本全文搜索库的任何信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-10-30T10:03:00.450

感谢 Hunspell 项目的 Laszlo，我在这里找到了一本日语词典[http://cgit.freedesktop.org/libreoffice/core/tree/i18npool/source/breakiterator/data/ja.dic](http://cgit.freedesktop.org/libreoffice/core/tree/i18npool/source/breakiterator/data/ja.dic)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-19T16:51:46.587

The big problem with using Japanese and tsearch2 is that tsearch2 requires that languages be separated by whitespace between words and Japanese does not do this. However according to [http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/docs/tsearch2j.html](http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/docs/tsearch2j.html) there are libraries available to make the conversion (these could be hooked into PostgreSQL through appropriate language functions). He then mentioned he had to modify some other things and his code is no longer available but off-hand I can't think of any reason you couldn't use simple dictionaries on Japanese at that point (you'd lose stemming and stop words) but that should get you going.

# php - 使用 php 方法 file_get_contents 我将整个网页拉到我的网站

> ID：14077288
> 
> 赞同：0
> 
> 时间：2012-12-28T23:58:18.383
> 
> 标签：php, javascript, dom

这是我的代码：

```
<?php 
$html = file_get_contents("http://aaaaaa.bbbbb.com/thisstuff");

$dom = new DOMDocument;
$dom->loadHTML($html);

var_dump ($dom->getElementsByTagName('div'));

  for ($i = 0; $i < $items->length; $i++)
         echo $items->item($i)->nodeValue . "<br/>";
?> 
```

我需要检索的页面上唯一的 div 类是：

class="fap 索引" id="canvas"

我应该如何解决这个问题，也许使用 document.getElementById？

任何帮助将不胜感激。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:02:23.490

是的，您可以使用：

```
$canvas = $dom->getElementById('canvas'); 
```

不确定您想对将设置为 的 DOMElement 对象做什么`$canvas`，但您显然可以查看 DOMElement 的文档以查看其上可用的方法。

[http://php.net/manual/en/class.domelement.php](http://php.net/manual/en/class.domelement.php)

# boost-python - 从返回 shared_ptr 的函数返回相同的底层 Python boost::python::object

> ID：14077294
> 
> 赞同：1
> 
> 时间：2012-12-28T23:59:23.060
> 
> 标签：boost-python

在我的应用程序中，我通过 boost::shared_ptr 通过 boost::python 包装 C++ 对象。

我遇到的问题是，每当我在 C++ 中返回一个引用时，boost 都会分配一个新对象来指向该引用，而不是重用现有的 Python 对象。除其他外，这破坏了可能已在 Python 中设置的相等测试和自定义属性。

每次我给它一个指向同一个底层对象的 shared_ptr 时，是否有一种干净、简单的方法可以让 boost::python 自动重用现有的 boost::python::object（或至少 PyObject）？

示例代码：

C++：

```
#include <boost/python.hpp>
using namespace boost::python;

class Apple {};

boost::shared_ptr<Apple> theMoldyApple(new Apple());

boost::shared_ptr<Apple> getMoldyApple() {
    //pretend we do some logic here that won't always return theMoldyApple 
    //exactly
    return theMoldyApple;
}

BOOST_PYTHON_MODULE(bobtest) {
    class_<Apple, boost::shared_ptr<Apple>>("Apple", init<>());

    def("getMoldyApple", getMoldyApple);
} 
```

Python：

```
from bobtest import *

# Set a custom property on the Python object:
ma = getMoldyApple()
ma.customProp = 11

# This works fine because ma is the same PyObject is was above:
print "ma.customProp:", ma.customProp

# This doesn't work because boost::python wraps a copy of the shared_ptr
# (that points to theMoldyApple) with a new PyObject each time I call
# getMoldyApple()
print "getMoldyApple().customProp:", getMoldyApple().customProp 
```

结果：

```
ma.customProp: 11
getMoldyApple().customProp:
Traceback (most recent call last):
  File "<string>", line 14, in <module>
AttributeError: 'Apple' object has no attribute 'customProp' 
```

期望的结果：

```
ma.customProp: 11
getMoldyApple().customProp: 11 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-01-16T07:56:34.903

您需要按如下方式定义它：

```
class_<Apple>("Apple", no_init)
    .def("__init__", make_constructor(getMoldyApple))
; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-01-21T12:16:36.873

您需要创建一个包含 Python 对象的包装类，并使用`has_back_reference`.

[http://www.boost.org/doc/libs/1_55_0/libs/python/doc/v2/has_back_reference.html](http://www.boost.org/doc/libs/1_55_0/libs/python/doc/v2/has_back_reference.html)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2016-06-10T14:25:37.533

我在代码审查中发布了一个使用自定义转换器和地图作为缓存的通用解决方案：

[https://codereview.stackexchange.com/questions/130044/same-pyobject-for-a-shared-ptr-c-object](https://codereview.stackexchange.com/questions/130044/same-pyobject-for-a-shared-ptr-c-object)

# java - hadoop reducer 是否有输入超时？

> ID：14077296
> 
> 赞同：0
> 
> 时间：2012-12-28T23:59:36.097
> 
> 标签：java, hadoop, hortonworks-data-platform

我有一个 hadoop 作业，我试图在 8 节点 Windows HDP 集群上运行。该作业有超过 137000 个输入，它在大约 3.5 小时内处理了 84% 到 92% 的地图任务。然后 reducer 在 0% 处重新启动，并且 map 任务重新运行。工作永远不会完成。

我的问题是，reducer 从 dfs 读取 map 输出或块是否有超时导致 reducer 重新启动？或者，如果减速器达到某种限制，它会产生一条错误消息，帮助我确定原因。我的第一个障碍是默认队列只允许 100000 个任务，但作业出错，并显示这样的消息。

我正在使用的 hadoop 版本是您使用 Microsoft HDInsight 获得的版本。它似乎是 windows 的 hadoop 1.1.0 快照（Hortonworks Data Platform 1.0.1 Developer Preview for Windows）。我设置属性为客户端任务提供 8000mb 的内存。由于 jobtracker 是从 Windows 服务启动的，因此我无法确定 VM 实际启动时使用了多少内存。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-07-10T12:59:15.960

你在地图任务中使用了计数器吗？您的地图任务占用大量 CPU 资源吗？如果是，您需要使用计数器来确保 Hadoop 不会认为您的工作挂起，而是正在处理。

# python - 如何使鼻子将案例的输出记录到单独的文件中？

> ID：14077299
> 
> 赞同：1
> 
> 时间：2012-12-28T23:59:59.677
> 
> 标签：python, testing, nose

我正在使用鼻子来运行一堆测试用例。我想将每个案例的输出记录到单独的文件中，并了解每个案例的结果[成功/失败]。不幸的是，我不知道怎么用鼻子做。有人可以提供一些线索吗？谢谢你

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-01-03T02:28:58.873

首先，这听起来像是*不寻常的用法*，可能表明您应该重新考虑您的测试方案。

我可以想出几种方法来解决这个问题。最简单的方法是让每个测试记录自己，而不是让鼻子为你做。如果您只有几个测试，或者只关心记录几个测试的结果，那么这绝对是这样做的方法。

更复杂和通用的方法是[编写一个鼻子插件，在](https://nose.readthedocs.org/en/latest/plugins/writing.html#writing-plugins)每次测试完成时记录它的结果。为此，您需要编写一个实现 afterTest() 方法的插件。

```
from nose.plugins import Plugin
import datetime

class SeparateReports(Plugin):
  "Log the results of each test into a separate file."
  def afterTest(self, test):
    logname = test.id() + '.log'
    success = test.passed
    date = datetime.datetime.now()
    # print logname, datetime.datetime.now(), success
    with open(logname, 'a') as log:
        log.write("%s: %s\n" % (date, success)) 
```

这将附加到以您的特定测试命名的日志文件中，一个日期戳和 True 表示成功/False 表示失败。几点注意事项：

*   有关打印结果的示例，请参见注释掉的行。
*   这个插件需要通过nose[*注册*；请参阅文档](https://nose.readthedocs.org/en/latest/plugins/writing.html#registering)。
*   注册后，必须启用插件；使用命令行选项**--with-separatereports**（根据插件名称自动生成）。
*   这会很慢，因为它会为每个测试触及文件。您可能需要一个开放的 sqlite DB 或类似的东西。

# php - php回显第一个div

> ID：14077304
> 
> 赞同：2
> 
> 时间：2012-12-29T00:00:26.790
> 
> 标签：php, regex

我不想成为帮助吸血鬼：你不必为我编写代码。我主要想知道我可以使这成为可能。

我应该如何回显字符串中的前 5 个 div？我会使用“file_get_contents”来获取它，将它放在一个字符串中，解析它，然后回显它。我将如何解析它？正则表达式？一些dom解析器？

就像这个字符串：

```
<div class="div">1</div><div class="div">2</div><div class="div">3</div><div class="div">4</div><div class="div">5</div><div class="div">end!</div> 
```

非常感谢，加油

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:08:23.587

试试这个：

*   您可以添加 root-Element 以使输入数据有效 XML 并使用
    libxml（DOM、simplexml 等）。但输入数据必须是有效的 xml 数据（您的示例数据看起来有效，只需要根元素）。
*   使用带有`><`as 模式而不是 substr 的 strpos。这是更快的方法

**更新：** 这里使用 strpos 和 substr 的示例代码：

```
$data = '<div class="div">1</div><div class="div">2</div><div class="div">3</div><div class="div">4</div><div class="div">5</div><div class="div">end!</div>';
$pos = 0;
for($i=0; $i<5; $i++) {
    $pos = strpos($data, '><', $pos+2);
}
echo substr($data, $pos+1); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:05:06.840

如果您想坚持使用 PHP，[strpos](http://php.net/manual/en/function.strpos.php)和[substr可能是最好的方法。](http://php.net/manual/en/function.substr.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:10:19.700

如果 div 的内容可以包含子字符串“div”或其他元素，最好使用一些解析器。我推荐[phpQuery](http://code.google.com/p/phpquery/)，它像 jQuery 一样简单，但是对于 php。

代码将如下所示：

```
echo pq('div:lt(5)', $string)->html() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T00:14:03.910

```
$string = '<div class="div">1</div><div class="div">2</div><div class="div">3</div><div class="div">4</div><div class="div">5</div><div class="div">end!</div>';

$dom = new DOMDocument();
$new_dom = new DOMDocument;
$dom->loadHTML($string);

$count = 0;
foreach ($dom->getElementsByTagName('div') as $node)
{
    $new_dom->appendChild($new_dom->importNode($node, TRUE));
    if (++$count >= 5)
        break;
}

echo $new_dom->saveHTML(); 
```

[您可以使用 PHP 的DOMDocument](http://us3.php.net/manual/en/class.domdocument.php)类，而不是使用 jQuery 或 3rd 方库。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-12-29T00:15:03.653

jQuery切片

```
$(".topics .topic").slice(5).hide(); 
```

[http://api.jquery.com/slice/](http://api.jquery.com/slice/)

# c++ - 副作用不起作用

> ID：14077307
> 
> 赞同：1
> 
> 时间：2012-12-29T00:00:44.910
> 
> 标签：c++, side-effects, gcc4.7

我创建了一个用于网络的缓冲区类，并使用副作用来获取缓冲区指针以及大小。我创建了一个简单的测试，它显示与类的 getptr() 函数相同的行为。

```
char SomeBuffer[100];

void* getbuf(int& size) {
  size = 100;    
  return SomeBuffer;
}

int testrecv(void* ptr, int size) {
 int i = 0;//BREAKPOINT HERE
 return 0;
}

int main(int argc, char**argv) {
 int size;
 testrecv(getbuf(size), size);
} 
```

当我从 testrecv() 函数中查看变量时，大小是留在堆栈上的一些随机值。由于 getbuf() 的副作用，testrecv() 中的大小不应该为 100 吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:02:34.313

函数参数的求值顺序是*实现定义的*。这意味着您不能依赖在参数传递给`getbuf`之前被调用。`size``testrecv`

对于您的特定编译器，这里发生的事情是`testrecv`从最后到第一个评估参数。`size`首先评估，当时它有一个未指定的值*（随机值）*。只有这样`getbuf`才被评估，将您的`size`变量修改为您期望的值，但对于函数参数来说为时已晚。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:04:07.843

未指定函数参数的评估顺序。看来，您使用的系统首先评估`size`，然后是`getbuf(size)`. 结果，该参数没有预期值。最简单的解决方法可能是返回指针和大小：

```
std::pair<void*, int> getbuf() { return std::make_pair(someBuffer, 100); }
int testrcv(std::pair<void*, int> buffer) { ... } 
```

（或者你可以使用`std::vector<T>`一个合适的类型......）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-29T00:06:38.247

问题是您假设了一个评估顺序：

```
testrecv(getbuf(size), size);

// What seems to be happening is
1) size is evaluated and set up for the function call.
2) getbuf() is called. This sets the local copy of size
   but the value that is being passed to the function call has already been
   evaluated. So this value will not be passed (but the random value that
   was in the variable at the time the `size` parameter was evaluated).
3) Function testrecv() called. 
```

不要依赖副作用。

```
 int size;
 void* buf = getbuf(size);  // Now size will be set
 testrecv(buf, size); 
```

见：[https ://stackoverflow.com/a/367663/14065](https://stackoverflow.com/a/367663/14065)

# java - 非常奇怪的摆动错误

> ID：14077309
> 
> 赞同：1
> 
> 时间：2012-12-29T00:00:47.253
> 
> 标签：java, swing

我正在为我制作的游戏编写登录脚本。我目前正在检查提供的信息以确保其有效。我遇到了一个问题，当我去检查 2 个文本字段是否具有相同的值时。当他们这样做时，他们会做与我想要做的相反的事情。

```
private void regAccConfEmailFieldFocusFocusLost(FocusEvent event) {
    if(regAccConfEmailField.getText() == regAccEmail.getText() && regAccConfEmail != null)
    {
        regAccConfEmailField.setBorder(new LineBorder(Color.green, 1, false));
        confEmail = true;
    }
    else
    {
        regAccConfEmailField.setBorder(new LineBorder(Color.red, 1, false));
        confEmail = false;
    }
}

private void regAccConfSecQFieldFocusFocusLost(FocusEvent event) {
    if(regAccConfSecQField.getText() == null)
    {
        regAccConfSecQField.setBorder(new LineBorder(Color.red, 1, false));
        secQuestion = false;
    }
    else
    {
        regAccConfSecQField.setBorder(new LineBorder(Color.green, 1, false));
        secQuestion = true;
    }
} 
```

这是我拥有的代码，我需要知道为什么这些方法中的每一个都与给出的相反。

假设 regAccConfEmailField 和 regAccEmailField 都等于 hello@gmail.com 它将转到 if 语句而不是 else。如果需要，我可以提供更多代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:05:35.330

这个说法有两个问题：

```
if (regAccConfEmailField.getText() == regAccEmail.getText() && regAccConfEmail != null) 
```

*   您应该`null`首先进行检查，以便它短路表达式 if `regAccConfEmail`is`null`
*   也用于`String.equals`比较`String`内容而不是`==`运算符。该`==`运算符用于比较对象引用，并且当前为您提供与您想要的相反的结果，因为来自 2 个字段的值将是不同的`String`对象。

您可以替换为

```
if (regAccConfEmail != null && regAccConfEmailField.getText().equals(regAccEmail.getText())) 
```

*   也`regAccConfSecQField.getText()`永远不能`null`从一个`JTextField`如此替换

    if (regAccConfSecQField.getText() == null)

和

```
 if (regAccConfSecQField.getText().trim().isEmpty()) 
```

*   最后，您似乎正在使用`FocusListener`依赖`FocusEvents`于执行验证的 a。看看使用[DocumentListener](http://docs.oracle.com/javase/tutorial/uiswing/events/documentlistener.html)来触发对文档更改的验证。

# ios - 如何拦截 UIWebView URL 资源请求

> ID：14077316
> 
> 赞同：4
> 
> 时间：2012-12-29T00:01:50.200
> 
> 标签：ios, url, uiwebview

这真的很难弄清楚，但我想我已经成功地弄清楚了。例如，如果您尝试构建进度指示器，或者在加载页面的生命周期中的某个时间点执行某些操作，则此代码会很有用。

使用此代码，您现在可以查看正在下载的每个 URL，无论是图像、css 文件等。

```
@interface CustomURLProtocol : NSURLProtocol
@end

@implementation CustomURLProtocol

+ (void)enable
{
    [NSURLProtocol registerClass:[CustomURLProtocol class]];
}

+ (BOOL)canInitWithRequest:(NSURLRequest *)request
{
    // Do something here with request.URL.absolutestring

    return NO;
}

@end 
```

现在，只需调用 [CustomURLProtocol enable]。

# vba - 在宏中使用 VLookup

> ID：14077317
> 
> 赞同：0
> 
> 时间：2012-12-29T00:01:58.007
> 
> 标签：vba, excel, vlookup

我是 VBA 的新手，但我上瘾了！我创建了一个工作簿，以 2 周为单位跟踪加班，每个工作表有一个 2 周的时间段。我正在尝试调试的宏旨在将工作表中所做的任何更改传递到以下工作表。诀窍是一行中的数据可能在以下工作表中的另一行中，因此我尝试在宏中使用 VLookup 以保持其准确性。

```
Sub CarryForward()
    Dim Answer As String
    Answer = MsgBox("This should only be used for a PERMANENT crew change." & vbNewLine & "If you are adding a new person to the list," & vbNewLine & "please use the Re-Sort function." & vbNewLine & "Do you want to continue?", vbExclamation + vbYesNo, "Caution!")
    If Answer = vbNo Then
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Dim ActiveWorksheet As String
    ActiveWorksheet = ActiveSheet.Name
        For i = (ActiveSheet.Index + 1) To Sheets("DATA").Index - 1
            For x = 5 To 25
                Dim a As String
                Dim b As String
                a = "B" & x
                b = "C" & x
                ActiveSheet.Range(b).Value = Application.WorksheetFunction.VLookup(a, Sheets(ActiveWorksheet).Range("B5:C25"), 2, False)
            Next x
            Range("A3").Select
        Next i
    Sheets(ActiveWorksheet).Select
    Application.CutCopyMode = False
    Range("A3").Select
    Application.ScreenUpdating = True
End Sub 
```

我很确定这只是 VLookup 代码行中的语法错误。发布的许多帮助都接近我正在寻找的内容，只是没有让我越过终点线。

任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:25:15.963

有点不清楚您要做什么，但我认为在字里行间阅读

*   您想查找包含在名为的单元格中的值`a`吗？
*   并将结果放在工作表索引上`i`？

此外，还有很多改进代码的机会：请参阅下面的嵌入评论

```
Sub CarryForward()
    Dim Answer As VbMsgBoxResult  ' <-- Correct Datatype
    Answer = MsgBox("This should only be used for a PERMANENT crew change." & vbNewLine & _
        "If you are adding a new person to the list," & vbNewLine & _
        "please use the Re-Sort function." & vbNewLine & _
        "Do you want to continue?", _
        vbExclamation + vbYesNo, "Caution!")
    If Answer = vbNo Then
        Exit Sub
    End If
    Application.ScreenUpdating = False
    ' Dim ActiveWorksheet As String  <-- Don't need this
    'ActiveWorksheet = ActiveSheet.Name <-- use object variables
    Dim wbActive As Workbook  ' <-- don't select, use variables for sheet objects
    Dim shActive As Worksheet
    Set wbActive = ActiveWorkbook
    Set shActive = ActiveSheet
    'Dim a As String ' <-- no point in putting these inside the loop in VBA.  And don't need these anyway
    'Dim b As String
    Dim SearchRange As Range
    Set SearchRange = shActive.Range("B5:C25") ' <-- Use variable to hold range
    Dim shDest As Worksheet
    Dim i As Long, x As Long '<-- dim all your variables
    For i = (shActive.Index + 1) To wbActive.Worksheets("DATA").Index - 1 ' <-- qualify references
        Set shDest = wbActive.Sheets(i)
        For x = 5 To 25
            'a = "B" & x <-- no need to create cell names
            'b = "C" & x
            ' I think you want to lookup the value contained in cell named by a?
            ' and put the result on sheet index i?
            '  Note: if value is not found, this will return N/A.  Add an error handler
            wbActive.Sheets(i).Cells(x, 3).Value = Application.VLookup(shActive.Cells(x, 2).Value, SearchRange, 2, False)
        Next x
        'Range("A3").Select
    Next i
    'Sheets(ActiveWorksheet).Select ,-- don't need these
    'Application.CutCopyMode = False
    'Range("A3").Select
    Application.ScreenUpdating = True
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T12:42:56.967

我怀疑您可能希望将 vlookup 语句替换为类似

```
Application.WorksheetFunction.VLookup(ActiveWorksheet.Range(a).value, ActiveWorksheet.Range("B5:C25"), 2, False) 
```

目前看起来你只是在对一些字符串 B5、B6、B7 等而不是这些单元格中的值进行 vlookup

# python - 让用户写一个句子并垂直发送到一个文件

> ID：14077319
> 
> 赞同：1
> 
> 时间：2012-12-29T00:02:05.720
> 
> 标签：python

我想制作一个打印用户写的句子的程序，并将其垂直打印到文件中。我目前的代码是：

```
# Create a program that takes sentence from user, and splits 
# the words into a list.
# Then write the list into a a file vertically.

# Take sentence from user
sentence = raw_input('Write a sentence :')

# Split the words of sentence
splited = str(sentence.split())
print splited

# Write to file
f=open('C:\Users\QamarAli\Desktop\HelloFile.txt', 'w')
for i in range(len(splited)):
    f.writelines(splited)
    f.writelines("\n")
f.close() 
```

如果我输入了 sentence `Hi i am aFAFAF`，那么文本文件的内容是：

```
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF']
[u'Hi', u'i', u'am', u'aFAFAF'] 
```

而我希望它是

```
你好
一世
是
一个FAFAF

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:09:34.240

这很简单

```
f.write('\n'.join(sentence.split())) 
```

甚至不需要创建变量（如果你想，`splited`你甚至可以消除变量：） 。`sentence``f.write('\n'.join(raw_input().split()))`

* * *

如果你想坚持`for`循环，你可能打算做这样的事情：

```
splited = sentence.split()  # notice no `str`

for i in range(len(splited)):
    f.write(splited[i])
    f.write('\n') 
```

或者更简单地说：

```
for s in sentence.split():
    f.write(s + '\n') 
```

请注意，这种方法将始终留下一个尾随换行符，而`f.write('\n'.join(sentence.split()))`不会。如果需要，您可以通过使用轻松添加这个额外的换行符

```
f.write('\n'.join(sentence.split()) + '\n') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:08:08.560

您正在将列表“打印”到文件中，而您应该遍历列表。

```
 # your code. get rid of your own for loop and replace it with this one
     for part in splited:
            #this is the part which I am talking about
            f.writelines(part)
            f.writelines("\n")
     # your code 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-29T00:14:04.330

好的，如果您愿意，我将解释错误，而不是给出代码高尔夫风格的答案！

`splited = str(sentence.split())`

您不应该将所有这些都转换为字符串， split() 返回 a `list`，因此将其保留为单词列表：

`words = sentence.split()`

接下来，您的循环是错误的：

`for i in range(len()):`

你本来打算的`for i in range(len(words))`，但你可以做到`for word in words:`

* * *

所以你可以尝试：

```
for word in sentence.split():
   f.write(word + '\n') 
```

# python - 从 txt 文件中读取特定的用户输入

> ID：14077320
> 
> 赞同：1
> 
> 时间：2012-12-29T00:02:17.780
> 
> 标签：python, readfile

我有一个程序让用户输入 som 数据，然后将这些数据绘制在画布上（如每周计划）。我现在希望用户能够删除或重做一个条目（我将通过点击事件来完成），但是，我的问题是：

如何读取文本文件中的特定行？可能的文本文件示例：

```
Abe
#0080c0 
February
Friday 
21 
Part delivery 

John 
#ff8000 
July 
Sunday 
21 
Social 

Egon 
#ff80ff 
April 
Thursday 
15 
Work 
```

请注意，这是文本文件的一小部分，理想情况下它将包含 56 个这些 6 行集群。

我插入文本的代码：

```
taskentry = str(tasknameentry.get())
monthentry = str(monthvar.get())
dayentry = str(dayvar.get())
dateentry = str(datevar.get())
activityentry = str(typevar.get())

tasklist = [taskentry, hexstr, monthentry, dayentry, dateentry, activityentry]
taskfile = open('taskfile.txt', 'a')
for word in tasklist:
    taskfile.write('%s \n' % word)
taskfile.write('\n')
taskfile.close() 
```

因此，为了让用户能够重做或删除“任务”，我需要读取文件并查找特定的任务名称或类似名称，我只是不知道该怎么做。我已经通读了我的书的 .write 和 .read 部分，查看了此处的文档和问题，但未能提出有效的解决方案。

我现在需要的，所以我可以继续前进，这只是在搜索 fx John 时读取 fx 6 附加行的一种方式。因此，我将来可以通过单击选择重做或删除事件。

提前，谢谢！

最好的问候，卡斯帕

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:21:07.187

如果文件不是那么大，您可以将文件读入缓冲区，修改该缓冲区并将缓冲区写回文件。一个快速的代码片段就像：

```
#open the file
f = open('file.txt')
lines = f.readlines()
lineNum = -1

#find the line to modify
for i, line in enumerate(lines):
    if line.strip() == "John":
        lineNum = i
        break

if lineNum == -1:
    #Line not found, handle the error..

#modify the buffer with the new data
newtasklist = [taskentry, hexstr, monthentry, dayentry, dateentry, activityentry]
for task in newtasklist:
    lines[lineNum] = task
    lineNum += 1

#or if you want to remove the task list :
lines = lines[:lineNum] + [lineNum + 7:]

# and write everything back
with open('file.txt', 'w') as file:
    file.writelines(lines) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:14:27.610

首先，我不是这方面的佼佼者，但如果您扫描整个文档并将其存储到字符串的 ArrayList 中，您就可以删除某些行、添加行和修改行。

之后，您可以删除文档的信息并重新粘贴 ArrayList 中的内容。

至于读取特定行，我实际上并不认为有一种方法可以使用 Scanner 或 FileWriter 读取该行。

对不起，如果这真的没有帮助。我正在尽我所能以任何方式提供帮助！

一些示例代码可能是：

```
ArrayList<String> taskList = new <String>ArrayList;

File file = new File(<File Name>);
try
{
    Scanner scan = new Scanner(file);
    while(scan.hasNext())
    {
            taskList.add(scan.next());
    }
} catch (FileNotFoundException e)
{
    e.printStackTrace();
    return;
} 
```

这将创建一个可搜索的单词数组，然后您可以根据需要删除和添加它，然后清除您的文档并从数组列表中重新粘贴新信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:23:35.333

您可以使用 readlines 创建列表，其中每个条目都是 txt 文件的单独行。然后您可以更改此列表中的特定条目并使用 writelines 更改 txt 文件。

```
Tasks=open('taskfile.txt', 'r').readlines() 
```

在数据中，您按名称列出了每个人的任务：

```
Data={}
n=0
try:
  while True:
     Data[Tasks[n+n*6]]=Tasks[n+1:n+6]
     n+=1
except:
   pass 
```

然后您可以通过以下方式更改 John 的第二个任务：

```
Data['John'][1]='Football' 
```

# oop - 迭代器模式

> ID：14077322
> 
> 赞同：-2
> 
> 时间：2012-12-29T00:02:27.983
> 
> 标签：oop, design-patterns, iterator

所以我一直在看几个视频，在互联网上阅读了一些关于这种设计模式的信息，但只是为了让事情变得清楚，这种模式是否正确：

*具有自己的 Iterator 接口实现的对象（主题）*

没有别的？没有像观察者模式或装饰器模式之类的花哨的东西吗？它只是一个已知接口的实现？！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:15:10.880

**简答**

是的，实现接口就是它的全部。

**长答案**

说“只实现一个接口”就像有一个电影的想法然后“只创建电影”。

您的界面只不过是一个规范；它不做任何工作，它只是定义了一个签名。当您实现接口时，您的大部分工作就完成了——即：编写代码。

请不要让“实现接口”这些词欺骗了您。它可以很简单，也可以很复杂。

为了给你一个想法，举这个例子。我有一个类的接口，它可以计算你的身高和体重，并据此预测你未来妻子的名字。太神奇了，不是吗？这是界面：

```
class IPredictor {
   public abstract void setWeight(double weight);
   public abstract void setHeight(double height);
   public abstract string getNameOfFutureWife();
}; 
```

现在要完成这项工作，您只需要实现接口。完成后请告诉我；我想知道未来的巴泽尔夫人的名字：D

# structuremap - StructureMap 注册表不适用于通用接口

> ID：14077328
> 
> 赞同：1
> 
> 时间：2012-12-29T00:02:59.203
> 
> 标签：structuremap

```
public class RepositoryRegistry : Registry
    {
        public RepositoryRegistry()
        {
            Scan(x =>
            {
                x.Assembly("MyApp.Data");
                x.TheCallingAssembly();
                x.WithDefaultConventions();                
                x.AddAllTypesOf(typeof(ILookupRepo<>));                      
            });

            var tmp = ObjectFactory.GetInstance<ILookupRepo<User>>();

            Debug.WriteLine(ObjectFactory.WhatDoIHave());
        }
    } 
```

收到此错误：

```
{"StructureMap Exception Code:  202 No Default Instance defined for PluginFamily MyApp.Data.Repositories.Lookup.ILookupRepo`1[[MyApp.Data.Context.User, MyApp.Data, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], TolMobile.Data, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"} 
```

StructureMap 似乎无法解决`IAnything<T>`。有什么理由会停止工作吗？我以完全相同的方式在另一个项目中使用了它，它解决了。唯一的区别是我现在使用的 StructureMap 版本更新...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:04:42.383

这不是 StructureMap 问题 - 没有类型继承自`ILookupRepo<>`.

这是一个开放的泛型类型，而不是基本类型！如果你想找到关闭的类型`ILookupRepo<>`，那么你需要像这样扫描：

```
Scan(x =>
{
    x.Assembly("MyApp.Data");
    x.TheCallingAssembly();
    x.WithDefaultConventions();                
    x.ConnectImplementationsToTypesClosing(typeof(ILookupRepo<>));
}); 
```

[有一篇关于该主题的博客文章。](http://lostechies.com/jimmybogard/2009/12/18/advanced-structuremap-connecting-implementations-to-open-generic-types/)

# ios - Phonegap iOS 前置摄像头 - 翻转图像

> ID：14077330
> 
> 赞同：3
> 
> 时间：2012-12-29T00:03:27.907
> 
> 标签：ios, cordova, camera, image-rotation

我正在使用 Phonegap 检索相机图片，然后将其输出到 HTML5 画布上。

如果我使用后置摄像头，一切都很好，但如果我使用前置摄像头，图像会上下颠倒。

有没有人遇到过这个问题？关于为什么会发生这种情况的任何想法？

有什么办法可以查出是用哪个相机拍照的吗？

以下是我的代码：

```
//take picture on click
$("#camera").click(function(){
    //Take picture using device camera and retrieve image as base64-encoded string
    navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50 });
})

// Called when a photo is successfully retrieved in base64 format.
// It draws the photo on the canvas.
function onPhotoDataSuccess(imageData) {
    var imageObj = new Image();
    imageObj.onload = function(){
        drawImage(cbook, this);
    };
    imageObj.src = imageData;
} 
```

谢谢。

# mongokit - 使用 mongokit 进行循环引用 - 有可能吗？

> ID：14077334
> 
> 赞同：1
> 
> 时间：2012-12-29T00:04:19.123
> 
> 标签：mongokit

我有 2 类分支和用户。用户属于某个分支。但是，每个分支机构都有一位 CEO（一种用户）。但是，当我设计 mongokit 类并尝试使用引用时，它确实适用于类 User（因为分支是在 User 之前定义的），但它不适用于类 Branch，出现以下错误：

***“ceo”：用户*** ***名错误：未定义名称“用户”***

## 那么问题 - 如何实现这样的参考？

```
from mongokit import *
from datetime import datetime, date, time
import pprint

db = Connection()

@db.register
class Registry(Document):
    structure = {
        'created': datetime,
        'updated': datetime,
        'deleted': datetime
    }

@db.register
class Branch(Registry):
    structure = {
        'name':unicode,
        'groupEmail':unicode,
        'timezone':unicode,
        'address': {
            'address1':unicode,
            'address2':unicode,
            'city':unicode,
            'state':unicode,
            'country':unicode,
            'zip': unicode
        },
        'size':int,
        'ceo': User
}

@db.register
class User(Document):
    structure = {
        'fname': unicode,
        'lname': unicode,
        'branch': Branch,
        'address': {
            'address1':unicode,
            'address2':unicode,
            'city':unicode,
            'state':unicode,
            'country':unicode,
            'zip': unicode
        },
        'created': datetime,
        'updated': datetime,
        'deleted': datetime
    } 
```

# c - 如何使用 cairo 在 Gtk+ 3 中确定非矩形绘图区域？

> ID：14077335
> 
> 赞同：0
> 
> 时间：2012-12-29T00:04:18.780
> 
> 标签：c, gtk, cairo, gtk3, inkscape

[Gtk+ 3 迁移指南](http://developer.gnome.org/gtk3/stable/checklist-gdkeventexpose-region.html)展示了如何使用该字段`GdkEventExpose.region`为重新渲染小部件提供细粒度区域。我们已经在 Inkscape 中做了类似的事情，以避免在我们的绘图画布上渲染过多复杂的东西。

但是，指南中的示例显示了如何为旧的 Gtk+ 2 的expose_event 处理程序执行此操作。

如何在新的 Gtk+ 3 绘图处理程序中执行等效操作，该处理程序接收“已剪辑”的 Cairo 上下文作为参数，而不是`GdkEventExpose`?

我想一种可能性是`cairo_copy_clip_rectangle_list`在“准备好的”开罗上下文中使用来获取构成要绘制的区域的矩形列表。有没有人有使用这个的经验？这似乎是一种明智的做法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-02-21T18:57:41.857

是的，您应该在小部件的 ::draw() 信号处理程序中获得的 cairo_t 上使用 cairo_copy_clip_rectangle_list() 。请参阅此提交以获取示例： [http ://git.gnome.org/browse/vte/commit/?id=21a064ac8b5925108b0ab9bd6516664c8cd3e268](http://git.gnome.org/browse/vte/commit/?id=21a064ac8b5925108b0ab9bd6516664c8cd3e268)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-31T11:32:30.187

由于我没有太多线索，我决定检查源代码。GDK 在窗口上发出一个`GDK_EXPOSE`事件并`GdkEventExpose`为此创建实例。

然后通过以下方式在 gtk/gtkmain.c 中处理此事件`gtk_widget_send_expose()`：

[http://git.gnome.org/browse/gtk+/tree/gtk/gtkwidget.c?id=eecb9607a5c0ee38eadb446545beccd0922cb0b8#n6104](http://git.gnome.org/browse/gtk+/tree/gtk/gtkwidget.c?id=eecb9607a5c0ee38eadb446545beccd0922cb0b8#n6104)

正如您在文档中所学的那样，此函数将 剪辑`cairo_t`到。`GdkEventExpose.region`

然后调用`_gtk_widget_draw_internal()`which 发出实际的绘图信号：

[http://git.gnome.org/browse/gtk+/tree/gtk/gtkwidget.c?id=eecb9607a5c0ee38eadb446545beccd0922cb0b8#n5726](http://git.gnome.org/browse/gtk+/tree/gtk/gtkwidget.c?id=eecb9607a5c0ee38eadb446545beccd0922cb0b8#n5726)

据我所知，这里没有任何内容可以让您直接访问剪辑区域。在`gtk_widget_send_expose()`作为用户`GdkEvent`数据添加到 cairo 上下文中。但是，这是不可访问的，因为所有涉及的函数和变量都是静态的。所以你必须使用`cairo_copy_clip_rectangle_list()`.

然而，这听起来非常低效。首先`gdk_cairo_region`将区域转换为对的多个调用`cairo_rectangle`，然后 cairo 将其从其内部表示转换为 a `cairo_rectangle_list_t`（如果剪辑由于某种原因不是区域，则可能会失败）。如果您发现这很慢，那么将一些快捷方式直接添加到 gtk 可能是有意义的。

# javascript - 查找函数调用的 DOM 位置

> ID：14077337
> 
> 赞同：1
> 
> 时间：2012-12-29T00:04:26.023
> 
> 标签：javascript, jquery

我知道在 Jquery 中，如果我触发了一个事件（点击等），您可以获得 event.id，但我将如何获得一个简单函数调用的 DOM 位置

前任 ：

```
<pre id="container2">...
  <script>
  FunctionCall();
  </script>
</pre> 
```

我想从我的 FunctionCall 中获取“container2”值

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:01:25.960

一般来说，脚本不知道它是从哪里启动的，因此没有通用的方法来执行您所要求的操作。您必须找到一个您事先知道的容器 div，或者插入您自己的已知对象，然后您可以找到。

在您的具体示例中，您可以这样做：

```
<pre id="container2">...
  <script>
  var fCntr = fCntr || 1;
  document.write('<div id="FunctionCallLocation' + fCntr + '"></div>');
  FunctionCall(fCntr++);
  </script>
</pre> 
```

然后，在脚本中，您可以找到具有传递给它的 id 的 DOM 元素。

Or, you could put the `document.write()` into the function itself so it marks its own location:

```
var fCntr = 1;
function FunctionCall() {
    var myLoc = "FunctionCallLocation" + fCntr++;
    document.write('<div id="' + myLoc + '"></div>');
    var myLoc = document.getElementById(myLoc);
} 
```

This exact code would only work if FunctionCall was only called at page load time so the `document.write()` would work as desired.

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-12-29T00:16:03.437

也许您可以尝试将 id 或类添加到脚本元素。所以是这样的：

```
<pre id='container2'>
    <script id='location'>
        (function FunctionCall() {
            var container2 = document.getElementById('location').parentNode;
            container2.appendChild(document.createElement('p'));
        }())
    </script>
</pre> 
```

# html - 当使图像浮动时，其他块元素会在它后面吗？

> ID：14077340
> 
> 赞同：0
> 
> 时间：2012-12-29T00:04:56.313
> 
> 标签：html, css

所以基本上我正在尝试用 html 和 css 找出一种超级简单和干净的方法，让用户头像直接坐在文章评论的左侧。

我正在尝试在一个有效的图像上浮动，但是即使文本没有，块元素似乎仍然在它后面？

知道为什么吗？例如见这里：http: [//www.prxa.info/articles/rochard.1579#comments](http://www.prxa.info/articles/rochard.1579#comments)

第二个评论引用框在头像后面，但文字没有？

图像只是使用这个：

```
style="float: left; padding-right: 10px; clear: right;" 
```

尝试有无明确 - 没有区别。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:58:50.480

添加这些规则

```
.qoute {
   float: left;
   width: 80%;
} 
```

并将其余评论放在一个 div 中并清除 DIV 以将其放入新行

# visual-studio-lightswitch - 在添加新项目时，来自同一实体的同一页面上的 Lightswitch 多个网格会导致问题

> ID：14077341
> 
> 赞同：1
> 
> 时间：2012-12-29T00:04:55.607
> 
> 标签：visual-studio-lightswitch

我们有一个基于 sql 表的名为 workingfields 的实体。该表中有一个类型字段，因此我们可以将不同类型的工作字段存储在同一个表中。然后，我们在一个屏幕上有 5 个不同的网格，它们基于工作字段实体，但每个都基于我们从工作字段创建的单独查询，该查询按特定类型的工作字段过滤它。

因此，我们的每个网格都只显示与该类型匹配的项目。当我们将新项目添加到其中一个网格时，它会将其添加到所有网格的底部。如果我们点击保存并刷新，它将以正确的类型保存它，因为我们正在设置当我们在网格中添加一个新实体时，当我们刷新屏幕时它在其他网格上消失。但是，它就像网格的查询过滤器向我们展示我们想要的数据，但是由于它们都基于称为工作字段的同一实体，lightswitch 认为我们想要向实体添加新的并且它在所有网格上显示它，即使我们希望它只显示在一个网格上。有没有办法只能让它在我们想要的特定网格上而不是在整个屏幕上添加新的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-31T14:40:01.407

也许很明显，但是您是否尝试过将每个网格分成单独的屏幕？

# haskell - 奇怪的存在类型

> ID：14077344
> 
> 赞同：4
> 
> 时间：2012-12-29T00:05:14.283
> 
> 标签：haskell, existential-type

[http://www.iai.uni-bonn.de/~jv/mpc08.pdf](http://www.iai.uni-bonn.de/~jv/mpc08.pdf) - 在这篇文章中我无法理解以下声明：

```
instance TreeLike CTree where
...
abs :: CTree a -> Tree a
improve :: (forall m. TreeLike m => m a) -> Tree a
improve m = abs m 
```

1.  有什么区别（forall m. TreeLike m => ma）带来了（我认为 TreeLike m => ma 在这里就足够了）

2.  为什么它在这里允许 abs，如果 m in ma 可以是任何 TreeLike，而不仅仅是 CTree？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-12-29T00:14:57.003

那是等级2的类型，而不是存在的类型。该类型的意思是参数`improve`必须是多态的。您不能将类型的值`Ctree a`（例如）传递给`improve`. 它根本不能在类型构造函数中具体化。它在类型构造函数中显式必须是多态的，并具有类型构造函数实现`Treelike`类的约束。

对于您的第二个问题，这允许实现`improve`选择`m`它想要的任何类型 - 这是实现的选择，并且类型系统对调用者隐藏了它。在这种情况下，实现恰好可以选择`Ctree`。`m`这完全没问题。诀窍是调用者`improve`无法在任何地方使用该信息。

这样做的实际结果是无法使用类型的详细信息来构造值 - 它必须使用`Treelike`类中的函数来构造它。但是实现会选择一个特定的类型来工作，允许它在内部使用表示的细节。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-29T00:15:22.540

是否`m`可以是“任何 T​​reeLike”取决于您的观点。

从实现的角度来看`improve`，是真的——`m`可以是any `TreeLike`，所以选择一个方便的，使用`abs`。

从论点的角度来看——`m`也就是说，任何适用`improve`于某个论点的观点，恰恰相反的东西成立：`m`事实上*必须能够是*any `TreeLike`，而不是我们选择的单一的。

将此与数字文字的类型进行比较——类似的意思是它是我们想要`(5 :: forall a. Num a => a)`的任何实例，但如果一个函数需要一个类型的参数，它想要的东西可以是*它*选择的任何实例。所以我们可以给它一个多态的，但不是，比如说，5。`Num``(forall a. Num a => a)``Num`*`5``Integer`*

 *在许多方面，您可以将多态类型视为函数将类型作为额外参数的意思，它告​​诉它我们希望为每个类型变量使用哪种特定类型。因此，要查看 和 之间的区别`(forall m. TreeLike m => m a) -> Tree a`，您可以将它们理解为vs.`forall m. TreeLike m => m a -> Tree a`之类的东西。`(M -> M a) -> Tree a``M -> M a -> Tree a`*

# java - 以 UTF-8 保存 Java 文件

> ID：14077345
> 
> 赞同：3
> 
> 时间：2012-12-29T00:05:19.057
> 
> 标签：java, character-encoding

当我运行这个程序时，它给了我一个“？” 对于 unicode 代码点*\u0508*。这是因为默认的 windows 字符编码 CP-1252 无法映射此代码点。

但是当我在 Eclipse 中将此文件保存为 'Text file encoding' = UTF-8 并运行此程序时，它会给我正确的输出**AԈC**。

为什么这行得通？我的意思是 java 文件保存为 UTF-8，但底层的 Windows 操作系统编码仍然是 CP-1252。我的问题类似于，当我尝试读取最初以 UTF-8 编写的 UTF-16 文本文件时，输出会因不同的框符号而变得奇怪。

```
public class e {
public static void main(String[] args) {
    System.out.println(System.getProperty("file.encoding"));
    String original = new String("A" + "\u0508" + "C");
    try {
        System.out.println("original = " + original);
    } catch (Exception e) {
        e.printStackTrace();
    }
}
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:18:32.817

将 Java 源文件保存为 UTF-8 或 Windows-1252 应该没有任何区别，因为这两种编码都以相同的方式对所有 ASCII 代码点进行编码。而且您的源文件仅使用 ASCII 字符。

因此，您应该尝试在其他地方找到错误。我建议重做您小心执行的步骤并重新进行测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:43:32.233

问题是运行程序时 file.encoding 的设置，以及 System.out 的目的地。如果 System.out 是一个 Eclipse 控制台，它很可能被设置为 UTF-8 Eclipse 控制台。如果它只是一个 Windows DOS 框，它是一个 CP1252 代码页，并且只会显示 ? 在这种情况下。

# php - 未显示 php 到 html 的输出

> ID：14077351
> 
> 赞同：1
> 
> 时间：2012-12-29T00:05:55.563
> 
> 标签：php, html, mysql, printing, lamp

我正在编写一个带有 mysql 集成的简单 php 应用程序。
我有一个简单的 html 页面，我在其中连接数据库，然后为了验证，我想打印主机信息。

我[在 html 文件中有这个。](http://pastebin.com/fD34CW5H)
输出是两个水平条，它们之间没有任何东西。

代码有什么问题？

我在 aptana 工作室（也使用灯泡）的 ubuntu 12.10 上写作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:11:40.527

你对你的 MySQLi 对象有点偏离，它应该更像..

```
$link = new mysqli("localhost", "my_user", "my_password", "dbname");
printf("Host Information: %s\n", $link->host_info); 
```

MySQLi 是一个面向对象的系统，host_info 是一个公共成员，一旦你拥有一个有效的 MySQLi 实例，你就可以访问它。

[http://php.net/manual/en/mysqli.get-host-info.php](http://php.net/manual/en/mysqli.get-host-info.php)

编辑：允许错误报告并检查连接。

```
<?php
    error_reporting(E_ALL ^ E_NOTICE);
?>
<!DOCTYPE html>
<html>
    <head>
        <title>Database Management Systems II - 2nd assignment</title>
    </head>
    <body>
        <hr>
        <?php
            $link = mysqli_connect("host","username","pass","database");
            if(mysqli_connect_error())
                echo "MySQLi Error: " . mysqli_connect_error();
            else
                echo "MySQLi Host Info: " . mysqli_get_host_info($link);
        ?>     
        <hr>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:27:22.420

检查以确保您实际连接到数据库：

```
$link = new mysqli("localhost", "my_user", "my_password", "dbname");
if (mysqli_connect_error()) {
    die('Connect Error (' . mysqli_connect_errno() . ') '
        . mysqli_connect_error());
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:30:56.193

所有迹象都表明您的 PHP 没有被执行期间。您的数据库代码可能仍然关闭，但我们甚至还没有到那个时候。这意味着正在发生两件事之一。您的扩展程序错误，或者您的 PHP 未配置。

首先，试试这个脚本（另存为 info.php）：

```
<?php
    phpinfo();
?> 
```

如果这不起作用，那么您没有配置。如果这确实有效，那么试试这个稍长的准系统示例；这是你的代码，没有数据库连接。您应该在两行之间看到一条存根消息。同样，保存时不要忘记 .php 扩展名：

```
<!DOCTYPE html>
<html>
    <head>
        <title>Database Management Systems II - 2nd assignment</title>
    </head>
    <body>
        <hr>
        <?php
            $link = 'link';
            printf("Host information: %s\n", $link);
        ?>
        <hr>
    </body>
</html> 
```

# jquery - jquery表单插件传递空值

> ID：14077352
> 
> 赞同：1
> 
> 时间：2012-12-29T00:06:01.790
> 
> 标签：jquery, jquery-forms-plugin

单击编辑信息按钮后，我有一个隐藏的 div 会显示在 facebox 模式窗口中。

```
<div id="editlog" style="display:none">
        <h3>Enter a new weight and/or photo.</h3>
        <form id="editlogform" action="editweight.php" method="post"  enctype="multipart/form-data">
            <input type="hidden" id="edittrigger" />
            <table width="400" cellpadding="0" cellspacing="6" border="0">
                <tr><td>New Weight.</td></tr>
                <tr><td><input type="text" name="weight" id="weight" maxlength="3" /></td></tr>
                <tr><td>New Photo</td></tr>
                <tr><td><input type="file" name="photo" /></td></tr>
                <tr><td><input type="button" value="submit" id="editlogsubmit" class="button"></td></tr>
            </table>
        </form>
    </div> 
```

如您所见，它还传递了一张照片。这是提交表单的jquery。

```
$('#editlogsubmit').live('click', function() {
    $('#editlogform').ajaxSubmit({ 
        success: function(data) {
            alert(data.t);
        }
    });
}); 
```

我在服务器端我`print_r()`的变量，它们都是空的？如果我使用 jquery 使用 id 而不是名称来获取值，我只能传递一些东西。我认为这可能与 div 处于模态的事实有关，但我不确定。关于为什么变量为空的任何想法？

# python - 在熊猫中将索引从整数更改为日期时出现问题

> ID：14077355
> 
> 赞同：2
> 
> 时间：2012-12-29T00:06:16.717
> 
> 标签：python, pandas, qstk

我在将 pandas DataFrame 索引从整数更改为日期时间时遇到问题。我想这样做，以便我可以调用 reindex 并填写表中列出的日期之间的日期。请注意，我现在必须使用 pandas 0.7.3，因为我也在使用 qstk，而 qstk 依赖于 pandas 0.7.3

首先，这是我的布局：

```
(Pdb) df
    AAPL  GOOG   IBM   XOM                 date
1      0     0  4000     0  2011-01-13 16:00:00
2      0  1000  4000     0  2011-01-26 16:00:00
3      0  1000  4000     0  2011-02-02 16:00:00
4      0  1000  4000  4000  2011-02-10 16:00:00
6      0     0  1800  4000  2011-03-03 16:00:00
7      0     0  3300  4000  2011-06-03 16:00:00
8      0     0     0  4000  2011-05-03 16:00:00
9   1200     0     0  4000  2011-06-10 16:00:00
11  1200     0     0  4000  2011-08-01 16:00:00
12     0     0     0  4000  2011-12-20 16:00:00

(Pdb) type(df['date'])
<class 'pandas.core.series.Series'>

(Pdb) df2 = DataFrame(index=df['date'])
(Pdb) df2
Empty DataFrame
Columns: array([], dtype=object)
Index: array([2011-01-13 16:00:00, 2011-01-26 16:00:00, 2011-02-02 16:00:00,
       2011-02-10 16:00:00, 2011-03-03 16:00:00, 2011-06-03 16:00:00,
       2011-05-03 16:00:00, 2011-06-10 16:00:00, 2011-08-01 16:00:00,
       2011-12-20 16:00:00], dtype=object)

(Pdb) df2.merge(df,left_index=True,right_on='date')
    AAPL  GOOG   IBM   XOM                 date
1      0     0  4000     0  2011-01-13 16:00:00
2      0  1000  4000     0  2011-01-26 16:00:00
3      0  1000  4000     0  2011-02-02 16:00:00
4      0  1000  4000  4000  2011-02-10 16:00:00
6      0     0  1800  4000  2011-03-03 16:00:00
8      0     0     0  4000  2011-05-03 16:00:00
7      0     0  3300  4000  2011-06-03 16:00:00
9   1200     0     0  4000  2011-06-10 16:00:00
11  1200     0     0  4000  2011-08-01 16:00:00
12     0     0     0  4000  2011-12-20 16:00:00 
```

我尝试了多种方法来获取日期时间索引：

1.) 使用带有日期时间值列表的 reindex() 方法。这会创建一个日期时间索引，但随后会为 DataFrame 中的数据填充 NaN。我猜这是因为原始值与整数索引相关联，并且重新索引到 datetime 试图用默认值填充新索引（如果没有指示填充方法，则为 NaN）。因此：

```
(Pdb) df.reindex(index=df['date'])
                     AAPL  GOOG  IBM  XOM date
date                                          
2011-01-13 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-01-26 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-02-02 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-02-10 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-03-03 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-06-03 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-05-03 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-06-10 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-08-01 16:00:00   NaN   NaN  NaN  NaN  NaN
2011-12-20 16:00:00   NaN   NaN  NaN  NaN  NaN 
```

2.) 将 DataFrame.merge 与我的原始 df 和第二个数据帧 df2 一起使用，这基本上只是一个日期时间索引，没有别的。所以我最终做了类似的事情：

```
(pdb) df2.merge(df,left_index=True,right_on='date')
    AAPL  GOOG   IBM   XOM                 date
1      0     0  4000     0  2011-01-13 16:00:00
2      0  1000  4000     0  2011-01-26 16:00:00
3      0  1000  4000     0  2011-02-02 16:00:00
4      0  1000  4000  4000  2011-02-10 16:00:00
6      0     0  1800  4000  2011-03-03 16:00:00
8      0     0     0  4000  2011-05-03 16:00:00
7      0     0  3300  4000  2011-06-03 16:00:00
9   1200     0     0  4000  2011-06-10 16:00:00
11  1200     0     0  4000  2011-08-01 16:00:00 
```

（反之亦然）。但我总是以整数索引结束这种事情。

3.) 从一个带有日期时间索引（从 df 的“日期”字段创建）和一堆空列的空 DataFrame 开始。然后我尝试通过将具有相同名称的列设置为等于 df 中的列来分配每一列：

```
(Pdb) df2['GOOG']=0
(Pdb) df2
                     GOOG
date                     
2011-01-13 16:00:00     0
2011-01-26 16:00:00     0
2011-02-02 16:00:00     0
2011-02-10 16:00:00     0
2011-03-03 16:00:00     0
2011-06-03 16:00:00     0
2011-05-03 16:00:00     0
2011-06-10 16:00:00     0
2011-08-01 16:00:00     0
2011-12-20 16:00:00     0
(Pdb) df2['GOOG'] = df['GOOG']
(Pdb) df2
                     GOOG
date                     
2011-01-13 16:00:00   NaN
2011-01-26 16:00:00   NaN
2011-02-02 16:00:00   NaN
2011-02-10 16:00:00   NaN
2011-03-03 16:00:00   NaN
2011-06-03 16:00:00   NaN
2011-05-03 16:00:00   NaN
2011-06-10 16:00:00   NaN
2011-08-01 16:00:00   NaN
2011-12-20 16:00:00   NaN 
```

那么，如何在 pandas 0.7.3 中使用日期时间索引而不是整数索引重新创建 df？我错过了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T00:21:11.740

我想你正在寻找[`set_index`](http://pandas.pydata.org/pandas-docs/dev/generated/pandas.DataFrame.set_index.html)：

```
In [11]: df.set_index('date')
Out[11]: 
                     AAPL  GOOG   IBM   XOM
date                                  
2011-01-13 16:00:00     0     0  4000     0
2011-01-26 16:00:00     0  1000  4000     0
2011-02-02 16:00:00     0  1000  4000     0
2011-02-10 16:00:00     0  1000  4000  4000
2011-03-03 16:00:00     0     0  1800  4000
2011-06-03 16:00:00     0     0  3300  4000
2011-05-03 16:00:00     0     0     0  4000
2011-06-10 16:00:00  1200     0     0  4000
2011-08-01 16:00:00  1200     0     0  4000
2011-12-20 16:00:00     0     0     0  4000 
```

# c# - 如何提高 HttpWebResponse 在 HTTPS 请求上的性能？

> ID：14077358
> 
> 赞同：0
> 
> 时间：2012-12-29T00:06:33.660
> 
> 标签：c#, https, httpwebrequest, httpwebresponse

我正在构建一个高度依赖网页加载速度的应用程序。

我在 C# 上使用 HttpWebResponse 没有得到任何好的结果。我使用 Chrome 和 IE 等互联网浏览器获得了更好的结果

**以下是我收集的统计数据：**

HttpWebResponse (C#) = 17 秒 / 20 个请求

Chrome 上的 Javascript/iFrame = 9 秒 / 20 个请求

IE 上的 Javascript/iFrame = 11 秒 / 20 个请求

**问题 #1** 我能做些什么来优化我的代码以获得更好的性能？

**问题 #2** 我可以单击两次开始按钮并打开两个连接，这样我就可以与浏览器性能相提并论。这很好用，但是我发送请求的网站有限制。如果我在另一个请求完成之前发送一个新请求，它会阻止我的连接 10 分钟。有没有办法可以防止这种情况？

我的主题：

```
void DomainThreadNamecheapStart()
{
    while (stop == false)
    {
        foreach (string FromDomainList in DomainList.Lines)
        {
            if (FromDomainList.Length > 1)
            {
                // I removed my api parameters from the string
                string namecheapapi = "https://api.namecheap.com/foo" + FromDomainList + "bar";

                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(namecheapapi);
                request.Proxy = null;
                request.ServicePoint.Expect100Continue = false;

                HttpWebResponse response = (HttpWebResponse)request.GetResponse();
                StreamReader sr = new StreamReader(response.GetResponseStream());

                status.Text = FromDomainList + "\n" + sr.ReadToEnd();

                sr.Close();
            }
        }
    }
} 
```

我的按钮：

```
private void button2_Click(object sender, EventArgs e)
{
    stop = false;
    Thread DomainThread = new Thread(new ThreadStart(DomainThreadNamecheapStart));
    DomainThread.Start();
} 
```

***我的老问题：*** [如何提高 HttpWebResponse 的性能？](https://stackoverflow.com/questions/14071945/how-do-i-increase-the-performance-of-httpwebresponse)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:45:16.107

每次按下按钮时，您都会创建一个线程。创建线程很昂贵，并且本身需要时间。尝试使用现有线程池中的线程（尝试`QueueUserWorkItem`），看看是否有帮助。

# php - 当我在描述框中使用单引号时出现 SQL 错误

> ID：14077360
> 
> 赞同：0
> 
> 时间：2012-12-29T00:06:49.117
> 
> 标签：php, sql, odbc, parameterized

我已经建立了一个网站来为我的小型企业提交时间表。它使用 SQL 语句通过 ODBC 将数据提交到 Microsoft Access 数据库。我现在注意到，每当我在描述框中使用单引号时，它都会给我一个错误。

我阅读了这个并且听到很多人说“参数化你的查询”，但我不确定如何做到这一点。

我的网站上有一个 HTML 文本框

```
<textarea name="JobDescription" cols="75" rows="8" id="otherpurch"></textarea><br> 
```

它是表单的一部分，并与其他各种东西一起提交。我将如何处理在此框中键入的描述中包含单引号？我有一个名为“submit_form”的 .php 文件，我认为必须在其中完成。参数化查询的一般程序是什么？我对此有点困惑。

非常感谢任何帮助！

这是数据从文本框发送到数据库的方式。

```
$JobDescription=$_POST['JobDescription'];
$JobDescription=stripslashes($JobDescription);
$JobDescription=mysql_real_escape_string($JobDescription);

//make connection to database, bail if no connection
$connection = odbc_pconnect('db','','');
if (!$connection) { exit("Connection Failed: " . $connection); }

//Send data (usually there are many other variables being sent, but I removed them
//for the purposes of showing you just the text being sent from the description box

$sql = "INSERT INTO TimeSheet ('$JobDescription')";
$rs = odbc_exec($connection, $sql);
if (!$rs) { exit("Error in SQL"); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:20:36.017

您使用参数化 SQL 的意图是正确的，通过 ODBC 访问也支持这一点。

对于要使用的函数`odbc_exec`，请参阅： http:
[//php.net/manual/en/function.odbc-prepare.php](http://php.net/manual/en/function.odbc-prepare.php)
[http://php.net/manual/en/function.odbc-execute.php](http://php.net/manual/en/function.odbc-execute.php)

```
$JobDescription=$_POST['JobDescription']; // no escaping needed!

$connection = odbc_pconnect('db','','');
if (!$connection) { exit("Connection Failed: " . $connection); }

$stmt = odbc_prepare($connection, "INSERT INTO TimeSheet (?)");
$rs = odbc_execute($stmt, array($JobDescription)); 
```

# zend-framework - 如何更改zend框架默认应用程序标题错误页面？

> ID：14077362
> 
> 赞同：0
> 
> 时间：2012-12-29T00:06:55.737
> 
> 标签：zend-framework, error-handling

我在 zend 框架 1.12 项目上抛出异常错误，他给了我标题为“Zend 框架默认应用程序”的响应页面。

如何更改标题页？谢谢..

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T09:47:47.547

您需要修改的代码在`application/controllers/ErrorController.php`和相关的 view-script`application/views/scripts/error/error.phtml`中。

发疯！;-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:05:54.183

查看有关 zend 框架的本教程，以帮助更好地了解 mvc 的工作原理和 zend 框架中的功能。

[http://akrabat.com/zend-framework-tutorial/](http://akrabat.com/zend-framework-tutorial/)

# mysql - 在数据库中存储大型二维数组，加入表时的性能问题

> ID：14077365
> 
> 赞同：0
> 
> 时间：2012-12-29T00:07:49.570
> 
> 标签：mysql, performance

我存储每周 24 小时的时间表，这意味着每个人都有一个 24x7 二维数组 ( `availability[time][day]`)，每人总共 168 个元素。在通过用户进行搜索时，可用性是一个过滤器，这意味着这些元素必须存储在一个表中 ( `availabilities`)。

架构的一部分`availabilities`：

```
+---------+----------------+
| Field   | Type           |
+---------+----------------+
| user_id | int(10)        |
| time    | varchar(4)     |
| mon     | tinyint(1)     |
| tue     | tinyint(1)     |
| wed     | tinyint(1)     |
| thu     | tinyint(1)     |
| fri     | tinyint(1)     |
| sat     | tinyint(1)     |
| sun     | tinyint(1)     |
+---------+----------------+ 
```

示例选择（每个用户实际上一整天会有 24 行）：

```
+---------+------+-----+-----+-----+-----+-----+-----+-----+
| user_id | time | mon | tue | wed | thu | fri | sat | sun |
+---------+------+-----+-----+-----+-----+-----+-----+-----+
| 1       | 6am  |   1 |   0 |   1 |   1 |   1 |   0 |   0 |
| 1       | 7am  |   1 |   0 |   1 |   1 |   1 |   0 |   0 |
| 1       | 8am  |   1 |   0 |   1 |   0 |   1 |   0 |   0 |
| 1       | 9am  |   0 |   0 |   0 |   1 |   0 |   0 |   0 |
| 1       | 10am |   0 |   0 |   0 |   1 |   0 |   0 |   1 |
| 1       | 11am |   1 |   0 |   1 |   0 |   1 |   0 |   1 |
| 1       | 12pm |   1 |   0 |   1 |   1 |   1 |   0 |   1 |
+---------+------+-----+-----+-----+-----+-----+-----+-----+ 
```

我担心这个表会很大，加入和解析它会大大减慢速度。可用性过滤器将是最后一个应用的过滤器，但返回的潜在用户集可能仍然很大。

**我的问题：**

1.  **有没有更有效的方法来存储这些信息**，这样表就不会那么大了？将数组序列化并将其保存到用户表上的一个字段（例如`users.availability`）有助于性能吗？（会有更多的解析，但会跳过大量的连接）

2.  **桌子的大小真的是个问题吗？**这是我的第一个大型应用程序，所以我不确定这张表是否真的大到可以担心。（例如，如果返回 25 个用户，则该`availability`表将有 4,800 个字段 [不包括`user_id`]）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:19:28.260

当您接近数千万行时，您只需要开始担心性能。我在这里没有看到任何问题，除了你的一些过早的优化:)

由于您已经从正确的角度开始，看来，通过走规范化路线，性能不应该成为太多关注的问题。将时间表序列化为数组将是太多不必要的工作：

示例：如果您想搜索在 Y 天 X 小时安排的所有用户怎么办？如果将其存储在数组中，则必须单独解析和搜索每一行的时间和日期。您将回到原点并解决有关性能的严重问题。

放一个

```
EXPLAIN EXTENDED 
```

在您查询之前查看幕后发生的事情。只要您的联接通过索引搜索行，您的应用程序就应该运行。

# iphone - 为什么添加对象后 UIScrollView 不会完全滚动？使用故事板、ARC 和 Xcode 4.5.2

> ID：14077367
> 
> 赞同：8
> 
> 时间：2012-12-29T00:08:01.757
> 
> 标签：iphone, ios, uiscrollview, storyboard, autolayout

所以，我知道我也有类似的问题，但可能并不准确（所以请不要给我打分——只是警告我什么的）。我已经搜索了几天来解决这个简单的问题。使用故事板、ARC 和 Xcode 4.5.2，我只需将一堆标签放在 UIScrollView 中并让它垂直滚动。我已经尝试过在 viewDidLoad、viewDidAppear 和 viewWillAppear 中设置帧大小和内容大小的多种组合，但无济于事。**当里面没有任何东西时，滚动视图可以完美滚动，但是当我向它添加标签时，滚动只会滚动一个非常短的部分。**

注意：我需要使用自动布局，否则我的整个项目都会搞砸。

这是我当前的代码...

**.h 文件：**

```
#import <UIKit/UIKit.h>

@interface MortgageRatesViewController : UIViewController <UIScrollViewDelegate, UIScrollViewAccessibilityDelegate>

- (IBAction)backButton:(id)sender;

@property (strong, nonatomic) IBOutlet UIView *mortgageView;

@property (weak, nonatomic) IBOutlet UIScrollView *scrollView;

@end 
```

**.m 文件：**

```
#import "MortgageRatesViewController.h"

@interface MortgageRatesViewController ()

@end

@implementation MortgageRatesViewController

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil
{
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

//-------------------------------------------------------

- (void)viewDidLoad
{
    [super viewDidLoad];
    // Do any additional setup after loading the view.

    self.view.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@"appBackgroundColor.png"]];

    [self.scrollView setScrollEnabled:YES];
    [self.scrollView setContentSize:CGSizeMake(0, 809)];

}

//---------------------------------------------------------------

//---------------------------------------------------------------

//-(void)viewWillAppear:(BOOL)animated{
//    
//    
//    [super viewWillAppear:animated];
//    
//    
//    [self.scrollView setFrame:CGRectMake(0, 0, 320, 808)];   
//
//    
//}

//---------------------------------------------------------------

-(void)viewDidAppear:(BOOL)animated
{

    [super viewDidAppear:animated];

    [self.view addSubview:self.scrollView];
    [self.scrollView setScrollEnabled:YES];
    [self.scrollView setContentSize:CGSizeMake(0, 809)];

}

//-------------------------------------------------------------

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

- (IBAction)backButton:(id)sender {

    [self dismissViewControllerAnimated:YES completion:NO];

}
@end 
```

**注意：将 viewWillAppear 注释掉没有任何区别。**

**编辑：我在下面发布了解决方案。希望它能帮助别人！**

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2012-12-29T00:30:01.850

经过几天的研究，有趣的是，我实际上在发布此问题后几分钟就找到了解决方案！所以，对于我的情况，我只需要添加这段代码，它就起作用了：

```
- (void)viewDidLayoutSubviews
{
    [super viewDidLayoutSubviews];
    [self.scrollView setContentSize:CGSizeMake(320, 808)];
} 
```

它现在似乎工作得很好。任何人，请让我知道这是否是一种糟糕的做法，因为我是新手，我希望能得到任何帮助。否则，我会留下它，希望这可以帮助其他人！谢谢！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-08-09T05:39:43.820

**使用 Storyboard + Autolayout 的解决方案（无代码）：**

从左上角开始的垂直滚动示例：

*   设置第一个对象（子视图）的**top+leading**约束
*   **链接**每个对象直到最后一个
*   最**重要**的 - 将**底部约束**设置为滚动视图，使其从上到下连接。
*   设置`width`滚动视图的 - 一个特定的“幻数”或更好的方法 - 连接具有设置宽度的子视图的尾随约束 - 如果没有我通常设置标签的宽度 = 屏幕宽度 - 侧边距 =>**标准**(20)+ **UILabel** (280)+**标准**(20) - 这样滚动视图就可以准确地知道其内容的宽度，否则您将收到“不明确的宽度”警告。

*如果需要水平滚动，需要对约束进行调整。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-29T00:14:46.213

您的滚动视图的框架不是可滚动的大小。

查看内容大小

将 frame 设置为其 superview.bounds 然后将 content size 设置为 scoolview 的可滚动区域。

另外我不知道背景会滚动。

您需要将子视图添加到滚动视图本身。

它应该滚动自己的子视图。但它不会自行滚动:)

# javascript - 使用 pushState，访问另一个站点，然后回击得到我的 XHR 内容

> ID：14077373
> 
> 赞同：1
> 
> 时间：2012-12-29T00:08:50.553
> 
> 标签：javascript, html, html5-history

为有点模糊的标题道歉，希望这些重现步骤能告诉你我遇到的问题：

1.  在谷歌浏览器中，访问[griffinalters.com](http://www.griffinalters.com)（在最新版本的 Firefox 或 IE 中似乎不存在该问题）；
2.  点击任意一张卡片；
3.  访问另一个站点（about:blank 对此非常有效）；
4.  回击，您应该只看到为部分请求加载的 HTML（恰好看起来像[http://www.griffinalters.com/card/29/?ajax](http://www.griffinalters.com/card/29/?ajax)）。

我 pushState 的链接是`/card/29/`，但我加载到我的 div 中的链接是`/card/29/?ajax`（根据[这个答案](https://stackoverflow.com/questions/6309477/moving-back-to-a-pushstate-entry-that-used-ajax)中的建议）。最初我试图检查 in 的存在`XMLHTTPRequest`（`HTTP_X_REQUESTED_WITH`对于它的价值，我正在使用 Django 的[`is_ajax`](https://docs.djangoproject.com/en/dev/ref/request-response/#django.http.HttpRequest.is_ajax)方法）。

我加载了我的 XHR 返回的 HTML 块：

```
function update_main_card_from_url(theurl) {
    $(".primary-card").load(theurl + '?ajax');
} 
```

依次调用：

```
function micro_card_click(event) {
    event.preventDefault();

    var theurl = $(this).attr("href");
    SimpleHistory.pushState(theurl);

    update_main_card_from_url(theurl);
} 
```

我真正想了解的是为什么从不同的站点回击不会加载我推送的 URL，而是加载获取的 URL。谁能指出我正确的方向？

# android - 无法从 AsyncTask 显示 ProgressDialog：无法在未调用 Looper.prepare() 的线程内创建处理程序

> ID：14077374
> 
> 赞同：0
> 
> 时间：2012-12-29T00:08:52.447
> 
> 标签：android, android-asynctask, progressdialog

我有一种情况，用户点击特定按钮，我的应用程序中会显示一个以对话框为主题的活动。由于第二个活动（对话框活动）的内容是使用`HttpRequest`我希望用户看到的，`ProgressDialog`直到加载对话框。

AsyncTask 似乎是用于此目的的最佳选择。因此，我编写了以下课程。

```
public class DetailsList extends AsyncTask<String, Integer, String> {

public static final String LOG_TAG = "DetailsList";
private Context context;
private ProgressDialog dialog;
private Activity activity;

public DetailsList(Context context) {
    this.context = context;
}

public DetailsList(Activity activity) {
    this.activity = activity;
}

@Override
protected void onPreExecute() {
    dialog = new ProgressDialog(this.context);
    dialog.setMessage("Loading...");
    dialog.setCanceledOnTouchOutside(false);
}

@Override
protected void onPostExecute(String result) {
    if(dialog.isShowing()) {
        dialog.dismiss();
    }
}

@Override
protected String doInBackground(String...params) {
    this.publishProgress(100);
    Log.d(LOG_TAG, "doInBackground started.");
    JSONObject requestContent = new JSONObject();
    JSONObject detailViewResponse = new JSONObject();
    try {
        requestContent.put("serviceId", params[0]);
        APIRequest detailViewAPI = new APIRequest(
                "http://" + GeneralConstants.SERVER_ADDRESS + "/services/",
                requestContent
                );
        detailViewResponse = detailViewAPI.request();
    } catch (Exception e) {
        e.printStackTrace();
    }
    return detailViewResponse.toString();
}

@Override
protected void onProgressUpdate(Integer... values) {
    super.onProgressUpdate(values);
    dialog.show();
} 
```

}

当进行 get 调用时，我有以下异常堆栈跟踪：

```
12-29 05:12:29.149: W/System.err(3459): java.lang.RuntimeException: Can't create handler inside thread that has not called Looper.prepare()
12-29 05:12:29.159: W/System.err(3459):     at android.os.Handler.<init>(Handler.java:121)
12-29 05:12:29.159: W/System.err(3459):     at android.app.Dialog.<init>(Dialog.java:112)
12-29 05:12:29.159: W/System.err(3459):     at android.app.AlertDialog.<init>(AlertDialog.java:114)
12-29 05:12:29.159: W/System.err(3459):     at android.app.AlertDialog.<init>(AlertDialog.java:98)
12-29 05:12:29.164: W/System.err(3459):     at android.app.ProgressDialog.<init>(ProgressDialog.java:77)
12-29 05:12:29.164: W/System.err(3459):     at threads.DetailsList.<init>(DetailsList.java:30)
12-29 05:12:29.164: W/System.err(3459):     at app.command.DetailViewDisplayCommand.execute(DetailViewDisplayCommand.java:54)
12-29 05:12:29.164: W/System.err(3459):     at commands.Command.execute(Command.java:32)
12-29 05:12:29.164: W/System.err(3459):     at gl.ObjectPicker.findObjectForValue(ObjectPicker.java:92)
12-29 05:12:29.164: W/System.err(3459):     at gl.ObjectPicker.pickObject(ObjectPicker.java:58)
12-29 05:12:29.164: W/System.err(3459):     at gl.GL1Renderer.onDrawFrame(GL1Renderer.java:111)
12-29 05:12:29.164: W/System.err(3459):     at android.opengl.GLSurfaceView$GLThread.guardedRun(GLSurfaceView.java:1520)
12-29 05:12:29.164: W/System.err(3459):     at android.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1244) 
```

似乎错误是从我初始化对话框的行触发的。

```
dialog = new ProgressDialog(this.context); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:29:18.973

```
at android.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1244) 
```

AsyncTask 旨在防止主线程因繁重的操作而变慢。但是，您不在主线程上，而是在 OpenGL 线程上。我自己没有尝试过，但是会发生什么：

```
@Override
protected void onPreExecute() {
    Looper.prepare();
    Looper.loop();
    dialog = new ProgressDialog(this.context);
    dialog.setMessage("Loading...");
    dialog.setCanceledOnTouchOutside(false);
}

@Override
protected void onPostExecute(String result) {
    if(dialog.isShowing()) {
        dialog.dismiss();
    }
    Looper.quit();
} 
```

（这可能有效，也可能会尝试从错误的线程异常访问 UI。）

# php - 如何取消追加

> ID：14077376
> 
> 赞同：0
> 
> 时间：2012-12-29T00:09:27.390
> 
> 标签：php, mysql, forms

我有这个脚本来附加一组输入字段，它工作正常，但我需要有一个选项来删除/取消附加而不影响其他附加字段。例如，我点击我的追加按钮 5 次，它给了我 5 组输入字段，但我决定删除第 4 组。我该怎么做呢？我的表单数据正在提交到 mysql 数据库。

这是我的附加代码：

```
<script type="text/javascript">
    var oncount = 0;
    $(function(){

    $('a#add_field_online').click(function(e){
e.preventDefault();                                        
    oncount += 1;

    $('#activation').append(    
        '<div class="row-fluid">'
        +'<div class="span12" style="border-bottom:1px #dddddd; background-color:#cac6c6; ">'  
                +'<div style="float:left; width:5%;">'
                +'<label>&nbsp;</label>'
                +'<input type="radio" id="oprocess_where' + oncount + '" name="oprocess_where' + oncount + '" value="Online" checked >Online'
                +'</div>'

                +'<div style="float:left; width:7%">'
                +'<label>&nbsp;</label>'                    
                +'<select name="ostatus' + oncount + '" id="ostatus' + oncount + '" class="input-small">'
                +'<option value="Ghost">Ghost</option>'
                +'<option value="Actual">Actual</option>'
                +'</select>'
                +'</div>'

                +'<div style="float:left; width: 7%">'
                +'<label>Type</label>'
                +'<select id="oupg' + oncount + '" name="oupg' + oncount + '" class="input-small" >'
                +'<option value="" selected="&nbsp;" >&nbsp;</option>'
                +'<option value="Exp" >Exp</option>'
                +'<option value="Post" >Post</option>'
                +'<option value="Upgrade" >Upg</option>'
                +'<option value="Retail" >Retail</option>'
                +'</select>'
                +'</div>'

                +'<div style="float:left; width: 8%">'
                +'<label>F.U.D</label>'
                +'<input id="oupg_date' + oncount + '" name="oupg_date' + oncount + '"  type="text" class="input-small" />'
                +'</div> '

                +'<div style="float:left; width: 11%">'
                +'<label>Phone Used</label>'
                +'<select id="ophone_used' + oncount + '" name="ophone_used' + oncount + '" class="input-medium" >'
                    +'<option value="" selected="&nbsp;" >&nbsp;</option>'
                    +'<option value="Basic" >Basic</option>'
                    +'<option value="LTE" >LTE</option>'
                    +'<option value="iPhone 4/4S" >iPhone 4/4S</option>'
                    +'<option value="iPhone LTE" >iPhone LTE</option>'
                    +'<option value="BlackBerry" >BlackBerry</option>'
                    +'<option value="3G/4G" >3G/4G</option>'
                    +'<option value="Data Block / Smartphone" >Data Block / Smartphone</option>'
                +'</select>'
                +'</div>'

                +'<div id="odataBasic' + oncount + '" style="float:left; width: 12%;">'
                +'<label>Data Plan</label>'
                +'<select id="odata' + oncount + '" name="odata' + oncount + '" class="input-medium" >'
                    +'<option value="" selected="&nbsp;" >&nbsp;</option>'
                    +'<option value="DDL" >DDL</option>'
                    +'<option value="DPPU" >DPPU</option>'
                    +'<option value="Data Block" >Data Block</option>'
                    +'<option value="$10" >$10</option>'
                    +'<option value="$15" >$15</option>'                        
                +'</select>'
                +'</div>'

                +'<div id="odataSmart' + oncount + '" style="float:left; width: 12%; display: none;">'
                +'<label>Data Plan</label>'
                +'<select id="odatasmart' + oncount + '" name="odatasmart' + oncount + '" class="input-medium" >'
                    +'<option value="" selected="&nbsp;" >&nbsp;</option>'
                    +'<option value="$15" >$15</option>'
                    +'<option value="$20" >$20</option>'
                    +'<option value="$25" >$25</option>'
                    +'<option value="$30" >$30</option>'
                +'</select>'
                +'</div>'

                +'<div id="odivmessaging' + count + '" style="float:left; width: 11%">'
                +'<label>Messaging</label>'
                +'<select id="omessaging' + oncount + '" name="omessaging' + oncount + '" class="input-medium" >'
                    +'<option value="" selected="&nbsp;" >&nbsp;</option>'
                    +'<option value="$5" >$5</option>'
                    +'<option value="$10" >$10</option>'
                    +'<option value="$15" >$15</option>'
                    +'<option value="$20" >$20</option>'
                    +'<option value="$30" >$30</option>'
                +'</select>'
                +'</div>'

                +'<div style="float:left; width: 8%">'
                +'<label>Rate Plan</label>'
                +'<input id="orate' + oncount + '" name="orate' + oncount + '"  type="text" class="input-small" />'
                +'</div> '

                +'<div style="float:left; width: 8%">'
                +'<label>Phone Number</label>'
                +'<input id="onumber_act' + oncount + '" name="onumber_act' + oncount + '" type="text" maxlength="10" class="input-small" />'
                +'</div>'

                +'<div style="float:left; width: 12%">'
                +'<label>Notes / Username </label>'
                +'<input id="onotes' + oncount + '" name="onotes' + oncount + '" type="text" class="input-medium"/>'
                +'<input type="hidden" name="oncounter[]" value="1">'
                +'</div>'
        +'</div>'   
        +'</div>'   
         ); 
    $("#ophone_used"+ oncount).change(function(){
    if ($("#ophone_used"+ oncount).val() == "Basic") {
        ('#odataBasic'+ oncount).show();
        $('#odataSmart'+ oncount).hide();
        } else {
        $('#odataBasic'+ oncount).hide();
        $('#odataSmart'+ oncount).show();   
    }
    });
    });

}); 
```

这是我的附加按钮

```
<a href="#" class="btn btn-mini btn-danger" id="add_field"><span>Add In-Store Activation</span></a> 
```

我的 SQL 提交

```
if(is_array($_POST[oncounter]))
 {
$oncount=count($_POST[oncounter]);

for($o=0;$o<=$oncount;$o++)
{       
    $oprocess_where = mysql_real_escape_string(stripslashes(htmlentities($_POST["oprocess_where".$o.""])));
    $ostatus = mysql_real_escape_string(stripslashes(htmlentities($_POST["ostatus".$o.""])));
    $oupg = mysql_real_escape_string(stripslashes(htmlentities($_POST["oupg".$o.""])));
    $oupg_date = date('Y-m-d', strtotime($_POST["oupg_date".$o.""]));
    $ophone_used = mysql_real_escape_string(stripslashes(htmlentities($_POST["ophone_used".$o.""])));
    $odata = mysql_real_escape_string(stripslashes(htmlentities($_POST["odata".$o.""])));
    $odatasmart = mysql_real_escape_string(stripslashes(htmlentities($_POST["odatasmart".$o.""])));
    $omessaging = mysql_real_escape_string(stripslashes(htmlentities($_POST["omessaging".$o.""])));
    $orate = mysql_real_escape_string(stripslashes(htmlentities($_POST["orate".$o.""])));
    $onumber_act = mysql_real_escape_string(stripslashes(htmlentities($_POST["onumber_act".$o.""])));
    $onotes = mysql_real_escape_string(stripslashes(htmlentities($_POST["onotes".$o.""])));

    $oorderStatus = "Pending";
    $oinstore= 0; 
    $oonline = 1; 
    $opending = 1;

    if($oprocess_where !="")
    {
    $query="insert into phone_details (process_where, status, upg, upg_date, phone_used, data, datasmart, messaging, rate, number_act, notes, dealID, custID, orderStatus, online, instore, pending) 
values ('".$oprocess_where."','".$ostatus."','".$oupg."','".$oupg_date."','".$ophone_used."','".$odata."','".$odatasmart."','".$omessaging."','".$orate."','".$onumber_act."','".$onotes."', '$dealID', $custID, '$oorderStatus', $oonline, $oinstore, $opending)";
        mysql_query($query) or die(mysql_error());
    }
} 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:06:28.280

在该 div 的某处添加一个按钮

```
$('#activation').append(    
    '<div class="row-fluid removethisrow"><button class="remove">Remove</button>' 
```

`.on()`使用（以可行的方式）预绑定该按钮`.live()`，因此此 JQ 可以超出附加功能。

```
$('#activation').on('click', '.remove', function(){
    $(this).closest('.removethisrow').remove();
}); 
```

...

但我不会使用`name="ostatus' + oncount + '"`我将该值放在行的 div 中，以防我需要在其中定位内容

```
$('#activation').append(    
    '<div class="row-fluid removethisrow" id="oncount_' + oncount + '"><button class="remove">Remove</button>' 
```

并使用 post 数组，因此一旦将其发送到服务器，oncount 实际上并不相关。

任何一个

```
 <input type="radio" name="oprocess_where[]" class="oprocess_where" ... /> 
```

和

```
if(is_array($_POST[oprocess_where])) {
    for ($i=0; $i<count($_POST['oprocess_where']); $i++){
        $oprocess_where = mysql_real_escape_string(stripslashes(htmlentities($_POST["oprocess_where"][$i])));
        $ostatus = mysql_real_escape_string(stripslashes(htmlentities($_POST["ostatus"][$i]))); 
```

或者

```
 <input type="radio" name="rows[]['oprocess_where']" class="oprocess_where" ... /> 
```

和

```
if(is_array($_POST[rows])) {
    foreach ($_POST['rows'] as $row) {
        $oprocess_where = mysql_real_escape_string(stripslashes(htmlentities($row["oprocess_where"])));
        $ostatus = mysql_real_escape_string(stripslashes(htmlentities($row["ostatus"]))); 
```

...

但我不会做`mysql_real_escape_string(stripslashes(htmlentities`不止一次

```
foreach ($_POST['rows'] as $row) {
    foreach (explode(' ','oprocess_where ostatus oupg oupg_date etc')) as $allowed) {
        $insert[$allowed]=mysql_real_escape_string(stripslashes(htmlentities($row[$allowed])));
    }
    $sql='INSERT INTO phone_details ('.implode(array_keys($insert)).') VALUES ('.implode($insert).')';
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:21:09.417

您可以有一个删除功能，然后将 onclick 事件附加到您附加的所有内容。所以像：

```
function removeElm(elm)
{
    $(elm).remove();
} 
```

然后当你追加时，添加如下内容：

```
<div onclick="removeElm(this)" id="features_remove" style="float:left; width: 11%; margin-left:115px;" > 
```

# android - Android为样式添加自定义属性

> ID：14077384
> 
> 赞同：0
> 
> 时间：2012-12-29T00:10:12.383
> 
> 标签：android

我正在尝试实现一项功能以让用户更改主题。

我已经这样做了，但是根据主题是浅色还是深色，我需要使用相反的颜色在画布上画线。我认为最好的方法是在绘图时简单地调用 R.style.colorAttribute 来获得正确的颜色。

在 styles.xml 中，我定义了以下主题：

```
<style name="DarkTheme" parent="android:Theme.Holo" />

<style name="LightTheme" parent="android:Theme.Holo.Light" /> 
```

任何人都可以帮助在这里添加一个存储颜色的属性的最佳方法。我以前没有这样做过，不确定我应该使用 color.xml 文件还是 styles.xml 文件。

谢谢

只是为了说清楚

对于深色主题，我需要白色，而对于浅色主题，我需要相同的属性，但为黑色。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:23:37.687

如果您喜欢某个主题，但想对其进行调整，只需将该主题添加为自定义主题的父级即可。例如，您可以像这样修改传统的灯光主题以使用您自己的颜色：

```
<color name="custom_theme_color">#b0b0ff</color>
<style name="CustomTheme" parent="android:Theme.Light">
    <item name="android:windowBackground">@color/custom_theme_color</item>
    <item name="android:colorBackground">@color/custom_theme_color</item>
</style> 
```

[更多关于 developer.android.com 上的样式。](http://developer.android.com/guide/topics/ui/themes.html)

# java - 如何使用 was7 在客户端应用程序中测试 ejb

> ID：14077385
> 
> 赞同：0
> 
> 时间：2012-12-29T00:10:12.867
> 
> 标签：java, jakarta-ee, ejb, websphere

我有我的ejb，它的客户端装在一个耳朵里，它部署在was7上现在我需要用junit测试它所以我创建了一个独立的java应用程序我添加了由ejb客户端生成的jar并尝试调用在制作实际测试用例之前：

```
 @EJB private static ConfiguratorIDA conf;
/**
 * @param args
 */
public static void main(String[] args) {
    // TODO Auto-generated method stub
    try {
        conf.setupIsbanDataAccess();
    } catch (NegocioException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }
} 
```

我的 was 和我的 ejb 一样运行，但是当我运行我的应用程序时，我在 conf.setupIsbanDataAccess(); 上得到 NullPointerException。

有谁知道如何在独立的 Java 应用程序中调用 ejb？提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-03T17:18:21.917

注入（包括`@EJB`）仅在您使用[应用程序客户端容器](http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/rcli_javacmd.html)时才有效，因为容器需要有机会在运行您的 main 方法之前执行注入。如果您真的想使用独立的 JVM，那么您需要在类路径中包含[EJB 瘦客户端](http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/tcli_ejbthinclient.html)，并使用 JNDI 手动查找 EJB，而不是尝试使用注入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:23:14.317

[在C3P0](http://sourceforge.net/projects/c3p0/)的帮助下，我已经成功地在 EJB3 模块上实现了单元测试。有一篇关于如何在[此处](http://sachinparnami.blogspot.de/2009/09/devlopement-testing-using-jpa-junit.html)进行操作的简洁的博客文章。

# javascript - jQuery 数据表以正确的格式导出到 Excel

> ID：14077387
> 
> 赞同：0
> 
> 时间：2012-12-29T00:10:51.823
> 
> 标签：javascript, jquery, excel, csv, datatables

我们如何将 jQuery 数据表的内容导出为正确的 Excel 格式？当前实现仅导出到 .csv 文件。有没有人为此提供演示或工作示例？

更多细节是[这里](http://datatables.net/forums/discussion/11561/export-to-excel-willing-to-help/p1)和[这里](http://datatables.net/forums/discussion/11561/export-to-excel-willing-to-help/p1?post#Form_Body)的讨论。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-01-07T19:12:24.900

如果您只想以 excel 格式导出，则必须修改“TableTools.min.js”文件。您必须打开“TableTools.min.js”文件并将“ *.csv”替换为“* .xls”字样。然后它将工作导出正确的 Excel 格式。

此外，如果您想通过以下链接下载更新的“TableTools.min.js”下载。

[https://drive.google.com/file/d/0B8IHTmhRUyLpcjhnWWpOR3k3dlE/edit?usp=sharing](https://drive.google.com/file/d/0B8IHTmhRUyLpcjhnWWpOR3k3dlE/edit?usp=sharing)

**感谢和问候**
迪帕克乔希
9899835174

# android - android游戏循环与渲染线程中的更新

> ID：14077403
> 
> 赞同：19
> 
> 时间：2012-12-29T00:13:35.257
> 
> 标签：android, opengl-es, thread-sleep, game-loop

我正在制作一款安卓游戏，目前没有得到我想要的性能。我在自己的线程中有一个游戏循环，可以更新对象的位置。渲染线程将遍历这些对象并绘制它们。当前的行为似乎是波动/不均匀的运动。我无法解释的是，在我将更新逻辑放在它自己的线程中之前，我将它放在 onDrawFrame 方法中，就在 gl 调用之前。在这种情况下，动画非常流畅，只有当我尝试通过 Thread.sleep 限制更新循环时，它才会变得不稳定/不均匀。即使我让更新线程发疯（不休眠），动画也很流畅，只有当涉及到 Thread.sleep 时才会影响动画的质量。

我创建了一个框架项目，看看是否可以重新创建问题，下面是渲染器中的更新循环和 onDrawFrame 方法： **更新循环**

```
 @Override
public void run() 
{
    while(gameOn) 
    {
        long currentRun = SystemClock.uptimeMillis();
        if(lastRun == 0)
        {
            lastRun = currentRun - 16;
        }
        long delta = currentRun - lastRun;
        lastRun = currentRun;

        posY += moveY*delta/20.0;

        GlobalObjects.ypos = posY;

        long rightNow = SystemClock.uptimeMillis();
        if(rightNow - currentRun < 16)
        {
            try {
                Thread.sleep(16 - (rightNow - currentRun));
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
} 
```

这是我的**onDrawFrame**方法：

```
 @Override
public void onDrawFrame(GL10 gl) {
    gl.glClearColor(1f, 1f, 0, 0);
    gl.glClear(GL10.GL_COLOR_BUFFER_BIT |
            GL10.GL_DEPTH_BUFFER_BIT);

    gl.glLoadIdentity();

    gl.glBindTexture(GL10.GL_TEXTURE_2D, textures[0]);
    gl.glTranslatef(transX, GlobalObjects.ypos, transZ);
    //gl.glRotatef(45, 0, 0, 1);
    //gl.glColor4f(0, 1, 0, 0);

    gl.glEnableClientState(GL10.GL_VERTEX_ARRAY);
    gl.glEnableClientState(GL10.GL_TEXTURE_COORD_ARRAY);

    gl.glVertexPointer(3,  GL10.GL_FLOAT, 0, vertexBuffer);
    gl.glTexCoordPointer(2, GL10.GL_FLOAT, 0, uvBuffer);

    gl.glDrawElements(GL10.GL_TRIANGLES, drawOrder.length,
              GL10.GL_UNSIGNED_SHORT, indiceBuffer);

    gl.glDisableClientState(GL10.GL_VERTEX_ARRAY);
    gl.glDisableClientState(GL10.GL_TEXTURE_COORD_ARRAY);
} 
```

我查看了副本岛的源代码，他在单独的线程中执行更新逻辑，并使用 Thread.sleep 对其进行限制，但他的游戏看起来非常流畅。有没有人有任何想法或有没有人经历过我所描述的？

**--- 编辑：1/25/13---**
我有一些时间思考并大大平滑了这个游戏引擎。我如何做到这一点可能是对实际游戏程序员的亵渎或侮辱，因此请随时纠正这些想法。

基本思想是保持更新、绘制...更新、绘制...的模式，同时保持时间增量相对相同（通常不受您的控制）。我的第一个行动方案是同步我的渲染器，使其仅在被通知允许这样做后才绘制。这看起来像这样：

```
public void onDrawFrame(GL10 gl10) {
        synchronized(drawLock)
    {
        while(!GlobalGameObjects.getInstance().isUpdateHappened())
        {
            try
            {
                Log.d("test1", "draw locking");
                drawLock.wait();
            } 
            catch (InterruptedException e) 
            {
                e.printStackTrace();
            }
        }
    } 
```

当我完成更新逻辑时，我调用 drawLock.notify()，释放渲染线程来绘制我刚刚更新的内容。这样做的目的是帮助建立更新、绘制...更新、绘制...等模式。

一旦我实现了这一点，它就会变得相当流畅，尽管我仍然偶尔会遇到运动跳跃。经过一些测试，我发现在 ondrawFrame 调用之间发生了多次更新。这导致一帧显示两次（或更多）更新的结果，比正常情况跳跃更大。

我为解决这个问题所做的是将两个 onDrawFrame 调用之间的时间增量限制为某个值，例如 18 毫秒，并将额外的时间存储在剩余时间中。如果他们可以处理，这个剩余部分将在接下来的几次更新中分配给后续的时间增量。这个想法防止了所有突然的长跳，基本上平滑了多帧的时间尖峰。这样做给了我很好的结果。

这种方法的缺点是，在一段时间内，物体的位置不会随着时间的推移而准确，实际上会加速以弥补这种差异。但它更平滑，速度变化不是很明显。

最后，我决定根据以上两个想法重写我的引擎，而不是修补我最初制作的引擎。我对线程同步进行了一些优化，也许有人可以评论。

我当前的线程交互如下：
-**更新线程**更新当前缓冲区（双缓冲区系统，以便同时更新和绘制），然后如果前一帧已绘制，则将此缓冲区提供给渲染器。
- 如果前一帧还没有绘制，或者正在绘制，更新线程将等待，直到**渲染线程**通知它已经绘制。
-**渲染线程**一直等待，直到**更新线程**通知已发生更新。
- 当**渲染线程**绘制时，它会设置一个“最后绘制的变量”，指示它最后绘制的两个缓冲区中的哪一个，并且如果它正在等待前一个缓冲区被绘制，也会通知更新线程。

这可能有点令人费解，但这样做是为了发挥多线程的优势，因为它可以在帧 n-1 正在绘制时执行帧 n 的更新，同时还可以防止每帧多次更新迭代，如果渲染器正在使用很久。为了进一步解释，如果检测到 lastDrawn 缓冲区等于刚刚更新的缓冲区，则此多次更新场景由更新线程锁定处理。如果它们相等，这向更新线程表明之前的帧还没有被绘制。

到目前为止，我得到了很好的结果。如果有人有任何意见，请告诉我，很高兴听到您对我所做的任何事情的看法，无论是对还是错。

谢谢

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-01-15T21:41:42.953

（Blackhex 的回答提出了一些有趣的观点，但我不能将所有这些都塞进评论中。）

让两个线程异步操作必然会导致这样的问题。这样看：驱动动画的事件是硬件“vsync”信号，即Android表面合成器向显示硬件提供一个充满数据的新屏幕的点。每当 vsync 到达时，您都希望拥有一个新的数据帧。如果您没有新数据，则游戏看起来很不稳定。如果您在此期间生成了 3 帧数据，则会忽略其中的 2 帧，而您只是在浪费电池寿命。

（全速运行 CPU 也可能导致设备变热，这可能导致热节流，从而减慢系统中的所有内容……并且会使您的动画断断续续。）

与显示保持同步的最简单方法是在`onDrawFrame()`. 如果有时执行状态更新和渲染帧所需的时间超过一帧，那么你会看起来很糟糕，需要修改你的方法。简单地将所有游戏状态更新转移到第二个核心并不会像您希望的那样有很大帮助——如果核心#1 是渲染器线程，核心#2 是游戏状态更新线程，那么核心#1 将会运行在核心#2 更新状态时处于空闲状态，之后核心#1 将在核心#2 处于空闲状态时恢复进行实际渲染，并且需要同样长的时间。要实际增加每帧可以执行的计算量，您需要有两个（或更多）内核同时工作，这会引发一些有趣的同步问题，具体取决于您如何定义分工（请参阅[http://developer.android.com/training/articles/smp.html](http://developer.android.com/training/articles/smp.html)如果你想走那条路）。

尝试使用`Thread.sleep()`来管理帧速率通常会以失败告终。您无法知道 vsync 之间的时间间隔是多长时间，或者下一次到达还有多长时间。每个设备都不同，在某些设备上它可能是可变的。你最终会得到两个时钟——vsync 和 sleep——互相跳动，结果就是动画不连贯。最重要的是，`Thread.sleep()`不对准确性或最短睡眠时间做出任何具体保证。

我还没有真正浏览过 Replica Island 的源代码，但是`GameRenderer.onDrawFrame()`您可以看到他们的游戏状态线程（创建要绘制的对象列表）和 GL 渲染器线程（仅绘制列表）之间的交互。在他们的模型中，游戏状态只根据需要更新，如果没有任何改变，它只是重新绘制之前的抽签列表。此模型适用于事件驱动游戏，即当发生某些事情时屏幕上的内容会更新（您按下键、计时器触发等）。当事件发生时，他们可以进行最小的状态更新并根据需要调整抽签列表。

从另一个角度来看，渲染线程和游戏状态是并行工作的，因为它们并没有严格地联系在一起。游戏状态只是根据需要更新东西，渲染线程将它锁定在每个 vsync 并绘制它找到的任何东西。只要双方都没有将任何东西锁定太久，他们就不会明显干涉。唯一有趣的共享状态是绘制列表，由互斥锁保护，因此它们的多核问题被最小化。

对于 Android Breakout ( [http://code.google.com/p/android-breakout/](http://code.google.com/p/android-breakout/) )，游戏中有一个连续弹跳的球。在那里，我们希望尽可能频繁地更新我们的状态，因此我们驱动 vsync 的状态变化，使用前一帧的时间增量来确定事情进展了多远。每帧的计算量很小，对于现代 GL 设备来说，渲染非常简单，所以它很容易在 1/60 秒内完成。如果显示器更新得更快（240Hz），我们可能偶尔会丢帧（同样，不太可能被注意到），我们会在帧更新时消耗 4 倍的 CPU（这是不幸的）。

如果由于某种原因其中一款游戏错过了垂直同步，玩家可能会也可能不会注意到。状态通过经过的时间前进，而不是固定持续时间“帧”的预设概念，因此例如球将在两个连续帧中的每一个上移动 1 个单位，或者在一帧上移动 2 个单位。根据帧速率和显示器的响应能力，这可能是不可见的。（这是一个关键的设计问题，如果您将游戏状态设想为“滴答声”，可能会令您头疼。）

这两种都是有效的方法。关键是在调用时绘制当前状态`onDrawFrame`，并尽可能不频繁地更新状态。

其他碰巧读到这篇文章的人请注意：不要使用`System.currentTimeMillis()`. 问题中使用的示例`SystemClock.uptimeMillis()`基于单调时钟而不是挂钟时间。那，或者`System.nanoTime()`，是更好的选择。（我正在对`currentTimeMillis`.

**更新：**我为类似问题写了[更长的答案。](https://stackoverflow.com/questions/21838523/annoying-lags-stutters-in-an-android-game/22387533#22387533)

**更新 2：**我写了一个[更长](http://source.android.com/devices/graphics/architecture.html)的关于一般问题的答案（见附录 A）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T10:52:12.663

问题的一部分可能是由于 Thread.sleep() 不准确这一事实造成的。尝试调查睡眠的实际时间。

让你的动画平滑的最重要的事情是你应该计算一些插值因子，称之为 alpha，它在两个连续的动画更新线程调用之间的连续渲染线程调用中线性插值你的动画。换句话说，如果您的更新间隔与您的帧速率相比较高，那么不插入动画更新步骤就像您以更新间隔帧速率进行渲染一样。

编辑：例如，这是 PlayN 的做法：

```
@Override
public void run() {
  // The thread can be stopped between runs.
  if (!running.get())
    return;

  int now = time();
  float delta = now - lastTime;
  if (delta > MAX_DELTA)
    delta = MAX_DELTA;
  lastTime = now;

  if (updateRate == 0) {
    platform.update(delta);
    accum = 0;
  } else {
    accum += delta;
    while (accum >= updateRate) {
      platform.update(updateRate);
      accum -= updateRate;
    }
  }

  platform.graphics().paint(platform.game, (updateRate == 0) ? 0 : accum / updateRate);

  if (LOG_FPS) {
    totalTime += delta / 1000;
    framesPainted++;
    if (totalTime > 1) {
      log().info("FPS: " + framesPainted / totalTime);
      totalTime = framesPainted = 0;
    }
  }
} 
```

# c# - 将变量从嵌入式 Web 浏览器传递到应用程序

> ID：14077409
> 
> 赞同：4
> 
> 时间：2012-12-29T00:14:05.057
> 
> 标签：c#, javascript, wpf, winforms

我想知道是否可以将数据从 C# 应用程序（例如 WPF）传递到嵌入式 Web 浏览器中的网页（即带有 Javascript 的 HTML 页面）。如果是这样，怎么做？

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:50:35.343

您可以使用`Window.external`. 尝试用谷歌搜索这个关键字，更多信息会很快出现。

[这篇博](https://blogs.msdn.com/b/wpf/archive/2011/05/27/how-does-wpf-webbrowser-control-handle-window-external-notify.aspx)文有一个很好的简单 (WPF-) 示例，如何使用`Window.external`. 这里的另一个关键字是`[System.Runtime.InteropServices.ComVisibleAttribute(True)]`. 您必须使用此属性标记您的处理程序类才能从 JavaScript 访问。`ObjectForScripting`最后，您通过其属性告诉您的 WebBrowser 控件有关处理程序类的信息。

# javascript - 样式错误检查元素

> ID：14077410
> 
> 赞同：0
> 
> 时间：2012-12-29T00:14:20.970
> 
> 标签：javascript, jquery, styling

我有这段代码，它显示了我的错误，我正在尝试设置以下三个验证的样式，请更正下面的错误..这可能吗？

```
if (name == '' || name.length <= 2) {
        valid = '<p>Your name' + required +'</p>';  
    }

    if (!email.match(/^([a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$)/i)) {
        valid += '<p>Your email' + required +'</p>';                                                  
    }

    if (mydropdown == '') {
        valid += '<p>An item from the list' + required +'</p>';

    }

    // let the user know if there are erros with the form
    if (valid != '') {

        $('form #response').removeClass().addClass('error strong')
            .html('<strong>Please correct the errors below.</strong>' +valid).fadeIn('fast');   

    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:18:44.800

将类添加到`<p>`标签并使用 CSS 添加样式。

```
if (name == '' || name.length <= 2) {
    valid = '<p class="error">Your name' + required +'</p>';  
}

if (!email.match(/^([a-z0-9._-]+@[a-z0-9._-]+\.[a-z]{2,4}$)/i)) {
    valid += '<p class="error">Your email' + required +'</p>';                                                  
}

if (mydropdown == '') {
    valid += '<p class="error">An item from the list' + required +'</p>';

} 
```

在您的 CSS 文件中：

```
p.error {
    color: red;
    font-weight: bold;
    /* whatever style you want */
} 
```

# clojure - 什么时候需要声明使用命名空间，什么时候不需要？

> ID：14077413
> 
> 赞同：3
> 
> 时间：2012-12-29T00:14:40.377
> 
> 标签：clojure

我有两个“lein”项目，在两个测试文件中有完全相同的代码：

```
... clojure.set/union ... 
```

第一个项目编译并成功运行。第二个错误：

```
Exception in thread "main" java.lang.ClassNotFoundException: clojure.set, compiling:(foo/bar.clj:14)
...
Caused by: java.lang.ClassNotFoundException: clojure.set
... 
```

`:use`如果我添加显式，我只能让第二个项目运行`bar.clj`

```
(:use clojure.set) 
```

第一个项目虽然没有这个声明。为什么会有不同的行为？

**更新**：

第一个项目没有发生异常，在中具有以下声明`project.clj`：

```
:eval-in-leiningen true 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:39:08.940

如果您希望本地符号引用该名称空间中的名称，则只需声明使用名称空间。否则，您可以拼出要使用的每个 var 的全名。参见[http://clojure.org/namespaces的第一页](http://clojure.org/namespaces)

普通函数通常存储在`var`s 中，您可以通过完整拼写名称`(clojure.core/+ 1 2)`或通过在封闭的命名空间中使用符号来`refer`访问它。例如，我们可以从一个名为 bar 的完全空白的命名空间开始。它甚至不会从其中的核心 Clojure 函数开始：

```
foo> (in-ns 'bar)
#<Namespace bar>
bar> (+ 1 2)
CompilerException java.lang.RuntimeException: Unable to resolve symbol: + in this context, compiling:(NO_SOURCE_PATH:1) 
```

虽然`+`如果我们拼出`var`包含它的全名，我们可以使用该函数。

```
bar> (clojure.core/+ 1 2)
3 
```

然后您可以通过调用使符号`+`引用它在 clojure.core 中所做的相同 var`refer`

```
bar> (clojure.core/refer 'clojure.core)
nil
bar> (+ 1 2)
3 
```

* * *

至于您的错误，在以下情况下往往会发生这种情况：

*   您在该命名空间中运行`(use 'clojure.set)`或`(require 'clojure.set)`从 REPL
*   从 clojure.set 调用函数的代码实际上并未被调用，导致您看不到错误。
*   它`(ns foo.bar (:use clojure.clj))`在一个项目的文件顶部的形式中声明，而不是在另一个项目中

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-30T12:04:10.013

Clojure 中的依赖关系的行为与大多数其他动态语言中的非常相似：除非您明确*需要*命名空间，否则其中的符号将不可用，因为命名空间尚未加载到运行时中；但是，一旦加载了命名空间，它的符号就可以从**所有**命名空间中使用，这解释了您所看到的行为。不一致是由文件加载到运行时的详细顺序造成的。

命名空间依赖问题的其他方面仅涉及取消引用外部命名空间符号的便利程度：

*   您可以声明要使用的*命名空间前缀*而不是全名：

    `(require [clojure.string :as s])`

    这给你`(s/join "," coll)`

*   您可以将外部命名空间中的某些符号*引用*到主命名空间中。这将本地符号绑定到外部命名空间中的同名对应项：

    `(require [clojure.string :refer [join]])`

    这给了你`(join "," coll)`

*   您既可以声明前缀也可以引用特定符号：

    `(require [clojure.string :as s :refer [join]])`

    这给了你`(join "," coll)`以及`(s/join "," coll)`

*   您可以*将*整个命名空间引用到您的主命名空间中：

    `(require [clojure.string :refer :all])`

注意：演示的语法仅在`(ns ...)`表单内有效。当*require*用作独立形式时，必须明确引用所有符号。

如您所见，您所需要的（从 Clojure 1.4 开始）就是*require*，而*use*现在对于不需要声明前缀的情况来说只是一个小小的便利。

`(use clojure.string)`是相同的`(require [clojure.string :refer :all])`

`(use [clojure.string :only [join]])`是一样的`(require [clojure.string :refer [join]])`。

# amazon-dynamodb - DynamoDB 增加一个键/值

> ID：14077414
> 
> 赞同：19
> 
> 时间：2012-12-29T00:14:43.260
> 
> 标签：amazon-dynamodb

如果我有一个 DynamoDB 表，其中 UserID 作为键，数字作为值，我可以在单个操作中增加该数字/值吗？还是我需要把它读出来，增加并写回去？

谢谢

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2012-12-29T00:28:25.310

DynamoDB 支持原子计数器的概念。您只需调用 update_item with`action: "ADD"`即可自动增加项目的值。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2019-09-14T13:10:42.377

正如其他人所说，您可以通过一个操作递增，但是现在不推荐使用“action: ADD”。当前实现此目的的方法是使用 UpdateExpression。我还假设 OP 意味着有一个数字 [属性] 的值需要增加。我正在调用属性 loginCount：

```
dynamoDB.updateItem({
  TableName: "Users",
  Key: { "UserId": { S: "c6af9ac6-7b61" } },
  ExpressionAttributeValues: { ":inc": {N: "1"} },
  UpdateExpression: "ADD loginCount :inc"
}) 
```

* * *

## 回答 #3

> 赞同：-7
> 
> 时间：2013-01-07T18:32:30.937

如果您正在寻找类似 MySQL 的自动增量功能，那么不，这在 DynamoDB 中是不可能的。

# ruby-on-rails - 符号链接链接文件夹

> ID：14077424
> 
> 赞同：0
> 
> 时间：2012-12-29T00:15:23.770
> 
> 标签：ruby-on-rails, command-line, capistrano

我正在尝试将公用文件夹符号链接到我的 rails 应用程序到我服务器上的 public_html 文件夹，但我似乎无法正确处理。

我的 deploy.rb 文件中有一个任务，名为`:link_release_to_public`：

```
namespace :deploy do 
  task :link_release_to_public do
    run "cd ~"
    run "rm -rf ~/public_html"
    run "ln -sf ~/#{current_path}/public ~/public_html"
  end
end 
```

在其中，我删除了现有的“public_html”文件夹，然后使用以下命令创建符号链接：

```
ln -sf ~/rails_app/releases/current/public ~/public_html 
```

目标是用指向当前版本的公共文件夹的符号链接替换 ​​~/public_html。

但是，运行`cap deploy:link_release_to_public`成功完成，而不是将文件直接链接到 ~/public_html 文件夹，而是创建“public_html”文件夹，然后在 ~/public_html 中符号链接“public”，以便：`~/public_html/public`.

如果我直接在服务器上（通过 SSH）在任务中执行完全相同的步骤，它会完美运行。我不明白我做错了什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:12:55.480

试试这个 ：

```
ln -sf ~/rails_app/releases/current/public/ ~/public_html 
```

注意末尾的斜线`...current/public/`。它指示`ln`命令对目录进行符号链接，而不是创建新目录并对其进行符号链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T03:05:24.313

看来问题在于如何将命令放入任务中。我更改了任务，以便同时发出 remove 和 symlink 命令，而不是分别发出：

```
namespace :deploy do 
  task :link_release_to_public do
    run "cd ~"
    run "rm -rf ~/public_html && ln -sf ~/#{current_path}/public ~/public_html"
  end
end 
```

我运行了该命令，并通过将符号链接放置为 ~/public_html 来按预期工作。

# javascript - 为什么不能在 Windows 应用商店模板中使用 CSS？

> ID：14077425
> 
> 赞同：0
> 
> 时间：2012-12-29T00:15:28.953
> 
> 标签：javascript, html, css, windows-8, windows-store-apps

我正在使用*Grip 应用程序*模板，并且我进行了一些更改，例如因为我无法在*groupedItems.html*中添加 Id ：

```
 <div class="itemtemplate" data-win-control="WinJS.Binding.Template">
    <div id="item" data-win-bind="className: importancia">
        <img class="item-image" src="#" data-win-bind="src: backgroundImage; alt: title" />
        <div class="item-overlay">
            <h4 class="item-title" data-win-bind="textContent: title"></h4>
            <h6 class="item-subtitle win-type-ellipsis" data-win-bind="textContent: subtitle"></h6>
        </div>
    </div>
</div> 
```

在*CSS*中，我对*groupedItems.css*进行了所有更改，例如：

```
 .groupeditemspage .groupeditemslist #item {
    -ms-grid-columns: 1fr;
    -ms-grid-rows: 1fr 90px;
    display: -ms-grid;
    height: 250px;
    width: 250px;
} 
```

*并且作为data.js*中的常规模板效果很好，我添加了一个新选项：

```
 var sampleItems = [
        { group: sampleGroups[0], importancia: "alta", title: "Item Title: 1", subtitle: "Item Subtitle: 1", description: itemDescription, content: itemContent, backgroundImage: lightGray },
        { group: sampleGroups[0], title: "Item Title: 2", subtitle: "Item Subtitle: 2", description: itemDescription, content: itemContent, backgroundImage: darkGray },
        { group: sampleGroups[0], title: "Item Title: 3", subtitle: "Item Subtitle: 3", description: itemDescription, content: itemContent, backgroundImage: mediumGray },
        { group: sampleGroups[0], title: "Item Title: 4", subtitle: "Item Subtitle: 4", description: itemDescription, content: itemContent, backgroundImage: darkGray },
        { group: sampleGroups[0], title: "Item Title: 5", subtitle: "Item Subtitle: 5", description: itemDescription, content: itemContent, backgroundImage: mediumGray }]; 
```

我想改变一个项目的宽度，我在头部添加了这段代码：

```
<style type="text/css">
    .alta {
        width: 510px;
    }
</style> 
```

我不知道为什么不起作用，它什么也没做。我需要改变什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T03:07:02.097

尝试：

```
<style type="text/css">
    .alta {
        width: 510px !important;
    }
</style> 
```

由于您更改`item`为 id（相对于类），它现在比类 ( `alta`) 更具体，因此其宽度设置将优先。使用 !important 将覆盖它。通过更改`item`为 id，您可能也会无意中影响其他样式，因此请仔细检查它是否可以正常工作。或者，您可以将您的`importancia`属性添加到所有元素中，并在其他情况下将其默认为“item”，然后是“alta item”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T04:16:33.320

我强烈建议不要使用`!important`，因为它并没有教你任何东西，而是一种编写样式的骇人听闻的方式。您需要了解的是，您对一种风格越“具体”，该风格的先例就越高。例如，采用以下结构：

```
<div id="my-div" class="outer">
    <div class="inner">Some Content</div>
</div> 
```

以下样式会产生红色文本，因为它更“具体”：

```
.outer .inner { color: red; }
.inner { color: blue; } 
```

以下示例将生成绿色文本，因为 ID 总是更具体：

```
#my-div .inner { color: green; }
.outer .inner { color: red; }
.inner { color: blue; } 
```

所以要回答你的问题，你有以下风格（非常“具体”）：

```
.groupeditemspage .groupeditemslist #item { ... } 
```

为了给某个#item 赋予不同的颜色，您必须执行以下操作：

```
.groupeditemspage .groupeditemslist #item.alta { ... } 
```

我还想借此机会提一下，您在这样的模板中使用 ID (#item) 是不合适的。您只能使用一次 ID……这就是为什么它被称为 ID。如果您多次使用某个东西，它就不再识别任何东西。您应该改用一个类。

# timeout - WinJS.xhr 超时丢失请求？

> ID：14077426
> 
> 赞同：0
> 
> 时间：2012-12-29T00:15:36.893
> 
> 标签：timeout, xmlhttprequest, winjs

我正在尝试做的（尽管[我完全怀疑有*更好*的方法](https://stackoverflow.com/q/14041621/328193)）是将 HTTP 请求发送到我网络上的一系列主机。`WinJS.xhr`我可以通过循环调用来访问每个主机。但是，完成该范围所需的时间太长。

在 Fiddler 中检查表明，一次发送了十几个请求，等待超时，然后继续处理下一个左右的请求。所以我想我会尝试减少每个请求的超时时间。根据我的需要，如果主机在 500 毫秒内没有响应，它就不会响应。

按照[文档](http://msdn.microsoft.com/en-us/library/windows/apps/hh868283.aspx)，我尝试使用足够小的设置将调用包装到调用`WinJS.xhr`中，但没有任何变化。`WinJS.Promise.timeout`更改承诺超时并没有真正影响实际请求。

多一点搜索让我得到[一个建议](http://social.msdn.microsoft.com/Forums/en-US/winappswithhtml5/thread/db7ccb75-57d0-40e5-973a-b52b217653af)，我可以修改使用的`XMLHttpRequest`对象`WinJS.xhr`并设置超时。在以更快的速度发出请求方面，这就像一个魅力。但是，似乎有副作用。

看着 Fiddler 中的请求，大约有十几个很快就触发了，然后整个事情就结束了。“接下来的十几个”永远不会到来。 *有时*（基于异步调用的半随机性）在 fiddler 中出现的前十个左右包括范围的低端和范围的 9-10 和范围顶端的 2-3 或接近它。

还有什么我可以尝试的，或者其他方式来实现这里的最终目标吗？（在这个问题的范围内，最终目标是在合理的时间内发送大量请求，但也欢迎任何关于更好的整体方式扫描网络上特定服务的建议。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T11:38:25.773

你能写出你用于超时的代码吗，我写了这样的东西但它不起作用，所以我很好奇你是怎么做的：

```
 var timeoutFired = function () {
        console.log("derp");
    };

    var options = {
        url: "http://somesite.com",
        responseType: "document",
        customRequestInitializer: function (req) {
            req.timeout = 1;
            req.ontimeout = timeoutFired;
            //do something with the XmlHttpRequest object req
         }
    };

    WinJS.xhr(options).
    .... 
```

以下是一些您可能会发现有用的替代方法，不确定超时如何/为什么不起作用，但我尝试编写自定义超时函数：

```
(function (global) {
    var options = {
        url: "http://something.com",
        responseType: "document",
    };

    var request = WinJS.xhr(options).then(
        function (xmlHttpRequest) {
            console.log("completed");
        },
        function (xmlHttpRequest) {
            //error or cancel() will throw err
            console.log("error"+ xmlHttpRequest.message);

        },
        function (xmlHttpRequest) {
            console.log("progress")
    });  

    function waitTime() {
        return new WinJS.Promise(
            function (complete, error, progress) {
                var seconds = 0;
                var interval = window.setInterval(
                    function () {
                        seconds++;
                        progress(seconds);
                        //prob should be called milliseconds
                        if (seconds > 5) {
                            window.clearInterval(interval);
                            complete();
                        }
                    }, 100);
            });
    };

    waitTime().done(
        function () {
            console.log("complete");
            request.cancel();
        },
        function () {
            console.log("error")
        },
        function (seconds) {
            console.log("progress:" + seconds)
        });
}); 
```

另一个很酷的小技巧是使用 promise.any (vs .join) ，它会在一个 OR 另一个先完成时触发，因此考虑到这一点，您可以编写如下内容：

```
 (function (global) {
    var options = {
        url: "http://url.com",
        responseType: "document",
    };

    var request = {
        runRequest: function () {
            return WinJS.xhr(options).then(
            function (xmlHttpRequest) {
                console.log("completed");
            },
            function (xmlHttpRequest) {
                //error or cancel() will throw err
                console.log("error" + xmlHttpRequest.message);

            },
            function (xmlHttpRequest) {
                console.log("progress")
            });
        }
    };

    WinJS.Promise.any([WinJS.Promise.timeout(500), request.runRequest()]).done(
        function () {
            console.log("any complete");
        });
})(); 
```

# xcode - 从 Settings.bundle plist 文件注册默认设置？

> ID：14077431
> 
> 赞同：4
> 
> 时间：2012-12-29T00:16:11.933
> 
> 标签：xcode, plist, settings.bundle

我正在向我的 iOS 应用程序添加一个 Settings.bundle 文件。只需一两个设置，它就非常少。Settings.bundle 中的 plist 文件为 Settings 应用程序指定默认值。我已经读过，为了让我的 iOS 应用程序知道这些默认值，我还必须将它们编码到我的应用程序中。这似乎是在重复我自己，并在我修改程序时为默认设置留下一个空缺，以便很容易地不同步。

我知道我可以使用 plist 文件的内容注册默认值，如下所示：

```
[[NSUserDefaults standardUserDefaults] registerDefaults:[NSDictionary dictionaryWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"Defaults" ofType:@"plist"]]]; 
```

不过，这似乎也在重复我自己。是否可以使用 Settings.bundle 中的 plist 文件作为这些默认值的来源，以便我只在 1 个位置指定默认值？

我确实将负载调整为如下所示：

```
[[NSUserDefaults standardUserDefaults] registerDefaults:[NSDictionary dictionaryWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"Settings.bundle/Root" ofType:@"plist"]]]; 
```

但是，那没有用。有谁知道这是否可能，以及如何加载该 plist 文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-04-29T11:41:37.653

Wanted to add this as a comment to Andy's answer, but Stack Overflow didn't let me (too long for a comment).
If you're using ObjC here's your version:

```
-(void)registerDefaults
{
    NSString* pathString = [[[NSBundle mainBundle] bundlePath] stringByAppendingPathComponent:@"Settings.bundle"];
    NSString* rootPath = [pathString stringByAppendingPathComponent:@"Root.plist"];
    NSDictionary* settingsDict = [NSDictionary dictionaryWithContentsOfFile:rootPath];
    NSArray* prefSpecifiers = settingsDict[@"PreferenceSpecifiers"] ;

    NSMutableDictionary* defaults = [NSMutableDictionary dictionary];

    for (NSDictionary* item in prefSpecifiers) {
        NSString* theKey = item[@"Key"];
        NSObject* defaultValue = item[@"DefaultValue"];

        if (defaultValue && theKey) {
            defaults[theKey] = defaultValue;
        }

    }

    if (defaults.count > 0) {
        [[NSUserDefaults standardUserDefaults] registerDefaults:defaults];
    }

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-02-27T15:46:02.387

对的，这是可能的。以下是您在 Swift 中的操作方式：

```
func loadDefaults() {

    let pathStr = NSBundle.mainBundle().bundlePath
    let settingsBundlePath = pathStr.stringByAppendingPathComponent("Settings.bundle")
    let finalPath = settingsBundlePath.stringByAppendingPathComponent("Root.plist")
    let settingsDict = NSDictionary(contentsOfFile: finalPath)
    let prefSpecifierArray = settingsDict?.objectForKey("PreferenceSpecifiers") as NSArray

    var defaults:[NSObject:AnyObject] = [:]

    for prefItem in prefSpecifierArray {

        if let key = prefItem.objectForKey("Key") as String! {

            let defaultValue:AnyObject? = prefItem.objectForKey("DefaultValue")
            defaults[key] = defaultValue
        }
    }

    _userDefaults.registerDefaults(defaults)
} 
```

这将使用 Key 从每个 PreferenceSpecifier 加载 DefaultValue。例如：

```
<dict>
    <key>Type</key>
    <string>PSMultiValueSpecifier</string>
    <key>Title</key>
    <string>Frequency</string>
    <key>Key</key>
    <string>frequency</string>
    <key>DefaultValue</key>
    <integer>15</integer>
    <key>Titles</key>
    <array>
        <string>5 minutes</string>
        <string>15 minutes</string>
        <string>30 minutes</string>
        <string>60 minutes</string>
    </array>
    <key>Values</key>
    <array>
        <integer>5</integer>
        <integer>15</integer>
        <integer>30</integer>
        <integer>60</integer>
    </array>
</dict> 
```

该`loadDefaults`函数会将默认值 15 加载到“频率”的用户默认值中。

我建议您`loadDefaults`从处理程序中调用您的应用程序委托的`didFinishLaunchingWithOptions`函数，如下所示：

```
func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -> Bool {

    loadDefaults()

    return true
} 
```

然后稍后在您的应用程序中，例如在 a 中`UITableViewController`，您可以像这样加载用户默认值：

```
let kFrequency = "frequency"
frequency = _userDefaults.integerForKey(kFrequency) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-20T03:06:48.083

根据上面[Andy 的回答](https://stackoverflow.com/a/28768939/433373)，适用于**Swift 4**，并避免使用 force-unwrap/force-cast：

```
private func loadDefaults() {
    let userDefaults = UserDefaults.standard

    let pathStr = Bundle.main.bundlePath
    let settingsBundlePath = (pathStr as NSString).appendingPathComponent("Settings.bundle")
    let finalPath = (settingsBundlePath as NSString).appendingPathComponent("Root.plist")
    let settingsDict = NSDictionary(contentsOfFile: finalPath)
    guard let prefSpecifierArray = settingsDict?.object(forKey: "PreferenceSpecifiers") as? [[String: Any]] else {
        return
    }

    var defaults = [String: Any]()

    for prefItem in prefSpecifierArray {
        guard let key = prefItem["Key"] as? String else {
            continue
        }
        defaults[key] = prefItem["DefaultValue"]
    }
    userDefaults.register(defaults: defaults)
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-12-29T03:00:49.377

这不是必需的，您可以通过调用在 plist 中分配给它的键来简单地调用 plist 中的数据，例如，

```
_buttonSelection = [[NSUserDefaults standardUserDefaults] stringForKey:@"buttonAction01"]; //_buttonSelection is a NSString so that can be anything 
```

# android - 处理程序不执行运行

> ID：14077433
> 
> 赞同：0
> 
> 时间：2012-12-29T00:16:19.037
> 
> 标签：android

这感觉应该是一个非常简单的任务，但我遇到了很多问题。在我的程序中，我为自己扩展了 WebView 类，并尝试以编程方式将其添加到布局中。这是我的代码：

```
Looper.prepare();
Handler handler = new Handler();
handler.post(new Runnable() {
public void run() {
            MyWebView webView = new MyWebView(context,1,2,3,4);
            appState.projectWebView.add(webView);
            addView(webView);
                   }
}); 
```

当我运行此代码时，它不会执行。我不知道为什么。谢谢你的时间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:29:19.563

您不能在*UI 线程*`Handler`之外创建。好吧，你可以，但是你必须将该线程变成一个消息队列，而不仅仅是.*`Looper.prepare()`*

 *您需要做的是`Activity`向包含示例中代码的类传递一个并调用`runOnUiThread()`它。*或者，您可以在UI 线程*上传递`Handler`created ，例如在运行UI 的线程上创建它，然后调用该处理程序。*`Activity``post`*

 *请注意，这是一个糟糕的建议，您似乎正在尝试针对 Android 框架进行操作。但是，如果没有关于您*实际*尝试做什么的更多信息，就没有什么可以说的了。**

# google-apps-script - 使用触发器和手动运行的电子表格脚本

> ID：14077437
> 
> 赞同：0
> 
> 时间：2012-12-29T00:16:45.780
> 
> 标签：google-apps-script

这应该很简单，但我被困在这个脚本上......它有一个手动运行并在时间触发器上运行的函数（createnewsheet），**所以**我不得不选择`openById()`访问电子表格，但是当我查看工作表并运行时手动功能我想将新创建的工作表设置为活动状态，这就是给我带来麻烦的原因。

当我从脚本编辑器运行函数（createnewsheet）时，一切都很好，但是当我从电子表格菜单中调用它时，我收到此错误消息：`Specified sheet must be part of the spreadsheet`因为最后一行代码。AFAIK我没有在我的电子表格之外处理工作表...... *知道在这种情况下我做错了什么吗？*

这是显示问题的简化代码，[此处提供共享副本](https://docs.google.com/spreadsheet/ccc?key=0AnqSFd3iikE3dGVtYk5hWUZVUFNZMzAteE9DOUZwaVE)

```
 var ss = SpreadsheetApp.openById('0AnqSFd3iikE3dGVtYk5hWUZVUFNZMzAteE9DOUZwaVE');
  var sheet = SpreadsheetApp.getActiveSpreadsheet();
  var sh = ss.getSheetByName('master')
  var logsheet = ss.getSheetByName('logger')
  var FUS1=new Date().toString().substr(25,6)+":00";

function onOpen() {
    var menuEntries = [ {name: "Manual test", functionName: "createnewsheet"},
                       ];
    sheet.addMenu("Utilities",menuEntries);
    SpreadsheetApp.setActiveSheet(logsheet);// this is working fine
    }

function createnewsheet(){

    var sheetName = "Control on "+ Utilities.formatDate(new Date(), FUS1, "MMM-dd-yy")
      try{ 
    var newsheet = ss.insertSheet(sheetName,2);// creates the new sheet in 3rd position
      }catch(error){
        FUS1=new Date().toString().substr(25,6)+":00";
        var newsheet = ss.insertSheet(sheetName+' - '+Utilities.formatDate(new Date(), FUS1, "HH:mm:ss"),2);// creates the new sheet with a different name if already there
        }
    newsheet.getRange(1,1).setValue(sheetName);
    SpreadsheetApp.setActiveSheet(ss.getSheets()[2]);// should make 3 rd sheet active but works only when run from script editor
//    SpreadsheetApp.setActiveSheet(newsheet);// should have same result but works only when run from script editor
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T15:08:18.923

我找到了一种实用的解决方法来解决我的用例：我使用菜单中的不同功能（在`setActive()`我想要的工作表中）并从这个菜单中调用主要功能。当从触发器调用时，设置任何活动表是没有用的，所以我从主函数中删除了这部分。

它是这样的：

```
function manualTest(){ // from the ss menu
    createnewsheet();
    var sheet = SpreadsheetApp.getActiveSpreadsheet();
    SpreadsheetApp.setActiveSheet(sheet.getSheets()[2]);// this works from the menu when ss is open
}

function createnewsheet(){ // from the trigger and from function manualTest()
    var sheetName = "Control on "+ Utilities.formatDate(new Date(), FUS1, "MMM-dd-yy");
      try{ 
    var newsheet = ss.insertSheet(sheetName,2);
      }catch(error){
        FUS1=new Date().toString().substr(25,6)+":00";
        var newsheet = ss.insertSheet(sheetName+' - '+Utilities.formatDate(new Date(), FUS1, "HH:mm:ss"),2);
        }
    newsheet.getRange(1,1).setValue(sheetName);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:52:11.107

这里有一个问题

```
SpreadsheetApp.setActiveSheet(ss.getSheets()[2]); 
```

当您从脚本编辑器运行它时，它会自动获取容器电子表格并使所述工作表处于活动状态，但当您从自定义菜单或触发器运行它时，情况并非如此。将此语句修改为：

```
ss.setActiveSheet(ss.getSheets()[2]);
ss.setActiveSheet(newsheet); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-30T17:14:50.500

我发现的最佳解决方案是重新播种`sheet`。`getActiveSpreadsheet()`识别当前正在使用的电子表格，因此无需再次 openById，但是

```
//  SpreadsheetApp.setActiveSheet(ss.getSheets()[2]);
//  SpreadsheetApp.setActiveSheet(newsheet);
sheet = SpreadsheetApp.getActiveSpreadsheet(); // reloads the active sheet (including changes to the Sheets array)
sheet.setActiveSheet(sheet.getSheets()[2]); // works as expected from editor and custom menu 
```

我认为这表明原始`ss`并`sheet`已将电子表格缓存到内存中，并且它们的指针未刷新以反映结构变化。我尝试将 .flush() 作为快捷方式，但这似乎是从脚本刷新工作表的一种方式，而不是相反的方式。

# paypal - 如何使用 Paypal 的透明重定向处理 CSC/AVS？

> ID：14077438
> 
> 赞同：1
> 
> 时间：2012-12-29T00:16:46.410
> 
> 标签：paypal

我想使用透明重定向（Paypal Payments Pro 包的功能）来处理结帐。PayPal 文档（摘录如下）说，当使用透明重定向时，PayPal 将不处理检查 AVS 和 CSC，将这项任务留给我。

真的有必要按照文档中的说明关闭“AVS”和“CSC”吗？

如果有必要，那么处理这个问题的实用方法是什么？如果我不执行 AVS 和 CSC 检查，那么它似乎会导致更多的欺诈性收费。也许它也违反了 PayPal TOS。是否有执行该服务的 3rd 方 Web API？

来自 Paypal 的“透明重定向”文档：

> 您需要提供自己的收据和电子邮件以及 AVS 和 CVV2 支票。• 安全设置（AVS & CSC）必须关闭。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T22:08:38.843

我不确定您正在查看文档中的哪一页，但这听起来像是在误导您。实际上，您可以使用 Payments Pro 进入几个不同的地方。

在大多数情况下，当您获准使用 Payments Pro 时，您可以完全访问欺诈管理过滤器（或以前称为风险控制的功能）。默认情况下，这些设置被配置为接受几乎任何付款，无论 AVS 还是 CSC 匹配或不。它只是让您完全控制。

通过完全控制，您可以将帐户设置为在 AVS 或 CSC 失败时简单地接受付款（这也是默认设置），或者您可以将其设置为在这些失败时自动拒绝付款，或者您可以将其设置为接受付款，但标记它并向您发送有关它的警告。

这些设置在您的 PayFlow Manager 设置或 PayPal 配置文件中可用，具体取决于他们让您使用的 Pro 版本。

在某些情况下，如果您的信用不佳或信用不足，他们可能会批准您使用 Payments Pro，但他们实际上会为您设置欺诈过滤器，以便 AVS 和 CSC 必须匹配才能批准付款。在这些情况下，它们不会让您自行调整这些设置。

所以基本上，您只需要寻找您的欺诈过滤器并配置它们以满足您的需求。

# ember.js - Ember.js：观察所有对象属性

> ID：14077439
> 
> 赞同：9
> 
> 时间：2012-12-29T00:16:53.640
> 
> 标签：ember.js

我想观察对象属性的所有变化。
在以下示例中，如果 firstname 或 lastname 更改，我希望 personChanged 观察者通知我。
但是我想在所有对象属性上应用一些通用的东西（使用 Ember.keys() ??）如何用更通用的东西替换 'firstname'、'lastname' ？

在我的例子中：

`personChanged``firstname`当or`lastname`改变时被调用：

```
 App.MyObject: Ember.Object.create({
   firstname: 'first',
   lastname: 'last',
   personChanged: Ember.observer(function() {
            console.log("person changed");
   }, 'firstname', 'lastname') 
 }) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T18:26:47.597

`ObjectProxy`根据您的要求，可以使用两种口味中的一种。两种方法的区别仅在于观察者被调用的时间和次数以及它们都依赖于`Ember.keys`.

两种解决方案的 HTML 是相同的。

**HTML**

```
<script type="text/x-handlebars" data-template-name="app">
    Name: {{App.MyObject.firstname}} {{App.MyObject.lastname}}

    <ul>
    {{#each App.List}}
        <li>{{this}}</li>
    {{/each}}
    </ul>
</script> 
```

***解决方案 1***

JsFiddle：http: [//jsfiddle.net/2zxSq/](http://jsfiddle.net/2zxSq/)

**Javascript**

```
App = Em.Application.create();

App.List = [];

App.MyObject = Em.ObjectProxy.create({
    // Your Original object, must be defined before 'init' is called, however.
    content: Em.Object.create({
        firstname: 'first',
        lastname:  'last'
    }),

    // These following two functions can be abstracted out to a Mixin
    init: function () {
        var self = this;
        Em.keys(this.get('content')).forEach(function (k) {
            Em.addObserver(self.get('content'), k, self, 'personChanged')
        });
    },

    // Manually removing the observers is necessary.
    willDestroy: function () {
        var self = this;
        Em.keys(this.get('content')).forEach(function (k) {
            Em.removeObserver(self.get('content'), k, self, 'personChanged');
        });
    },

    // The counter is for illustrative purpose only
    counter: 0,
    // This is the function which is called.
    personChanged: function () {
        // This function MUST be idempotent.
        this.incrementProperty('counter');
        App.List.pushObject(this.get('counter'));
        console.log('person changed');
    }
});

App.ApplicationView = Em.View.extend({
    templateName: 'app'
});

// Test driving the implementation.
App.MyObject.set('firstname', 'second');
App.MyObject.set('lastname',  'last-but-one');

App.MyObject.setProperties({
    'firstname': 'third',
    'lastname' : 'last-but-two'
}); 
```

在初始化时，会观察对象上*已经*存在的`MyObject`所有属性，并且每次任何属性更改时都会调用该函数。然而，由于观察者被急切地解雇 [1]，该函数应该是[幂等](http://en.wikipedia.org/wiki/Idempotence)的，而示例中的函数不是。下一个解决方案通过让观察者变得懒惰来解决这个问题。*`content``personChanged``personChanged`*

 ****解决方案 2***

JsFiddle：http: [//jsfiddle.net/2zxSq/1/](http://jsfiddle.net/2zxSq/1/)

**Javascript**

```
App.MyObject = Em.ObjectProxy.create({
    content: Em.Object.create({
        firstname: 'first',
        lastname:  'last'
    }),

    init: function () {
        var self = this;
        Em.keys(this.get('content')).forEach(function (k) {
            Em.addObserver(self, k, self, 'personChanged')
        });
    },

    willDestroy: function () {
        var self = this;
        Em.keys(this.get('content')).forEach(function (k) {
            Em.removeObserver(self, k, self, 'personChanged');
        });
    },

    // Changes from here 
    counter: 0,
    _personChanged: function () {
        this.incrementProperty('counter');
        App.List.pushObject(this.get('counter'));
        console.log('person changed');
    },

    // The Actual function is called via Em.run.once
    personChanged: function () {
        Em.run.once(this, '_personChanged');
    }
}); 
```

这里唯一的变化是实际的观察者函数现在只在[Ember Run 循环结束时](https://stackoverflow.com/questions/12467345/ember-js-collapsing-deferring-expensive-observers-or-computed-properties)被调用，这可能是您正在寻找的行为。

***其他注意事项***

这些解决方案使用`ObjectProxy`而不是在对象本身上定义观察者，以避免设置虚假的观察者（在诸如 、 等属性上`init`）`willDestroy`或[要观察的属性的显式列表](https://stackoverflow.com/questions/13186618/how-to-dynamically-add-observer-methods-to-an-ember-js-object)。

可以将此解决方案扩展为开始观察动态属性，方法是`setUnknownProperty`在每次将键添加到时重写代理以添加观察者`content`。将`willDestroy`保持不变。

***参考***

[1] 多亏了 Asyn Observers，这可能很快就会改变

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T07:33:56.807

使用内联观察者，您所拥有的一切都是正确的，但您只是有一些语法错误。然而，用关键字做起来就更简单了`observes`。所以我在下面稍微调整了你的例子。

```
App.MyObject: Ember.Object.create({
    firstname: 'first',
    lastname: 'last',
    personChanged: function() {
        //firstname or lastname changed
    }.observes('firstname','lastname')
}); 
```

**注意：**我在属性周围加上引号

**来源：** [http ://emberjs.com/guides/object-model/observers/](http://emberjs.com/guides/object-model/observers/)*

# c# - c#中的Window Media Player背景颜色

> ID：14077443
> 
> 赞同：5
> 
> 时间：2012-12-29T00:17:56.640
> 
> 标签：c#, windows-media-player

Windows Media Player 控件的默认背景颜色为黑色。我们可以改变这个颜色吗？

我[在 msdn 网站上](http://msdn.microsoft.com/en-us/library/aa451588.aspx)发现 DisplayBackColor 属性可用于 Windows CE，但在我的 winforms 应用程序中不可用。

还有什么办法可以改变吗？

# mysql - MySQL SELECT MAX 的对面

> ID：14077445
> 
> 赞同：-2
> 
> 时间：2012-12-29T00:17:58.323
> 
> 标签：mysql, max

我正在尝试查找数据库中不是 MAX(bid_ts) 的所有行。我可以使用 !MAX(bid_ts) 还是有更好的方法来做到这一点？

```
$auctionswinning = "
  SELECT 
    listings.end_date, 
    listings.user_id, 
    listings.title, 
    listings.auc_fp, 
    listings.id, 
    listings.auc_image1 
  FROM listings 
  INNER JOIN (
    SELECT
     listing_id, 
     user_id, 
     !MAX(bid_ts) maxDate
    FROM bids
    GROUP BY listing_id, user_id
  ) bids ON listings.id = bids.listing_id
  WHERE 
   bids.user_id=$userid
   AND listings.end_date > NOW()"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T05:33:06.493

尝试这个

```
SELECT 
    listings.end_date, 
    listings.user_id, 
    listings.title, 
    listings.auc_fp, 
    listings.id, 
    listings.auc_image1 
FROM listings 
INNER JOIN (SELECT
                 listing_id, 
                 user_id, 
                 bid_ts maxDate
            FROM bids
            WHERE bid_ts NOT IN (SELECT MAX(bid_ts) FROM bids)
            GROUP BY listing_id, user_id
            ) bids ON listings.id = bids.listing_id
WHERE bids.user_id=$userid
AND listings.end_date > NOW() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:19:52.493

您必须为此创建一个子查询：

```
SELECT bid_ts FROM tbl WHERE bid_ts <> (SELECT MAX(bid_ts) FROM tbl); 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-12-29T00:26:02.353

```
SELECT bid_ts
FROM tbl
HAVING bid_ts <> MAX(bid_ts) 
```

我还没有尝试过，最好避免 HAVING，但它应该让你开始。

# java - 是在编译时还是运行时检查访问？

> ID：14077450
> 
> 赞同：2
> 
> 时间：2012-12-29T00:18:49.873
> 
> 标签：java, oop

> **可能重复：**
> [JVM/Java，是否在运行时强制执行方法可访问性规则？](https://stackoverflow.com/questions/8088921/jvm-java-are-method-accessibility-rules-enforced-at-runtime)

当使用具有公共和私有字段和成员的类时，是否在编译时或运行时检查代码是否存在访问冲突（例如，尝试从外部类访问私有字段）？或两者？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:31:36.723

两个都。如果您尝试编译试图访问不可访问的对象或方法的代码，您将收到编译时错误：

```
field has private access in package.Class 
```

此外，当您的类尝试在运行时访问某些字段时，JVM 会检查访问：

```
Exception in thread "main" java.lang.IllegalAccessError: tried to access field package.Class.field from class YourClass 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-29T00:28:23.703

它在编译时被检查。我尝试了以下两个类：

```
class A { 
    private int i;
} 
```

和

```
class B { 
    private void test() {
        A a = new A();
        a.i = 5;
    }   
} 
```

当我尝试编译`B.java`时，出现以下错误：

```
B.java:4: i has private access in A
        a.i = 5;
         ^
1 error 
```

但是，请记住，这个简单的示例仅适用于基本情况。当考虑反射时，这种行为可能会改变，即变量的名称仅在运行时确定。在这种情况下，无法在编译时检查访问修饰符，并且必须将检查推迟到运行时。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-29T00:44:40.953

在这两种情况下。在编译时很容易看到。但是在运行时测试也不难。创建 2 个类

```
public class Test1 {
    public static void main(String[] args) throws Exception {
        Test2.hello();
    }
}

public class Test2 {
    static void hello() {
        System.out.println("hello");
    }
} 
```

编译运行`java Test1`，正常

现在将 Test2 更改为

```
priivate static void hello() {
    System.out.println("hello");
} 
```

并单独编译，使Test1.class不变。运行`java Test1`。你会得到

```
Exception in thread "main" java.lang.IllegalAccessError: tried to access method Test2.hello()V from class Test1
    at Test1.main(Test1.java:5) 
```

# html - 我们如何自定义导航栏的颜色，基本上是基础框架的主题？

> ID：14077451
> 
> 赞同：0
> 
> 时间：2012-12-29T00:18:49.997
> 
> 标签：html, responsive-design, zurb-foundation

我已经从[http://foundation.zurb.com/](http://foundation.zurb.com/)下载了带有默认主题的基础框架。
我不知道如何改变各种东西的颜色，比如导航栏、按钮、为身体添加背景和带阴影的框！等等

我尝试将以下内容添加到 app.css 但它不起作用

> ```
> body {
>   background-color: #333;
>   position: relative;
>   font-family: helvetica, arial, sans-serif;
>   color: #666666;     
>   border-right: 1px solid #333;
>   border-left: 1px solid #333;    
>   -moz-box-shadow: 0 0 5px 5px #888;  
>   -webkit-box-shadow: 0 0 5px 5px#888;    
>   box-shadow: 0 0 5px 5px #888; 
> } 
> ```

请建议该怎么做。
有一些关于 scss+foundation 的东西，但我不确定它是什么……也不敢尝试，看起来有点吓人。
我认为使用 Foundation Framework 会变得如此复杂。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-03T17:23:56.853

这很简单，但需要一些工作...... app.css 通过覆盖foundation.css 中的值来解决问题！

但是找出应该覆盖哪个元素或选择器并不容易，尤其是在不了解大部分 css 的情况下。但是有一种方法可以解决这个问题......即 firebug for firefox ！它是一个很棒的应用程序，它告诉我在网站的任何地方都使用了哪种风格。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:22:20.073

你应该做的是利用诸如 Firebug (For Firefox) 之类的工具来检查你感兴趣的元素。这将清楚地让你看到 CSS 对元素的实际影响以及代码所在的文件/行，以便你可以改变它。您还可以在 Firefox 中将新值覆盖到代码中，以查看它会对您的页面产生什么影响。

# python - 摆脱字典中不需要的键

> ID：14077452
> 
> 赞同：0
> 
> 时间：2012-12-29T00:18:56.373
> 
> 标签：python, dictionary

我有一本字典`dict1`；每个值都是一个字符串列表。如果这个字符串列表中的所有元素都包含`'my_string'`，我不需要这个特定的键。我想出了这个：

```
from collections import defaultdict
dict2 = defaultdict(list)
for key, value in dict1.iteritems():
    for list_element in value:
        if 'my_string' not in list_element:
            dict2[key] = dict1[key] 
```

它确实有效，但我确信有更好的方法。（而且我不想创建另一个字典，这发生在上面的代码中，但这并不重要。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T00:31:57.150

您不能`dict`在迭代它时修改。您要么需要通过过滤旧的来创建新`dict`的，要么创建某种临时对象来迭代：

`dict`(1)用过滤后的结果新建一个：

```
dict1 = {k:v for (k, v) in dict1.iteritems() if all('my_string' in e for e in v)} 
```

(2.1) 创建一个临时的`dict`：

```
for k, v in dict1.copy():
    if all('my_string' in e for e in v):
        del dict1[k] 
```

(2.2) 创建一个临时`list`的key-value `tuple`s：

```
for k, v in dict1.items():
    if all('my_string' in e for e in v):
        del dict1[k] 
```

(2.3) 创建一个临时`list`的密钥：

```
for k in dict1.keys():
    if all('my_string' in e for e in dict1[k]):
        del dict1[k] 
```

那么，你如何在他们之间做出决定呢？

嗯，1 是最容易推理的，因为它具有无突变代码的所有好处。但是对于新手程序员来说，2.1-2.3 可能更简单。通常，这种区别是最重要的。

如果你担心内存使用，显然 2.3 比 2.1-2.2 更好，因为它生成的临时对象要小得多。但是 2.3 对 1 呢？这取决于两件事：首先，与仅剩余物品`list`的 a 相比，所有钥匙的a 有多大？`dict`其次，通过从头开始构建一个较小的哈希表而不是缩小一个较大的哈希表可以获得多少空间？通常，您不会从后者中获得*任何*好处，因为 Python 根本不会缩小哈希表……但如果这很重要，您需要在您的平台上使用您的用例进行测试，看看会发生什么。

如果您担心性能，它与内存使用非常相似。2.3 vs. 1 是明显的竞争者，除非你保留大部分`dict`周围，否则 1 会更好——但同样，如果重要，你需要自己衡量。

最后，请注意，以上内容适用于 Python 2.7，这就是您似乎正在使用的（作为猜测）。在 3.x 中，`items`两者`keys`都返回现有的迭代器`dict`，因此您需要明确`list(dict1.items())`地`list(dict1.keys())`进行复制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:23:52.743

```
for key, value in dict1.items():
    if all('my_string' in e for e in value):
        del dict1[key] 
```

注意：注意不要`iteritems`从同一个字典中使用和删除。`items`很好，它可以复制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T01:03:03.200

我*认为*您可以只使用字典理解，如果您的版本中可用的话：

```
filtered = {k:v for k,v in d1.items() if all(e == 'my_string' for e in v)} 
```

这假设您不介意制作第二个字典，它是第一个字典的过滤副本。

# c++ - 电容式传感器问题

> ID：14077456
> 
> 赞同：0
> 
> 时间：2012-12-29T00:19:13.197
> 
> 标签：c++, arduino

我一直在使用电容式按钮为 Arduino 编写[乒乓球](http://en.wikipedia.org/wiki/Pong)游戏，但我收到“没有匹配函数调用 'CapacitiveSensor::CapacitiveSensor()'”错误。这是我上过的课程的代码错误：

```
//Input.cpp

#include <CapacitiveSensor.h>
#include "Input.h"
#include "Arduino.h"

Input::Input (byte sPin, byte rPin1, byte rPin2) { //I get the error on this line
    upButton = CapacitiveSensor(sPin, rPin1);
    downButton = CapacitiveSensor(sPin, rPin2);
}
//Continued for bChk 
```

然后这是标题：

```
//Input.h

#ifndef Input_H
#define Input_H
#include "Arduino.h"
#include <CapacitiveSensor.h>

class Input{
    public:
        const static byte up = 0;
        const static byte down = 1;
        CapacitiveSensor upButton;
        CapacitiveSensor downButton;
        boolean bChk(byte button);
        Input(byte sPin, byte rPin1, byte rPin2);
};

#endif 
```

我知道标准命名约定说常量应该大写，但它们已经被保留了。而且变量等应该是私有的。我很懒。此外，我在与调用构造函数的行不同的行上得到错误......我也没有创建 CapacitiveSensor 类。

我在 Mac 上，如果这很重要（我对此表示怀疑）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:33:41.410

看起来`CapacitiveSensor`该类没有定义默认构造函数，因此`Input`该类不知道如何构造`upButton`and `downButton`。

一个选项是初始化`upButton`并`downButton`在`Input`构造函数中传递所需的参数：

```
class Input {
public:
    Input(byte sPin, byte rPin1, byte rPin2)
        : upButton(CapacitiveSensor(sPin, rPin1))
        , downButton(CapacitiveSensor(sPin, rPin2))
    {}
    CapacitiveSensor upButton;
    CapacitiveSensor downButton;
}; 
```

另一种选择是将这些成员转换为指针，并使用`new`所需的参数分配它们。例子：

```
class Input {
public:
    Input() : upButton(NULL), downButton(NULL) {}
    void initializeMembers(byte sPin, byte rPin1, byte rPin2) {
        upButton = new CapacitiveSensor(sPin, rPin1);
        downbutton = new CapacitiveSensor(sPin, rPin2);
    }
    CapacitiveSensor *upButton;
    CapacitiveSensor *downButton;
}; 
```

或者最终，您可以扩展`CapacitiveSensor`类，定义默认构造函数，并将固定参数传递给超级构造函数。我相信这不是你想要的，但无论如何：

```
class CustomCapacitiveSensor : public CapacitiveSensor {
public:
    CustomCapacitiveSensor() {
        CapacitiveSensor(1, 2);
    }
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T07:33:02.203

要使用您显示的代码，CapacitiveSensor 类必须同时具有不带参数的默认构造函数和等于运算符重载（赋值）。这不太可能是您想要的，因为它构造了一个临时对象，然后将其分配回类成员，这很浪费。

要构造成员对象，请使用以下代码：

```
Input::Input(byte sPin, byte rPin1, byte rPin2) :
  upButton(sPin, rPin1), downButton(sPin, rPin2)
{
...
} 
```

这将直接构造两个对象实例。

# vba - 如果 vba 宏中的错误和 vlookup

> ID：14077458
> 
> 赞同：0
> 
> 时间：2012-12-29T00:19:40.540
> 
> 标签：vba, excel, formula, vlookup

我的任务是编写一个包含 if、iferror 和 Vlookup 的公式

我需要将公式应用到包含 values 的最后一行的末尾。

如果 vlookup 抛出 NA ，则单元格应为空白，否则该值应替换为数值“1”

但是当尝试公式但它给出错误时

```
Sub testt()

Dim l As Long

l = Sheets(1).Range("A1:A" & Sheets(1).Cells(Sheets(1).Rows.Count, "A").End(xlUp).Row).Count
    With Sheets("Sheet1")
        .Range("d1").Formula = "=IF(iferror(vlookup(c2,$D:$D,1,false),""),"",1)"
        .Range("d1").AutoFill Destination:=Range("d1:d" & l), Type:=xlFillDefault

    End With

End Sub 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T16:52:08.117

我的第一个想法......在VBA中，你应该在你的公式中使用两个“for each”......

另外，你想使用 IsError。

我将替换公式如下

```
.Range("d1").Formula = "=IF(iserror(vlookup(c2,$D:$D,1,false)),"""",1)" 
```

否则，请告诉我们您遇到了什么错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-30T02:54:44.940

我认为问题出在公式的 IF 部分，特别是逻辑测试。对于电子表格 IF 函数，公式为：

```
=IF(logical_test, value_if_true, value_if_false) 
```

逻辑测试是（来自 Excel 帮助文件）可以评估为 TRUE 或 FALSE 的任何值或表达式。例如，A10=100 是一个逻辑表达式；如果单元格 A10 中的值等于 100，则表达式的计算结果为 TRUE。否则，表达式的计算结果为 FALSE。

您的逻辑测试很简单：

```
iferror(vlookup(c2,$D:$D,1,false),"") 
```

也许应该是：

```
iferror(vlookup(c2,$D:$D,1,false),"") = "" 
```

给出公式（也有“国王的建议”）：

```
"=IF(iferror(vlookup(c2,$D:$D,1,false),"""")="","",1)" 
```

# android - 如何从字符串数组中访问字符串？

> ID：14077461
> 
> 赞同：0
> 
> 时间：2012-12-29T00:20:07.530
> 
> 标签：android, arrays, string

我是android开发的新手，所以如果这是一个可怕的新手错误，我很抱歉。

话虽如此，我知道在 java 中，如果我有一个名为 example 的字符串数组，我可以执行 example[0] 来访问第一个字符串。我基本上是在制作一个测验应用程序，它将以随机顺序放置答案，但我不相信我可以使用这种方法访问字符串资源（我的 values/strings.xml）中的字符串数组？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T00:22:40.820

从[这里](http://developer.android.com/guide/topics/resources/string-resource.html)

```
Resources res = getResources();
String[] planets = res.getStringArray(R.array.planets_array); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:24:39.997

您可以通过以下方式从资源中检索字符串：

```
String string = getString(R.string.hello); 
```

更多细节[在这里](http://developer.android.com/guide/topics/resources/string-resource.html)。

# php - Chrome：“从我离开的地方继续”模式和 Symfony2

> ID：14077462
> 
> 赞同：0
> 
> 时间：2012-12-29T00:20:34.470
> 
> 标签：php, security, google-chrome, symfony, fosuserbundle

使用 Symfony2 和 FOSUserBundle，我在以下实现中没有得到预期的行为。

首先，要知道`Continue where I left off`Chrome 中的选项会完全恢复用户会话，而无需检查“记住我”或类似的内容。因此，它会保存一个包含所有会话信息的 cookie。

我想要做的是避免从通过`Continue where I left off`Chrome 上的该选项存储的 cookie 创建会话。

或者，如果我无法避免创建会话，至少尝试知道会话来自完全透明的方式。

我在 Symfony2 文档中找到了这个（特别是[这里](http://symfony.com/doc/2.0/cookbook/security/remember_me.html)）：

> 但是，在某些情况下，您可能希望强制用户在访问某些资源之前实际重新进行身份验证。例如，您可能允许“记住我”用户查看基本帐户信息，但随后要求他们在修改该信息之前实际重新进行身份验证。安全组件提供了一种简单的方法来做到这一点。除了明确分配给他们的角色外，根据身份验证方式，用户会自动获得以下角色之一： IS_AUTHENTICATED_ANONYMOUSLY - 自动分配给位于站点的防火墙保护部分但尚未实际登录的用户。这只有在允许匿名访问的情况下才有可能。IS_AUTHENTICATED_REMEMBERED - 自动分配给通过记住我 cookie 进行身份验证的用户。

因此，如果我没有弄错，作为该`Copntinue where I left off`选项的结果透明登录的用户应该具有 IS_AUTHENTICATED_REMEMBERED。

好吧，事实并非如此。现实情况是授权是 IS_AUTHENTICATED_FULLY。

有没有人通过这个？

对这一切有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:15:09.757

会话在服务器端处理。根据会话生命周期的服务器配置，您可以关闭浏览器并重新打开它而不会丢失会话。`Continue where I left off`这与谷歌浏览器的选项无关。

授予是`IS_AUTHENTICATED_FULLY`因为会话在服务器上仍然处于活动状态，而不是因为 Google Chrome 选项。

简单的示例用例。假设我们设置了 5 分钟的会话生命周期。

**没有**记住我选项：

1.  我登录：在服务器上创建了一个会话。
2.  我关闭浏览器。
3.  10 分钟后我回来：会话已过期，因此我必须提供我的凭据。

**使用**记住选项：

1.  我登录：在服务器上创建了一个会话，并**在**我的浏览器上创建了一个 cookie，说*嘿我已连接*。
2.  我关闭浏览器。
3.  10 分钟后我回来：会话已过期**但**由于 cookie 说*嘿我已连接*，将自动创建一个新会话。因此，我不必再次提供我的凭据。

在这两种情况下，如果您在前 5 分钟内返回，您将自动登录，因为服务器仍在为您的浏览器处理会话。

# asp.net - asp.net mvc DropDownListFor 未填充

> ID：14077466
> 
> 赞同：1
> 
> 时间：2012-12-29T00:21:03.613
> 
> 标签：asp.net, asp.net-mvc-4

我想我在这里遗漏了一些东西。我有一个 ASP.NET MVC 4 应用程序。在我看来，我有一个与我的模型相关联的下拉列表。直截了当的东西。

```
@Html.DropDownListFor(x => x.GaragingAddress.State, 
                      POSBridge.Helpers.StateAbbreviations(), 
                      new {id="ADStreetState"}) 
```

我引用的辅助函数在这里（它不是最有效的，但现在我专注于功能证明而不是性能。）

```
namespace POSBridge
{
    public class Helpers
    {
        public static List<SelectListItem> StateAbbreviations(bool includeTerritories = false)
        {
            List<string> abbreviations = new List<string>
            {
                "",
                "AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD",
                "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD",
                "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"
            };
            if (includeTerritories)
            {
                abbreviations.AddRange(new string[] { "AS", "GU", "MP", "PR", "VI", "UM" });
            }

            List<SelectListItem> items = new List<SelectListItem>();
            foreach (string s in abbreviations) items.Add(new SelectListItem { Text = s, Value = s });
            return items;
        }
    }
} 
```

呈现页面时，未填充具有状态的选择列表。所有状态值都显示在下拉列表中。页面上的其他下拉列表被正确填充，当我在此处放置断点并检查即时窗口中的模型值时，Model.GarageAddress.State 属性肯定有一个值。因此，我确信它可能与我编写的 Helper 函数有关，但我不确定是什么/如何。

TIA

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:12:39.303

好的，这很奇怪且出乎意料，但以下代码有效。

```
@Html.DropDownListFor(x => x.GaragingAddress, 
    new SelectList(POSBridge.Helpers.StateAbbreviations(), 
                   "Value",
                   "Text", 
                   Model.GaragingAddress.State), 
    new { id="ADStreetState" }) 
```

我不知道为什么这行得通，而另一个行不通，但是如果某些事情正常，我该向谁抱怨？

# version-control - “责备”命令的简化语义是一件好事吗？

> ID：14077470
> 
> 赞同：40
> 
> 时间：2012-12-29T00:21:42.070
> 
> 标签：version-control, blame

我正在研究一种新的基于[weave](http://en.wikipedia.org/wiki/Aspect-oriented_programming#Implementation)的数据结构来存储版本控制历史。这无疑会在它问世时引发一些关于它是否是正确的做事方式的宗教战争，但这不是我现在的问题。

我的问题与输出[责备有关](http://tortoisesvn.tigris.org/blame.html)应该给。当一行代码被多次添加、删除和合并到自身中时，并不总是清楚应该归咎于哪个修订版本。值得注意的是，这意味着当一段代码被删除时，它曾经存在的所有记录都消失了，删除没有责任。与我讨论过这个问题的每个人都说，试图做得更好根本不值得。有时人们会说，被删除的部分后面的那一行的责任从它实际上是什么变成了该部分被删除时的修订。据推测，如果该部分位于末尾，那么最后一行的责任就改变了，如果文件最终为空，那么责任确实会消失在以太中，因为实际上没有地方可以放置责任信息。

继续我的实际问题。通常要为每一行负责，您会查看在历史记录中添加和删除它的完整历史记录，并使用三向合并（或者，在交叉合并的情况下，随机胡说八道）并基于这些之间的关系您根据其历史确定该行是否*应该*存在，如果不应该存在，那么您将其标记为当前版本的新版本。如果一行出现在具有不同责任的多个祖先中，那么它会任意选择继承哪一个。同样，我认为继续这种完全没有记录但事实上的标准做法将是没有争议的。

我的新系统的不同之处在于，它不是基于对整个历史的复杂计算来对给定行是否*应该*在当前修订版中进行复杂计算，而是简单地查看直接祖先，以及该行是否在任何他们选择任意一个来继承责任。我之所以做出这个改变主要是出于技术原因（出于类似的技术原因和缺乏关心，其他责备实现完全有可能做同样的事情）但在考虑了一下之后，我的一部分实际上更喜欢新行为比旧的更直观和可预测。大家怎么看？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2012-12-29T04:32:54.493

实际上，我在那里写了一个责备实现（我相信[Subversion](http://en.wikipedia.org/wiki/Apache_Subversion)的当前实现，除非有人在过去一两年内更换了它）。我也帮助了其他一些人。

至少责备的大多数实现都没有按照您的描述进行：

> 通常要为每一行负责，您会查看在历史记录中添加和删除它的完整历史记录，并使用三向合并（或者，在交叉合并的情况下，随机废话）并基于您之间的关系根据其历史确定该行是否应该存在，如果不应该存在，那么您将其标记为当前版本的新版本。如果一行出现在具有不同责任的多个祖先中，那么它会任意选择继承哪一个。同样，我认为继续这种完全没有记录但事实上的标准做法将是没有争议的。

实际上，大多数责备都比这复杂得多，并且根本不费心尝试使用关系，但他们只是使用简单的 delta 结构（通常是相同的内部结构，无论他们以前使用什么 diff 算法）以任意顺序引导父母它将其转换为文本输出）以查看块是否已更改，如果是，则归咎于它，并将该行标记为已完成。

例如，[Mercurial](http://en.wikipedia.org/wiki/Mercurial)只是进行迭代深度优先搜索，直到所有行都被指责。它没有试图考虑这些关系是否使它不太可能责怪正确的人。

[Git](http://en.wikipedia.org/wiki/Git_%28software%29)确实做了一些更复杂的事情，但仍然不像你描述的那样。

Subversion 做了 Mercurial 做的事情，但是历史图非常简单，所以更容易。

反过来，您的建议实际上是他们所有人真正在做的事情：

选择一个任意祖先，然后沿着兔子洞的那条路走，直到完成，如果它没有导致你责备所有行，任意选择下一个祖先，继续直到分配所有责备。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-12-29T04:24:10.333

在个人层面上，我更喜欢您的简化选项。

**原因：不管怎样，责备的使用并不多。**

所以我认为浪费大量时间来全面实施它没有任何意义。

这是真的。责任在很大程度上被证明是那些“彩虹尽头的金罐”特征之一。从我们这些站在地上的人看来，这真的很酷，梦想着有一天我们可以点击一个文件，看看谁写了哪几行代码。但是现在它已经被广泛实施，我们大多数人已经意识到它实际上并不是很有帮助。在 Stack Overflow上检查`blame`标签上的活动。它是荒凉的。

仅在最近几个月里，我就遇到了几十个“值得指责”的场景，在大多数情况下，我都尝试先使用指责，发现它要么很麻烦，要么完全没有帮助。相反，我通过对有问题的文件进行简单的过滤更改日志来找到我需要的信息。在某些情况下，如果我坚持不懈，我也可以使用 Blame 找到信息，但它会花费更长的时间。

主要问题是代码格式更改。几乎所有的第一层怪都被列为……我！为什么？因为我是负责修复换行符和制表符、重新排序函数顺序、将函数拆分为单独的实用程序模块、修复注释拼写错误以及改进或简化代码流的人。如果不是我，其他人也在沿途某处做了空格或块移动。为了在没有责备的帮助下我还记得之前的任何事情上得到有意义的责备，我不得不回滚修订并重新责备。并再次责备。然后再次。

因此，为了让责备在最幸运的情况下真正节省时间，责备必须能够启发式地越过换行符、空格，并理想地阻止复制/移动更改。这听起来是一个非常艰巨的任务，尤其是在为单个文件搜索变更日志时，大多数情况下，无论如何它不会产生很多差异，您可以相当快地手动筛选。（值得注意的例外可能是，设计糟糕的源代码树，其中 90% 的代码被塞进一两个巨大的文件中……但是如今在协作编码环境中，谁会再做很多事情了？）。

结论：给它一个简单的责备实现，因为有些人喜欢看到“它可以责备！” 在功能列表中。然后继续做重要的事情。享受！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T05:35:08.540

行合并算法比开发人员更愚蠢。如果他们不同意，那只是表明合并是错误的，而不是表明一个决策点。所以，简化的逻辑实际上应该更正确。

# javascript - AngularJS 模板中的条件逻辑

> ID：14077471
> 
> 赞同：71
> 
> 时间：2012-12-29T00:22:00.260
> 
> 标签：javascript, angularjs

我有一个看起来像这样的角度模板......

```
<div ng-repeat="message in data.messages" ng-class="message.type">

    <div class="info">
        <div class="type"></div>
        <div class="from">From Avatar</div>
        <div class="createdBy">Created By Avatar</div>
        <div class="arrowTo">
            <div class="arrow"></div>
            <div class="to">To Avatar</div>
        </div>
        <div class="date">
            <div class="day">25</div>
            <div class="month">Dec</div>
        </div>
    </div>

    <div class="main">
        <div class="content">
            <div class="heading2">{{message.title}}</div>
            <div ng-bind-html="message.content"></div>
        </div>

    </div>

    <br />
    <hr />
    <br />

</div> 
```

我已经设置了[一个 JSfiddle](http://jsfiddle.net/jon64digital/pGwRu/1/)来显示正在绑定的数据。

我需要做的是根据数据内容有条件地显示“from”、“to”和“arrowTo”div。

日志是这样的...

*   如果数据中有“from”对象，则显示“from”div 并绑定数据，但不显示“createdBy”div。
*   如果没有“from”对象但有“createdBy”对象，则显示“createdBy”div 并绑定数据。
*   如果数据中有“to”对象，则显示“arrowTo”div 并绑定它的数据。

或者用简单的英语，如果有发件人地址，则显示它，否则显示谁创建了记录，如果有收件人地址，则也显示。

我已经研究过使用 ng-switch 但我认为我必须添加额外的标记，如果没有数据，这将留下一个空的 div。另外，我需要嵌套 switch 指令，我不确定这是否可行。

有任何想法吗？

**更新：**

如果我要编写自己的指令（如果我知道怎么做！）那么这里有一些伪代码来展示我想如何使用它......

```
<div ng-if="showFrom()">
    From Template Goes Here
</div>
<div ng-if="showCreatedBy()">
    CreatedBy Template Goes Here
</div>
<div ng-if="showTo()">
    To Template Goes Here
</div> 
```

如果函数/表达式评估为假，这些中的每一个都会消失。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2012-12-29T22:34:06.040

Angular 1.1.5 引入了[ng-if](http://code.angularjs.org/1.1.5/docs/api/ng.directive:ngIf)指令。这是针对这个特定问题的最佳解决方案。如果您使用的是旧版本的 Angular，请考虑使用 angular-ui 的[ui-if](https://github.com/angular-ui/angular-ui/blob/master/modules/directives/if/if.js)指令。

如果您来到这里寻找“模板中的条件逻辑”一般问题的答案，还请考虑：

*   1.1.5 还引入了[三元运算符](https://stackoverflow.com/a/12151492/215945)
*   [ng-switch](http://docs.angularjs.org/api/ng.directive:ngSwitch)可用于有条件地从 DOM 中添加/删除元素
*   另请参阅[如何在 AngularJS 中有条件地应用 CSS 样式？](https://stackoverflow.com/questions/13813254/how-do-i-conditionally-apply-css-styles-in-angularjs)

* * *

原答案：

这是一个不太好的“ng-if”指令：

```
myApp.directive('ngIf', function() {
    return {
        link: function(scope, element, attrs) {
            if(scope.$eval(attrs.ngIf)) {
                // remove '<div ng-if...></div>'
                element.replaceWith(element.children())
            } else {
                element.replaceWith(' ')
            }
        }
    }
}); 
```

允许这种 HTML 语法：

```
<div ng-repeat="message in data.messages" ng-class="message.type">
   <hr>
   <div ng-if="showFrom(message)">
       <div>From: {{message.from.name}}</div>
   </div>    
   <div ng-if="showCreatedBy(message)">
      <div>Created by: {{message.createdBy.name}}</div>
   </div>    
   <div ng-if="showTo(message)">
      <div>To: {{message.to.name}}</div>
   </div>    
</div> 
```

[小提琴](http://jsfiddle.net/mrajcok/5ttQA/)。

replaceWith() 用于从 DOM 中删除不需要的内容。

此外，正如我在 Google+ 上提到的，如果您想使用 ng-show 而不是自定义指令，则可以使用[ng-style有条件地加载背景图像。](http://docs.angularjs.org/api/ng.directive:ngStyle)（为了其他读者的利益，Jon 在 Google+ 上说：“这两种方法都使用 ng-show，我试图避免，因为它使用 display:none 并在 DOM 中留下额外的标记。这是这种情况下的一个特殊问题，因为隐藏元素将有一个背景图像，该图像仍将在大多数浏览器中加载。”）。
另请参阅[如何在 AngularJS 中有条件地应用 CSS 样式？](https://stackoverflow.com/questions/13813254/how-do-i-conditionally-apply-css-styles-in-angularjs)

[angular-ui ui-if](https://github.com/angular-ui/angular-ui/blob/master/modules/directives/if/if.js)指令监视 if 条件/表达式的变化。我的没有。因此，虽然我的简单实现会在模型发生更改以仅影响模板输出时正确更新视图，但如果条件/表达式答案发生更改，它将无法正确更新视图。

例如，如果模型中 from.name 的值发生变化，视图将更新。但是如果你`delete $scope.data.messages[0].from`，from 名称将从视图中删除，但模板不会从视图中删除，因为 if 条件/表达式没有被监视。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-12-29T10:51:22.503

您可以使用[ngSwitch](http://docs.angularjs.org/api/ng.directive%3angSwitch)指令：

```
 <div ng-switch on="selection" >
    <div ng-switch-when="settings">Settings Div</div>
    <span ng-switch-when="home">Home Span</span>
    <span ng-switch-default>default</span>
  </div> 
```

如果您不希望使用空 div 加载 DOM，则需要使用 $http 创建自定义指令来加载（子）模板，并在达到特定条件时使用 $compile 将其注入 DOM。

这只是一个（未经测试的）示例。它可以而且应该被优化：

**HTML：**

```
<conditional-template ng-model="element" template-url1="path/to/partial1" template-url2="path/to/partial2"></div> 
```

**指示：**

```
app.directive('conditionalTemplate', function($http, $compile) {
   return {
      restrict: 'E',
      require: '^ngModel',
      link: function(sope, element, attrs, ctrl) {
        // get template with $http
        // check model via ctrl.$viewValue
        // compile with $compile
        // replace element with element.replaceWith()
      }
   };
}); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-12-29T00:42:08.357

您可以在循环中的每个 div 元素上使用 ng-show。这是你想要的：http: [//jsfiddle.net/pGwRu/2/](http://jsfiddle.net/pGwRu/2/)？

```
<div class="from" ng-show="message.from">From: {{message.from.name}}</div> 
```

# asp.net - 会话被无意中重置

> ID：14077473
> 
> 赞同：0
> 
> 时间：2012-12-29T00:22:20.493
> 
> 标签：asp.net, .net, session, session-state

我有一个旧的 ASP.NET 应用程序。它从 NET 2 转换为 net 4。它使用状态服务器会话。

在某些时候，应用程序会打开一个新页面（在新的浏览器选项卡中：link target = "_blank"）

但返回调用页面（选项卡）后，我发现会话已重置，因此不再使用当前用户，应用程序重定向到登录页面。实际上，SessionID 保持不变，但 IsSessionNew 设置为 true，并且 session 中没有设置任何变量。

该应用程序不使用 Session.Abort 或 Session.Clear。

即使我将会话更改为 InProc，并将链接的目标更改为 _top 或 _self，或者完全删除，也会发生同样的事情 - 会话被重置。

这是 web.config 中的会话设置（或者我使用了 StateServer，但结果相同）

```
<sessionState timeout="432000" cookieless="UseCookies" mode="InProc"/> 
```

知道什么会导致这种情况吗？

谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T20:33:01.623

我终于解决了这个问题。但是，我没有找到真正的原因，但我找到了导致问题的模块。这是一个 aspx 页面，做了 1001 件事情（它是基本功能加上另一个大约 80 件基于 ajax 调用的其他事情（！！！）。我没有制作那个页面！！！但是导致问题的部分是一个功能提供了一个图像文件。所以我将该部分重写为 ASHX 处理程序，然后代码工作正常 - 会话保持打开状态。

# android - 如何在模拟器上安装 OpenCV Manager？

> ID：14077474
> 
> 赞同：5
> 
> 时间：2012-12-29T00:22:31.367
> 
> 标签：android, opencv

在模拟器上运行 OpenCV for Android 示例需要安装 OpenCV 管理器。我的设备上有 x86 架构。许多教程只是简单地说安装 OpenCV Manager。你能告诉我具体怎么做吗？

我尝试使用“adb install”来安装它，但它不起作用。我在正确的目录中，否则 adb 工作正常。有没有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T11:31:51.497

OpenCV Manager apk 文件包含在 OpenCV SDK 中。

您可以运行安装它：

```
adb install <...>/OpenCV-2.4.3.2-android-sdk/apk/OpenCV_2.4.3.2_Manager_2.4_x86.apk 
```

（对于其他 SDK 版本路径会略有不同但类似）

# ruby-on-rails - 正确响应长时间运行进程的 POST 请求

> ID：14077476
> 
> 赞同：1
> 
> 时间：2012-12-29T00:22:51.663
> 
> 标签：ruby-on-rails, json, api, http-response-codes, grape-api

我正在尝试编写一个具有长时间运行过程的 API，最终用户可能会向其发出 POST 请求：

```
POST /things { "some":"json" } 
```

实际创建过程可能需要一些时间，经常会排队。可能需要很多分钟。因此，我不确定我应该返回什么或何时返回。它是通常的 201 plus 对象，在我的 API 创建对象所需的任何时间之后返回吗？这不会在客户端引起问题吗？是否有其他标准方法可以做到这一点 - 例如中间步骤？

如果有帮助，我将使用 Rails & Grape 作为我的 API。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-02T18:44:16.450

考虑[Post-Redirect-Get 模式](http://www.andypemberton.com/engineering/the-post-redirect-get-pattern/)是否适合您的需求。例如，您可以将 303 重定向返回到某种状态页面，客户端可以在其中检查请求的进度。一般来说，如果客户端必须等待任何明显的时间，201+object 是一个糟糕的选择，因为太多的事情可能会出错（如果出于烦恼或不耐烦，他会杀死浏览器窗口，或刷新或重新提交怎么办？）

# flash - 隐藏在位图下方的文本框

> ID：14077484
> 
> 赞同：0
> 
> 时间：2012-12-29T00:23:58.827
> 
> 标签：flash

我正在使用 Flash Professional CS6。我有一个木盒的位图图像。我想在此位图图像顶部有两个文本框，但是当我将文本框移动到图像顶部时，它们隐藏在下面。文本框中的任何文本都不会显示，因为图像覆盖了它们。

我该如何进行这项工作？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T10:31:37.657

我相信如果 send to back 对你没有帮助，那么问题可能不是你想的那样。

*   尝试更改文本框的字体（比如 Arial）和颜色。

*   通常不嵌入字体，导致文本框呈现空白（如果在运行时不可用）

*   除了尝试将对象包装成符号，然后再将它们放到舞台上。

*   如果您使用的是 IDE，则不妨使用分层。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:01:28.710

您可以尝试将文本字段分离到它们自己的图层上，并将其放在包含位图的图层上方（这是假设您没有代码）。

如果您有 (AS3) 代码，请尝试查找可能将位图移动到显示堆栈中文本字段上方的 addChild() 调用。同样调用 addChild() 并传入文本字段会将它们移动到显示堆栈的顶部（即使它们已经在显示堆栈上）。

# c++ - C++ 学习头文件。这个分号是怎么回事？

> ID：14077486
> 
> 赞同：5
> 
> 时间：2012-12-29T00:24:18.360
> 
> 标签：c++, header, header-files

我正在学习制作头文件。这是我的代码（三个单独的文件）

```
//Main.cpp
#include <iostream>
#include "functions.h"
;
using namespace std;

int main()
{
    cout << multiply(3, 4) << endl;

    return 0;
}

//functions.cpp
int multiply(int x, int y)
{
    return x * y;
}

//functions.h
#ifndef FUNCTIONS_H_
#define FUNCTIONS_H_

int multiply(int x, int y)

#endif 
```

代码编译并运行，但困扰我的部分在 Main.cpp 中。在“functions.h”下面和“使用命名空间”上面有那个分号。

我把它放在那里是因为视觉工作室说它期待一个，但我不知道为什么。我在教程中没有看到。

当然，它有效。但我不喜欢不知道它为什么在那里，它不应该在那里。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-12-29T00:25:36.253

因为你错过了functions.h中的一个分号

```
int multiply(int x, int y);
                          ^^^^ here 
```

C++ 用分号分隔语句。

这`#include directive` 会导致“functions.h”文件的内容与您的文件内容一起发送到编译器。这样做的结果是，由于头文件中的错误导致的编译错误经常在包含它们的代码中报告。（感谢 Philipp）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-29T00:28:01.553

由于 C 预处理器对 C 的语法一无所知 - 如果您愿意，您可以使用它来整理电子邮件、汇编源文件或 HTML，它只是将所有源代码放在一个长文件中，供编译器实际编译。

而且您`int multiply(int x, int y)`在“functions.h”之后缺少一个分号。

# cocos2d-iphone - Cocos2d 强制结束触摸

> ID：14077488
> 
> 赞同：0
> 
> 时间：2012-12-29T00:24:23.677
> 
> 标签：cocos2d-iphone, touch, collision-detection

有没有办法调用 ccTouchEnd 方法？

就像，在我的更新中，我希望它写

```
If(situation occurs){
[self ccTouchEnd];
} 
```

或类似的东西。我问的原因是因为这件事发生有两个不同的原因。一种是用户结束触摸。另一个是如果精灵与另一个精灵发生碰撞。

# ruby-on-rails - Rails 和 Omniauth - 我应该保存多少来自身份验证哈希的数据？

> ID：14077494
> 
> 赞同：3
> 
> 时间：2012-12-29T00:25:30.447
> 
> 标签：ruby-on-rails, ruby-on-rails-3, omniauth

我目前正在使用rails 和omniauth gem 将我的应用程序与facebook、twitter 和linkedin 集成。当我处理omniauth 回调时，我只需从身份验证哈希中保存uid 和provider。大多数在线教程也只保存这些字段，但是您以后如何从 facebook/twitter/linkedin 访问用户详细信息？除了 uid/provider 之外，还应保存身份验证哈希中的哪些其他字段？

我读过的一些指南：

[Github omniauth 与设计](https://github.com/plataformatec/devise/wiki/OmniAuth%3a-Overview)

[Railscast omniauth 和设计](http://railscasts.com/episodes/235-devise-and-omniauth-revised)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:49:26.810

在 Railscast 中，在创建全功能 OmniauthCallbacksController 之前有一个示例，其中行：

```
raise request.env["omniauth.auth"].to_yaml 
```

在屏幕上输出请求。如您所见，在这个散列中`omniauth.auth`，有很多关于经过身份验证的用户的有用信息。每次验证成功时都会收到它。`uid`在这种情况下，除了和之外，不需要在数据库中存储任何其他内容`provider`。

可以像这样访问哈希的条目：

```
(request.env["omniauth.auth"]).info.nickname 
```

或者

```
(request.env["omniauth.auth"]).uid 
```

您会看到逻辑：yaml 输出的每个部分（比如说“信息”）都包含特定的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T20:51:53.057

最后从 facebook 保存访问令牌，如果我需要信息，轮询 api，然后每 2 小时自动刷新一次令牌。

# jquery - 现有 html 的 jQuery 主题？

> ID：14077497
> 
> 赞同：0
> 
> 时间：2012-12-29T00:26:00.327
> 
> 标签：jquery, html, jquery-ui

我有一些现有的 html- 非常简单的东西。我想用来自 CDN 的 jQuery 为我的网站设置主题。我的页面顶部有这个：

```
 <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-darkness/jquery-ui.css" type="text/css">
    <script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
    <script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/jquery-ui.min.js'></script> 
```

但这似乎对我的ui没有任何影响。有没有办法让它神奇地应用于我页面中的每个元素？还是我需要手动为每个元素添加一个类或 id？或者以某种方式初始化事物？我能够将主题应用于按钮，但只能通过在按钮上明确设置 class="ui-button" 。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:32:49.737

如果您检查您声明的 .css 文件，您将看到与样式代码关联的所有特定 ID/类：http: [//ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-darkness /jquery-ui.css](http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-darkness/jquery-ui.css)

就像您提到的那样，它包含许多标识符，例如“ui-widget-header”或“ui-state-active”，看起来您必须将这些 id 分配给您的标记。此主题配置的真正目的是为 JQuery UI 组件设置样式，它的设计目的不是侵入性地影响现有页面的外观。

# javascript - 将 javascript 变量设置为外部降价文件

> ID：14077512
> 
> 赞同：2
> 
> 时间：2012-12-29T00:28:25.727
> 
> 标签：javascript, markdown

我有一个很长的降价文件。我还有一个通过 Markdown 运行解析器的 javascript 文件。在我的 javascript 文件中，我设置了：

var text = "md/markdown.md"

这似乎并没有像我希望的那样引入降价文件的内容。但是，如果我将 markdown 文件的内容复制并粘贴到变量中，那么一切都会正常运行。有没有办法可以设置这个 javascript 变量来获取这个外部降价文件的内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:36:41.813

运行 AJAX 请求：

```
var ajaxRequest, text;  

try{
    // Opera 8.0+, Firefox, Safari
    ajaxRequest = new XMLHttpRequest();
} catch (e){
    // Internet Explorer Browsers
    try{
        ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
    } catch (e) {
        try{
            ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (e){
            // Something went wrong
            alert("Your browser broke!");
            return false;
        }
    }
}
ajaxRequest.onreadystatechange = function(){
    if(ajaxRequest.readyState == 4){
        text = ajaxRequest.responseText;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:36:42.407

在 Web 浏览器的上下文中，如果您希望 JavaScript 从 URI 获取数据，那么您通常会使用[XMLHttpRequest](http://www.w3.org/TR/XMLHttpRequest/)对象。MDN 有一个[关于使用 XMLHttpRequest 的不错的教程](https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest/Using_XMLHttpRequest)。

大多数通用 JavaScript 库都包含 XHR 的包装器，其中包括兼容性修复（尤其是旧版 IE）。我喜欢[YUI](http://yuilibrary.com/yui/docs/io/)。另一种选择是相对普遍的[jQuery](http://api.jquery.com/jQuery.ajax/)。

对于问题中给出的情况，这不是问题，但要注意[同源政策](http://en.wikipedia.org/wiki/Same_origin_policy)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T00:43:05.177

出于安全原因，Javascript 无法直接读取本地文件。作为一种替代方式，您可以使用`XMLHttpRequest`来实现它。请检查 stackoverflow 上的链接：[read external file with Javascript](https://stackoverflow.com/questions/7406209/read-external-file-with-javascript)。此外，HTML5 提供了一种通过[File API 规范](http://www.w3.org/TR/file-upload/)与本地文件交互的标准方式。您可以参考教程：[http ://www.html5rocks.com/en/tutorials/file/filesystem/](http://www.html5rocks.com/en/tutorials/file/filesystem/)

# css - 为整个网站动态更新 CSS 类

> ID：14077519
> 
> 赞同：1
> 
> 时间：2012-12-29T00:29:19.540
> 
> 标签：css, yui

我有一个系列书籍的参考网站，我想制作它，以便读者避免剧透。我的想法是制作一个设置网页，他们在其中单击要查看信息的每本书的复选框。然后，我可以在他们每次访问该站点时（以某种方式）将其存储为 cookie，并使其适用于站点中的每个页面。所以，一页可能有这个：

```
<li class="teotw">Rand killed a Trolloc</li> 
```

另一个页面可能有

```
<li class="teotw">Nynaeve tugged her braid</li> 
```

除非他们选中了“teotw”书的框，否则该信息不会显示在页面上。我最初的想法是像这样切换 CSS 类的值：

```
document.styleSheets[0]['cssRules'][0].class['teotw'] = 'display:none';  
document.styleSheets[0]['cssRules'][0].class['teotw'] = 'display:inherit'; 
```

但我不确定这是否是最好的方法。首先，它仅适用于当前文档，因此我需要一种方法将其重新应用于他们访问的每个页面。如果重要的话，我也在使用 YUI。关于这样做的最佳方式的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:24:30.530

有很多方法可以实现它。您可以使用 YUI 样式表模块（请阅读其[用户指南](http://yuilibrary.com/yui/docs/stylesheet/)了解如何使用它），它可以实现您正在考虑的跨浏览器支持，并且比直接使用 DOM 更容易使用。

另一种方法是将类添加到`body`页面。您可以像这样定义样式：

```
.teotw {
  display: none;
}
.teotw-visible .teotw {
  display: block;
} 
```

使用以下 JS 代码：

```
if (someCondition) {
  // show the hidden content
  Y.one('body').addClass('teotw-visible');
} 
```

对于可见状态的持久性，您可以使用带有 YUI [Cookie 实用程序的 cookie 或带有](http://yuilibrary.com/yui/docs/cookie/)[CacheOffline](http://yuilibrary.com/yui/docs/cache/#offline)的本地存储。使用 cookie 的代码如下所示：

```
var body = Y.one('body');
if (Y.Cookie.get('teotwVisible')) {
  body.addClass('teotw-visible');
}
// change the cookie 
Y.one('#teotw-toggle').on('click', function (e) {
  var checked = this.get('checked');
  Y.Cookie.set('teotwVisible', checked);
  body.toggleClass('teotw-visible', checked);
}); 
```

您可能应该将不同的部分存储在 JS 对象中，并避免在每个 JS 行中硬编码类名。或者可能在复选框 ID 和部分类名称之间使用约定。

# java - 递归溢洪溢出

> ID：14077521
> 
> 赞同：1
> 
> 时间：2012-12-29T00:29:42.160
> 
> 标签：java, flood-fill

```
public void floodFill(int x, int y) {
    if (x >= 0 && x <= 9 && y >= 0 && y <= 9) {
        if (mines[x][y] == 0) {
            btn[x][y].setBackground(Color.GRAY);
            floodFill(x - 1, y);
            // floodFill(x + 1, y);
            floodFill(x, y - 1);
            // floodFill(x, y + 1);
        } else {
            return;
        }
    }
} 
```

这是我正在制作的类似扫雷游戏的 floodFill 代码。但是，如您所见，有 2 个部分被注释掉了。一旦我取消注释并运行程序。

```
Exception in thread "AWT-EventQueue-0" java.lang.StackOverflowError
at sun.awt.NullComponentPeer.setBackground(Unknown Source)
at java.awt.Component.setBackground(Unknown Source)
at javax.swing.JComponent.setBackground(Unknown Source)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:95)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:99)
at Minesweeper.BoardBuild.floodFill(BoardBuild.java:98) 
```

我不确定为什么会这样，也不知道如何解决。任何帮助表示赞赏。

**编辑：**

Fls'Zen 在聊天中给出的答案，以防万一其他人遇到这个问题

```
public void floodFill(int x, int y) {
    if (x >= 0 && x <= 9 && y >= 0 && y <= 9) {
        if (mines[x][y] == 0 && btn[x][y].getBackground() != Color.GRAY) {
            btn[x][y].setBackground(Color.GRAY);
            floodFill(x - 1, y);
            floodFill(x + 1, y);
            floodFill(x, y - 1);
            floodFill(x, y + 1);
        } else {
            return;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:35:15.433

当这些行未注释时，您调用 floodFill`x - 1`和`x + 1`。考虑当您调用 floodFill 时会发生什么`x - 1`。它还调用floodFill，`x + 1`它的`x`值是调用floodFill 的值。您有 floodFill 为相同的两个`x`值调用自己，原始`x`值和原始值`x - 1`。

如果您要使用递归，您应该选择一个“方向”（+ 或 -）并坚持下去。否则，您需要添加一些内容来跟踪已评估的坐标。

**编辑：** 当算法已经处理了单元格时，以下代码将避免递归。它通过检查当前坐标的背景颜色来实现这一点。如果背景已经是灰色的，那么它假定它已经处理了坐标并且不会再次处理它们。

```
if (mines[x][y] == 0 && btn[x][y].getBackground() != Color.GRAY) {
    btn[x][y].setBackground(Color.GRAY);
    floodFill(x - 1, y);
    floodFill(x + 1, y);
    floodFill(x, y - 1);
    floodFill(x, y + 1);
} else {
    return;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:34:09.227

看起来你没有记录你已经检查过的方块，所以它在整个棋盘上无限循环。

# c# - 如何在图像上绘制带有轮廓的文本？

> ID：14077523
> 
> 赞同：6
> 
> 时间：2012-12-29T00:29:59.680
> 
> 标签：c#, winforms, visual-studio-2008

我一直在搜索并寻找在图像上绘制带有轮廓的文本？

这是我的代码

```
 private static void tulisnamafile(string imagepath, string textnya)
    {

        Image image = Image.FromStream(new MemoryStream(File.ReadAllBytes(imagepath)));
        Bitmap newImage = new Bitmap(640, 380);
        using (Graphics g = Graphics.FromImage(newImage))
        {
            // Draw base image
            g.DrawImageUnscaled(image, 0, 0);
            //Static is HERE
            SolidBrush brushing = new SolidBrush(Color.White);
            Font font = new Font(("Comic Sans MS"), 20.0f);
            int napoint = newImage.Height - 90;
            int napointa = image.Width - 200;
            FontFamily ff = new FontFamily("Times New Roman");
            int fontSize = 24;
            Font f = new Font(ff, fontSize, FontStyle.Regular);
            StringFormat sf = new StringFormat();
            Rectangle displayRectangle = new Rectangle(new Point(5, napoint), new Size(newImage.Width - 1, newImage.Height - 1));
            g.DrawEllipse(Pens.Magenta, new Rectangle(0, 0, 1, 1));
            GraphicsPath gp = new GraphicsPath();
            gp.AddString(textnya, ff, (int)FontStyle.Bold, fontSize + 4, new Point(0, 0), sf);
            g.FillPath(Brushes.White, gp);
            g.DrawPath(Pens.Black, gp);

            g.Flush(FlushIntention.Sync);
            g.Dispose();
        }
        image.Dispose();
        string fileName = "ab.jpg";
        string path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, fileName);
        MessageBox.Show(path);
        newImage.Save(path, System.Drawing.Imaging.ImageFormat.Jpeg);
        newImage.Dispose();
    } 
```

它是触发器

```
 private void button3_Click(object sender, EventArgs e)
    {

        string imagename = "C:\\Documents and Settings\\admin\\My Documents\\Visual Studio 2008\\Projects\\template\\template\\bin\\Debug\\bg.jpg";
        tulisnamafile(imagename, "SlimPort® SP1002; Connect mobile devices to any big screen. High Speed micro USB");

    } 
```

检查代码结果：

![弄乱结果](../Images/b75d6f3b521f03e18d768d8ecdf28209.png) 这种混乱的结果，未包装并带有白色

这是我想要的，并带有包装？

![这个](../Images/c1fe77dbc0b894f5368344c6ac95c386.png)

我在[CodeProject](http://www.example.com/)中找到但不是运气，它使用 C++。基于[neowin的某人](http://www.neowin.net/forum/topic/269276-c-drawing-outline-text/)并尝试过[这个](http://www.java2s.com/Code/CSharp/2D-Graphics/TextRotate2.htm)..

但还是不走运。

**更新：**

这是我的工作代码，可能需要它的人...基于 Abdias Software 的代码（检查答案），我做了一些小改动（这些代码中有一些错误）。

```
 private static void tulisnamafile(string imagepath, string textnya)
    {

        float fontSize = 22;

        Image image = Image.FromStream(new MemoryStream(File.ReadAllBytes(imagepath)));
        //some test image for this demo
        Bitmap bmp = (Bitmap)Image.FromFile(imagepath);
        Graphics g = Graphics.FromImage(bmp);

        //this will center align our text at the bottom of the image
        StringFormat sf = new StringFormat();
        sf.Alignment = StringAlignment.Center;
        sf.LineAlignment = StringAlignment.Far;

        //define a font to use.
        Font f = new Font("Impact", fontSize, FontStyle.Bold, GraphicsUnit.Pixel);

        //pen for outline - set width parameter
        Pen p = new Pen(ColorTranslator.FromHtml("#77090C"), 8);
        p.LineJoin = LineJoin.Round; //prevent "spikes" at the path

        //this makes the gradient repeat for each text line
        Rectangle fr = new Rectangle(0, bmp.Height - f.Height, bmp.Width, f.Height);
        LinearGradientBrush b = new LinearGradientBrush(fr,
                                                        ColorTranslator.FromHtml("#FF6493"),
                                                        ColorTranslator.FromHtml("#D00F14"),
                                                        90);

        //this will be the rectangle used to draw and auto-wrap the text.
        //basically = image size
        Rectangle r = new Rectangle(0, 0, bmp.Width, bmp.Height);

        GraphicsPath gp = new GraphicsPath();

        //look mom! no pre-wrapping!
        gp.AddString(textnya, f.FontFamily, (int)FontStyle.Bold, fontSize, r, sf);

        //these affect lines such as those in paths. Textrenderhint doesn't affect
        //text in a path as it is converted to ..well, a path.    
        g.SmoothingMode = SmoothingMode.AntiAlias;
        g.PixelOffsetMode = PixelOffsetMode.HighQuality;

        //TODO: shadow -> g.translate, fillpath once, remove translate
        g.DrawPath(p, gp);
        g.FillPath(b, gp);

        //cleanup
        gp.Dispose();
        b.Dispose();
        b.Dispose();
        f.Dispose();
        sf.Dispose();
        g.Dispose();
        string fileName = "ab.jpg";
        string path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, fileName);
        bmp.Save(path, System.Drawing.Imaging.ImageFormat.Jpeg);
        bmp.Dispose();
    } 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-12-29T01:10:50.503

简单总结一下：

定义一个`GraphicPath`然后使用`DrawPath`来绘制文本的轮廓版本，`FillPath`绘制一个填充版本。

对于女性的第二张图像，首先在一个小的偏移处绘制第二个（填充的）版本。

对于渐变`LinearGradientBrush`使用`brush`. 轮廓的粗细由 Pen 的粗细定义。

对于换行，请定义 a`StringFormat`并使用 a`Rectangle`来定义您希望文本所在的区域。

要使文本居中，您可以将矩形定义为与图像具有相同的宽度，然后设置`strformat.Alignment`为`Center`。

更新：要复制第二张图片中的文本，您可以使用以下代码：

```
float fontSize = 52;

//some test image for this demo
Bitmap bmp = (Bitmap)Image.FromFile(s"test.jpg");
Graphics g = Graphics.FromImage(bmp);

//this will center align our text at the bottom of the image
StringFormat sf = new StringFormat();
sf.Alignment = StringAlignment.Center;
sf.LineAlignment = StringAlignment.Far;

//define a font to use.
Font f = new Font("Impact", fontSize, FontStyle.Bold, GraphicsUnit.Pixel);

//pen for outline - set width parameter
Pen p = new Pen(ColorTranslator.FromHtml("#77090C"), 8);
p.LineJoin = LineJoin.Round; //prevent "spikes" at the path

//this makes the gradient repeat for each text line
Rectangle fr = new Rectangle(0, bmp.Height - f.Height, bmp.Width, f.Height);
LinearGradientBrush b = new LinearGradientBrush(fr,  
                                                ColorTranslator.FromHtml("#FF6493"),
                                                ColorTranslator.FromHtml("#D00F14"),
                                                90);

//this will be the rectangle used to draw and auto-wrap the text.
//basically = image size
Rectangle r = new Rectangle(0, 0, bmp.Width, bmp.Height);

GraphicsPath gp = new GraphicsPath();

//look mom! no pre-wrapping!
gp.AddString("Demo for Stack Overflow", 
             f.FontFamily, (int)f.Style, fontSize, r, sf);

//these affect lines such as those in paths. Textrenderhint doesn't affect
//text in a path as it is converted to ..well, a path.    
g.SmoothingMode = SmoothingMode.AntiAlias;
g.PixelOffsetMode = PixelOffsetMode.HighQuality;

//TODO: shadow -> g.translate, fillpath once, remove translate
g.DrawPath(p, gp);
g.FillPath(b, gp);

//cleanup
gp.Dispose();
b.Dispose();
b.Dispose();
f.Dispose();
sf.Dispose();
g.Dispose();

bmp.Save(s"test_result.jpg", System.Drawing.Imaging.ImageFormat.Jpeg);
bmp.Dispose(); 
```

这将产生以下结果：

![生成的图像](../Images/5f2cebea100fe1782cb52821377e5262.png)

要产生额外的“阴影”，只需先翻译第`g`一个，绘制填充，然后删除翻译。

在`FromHtml`这里使用它是因为我从您的图像中挑选了颜色并且懒得转换。只需使用`Color.FromARGB()`或固定颜色 - 随心所欲。

VB版：

```
 Dim fontSize As Single = 52

    Dim bmp As Bitmap = Bitmap.FromFile("c:\test.jpg")
    Dim g As Graphics = Graphics.FromImage(bmp)

    Dim sf As New StringFormat(StringFormatFlags.NoClip)
    sf.Alignment = StringAlignment.Center
    sf.LineAlignment = StringAlignment.Far

    Dim f As New Font("Impact", fontSize, FontStyle.Bold, GraphicsUnit.Pixel)

    Dim p As New Pen(ColorTranslator.FromHtml("#77090C"), 4)
    p.LineJoin = LineJoin.Round

    'rectangle for font to repeat gradient for each line
    Dim fr As New Rectangle(0, bmp.Height - f.Height, bmp.Width, f.Height)
    Dim b As New LinearGradientBrush(fr,
                                     ColorTranslator.FromHtml("#FF6493"),
                                     ColorTranslator.FromHtml("#D00F14"),
                                     90)

    Dim r As New Rectangle(0, 0, bmp.Width, bmp.Height)
    Dim gp As New GraphicsPath

    gp.AddString("Demo for Stack Overflow",
                 f.FontFamily,
                 f.Style,
                 fontSize,
                 r,
                 sf)

    g.SmoothingMode = SmoothingMode.AntiAlias
    g.PixelOffsetMode = PixelOffsetMode.HighQuality

    g.DrawPath(p, gp)
    g.FillPath(b, gp)

    gp.Dispose() 'path
    b.Dispose() 'b
    b.Dispose()  'p
    f.Dispose()  'font
    sf.Dispose()  'stringformat
    g.Dispose()  'g

    bmp.Save("c:\test_result.jpg", Imaging.ImageFormat.Jpeg)
    bmp.Dispose() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:55:56.407

获得“更好”结果的一种简单方法是绘制文本两次。首先绘制阴影，例如右侧和底部的一些像素，如果您想要经典的阴影外观，灰色。您可能还想考虑使用不同的字体，我猜任何没有衬线的字体都会看起来更好。有关渐变效果，请参阅[msdn 页面](http://msdn.microsoft.com/en-us/library/system.drawing.drawing2d.lineargradientbrush.aspx)或 google 如何使用它。此外，使用图形对象的[SmoothingMode](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.smoothingmode.aspx)和[TextRenderingHint](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.textrenderinghint.aspx)，HighQuality 和 Antialias 应该会产生更好看的结果。

# javascript - 行删除功能不好用

> ID：14077526
> 
> 赞同：1
> 
> 时间：2012-12-29T00:30:06.223
> 
> 标签：javascript, jquery, html, dynamic-forms

我创建了一个包含动态表单的表，因此当单击添加按钮时，将显示一个新行，每行具有相同的表单。而且我也做了清除表格的开关，但是不太顺利。任何事情，因为在操作中还有其他功能可以删除该行。我所做的以下编码。

html:

```
<table class="table table-striped area-table tabel-form-makanan">
    <thead>
        <tr>
            <th>Nama Makanan</th>
            <th>Jenis Makanan</th>
            <th>Harga Makanan</th>                            
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <input type="text" name="nama-makanan[]" style="height: 30px; width: 280px;" class="nama-makanan" placeholder="ketikkan nama makanan"/>
                <input type="hidden" name="id-makanan[]" class="id-makanan"/>
            </td>
            <td>
                <input type="text" readonly name="nama-jenis-makanan[]" style="height: 30px; width: 280px;" class="nama-jenis-makanan" placeholder="nama jenis makanan"/>
            </td>
            <td>
                <input type="text" readonly name="harga-makanan[]" rel="hargaMakanan" style="height: 30px; width: 280px; text-align: right;" class="harga-makanan" placeholder="harga satuan makanan"/>
            </td>
            <td>
                <a class="btn hapus-baris-makanan" style="display: none;"><i class="icon-remove"></i></a>
            </td>
        </tr>
    </tbody>
</table>
<button class="btn btn-primary tombol-tambah-makanan" type="button" style="float: right; margin-right: 10px;">Tambah</button> 
```

用于动态表单的 javascript：

```
$('.tombol-tambah-makanan').on('click', function(){
    var tr = '<tr>\n\
                <td><input type="text" name="nama-makanan[]" style="height: 30px; width: 280px;" class="nama-makanan" placeholder="ketikkan nama makanan"/><input type="hidden" name="id-makanan[]" class="id-makanan"/></td>\n\
                <td><input type="text" readonly name="nama-jenis-makanan[]" style="height: 30px; width: 280px;" class="nama-jenis-makanan" placeholder="nama jenis makanan"/></td>\n\
                <td><input type="text" readonly name="harga-makanan[]" rel="hargaMakanan" style="height: 30px; width: 280px; text-align: right;" class="harga-makanan" placeholder="harga satuan makanan"/></td>\n\
                <td><a class="btn hapus-baris-makanan"><i class="icon-remove"></i></a></td>\n\
            </tr>';
    $("table.tabel-form-makanan tbody").append(tr);                  
}); 
```

用于删除表单的 javascript：

```
$('.tabel-form-makanan').on( 'click', '.hapus-baris-makanan', function(){
    var parent = $(this).parents('tr');
    var harga = $('.harga-makanan', parent).val();
    pengurangan_pesanan(harga);
    $(this).closest('tr').remove();
}); 
```

其他javascript：

```
function pengurangan_pesanan(price) {
        if (subtotal > 0) {
            var kembali = 0;
            subtotal -= parseFloat(price);
            $('.subtotal').val(subtotal);
            if (cek_bayar != isNaN || cek_bayar != 0) {
                kembali = cek_bayar - subtotal;
                $('.kembali').val(kembali);
            }
        }
} 
```

你有解决这个问题的方法吗，我真的很需要。谢谢你

*演示：http: [//jsfiddle.net/daniwarrior/ANfFe/1/](http://jsfiddle.net/daniwarrior/ANfFe/1/)

# gradle - 如何在自定义任务中定义默认的dependsOn

> ID：14077527
> 
> 赞同：0
> 
> 时间：2012-12-29T00:30:06.753
> 
> 标签：gradle

我对gradle比较陌生。为了在集群上创建自动部署脚本，我创建了一堆相互依赖的自定义任务。例如：

```
class StartSchedulerTask extends SchedulerTask {
    @TaskAction
    void start() {
        dependsOn env.nodes.name.collect {"startTomcat_$it"}
        println "Starting quartz on node: ${node}"
    }
} 
```

在 build.gradle 中，我动态创建了任务：

```
project.extensions.environment.nodes.each { TomcatNode n ->
    String name = n.name
    task "nodeInit_$name"(type: DeployToNodeInitTask) {
                node(n)
    }
    task "stopWorker_$name"(type: StopWorkerTask) {
        node(n)
    }
    task "stopTomcat_$name"(type: StopTomcatTask){
        node(n)
    }
    task "updateAppConfigs_$name"(type: UpdateAppConfigsTask){
        node(n)
        apps(V3Application.ALL_APPS)
        buildName('develop')
    }
    task "deployWars_$name"(type: DeployWarsTask){
        node(n)
        apps(V3Application.ALL_APPS)
        buildName('develop')
    }
    task "startTomcat_$name"(type: StartTomcatTask){
        node(n)
    }
    task "startWorker_$name"(type: StartWorkerTask){
        node(n)
    }
    task "terminateNode_$name"(type: DeployToNodeTerminationTask){
        node(n)
    }
}
task stopScheduler(type: StopSchedulerTask) {
    environment(environment)
}
task startScheduler(type: StartSchedulerTask) {
    environment(environment)
} 
```

默认任务配置为 startScheduler，这是部署过程的最后一步，其想法是任务图一旦构建，将负责我的任务的正确执行顺序。

但是，当我打印出任务图时，列出的唯一任务是 startScheduler。我错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T06:40:38.207

任务相关性必须在*配置时*声明，而不是在*执行时*声明。理论上您可以在任务的构造函数中执行此操作，但更好的方法是在构建脚本或插件中执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-29T11:53:09.730

感谢 Peter Niederwieser 和 Jeffrey 的评论，我能够想出我想要的完整解决方案。我没有将彼得的答案标记为答案，因为完整的答案如下，但这是正确解决方案的必要提示：

我创建了一个接口 DependencyAware：

```
public interface DependencyAware {
    void declareDependencies()
} 
```

每个知道如何声明其依赖关系的任务都实现了这个接口。例如：

```
class StartSchedulerTask extends SchedulerTask {

    @TaskAction
    void start() {
        println "Starting quartz on node: ${node}"
    }

    void declareDependencies() {
        dependsOn env.nodes.name.collect {"startTomcat_$it"}
    }
} 
```

在我的构建脚本中：

```
tasks.each { Task t ->
    if (t instanceof DependencyAware) {
        t.declareDependencies()
    }
} 
```

就是这样！

感谢彼得和杰弗里的指点

**更新 1**

```
task deploy(dependsOn: ['backupWars', 'startScheduler'])

task stopScheduler(type: StopSchedulerTask)

task backupWars(type: BackupWarsTask)

project.extensions.targetEnvironment.nodes.each { TomcatNode n ->
    String name = n.name
    [
        ("nodeInit_$name"): DeployToNodeInitTask,
        ("stopWorker_$name"): StopWorkerTask,
        ("stopTomcat_$name"): StopTomcatTask,
        ("updateAppConfigs_$name"): UpdateAppConfigsTask,
        ("deployWars_$name"): DeployWarsTask,
        ("startTomcat_$name"): StartTomcatTask,
        ("startWorker_$name"): StartWorkerTask,
        ("terminateNode_$name"): DeployToNodeTerminationTask,
    ].each { String taskName, Class taskType ->
        task "$taskName"(type: taskType) {
            node(n)
        }
    }
}

task startScheduler(type: StartSchedulerTask) {
    dryRun(testMode)
} 
```

不同部署步骤之间的内部依赖关系在任务本身中，例如：

```
class StartWorkerTask extends WorkerTask {

    @TaskAction
    void start() {
        println "Starting worker ${node}"
    }

    void declareDependencies() {
        dependsOn tomcatOnThisNodeHasBeenStarted()
    }

    String tomcatOnThisNodeHasBeenStarted() {
        "startTomcat_${node.name}"
    }
} 
```

拓扑声明如下：

```
environments {
    prod {
        nodes {
            (1..2).each { int i ->
                "w${i}_prod" {
                    host = "prod-n$i"
                    userName = "xxxxx"
                    password = "xxxxx"
                    loadBalancer = 'lb_prod'
                    frontendJkManagerUrl = 'http://web01/jkmanager'
                }
            }

            scheduler {
                name = "w1_prod"
            }
        }
    }
    rc {
    //rc topology here
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-29T01:21:11.293

这是因为您从 @TaskAction 方法内部声明了依赖项。@TaskAction 仅在依赖关系图形成后运行。

您可以`DoFirst()`在 @TaskActions 方法中滥用来调用所有依赖项，但这不会出现在依赖关系图中。

# php - 查询未加载 get_post_meta 数据

> ID：14077530
> 
> 赞同：0
> 
> 时间：2012-12-29T00:30:37.050
> 
> 标签：php, wordpress, function, post, meta

下面的函数用于加载我的自定义帖子类型帖子。问题是它没有加载 get_post_meta 数据。我的functions.php文件中有这个。我是否需要在 get_post_meta 中添加一些东西，因为它在函数文件中？

```
function get_latest_post(){ 
global $wpdb; 

$num=$_POST['numposts'];
$id = $_POST['id'];
$id = split('page',$id);
$id = str_replace('/','',$id[1]);
if($id!=0)
{
$offst = $id*$num-$num;
}else $offst=0;
$wp_query = new WP_Query();  $wp_query->query('post_type=video_posts&orderby=date&posts_per_page='.$num.'&offset='.$offst); 
if($wp_query->have_posts()) : $i = 1; while ($wp_query->have_posts()) : $wp_query->the_post();?>
<?php $embeds = get_post_meta($post->ID, 'rm_video_embed_code');  ?>
<?php $thumbnail_id = get_the_post_thumbnail($post->ID);
preg_match ('/src="(.*)" class/',$thumbnail_id,$link);  
if(!empty($thumbnail_id)) {
$image_path =  thumbGen($link[1],190,0,"crop=1&halign=center&valign=center&return=1");
$image_all = get_bloginfo('url').$image_path;
$my_image = array_values(getimagesize($image_all));
list($width, $height, $type, $attr) = $my_image;
}
?>
<div class="pop_<?php echo $i; ?>" style="display:none;"><div class="bClose"></div>
<?php foreach($embeds as $embed) { echo $embed; }?>
</div>

<?php if(has_post_thumbnail()) : ?>
<li><a href="javascript:void(0);" class="video_popup_<?php echo $i; ?>" title="<?php the_title(); ?>">
<div class="video_title"><?php the_title(); ?></div>
<div class="video_description"><?php the_content(); ?></div>
<div><img src="<?php echo $image_path; ?>" alt="<?php the_title(); ?>" title="<?php the_title(); ?>" width="<?php echo $width; ?>" height="<?php echo $height; ?>" /></div>
<div class="clear"></div>
</a></li>    
<?php endif; ?>   
<?php $i++; endwhile; ?>
<?php endif; //wp_reset_query();     
if((1==1)===FALSE){ 
echo "Oops! System error!"; 
}
else { 
}
die();
}
add_action('wp_ajax_get_latest_post', 'get_latest_post');
add_action('wp_ajax_nopriv_get_latest_post', 'get_latest_post'); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T03:02:03.297

将此添加到函数中`global $post;`

# regex - 在coffeescript正则表达式中应该如何转义双引号？

> ID：14077532
> 
> 赞同：2
> 
> 时间：2012-12-29T00:31:07.330
> 
> 标签：regex, coffeescript, jquery-chaining

我有以下咖啡脚本代码行（dCnt 和 sDesc 都是 jQuery 对象），它在移动其位置时对 HTML 块进行了一些基本的清理：

```
dCnt.append(sDesc.html().replace( /<div/gi, '<p' ).replace( /<\/div>/gi, '</p>' ).replace /\sstyle="text-align: center;"/gi, '') 
```

这将输出以下 JavaScript：

```
dCnt.append(sDesc.html().replace(/<div/gi, '<p').replace(/<\/div>/gi, '</p>').replace(/\sstyle="text-align: center;"/gi, '')); 
```

前两个替换没有问题，但第三个需要一些工作才能提出咖啡脚本编译器可以处理的东西，结果对我来说过于局限和脆弱。

到目前为止，我发现：

1）如果我在最后的替换周围有括号 ()，那么 coffeescript 将双引号解释为一个字符串并感到困惑（它最终将一个正斜杠解释为一个除法）。

2）如果我删除了停止 MATH 错误的括号，那么正则表达式中的任何空格都会使编译器感到困惑 - 上面代码的输出带有空格而不是 \s 是（注意最后的可怕破括号代替）：

```
dCnt.append(sDesc.html().replace(/<div/gi, '<p').replace(/<\/div>/gi, '</p>').replace / (style = "text-align: center;" / gi), ''); 
```

如果替换不在括号中（即从代码中删除 dCnt.append() 并在单独的行上处理），则正则表达式中的空格将导致编译器抛出 Unexpected ','错误（这至少比生成垃圾 JavaScript 更可取......）。

由于需要删除括号（coffeescript 中的可选，尽管我发现将它们排除在外会严重降低代码的可读性），因此无法链接受此问题影响的两个函数调用。

任何人都可以想出一个不那么脆弱的解决方案来解决这个问题，仍然可以完整地使用 jQuery 链接吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:28:53.850

问题似乎归结为这些：

```
s.replace(/ /, '')
s.replace / /, '' 
```

被 CoffeeScript 编译器视为模棱两可，它错误地解决了歧义。正确的？问题的根源是斜杠后面的空格，而不是双引号。CS看到这个：

```
/ / 
```

作为尝试的除法而不是正则表达式文字。然而，这：

```
/\ / 
```

被解释为匹配单个空格的正则表达式。

我可以想到几个解决方法：

1.  使用`\s`甚至`[ \t]`. 我认为这些比仅仅寻找一个空格更正确（当然，抛开整个“用正则表达式处理 HTML”问题）。
2.  逃脱领先的空间：`/\ style.../`。实际上，我更喜欢正则表达式中的原始空格，因为它使它们更容易计数。

因此，实际上并没有太多答案（对不起），但也许可以确认您没有失去理智。

# ocaml - OCaml 中具有多个参数的函数

> ID：14077535
> 
> 赞同：3
> 
> 时间：2012-12-29T00:31:38.570
> 
> 标签：ocaml

我正在尝试编写一个函数来将一个可变`int`的值增加指定的数量。

```
let increase var:int ref amount = (var := !var+amount;var);; 
```

这是我想出的，但它会产生错误。正确的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T00:38:34.733

您唯一的问题是`var`. 您需要使用括号：

```
# let increase (var: int ref) amount = var := !var + amount; var;;
val increase : int ref -> int -> int ref = <fun> 
```

对于它的价值，类型规范是可选的。OCaml 将推断类型。

（我个人会考虑使用函数 return `unit`，这将使其类似于内置函数`incr`。）

# php - 无法将内容添加到数据库

> ID：14077539
> 
> 赞同：0
> 
> 时间：2012-12-29T00:32:18.247
> 
> 标签：php, mysql

这是基于 O'Reilly 的《Learning PHP, MySQL, JavaScript and CSS, Second Edition》一书中的一个例子。

我无法通过界面将任何记录添加到数据库中。每当我尝试时，无论我输入什么，我都会得到完全相同的错误：

```
column count doesn't match value count at row 1 
```

如果我连续两次点击添加记录按钮而不退出页面，程序开始从数据库中**删除**记录。

```
<?php // sqltest.php

// Note: This example is different to the one in the book. It has
//       been amended to work correctly when deleting entries.

require_once 'login.php';
$db_server = mysql_connect($db_hostname, $db_username, $db_password);

if (!$db_server) die("Unable to connect to MySQL: " . mysql_error());

mysql_select_db($db_database, $db_server)
    or die("Unable to select database: " . mysql_error());

if (isset($_POST['delete']) && isset($_POST['isbn']))
{
    $isbn  = get_post('isbn');
    $query = "DELETE FROM classics WHERE isbn='$isbn'";

    if (!mysql_query($query, $db_server))   
        echo "DELETE failed: $query<br />" .
        mysql_error() . "<br /><br />";
}

if (isset($_POST['author']) &&
    isset($_POST['title']) &&
    isset($_POST['category']) &&
    isset($_POST['year']) &&
    isset($_POST['isbn']))
{
    $author   = get_post('author');
    $title    = get_post('title');
    $category = get_post('category');
    $year     = get_post('year');
    $isbn     = get_post('isbn');

    $query = "INSERT INTO classics VALUES" .
        "('$author', '$title', '$category', '$year', '$isbn')";

    if (!mysql_query($query, $db_server))
        echo "INSERT failed: $query<br />" .
        mysql_error() . "<br /><br />";
}

echo <<<_END
<form action="sqltest.php" method="post"><pre>
  Author <input type="text" name="author" />
   Title <input type="text" name="title" />
Category <input type="text" name="category" />
    Year <input type="text" name="year" />
    ISBN <input type="text" name="isbn" />
         <input type="submit" value="ADD RECORD" />
</pre></form>
_END;

$query = "SELECT * FROM classics";
$result = mysql_query($query);

if (!$result) die ("Database access failed: " . mysql_error());
$rows = mysql_num_rows($result);

for ($j = 0 ; $j < $rows ; ++$j)
{
    $row = mysql_fetch_row($result);
    echo <<<_END
<pre>
  Author $row[0]
   Title $row[1]
Category $row[2]
    Year $row[3]
    ISBN $row[4]
</pre>
<form action="sqltest.php" method="post">
<input type="hidden" name="delete" value="yes" />
<input type="hidden" name="isbn" value="$row[4]" />
<input type="submit" value="DELETE RECORD" /></form>
_END;
}

mysql_close($db_server);

function get_post($var)
{
    return mysql_real_escape_string($_POST[$var]);
}
?> 
```

这是sql文件

```
-- MySQL dump 10.13  Distrib 5.1.50, for Win32 (ia32)
--
-- Host: localhost    Database: 
-- ------------------------------------------------------
-- Server version   5.1.50-community

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Current Database: `publications`
--

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `publications` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `publications`;

--
-- Table structure for table `accounts`
--

DROP TABLE IF EXISTS `accounts`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `accounts` (
  `number` int(11) NOT NULL DEFAULT '0',
  `balance` float DEFAULT NULL,
  PRIMARY KEY (`number`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `accounts`
--

LOCK TABLES `accounts` WRITE;
/*!40000 ALTER TABLE `accounts` DISABLE KEYS */;
INSERT INTO `accounts` VALUES (12345,1050.61),(67890,140);
/*!40000 ALTER TABLE `accounts` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `classics`
--

DROP TABLE IF EXISTS `classics`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `classics` (
  `author` varchar(128) DEFAULT NULL,
  `title` varchar(128) DEFAULT NULL,
  `category` varchar(16) DEFAULT NULL,
  `year` smallint(6) DEFAULT NULL,
  `isbn` char(13) NOT NULL DEFAULT '',
  PRIMARY KEY (`isbn`),
  KEY `author` (`author`(20)),
  KEY `title` (`title`(20)),
  KEY `category` (`category`(4)),
  KEY `year` (`year`),
  FULLTEXT KEY `author_2` (`author`,`title`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `classics`
--

LOCK TABLES `classics` WRITE;
/*!40000 ALTER TABLE `classics` DISABLE KEYS */;
INSERT INTO `classics` VALUES ('Mark Twain (Samuel Langhorne Clemens)','The Adventures of Tom Sawyer','Classic Fiction',1876,'9781598184891'),('Jane Austen','Pride and Prejudice','Classic Fiction',1811,'9780582506206'),('Charles Darwin','The Origin of the Species','Classic Fiction',1856,'9780517123201'),('Charles Dickens','The Old Curiosity Shop','Classic Fiction',1841,'9780099533474'),('William Shakespear','Romeo and Juliet','Play',1594,'9780192814968');
/*!40000 ALTER TABLE `classics` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `classics52`
--

DROP TABLE IF EXISTS `classics52`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `classics52` (
  `author` varchar(128) DEFAULT NULL,
  `title` varchar(128) DEFAULT NULL,
  `category` varchar(16) DEFAULT NULL,
  `year` smallint(6) DEFAULT NULL,
  `isbn` char(13) NOT NULL DEFAULT '',
  PRIMARY KEY (`isbn`),
  KEY `author` (`author`(20)),
  KEY `title` (`title`(20)),
  KEY `category` (`category`(4)),
  KEY `year` (`year`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `classics52`
--

LOCK TABLES `classics52` WRITE;
/*!40000 ALTER TABLE `classics52` DISABLE KEYS */;
/*!40000 ALTER TABLE `classics52` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `customers`
--

DROP TABLE IF EXISTS `customers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `customers` (
  `name` varchar(128) DEFAULT NULL,
  `isbn` varchar(128) NOT NULL DEFAULT '',
  PRIMARY KEY (`isbn`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `customers`
--

LOCK TABLES `customers` WRITE;
/*!40000 ALTER TABLE `customers` DISABLE KEYS */;
INSERT INTO `customers` VALUES ('Joe Bloggs','9780099533474'),('Mary Smith','9780582506206'),('Jack Wilson','9780517123201');
/*!40000 ALTER TABLE `customers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Current Database: `test`
--

CREATE DATABASE /*!32312 IF NOT EXISTS*/ `test` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `test`;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2012-12-26 18:43:24 
```

我的 SQL 数据库本身是否搞砸了？如果是这样的话，它怎么会改变一个独立程序的功能呢？如果不是，是什么导致我的错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:36:09.973

根据您的经典表检查您的插入：`INSERT INTO classics VALUES" . "('$author', '$title', '$category', '$year', '$isbn')`

如果您没有在插入语句中指定列，那么您的值必须与表中的列数相匹配。

如果您将列命名为类似于变量，这可能会起作用。 `INSERT INTO classics (author, title, category, year, isbn) VALUES " . "('$author', '$title', '$category', '$year', '$isbn')`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:38:05.077

该错误表示列数不正确。检查您的数据库中是否真的有 5 列（作者、标题、类别、年份、isbn）。如果没有，您可以更改查询并指定列：

```
 "INSERT INTO `classics` (`author`, `title`, `category`, `year`, `isbn`) VALUES " .
    "('$author', '$title', '$category', '$year', '$isbn')" 
```

对于删除问题，我没有任何想法。

# api - ClojureScript API 文档

> ID：14077542
> 
> 赞同：3
> 
> 时间：2012-12-29T00:33:04.603
> 
> 标签：api, documentation, clojurescript

我[学会](https://stackoverflow.com/questions/14067266/what-versions-of-clojurescript-and-closure-am-i-using-with-lein-cljsbuild/14076585#14076585)了如何通过 lein-cljsbuild 找出我使用的 ClojureScript 版本。在哪里可以找到 cljs.core 的 API 文档？

我不得不从一篇博文中了解 js-obj。

我[可以查看源代码](https://github.com/clojure/clojurescript/blob/r1552/src/cljs/cljs/core.cljs)，但它是一个大文件，而且主要是 clojure.core 的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-01-14T12:12:53.210

不完全是完整的文档，但是这个备忘单在开始时真的很有帮助（而且总比没有好！）：

[http://appletree.or.kr/quick_reference_cards/Others/ClojureScript%20Cheat%20Sheet.pdf](http://appletree.or.kr/quick_reference_cards/Others/ClojureScript%20Cheat%20Sheet.pdf)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-01-03T01:00:03.357

ClojureScript 肯定存在文档问题。实际上，查看源代码并不算太糟糕。它很冗长，但一旦你习惯了它就不会太糟糕。

也就是说，没有人提供明确的 ClojureScript API 参考的原因之一是核心函数都反映了 Clojure，因此这将是相当多的冗余工作。如果一个函数在两种语言中都存在并且工作方式不同，那么它是非常不寻常的并且很可能是一个错误。

在实践中，我发现使用 Clojure API 文档（或类似 clojuredocs.org 之类的东西）加上非常偶然的对源代码的尝试对于我 99% 的 cljs 工作都非常有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-07-13T03:44:24.287

ClojureScript API 文档正在这里处理：
[http ://cljs.github.io/api](http://cljs.github.io/api)

# android - 动画后移动Android View点击边界

> ID：14077549
> 
> 赞同：3
> 
> 时间：2012-12-29T00:33:45.030
> 
> 标签：android, user-interface

我在 RelativeLayout 中有两个视图，它们都填满了屏幕，因此视图 B 位于视图 A 的顶部。我还定义了一个动画，它可以将视图 B 部分移出屏幕以显示下面的视图 A。动画效果很好，但是我遇到了视图边界不随视图移动的经典问题，所以我用来触发动画的按钮（位于视图 B 上）只能从其原始位置单击，不无论视图 B 位于何处。我遇到的问题是，在动画结束后，当我设置布局参数时，它会导致再次重绘视图 B，从动画结束的位置翻译。

作为一个具体的例子，视图 B 的左边缘最初位于 x = 0，按钮位于 x = 450。当按下按钮时，动画将视图移动到 x = -400。这可以正常工作 - 视图部分位于屏幕左侧，并且按钮现在位于 x = 50，因此它仍在屏幕上。虽然按钮的点击区域仍然在 x = 450。所以现在我在视图 B 上设置布局参数：

```
RelativeLayout.LayoutParams lp = (RelativeLayout.LayoutParams) viewB.getLayoutParams();
lp.rightMargin = 400;
viewB.setLayoutParams(lp); 
```

设置新参数后，视图在右侧获得 400px 的填充，将整个视图移动到 x = -800。按钮的可点击区域现在正确地位于 x = 50，所以看起来我可以让它看起来正确或行为正确。知道我做错了什么吗？这是动画的设置方式。

```
Animation anim = null;
anim = new TranslateAnimation(0, -400, 0, 0);
anim.setAnimationListener(this);
anim.setDuration(duration);
viewB.startAnimation(anim); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-01-06T04:08:47.713

我可以通过在动画之前或之后更改布局参数来使事情正常工作，视情况而定：

```
private int marginOffsets;

public void triggerAnimation(boolean show, offset)
{
    int curX = 0;
    int newX = 0;
    Animation anim = null;

    this.showingPanel = show;
    if(show)
    {
        curX = 0 - offset;

        android.widget.RelativeLayout.LayoutParams lp = new android.widget.RelativeLayout.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,  ViewGroup.LayoutParams.FILL_PARENT);
        lp.rightMargin = 0;
        rootPanel.setLayoutParams(lp);
    }
    else
    {
        newX = 0 - offset;
    }

    marginOffsets = newX < 0 ? 0 - offset : offset;

    anim = new TranslateAnimation(curX, newX, 0, 0);
    anim.setAnimationListener(this);
    anim.setDuration(duration);
    startAnimation(anim);        
}

public void onAnimationEnd(Animation anim)
{
    //This prevents flicker when the view is moving onscreen.
    clearAnimation();

    if(!showingPanel)
    {
        //Move the margin to move the actual bounds so click events still work.
        RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,  ViewGroup.LayoutParams.FILL_PARENT);
        lp.rightMargin = 0 - marginOffsets;
        rootPanel.setLayoutParams(lp);
    }    
} 
```

# jakarta-ee - 无法更改 @javax.ws.rs.ApplicationPath("webresources") 中指定的 REST 路径

> ID：14077553
> 
> 赞同：1
> 
> 时间：2012-12-29T00:34:17.447
> 
> 标签：jakarta-ee, netbeans, jax-rs

我正在使用 Netbeans，并且我有一个 REST 服务 -

```
@javax.ws.rs.ApplicationPath("webresources")
public class ApplicationConfig extends javax.ws.rs.core.Application {
} 
```

如果我将“webresources”字符串更改为其他内容，然后重建项目，该字符串会自动重置回“webresources”。

那么如何更改路径以使其不会重置？

# url - 在 iOS 邮件和 iOS Safari 之间更改的 URL（在 iPhone 上）

> ID：14077554
> 
> 赞同：1
> 
> 时间：2012-12-29T00:35:09.303
> 
> 标签：url, ios6, mobile-safari, email-client

单击“utm_source=eCom”作为 URL 一部分的 Mail 应用程序中的电子邮件链接会出现 Safari URL，其中“=eC”被替换为“ì”（小写 i，带有向左的重音符号）。最终结果：“utm_sourceìom”

在同一个例子中，“utm_content=Face”被替换为“utm_contentúce”。

同一封电子邮件中具有相同内容的其他链接没有这样做。有什么想法可能导致这种情况吗？

# android - 用于 Spinner Android 的资源 NotFoundException

> ID：14077556
> 
> 赞同：1
> 
> 时间：2012-12-29T00:35:21.647
> 
> 标签：android, android-widget, spinner, android-arrayadapter, android-xml

我有一个有按钮的活动。单击按钮时，它应该打开一个简单的弹出窗口，其中包含一个 TextView 和一个 Spinner。我的弹出窗口打开得很好。我的问题是当我获取对 Spinner 的引用时，它给了我一个 Resources$NotFoundException 并说资源 ID 无效。

我目前正在调用 popupView.findViewById(R.layout.popup_create_workout) 以尝试获取对微调器的引用。我还尝试获取对弹出窗口使用的父 XML 布局的引用并在其上调用 finViewById（例如 exampleView.findViewById(R.layout.example_popup_view)。我还尝试了普通的 ol'findViewById(R.layout.example_popup_view) （我没想到会起作用。但是，这两种技术都会在 View ID 上或当我在 Spinner 上调用 setAdapter() 时抛出 NullPointerExceptions。我尝试在 Eclipse 中清理项目，仔细检查以确保我正在使用正确的参考 ID、上下文等。

真正让我陷入循环的是，我能够从相同的 XML 布局中获取对 TextView 的引用并对其进行操作。我搜索了整个网站，发现了一些类似的问题，但没有一个是我所需要的。我还用谷歌搜索了我能想到的一切，但没有运气。

所以，我的问题是：当我尝试获取微调器的引用时，为什么会得到 Resources$NotFoundException ？我知道这可能很容易，但我似乎无法弄清楚。在此先感谢您的帮助！

这是与微调器有关的活动部分：

```
@Override
public void onClick(View v) {
    LayoutInflater inflater = (LayoutInflater) getBaseContext().getSystemService(LAYOUT_INFLATER_SERVICE);
    View popupView = inflater.inflate(R.layout.popup_add_goal, null);
    PopupWindow popupWindow = new PopupWindow(popupView);
    popupWindow.setWidth(240);
    popupWindow.setHeight(447);
    popupWindow.update();
    popupWindow.showAtLocation(v, Gravity.CENTER, 0, 0);

    ArrayList<String> list = new ArrayList<String>();
    list.add("Item 1");
    list.add("Item 2");
    list.add("Item 3");

    Spinner spinner = (Spinner) popupView.findViewById(R.id.goal_spinner);
    ArrayAdapter<ArrayList<String>> arrayAdapter = new ArrayAdapter<ArrayList<String>>(WorkoutActivity.context, R.id.list_content_white);
    arrayAdapter.add(list);
    spinner.setAdapter(arrayAdapter);
} 
```

});

和 XML 布局：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
android:layout_width="match_parent"
android:layout_height="match_parent"
android:orientation="vertical"
android:background="#CCff0000" >

<TextView
    android:id="@+id/textView1"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_gravity="center"
    android:text="Add goals"
    android:textColor="#ffffff"
    android:textSize="48sp" />

<LinearLayout android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical" >

    <TextView android:id="@+id/textView"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginTop="15dp"
        android:text="Search for a goal"
        android:textColor="#ffffff"
        android:textSize="40sp"
        android:gravity="center" />

    <Spinner android:id="@+id/goal_spinner"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="#ffffff" />

</LinearLayout> 
```

最后，堆栈跟踪：

```
12-29 03:51:14.832: E/AndroidRuntime(5216): FATAL EXCEPTION: main
12-29 03:51:14.832: E/AndroidRuntime(5216): android.content.res.Resources$NotFoundException: Resource ID #0x7f09001a type #0x12 is not valid
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.content.res.Resources.loadXmlResourceParser(Resources.java:2144)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.content.res.Resources.getLayout(Resources.java:853)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.LayoutInflater.inflate(LayoutInflater.java:394)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.ArrayAdapter.createViewFromResource(ArrayAdapter.java:371)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.ArrayAdapter.getView(ArrayAdapter.java:362)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.AbsSpinner.onMeasure(AbsSpinner.java:193)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.Spinner.onMeasure(Spinner.java:439)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.View.measure(View.java:15513)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:4827)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.measureChildBeforeLayout(LinearLayout.java:1404)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.measureVertical(LinearLayout.java:695)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.onMeasure(LinearLayout.java:588)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.View.measure(View.java:15513)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewGroup.measureChildWithMargins(ViewGroup.java:4827)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.measureChildBeforeLayout(LinearLayout.java:1404)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.measureVertical(LinearLayout.java:695)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.widget.LinearLayout.onMeasure(LinearLayout.java:588)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.View.measure(View.java:15513)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewRootImpl.performMeasure(ViewRootImpl.java:1874)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewRootImpl.measureHierarchy(ViewRootImpl.java:1089)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:1265)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:989)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:4351)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.Choreographer$CallbackRecord.run(Choreographer.java:749)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.Choreographer.doCallbacks(Choreographer.java:562)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.Choreographer.doFrame(Choreographer.java:532)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:735)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.os.Handler.handleCallback(Handler.java:725)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.os.Handler.dispatchMessage(Handler.java:92)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.os.Looper.loop(Looper.java:137)
12-29 03:51:14.832: E/AndroidRuntime(5216): at android.app.ActivityThread.main(ActivityThread.java:5039)
12-29 03:51:14.832: E/AndroidRuntime(5216): at java.lang.reflect.Method.invokeNative(Native Method)
12-29 03:51:14.832: E/AndroidRuntime(5216): at java.lang.reflect.Method.invoke(Method.java:511)
12-29 03:51:14.832: E/AndroidRuntime(5216): at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:793)
12-29 03:51:14.832: E/AndroidRuntime(5216): at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:560)
12-29 03:51:14.832: E/AndroidRuntime(5216): at dalvik.system.NativeStart.main(Native Method) 
```

这是包含 list_content_white 的布局：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
xmlns:android="http://schemas.android.com/apk/res/android"
android:gravity="center_vertical"
android:layout_width="fill_parent"
android:layout_height="fill_parent" >

<TextView
android:id="@+id/list_content_white"
android:textColor="#ffffff"
android:textSize="30sp"
android:textStyle="bold"
android:layout_margin="8dp"
android:layout_width="fill_parent"
android:layout_height="wrap_content" />

</LinearLayout> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:38:51.463

我不确定是什么导致了异常，但可能是这样。改变：

```
ArrayAdapter<ArrayList<String>> arrayAdapter = new ArrayAdapter<ArrayList<String>>(WorkoutActivity.context, R.id.list_content_white);
arrayAdapter.add(list); 
```

到：

```
ArrayAdapter<String> arrayAdapter = 
    new ArrayAdapter<String>(WorkoutActivity.this, R.id.list_content_white, list);
//                        This is wrong, see below  ^^^^ 
```

ArrayAdapter 已经需要一个 ArrayList，您只需提供 ArrayList 的子类型。

* * *

**根本问题**
将布局文件命名为与视图 id 相同的名称有一点危险……你已经找到了。您不想`R.layout.list_content_white` *在* `R.id.list_content_white`初始化 ArrayAdapter 时使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T04:44:25.133

把它放在 onCreate() 的两行中

```
LayoutInflater inflater = (LayoutInflater) getBaseContext().getSystemService(LAYOUT_INFLATER_SERVICE);
View popupView = inflater.inflate(R.layout.popup_add_goal, null); 
```

# actionscript-3 - 强制刷新影片剪辑？

> ID：14077558
> 
> 赞同：0
> 
> 时间：2012-12-29T00:35:45.000
> 
> 标签：actionscript-3, flash

我有一个非常简单的代码片段；

```
loadingMc.visible = true;
trace("ok");
// send photo to server
loadingMc.visible = false; 
```

发送照片需要 3-5 秒，但影片剪辑仅在过程的最后一秒可见。我可以在流程开始时在输出中看到“ok”消息。所以我认为问题不是重绘影片剪辑。是否有任何选项可以在流程开始之前强制重绘？

更新：发送到服务器部分；

```
upload.addEventListener(MouseEvent.CLICK, function(evt:MouseEvent):void{
    loadingText.visible = true;
    trace("ok");
    var bmd:BitmapData = new BitmapData(1024,768,true,0);
    bmd.draw(imageArea);
    savePicToServer(bmd);
});

function savePicToServer(bmd:BitmapData):void
{   
    var jpgEncoder:JPGEncoder = new JPGEncoder(85);
    var jpgStream:ByteArray = jpgEncoder.encode(bmd);

    var loader:URLLoader = new URLLoader();
    configureListeners(loader);
    var header:URLRequestHeader = new URLRequestHeader("Content-type", "application/octet-stream");
    var request:URLRequest = new URLRequest("http://localhost/test/upload.php?key=prvkey");
    request.requestHeaders.push(header);
    request.method = URLRequestMethod.POST;
    request.data = jpgStream;
    loader.load(request);
} 
```

在 COMPLETE 事件中；

```
loadingText.visible = false; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:21:23.717

**编辑**

仅仅通过阅读您的代码，我不明白为什么这不应该工作 - 但 FP 有时会做一些奇怪的事情。

在类似的情况下，我曾经`setTimeout()`强制播放器延迟后续动作并允许屏幕刷新：

```
upload.addEventListener(MouseEvent.CLICK, function(evt:MouseEvent):void{
    loadingText.visible = true;
    trace("ok");
    setTimeout( doSave, 10 );
});

private function doSave() : void {
    var bmd:BitmapData = new BitmapData(1024,768,true,0);
    bmd.draw(imageArea);
    savePicToServer(bmd);
} 
```

如果这仍然不起作用，也许更长的超时时间可以解决问题 - 但 10 毫秒通常应该足以刷新屏幕。

**编辑**

另一种方法是添加和删除一个`ENTER_FRAME`侦听器以确保框架确实被刷新：

```
upload.addEventListener(MouseEvent.CLICK, function(evt:MouseEvent):void{
    loadingText.visible = true;
    trace("ok");
    addEventListener( Event.ENTER_FRAME, onNextFrame );
});

private function onNextFrame( ev:Event ) : void {
    removeEventListener( Event.ENTER_FRAME, onNextFrame );
    doSave();
}

private function doSave() : void {
    var bmd:BitmapData = new BitmapData(1024,768,true,0);
    bmd.draw(imageArea);
    savePicToServer(bmd);
} 
```

# node.js - dotcloud 上的 nodejs/mongoose 身份验证问题

> ID：14077560
> 
> 赞同：0
> 
> 时间：2012-12-29T00:36:17.670
> 
> 标签：node.js, mongoose, dotcloud

我正在使用带有 mongoose 的 node.js，它无法连接到因身份验证问题而失败的数据库。

使用连接环境变量 uri: :mongodb://root: ***** **** @[appname]-[user]-db-0.azva.dotcloud.net:4518 结果是： { [MongoError: auth failed] name : 'MongoError', errmsg: '认证失败', ok: 0 }

尝试根据 DOTCLOUD_DB_MONGODB_HOST 等环境变量建立自己的 conn URI，URI 是正确的，传递给 env 变量但问题仍然是基于 DB 日志：db.0 Sat Dec 29 00:31:08 [ conn66] auth: 找不到用户 root, admin.system.users

谁能帮我解决这个丢失的用户根？

先感谢您！！！

更新：我通过“使用管理员”登录到 mongodb 节点上的 mongodb 控制台，也无法使用该用户名和密码进行身份验证。也不创建新用户和密码。:(

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T12:47:20.547

解决。dotcloud 系统以某种方式严重配置了数据库实例。创建一个新的应用程序，一切正常。

# jquery - 来自 MySQL 数据库的谷歌地图坐标，优化的正确方法？

> ID：14077566
> 
> 赞同：0
> 
> 时间：2012-12-29T00:37:38.277
> 
> 标签：jquery, mysql, optimization, google-maps-api-3

是否有从 mysql 获取 Google Maps 坐标的正确方法？

我正在做的当前方式是我有 jQuery 脚本来从填充元素中获取坐标，我使用 MySQL 来填充坐标列表。

```
// jQuery script to get the coordinates

var coordArray = [];

$(".marker").each(function(index,div)
{

 var coords = $(this).data("coords").split(",");
 coordArray.push([coords[0],coords[1]]);

});

//while loop in PHP and I have displayed the coordinates within a <div> element:

while($row = $sql->fetch(PDO::FETCH_ASSOC))
{
 <div class="marker" data-coords="<?php echo $row['lat'].",".$row['lng'];?>">stuff</div>
} 
```

有更好的方法吗？或者这也可以吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:29:40.660

在您的 php 中，您将在`while`循环中从 DB 创建一个值数组。然后使用这个数组输出到一个javascript变量`json_encode`

```
$arr=array();
while($row = $sql->fetch(PDO::FETCH_ASSOC)){
   $arr[]=array( $row['lat'], $row['lng']);
}

echo `<script>var markerData='. json_encode( $arr).';</script>'; 
```

这将在您将循环创建标记的页面中创建一个 JavaScript 数组：

```
<script>
var markerData=[ [100,40], [99,37]/* etc*/];
</script> 
```

您还可以根据需要使用 AJAX 检索 JSOn 数据

# java - 如何为可以识别源的 JTextField 创建适当的事件侦听器？

> ID：14077572
> 
> 赞同：1
> 
> 时间：2012-12-29T00:38:14.497
> 
> 标签：java, swing, listener

每当用户点击不同的组件时，我需要监听器触发，而不仅仅是在按下回车键时。我还需要识别源，因为我有数百个 JTextField，而我必须识别它们的唯一方法是通过数组索引。

我可以从 ActionListener 获取源，但 ActionListener 仅在用户按下回车键时触发。

我可以将 DocumentListener 附加到 JTextField 的关联文档，但似乎没有办法获取对 JTextField 本身的引用。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:47:14.750

> 我有数百个 JTextField，我必须识别它们的唯一方法是通过数组索引。

使用[`JTable`](http://docs.oracle.com/javase/tutorial/uiswing/components/table.html)而不是数百个[`JTextField's`](http://docs.oracle.com/javase/tutorial/uiswing/components/textfield.html)

> 我可以从 ActionListener 获取源，但 ActionListener 仅在用户按下回车键时触发。

[`ActionListener`](http://docs.oracle.com/javase/tutorial/uiswing/events/actionlistener.html)仅在`ENTER key`被按下时触发，并且[`JTextField`for`JFormattedTextField`和`JPasswordField`](http://docs.oracle.com/javase/tutorial/uiswing/components/text.html)

> 可以将 DocumentListener 附加到 JTextField 的关联文档，但似乎没有办法获取对 JTextField 本身的引用。

从你们每个人[`Listeners`](http://docs.oracle.com/javase/tutorial/uiswing/events/eventsandcomponents.html)都可以确定哪个从[`JComponents`](http://docs.oracle.com/javase/tutorial/uiswing/components/index.html)触发此事件

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:47:55.873

在 Oracle 对[How to Write a Document Listener](http://docs.oracle.com/javase/tutorial/uiswing/events/documentlistener.html)的解释中，您似乎可以在 Document 上放置一个或多个属性。

这是解释中的两行代码。

```
textField.getDocument().addDocumentListener(new MyDocumentListener());
textField.getDocument().putProperty("name", "Text Field"); 
```

好吧，您可以将第二行更改为以下内容：

```
textField.getDocument().putProperty("index", Integer.toString(index)); 
```

稍后在 Document Listener 代码中，您将使用此方法来获取属性。

```
document.getProperty("index"); 
```

# php - 会话参数

> ID：14077582
> 
> 赞同：-1
> 
> 时间：2012-12-29T00:40:24.860
> 
> 标签：php, session, redirect, session-variables

我做了这个代码：

文件索引.php：

```
 <?php
        if (isset($_POST['valider']))
            { if (!isset($_SESSION)) { session_start(); }
                   require("function.php");
                        $email                   = mysql_escape_string($_POST['email']); 
                        $password                    = mysql_escape_string($_POST['password']); 
                        if(!VerifierAdresseMail($email)){?>
                        <script>alert('invalid mail');</script>
    <?php
                        }
                        else{
                        if(!authentification($email,$password))
                        {?>
                        <script>alert('logging failed');</script>
                        <?php
                        }
                        else{
                        header('Location: choice.php'); 
                        }}
                        }
        ?> 
```

在function.php中：

```
<?php
function VerifierAdresseMail($adresse)  
{  
   $Syntaxe='#^[\w.-]+@[\w.-]+\.[a-zA-Z]{2,6}$#';  
   if(preg_match($Syntaxe,$adresse))  
      return true;  
   else  
     return false;  
}
function statistics($id){
$HOST_DB ="localhost";
                $NAME_DB="makempf3_captcha";
                $USER_DB ="root";
                $PWD_DB="";

                $connect = mysql_connect($HOST_DB,$USER_DB,$PWD_DB);
                $db=mysql_select_db($NAME_DB);
?><script>alert(<?php echo $cle ?>);</script><?php              
                $Log_query=mysql_query(
                    "   
                        SELECT * 
                        FROM  tbl_captcha
                        WHERE user_id ='$id'

                        ") or die(mysql_error());
$_SESSION['success'] =0;
$_SESSION['fail'] =0;
                      if ($Log_query == true && mysql_num_rows($Log_query) >0) {
?><script>alert('heni');</script><?php
                               while ($Res_user = mysql_fetch_array($Log_query) ) {
                                $_SESSION['success'] += $Res_user['success'];
                                $_SESSION['fail'] += $Res_user['fail'];

                            }
}

}
function authentification($mail,$pwd_U){

                 $HOST_DB ="localhost";
                $NAME_DB="makempf3_captcha";
                $USER_DB ="root";
                $PWD_DB="";

                $connect = mysql_connect($HOST_DB,$USER_DB,$PWD_DB);
                $db=mysql_select_db($NAME_DB);          

                $Log_query=mysql_query(
                    "   
                        SELECT * 
                        FROM  tbl_user
                        WHERE email ='$mail'
                        AND   user_pass   ='$pwd_U'

                        ") or die(mysql_error());

                        if ($Log_query == true && mysql_num_rows($Log_query) >0) {
                            $Res = array();
                            while ($Res_user = mysql_fetch_array($Log_query) ) {
                               $_SESSION['mail'] = $mail;
                                $_SESSION['pwd'] = $pwd_U;
                                $_SESSION['id'] = $Res_user['id'];

                            }
                            return true;
                        }
                        else return false;

}

?> 
```

当我在choice.php 中验证$_SESSION['id'] 时，它为null，但在index.php（重定向之前）中它有一个值。我不明白为什么我丢失了这个会话变量

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T00:43:37.417

您的`isset()`检查是不够的，因为它只会在`$_SESSION`为 NULL 时执行，而且永远不会 - 它是一个空数组，并且它始终存在，甚至在您调用`session_start()`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:43:53.740

您必须始终运行`session_start();`才能使用会话，即使您只是阅读它们。此外，`$_SESSION`它是一个超全局的，所以它永远不会为空： http: [//php.net/manual/en/reserved.variables.session.php](http://php.net/manual/en/reserved.variables.session.php)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:07:09.937

您可以在没有 isset() 检查的情况下运行 session_start。从手册：

> session_start() 根据通过 GET 或 POST 请求或通过 cookie 传递的会话标识符创建会话或恢复当前会话。

不要忘记在choice.php 中运行session_start

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T01:07:47.523

您的 Index.php 应该是这样的。你永远不应该告诉用户他们错了登录的哪一部分.....只是它失败了。

```
<?php
session_start();
require("function.php");

if (isset($_POST['valider']))
    { 
        $email = mysql_escape_string($_POST['email']); 
        $password = mysql_escape_string($_POST['password']); 
        if(VerifierAdresseMail($email) && authentification($email,$password))
            {
                header('Location: choice.php');
            }
            else
               {
                   echo "Invalid Login";
               }
?> 
```

# django - 无法让 Django 外键工作

> ID：14077584
> 
> 赞同：0
> 
> 时间：2012-12-29T00:40:57.033
> 
> 标签：django, django-models

我是 Django 的新手，但似乎这个应该很容易。我正在使用 Django 1.5 beta2，但我认为它对于像这样简单的事情应该足够稳定。这是我在注册应用程序中的课程。

```
class Shift(models.Model):
    begin_date = models.DateTimeField()
    finish_date = models.DateTimeField(null=True)

    def __unicode__(self):
        return str(self.begin_date) + ' to ' + str(self.end_date)

class Transaction(models.Model):
    begin_date = models.DateTimeField()
    finish_date = models.DateTimeField(null=True)
    status = models.CharField(max_length=10, default='Started')
    shift = models.ForeignKey(Shift)

    def __unicode__(self):
        return str(self.begin_date) + ' to ' + self(self.end_date) 
```

但是当我尝试创建一个子事务时它失败了。

```
david@fink:~/orthosie$ python manage.py shell
Python 2.7.3 (default, Sep 26 2012, 21:53:58) 
[GCC 4.7.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
>>> from register.models import Shift, Transaction
>>> from django.utils import timezone
>>> s = Shift(begin_date=timezone.now())
>>> s.transaction_set.create(begin_date=timezone.now())
Traceback (most recent call last):
  File "<console>", line 1, in <module>
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/fields/related.py", line 529, in create

    return super(RelatedManager, self.db_manager(db)).create(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/manager.py", line 149, in create
    return self.get_query_set().create(**kwargs)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/query.py", line 394, in create
    obj.save(force_insert=True, using=self.db)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/base.py", line 537, in save
    force_update=force_update, update_fields=update_fields)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/base.py", line 632, in save_base
    result = manager._insert([self], fields=fields, return_id=update_pk, using=using, raw=raw)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/manager.py", line 215, in _insert
    return insert_query(self.model, objs, fields, **kwargs)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/query.py", line 1646, in insert_query

return query.get_compiler(using=using).execute_sql(return_id)
  File "/usr/local/lib/python2.7/dist-packages/django/db/models/sql/compiler.py", line 935, in execute_sql
    cursor.execute(sql, params)
  File "/usr/local/lib/python2.7/dist-packages/django/db/backends/util.py", line 41, in execute
    return self.cursor.execute(sql, params)
  File "/usr/local/lib/python2.7/dist-packages/django/db/backends/sqlite3/base.py", line 364, in execute
    six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])
  File "/usr/local/lib/python2.7/dist-packages/django/db/backends/sqlite3/base.py", line 362, in execute
    return Database.Cursor.execute(self, query, params)
IntegrityError: register_transaction.shift_id may not be NULL
>>> 
```

我已经使用 sqliteman 手动挖掘了 sqlite 数据库，可以看到表 register_transaction 实际上有一个 shift_id 列。

```
-- Describe REGISTER_TRANSACTION
CREATE TABLE "register_transaction" (
    "id" integer NOT NULL PRIMARY KEY,
    "begin_date" datetime NOT NULL,
    "finish_date" datetime,
    "status" varchar(10) NOT NULL,
    "shift_id" integer NOT NULL REFERENCES "register_shift" ("id")
) 
```

我觉得一定有一些我想念的小东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:45:44.543

`s`没有 id，因为它没有被保存。

在拨打电话`s.save()`之前先拨打电话，或者使用`Shift.objects.create`代替`Shift()`.

# jquery - jQuery - 单击时隐藏和显示元素

> ID：14077588
> 
> 赞同：1
> 
> 时间：2012-12-29T00:41:14.987
> 
> 标签：jquery, hide, show, if-statement

我想制作一个通常显示“联系我们”的底部栏，但是当单击该栏时，它将显示联系方式，再次单击会将栏变成再次说“联系我们”。我尝试了 toggle() ，但这让我陷入了“我们的联系人+”和详细信息都被隐藏的情况。

我想我需要一个 else 语句，但是我对 jQuery 的了解是乏善可陈的。

[http://jsfiddle.net/DzYTZ/2/](http://jsfiddle.net/DzYTZ/2/)（由于某种原因它不起作用）

有人可以帮忙吗？

## 谢谢

```
<div class="footer2"> 
    <a href="#" class="contactus">
        Contact Us
    </a>

    <div class="more">
        <a href="#">
            @twitterhandle
        </a>

        <a href="#">
            e-mail
        </a>
    </div>
</div> 
```

```
 .footer2
{
background-color: black;
margin-top: 1em;
padding-top: 1em;
padding-bottom: 1em;
text-align: center;
width: 100%;
}
    .footer2 .contactus
{
    font-family: 'Open Sans', sans-serif;
    font-weight: 400;
    color: #e3e3e3;
    text-decoration: none;
    display: inline;
}
    .footer2 .contactus:hover
{
    color: white;
}
    .footer2 .more
{
    margin-left: 1em;
    display: none;
    font-family: 'Open Sans', sans-serif;
    font-weight: 400;
    display: inline;
}
    .footer2 .more a
{
    margin-left: 2em;
    color: #e3e3e3;
    text-decoration: none;
}
    .footer2 .more a:hover
{
    color: white;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:50:12.460

[你可以用这个](http://jsfiddle.net/DzYTZ/5/)

```
$('.footer2').click(function() {
    var display=$('.footer2 .more').css('display') == 'inline' ? 'none' : 'inline'; 
    $('.footer2 .more').css('display', display);
}); 
```

还要`display:inline`从 中删除`footer2 .more{...}`以使其最初隐藏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:51:55.000

你已经使用`.footer .more`了我认为你的意思`.footer2 .more`。您还需要`.more`使用 javascript 进行隐藏，因为您不能将 css 属性`display`同时设置为`none`和`inline`。最后，我添加了一个声明来切换“联系我们”文本，但如果需要，您可以将其删除。

试试这个：

```
$(function() {
    $('.footer2 .more').hide();

    $('.footer2').click(function() {
        $('.footer2 .more').toggle();
        $('.footer2 .contactus').toggle();
    });

});​ 
```

示例：http: [//jsfiddle.net/grc4/mG5EY/](http://jsfiddle.net/grc4/mG5EY/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T00:54:59.643

我将尝试通过一个示例来回答您的问题，该示例仅在容器上切换 css 类以显示和隐藏包含的元素：

HTML：

```
<div class="container">
    <a class="toggle-details" href="#">Contact Us</a>
    <div class="details">Details</div>
</div> 
```

CSS：

```
.details-visible .toggle-details {
    display: none;
}
.details {
  display: none;   
}
.details-visible .details {
    display: block;
} 
```

Javascript：

```
$('.toggle-details, .details').on('click', function(e) {
    e.preventDefault();

    $('.container').toggleClass('details-visible');
});​ 
```

[小提琴](http://jsfiddle.net/PKHFH/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-12-29T00:59:20.757

这是完整的代码。一些主要的事情阻止了它的工作。您的切换选择器需要在两个类之间使用逗号。这会将切换应用于两个元素。您还指定了一个`.footer`确实存在的名为的类。最后，样式`.footer2 .more`已经`display`指定了两次。这就是为什么它在页面加载时显示的原因。在此处更新示例[http://jsfiddle.net/DzYTZ/7/](http://jsfiddle.net/DzYTZ/7/)

```
 .footer2
    {
        background-color: black;
        margin-top: 1em;
        padding-top: 1em;
        padding-bottom: 1em;
        text-align: center;
        width: 100%;
    }

        .footer2 .contactus
        {
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
            color: #e3e3e3;
            text-decoration: none;
            display: inline;
        }

            .footer2 .contactus:hover
            {
                color: white;
            }

        .footer2 .more
        {
            margin-left: 1em;
            display: none;
            font-family: 'Open Sans', sans-serif;
            font-weight: 400;
            color: #e3e3e3;
            text-decoration: none;
        }

            .footer2 .more a
            {
                margin-left: 2em;
                color: #e3e3e3;
                text-decoration: none;
            }

                .footer2 .more a:hover
                {
                    display: none;
                    font-family: 'Open Sans', sans-serif;
                    font-weight: 400;
                    color: white;
                    text-decoration: none;
                } 
```

--

```
<div class="footer2">
    <a href="#" class="contactus">Contact Us
    </a>
    <div class="more">
        <a href="#">TWITTER HANDLE
        </a>

        <a href="#">EMAIL
        </a>
    </div>
</div> 
```

--

```
 $(function () {

        $('.footer2').click(function () {

            $('.contactus, .more').toggle()
        });

    }); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-29T01:02:18.923

如果我理解正确，这就是你想要的[DEMO](http://jsfiddle.net/DzYTZ/6/)。
我拿了你的小提琴并做了一些改变。

```
 $('.contactus').click(function() {
        if($(".more").css("display") == "none"){
            $(".more").css("display","inline");
        }else{            
            $(".more").css("display","none");
        }
    }); 
```

当您单击“联系我们”时，它将隐藏`more`该类，如果它已经隐藏，那么它将使其可见。
我只是在使用小提琴时，但我认为您希望`more`默认情况下隐藏该类，因此您可以在上面的代码之前添加此行。
`$(".more").css("display","none");`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-05T12:01:26.310

**试试这个它的作品！**

```
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>
$(document).ready(function(){
    $("#hide").click(function(){
        $("p").hide();
    });
    $("#show").click(function(){
        $("p").show();
    });
});
</script>
</head>
<body>

<p>If you click on the "Hide" button, I will disappear.</p>

<button id="hide">Hide</button>
<button id="show">Show</button>

</body>
</html> 
```

# c# - EF 正在复制数据库中的列

> ID：14077589
> 
> 赞同：1
> 
> 时间：2012-12-29T00:41:17.910
> 
> 标签：c#, entity-framework

我在 EF 中有一个问题，它正在复制像“MenuPai_Id”和“MenuPai_Id1”这样的列，这里是类。

```
public class Menu :EntidadePadrao
{
    public int? MenuPai_Id { get; set; }

    public virtual Menu MenuPai { get; set; }
    public virtual ICollection<Menu> MenusFilhos { get; set; }
    public virtual ICollection<PerfilUsuarioMenu> PerfisUsuario { get; set; }
}

public class MenuMap : EntityTypeConfiguration<Menu>
{
    public MenuMap()
    {
        // Primary Key
        this.HasKey(t => t.Id);           
        this.ToTable("Menu");
        this.Property(t => t.MenuPai_Id).HasColumnName("MenuPai_Id");

        this.HasOptional(t => t.MenuPai)
            .WithMany(t => t.MenusFilhos)
            .HasForeignKey(d => d.MenuPai_Id);
    }
} 
```

这是为表生成的 sql。

```
CREATE TABLE [dbo].[Menus] (
[Id] [int] NOT NULL IDENTITY,
[Sequencia] [int] NOT NULL,   
[MenuPai_Id] [int],   
[MenuPai_Id1] [int],
CONSTRAINT [PK_dbo.Menus] PRIMARY KEY ([Id]))
ALTER TABLE [dbo].[Menus] ADD CONSTRAINT [FK_dbo.Menus_dbo.Menus_MenuPai_Id1]
FOREIGN KEY ([MenuPai_Id1]) REFERENCES [dbo].[Menus] ([Id]) 
```

我在项目中有其他类似的映射，它是自动生成的，并且工作正常。只是我手动添加的这个类，我找不到为什么不能以相同的方式工作。

我很感激任何帮助。

编辑：我只是忘记了这个：

```
modelBuilder.Configurations.Add(new MenuMap()); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:52:12.657

`MenuId`不应为*空*，因为它是主键，

```
public class Menu :EntidadePadrao
{
    public int MenuId { get; set; }
    public int MenuPai_ID {get; set; }

    // Navigation List
    public Menu MenuPai { get; set; }
    public virtual ICollection<Menu> MenusFilhos { get; set; }
    public virtual ICollection<PerfilUsuarioMenu> PerfisUsuario { get; set; }
} 
```

然后在您的配置中，告诉 EF that `MenuPai_ID`is *nullable*。

```
public MenuMap()
{
    // Primary Key
    this.HasKey(t => t.MenuId);

    // Property and Mapping
    this.ToTable("Menu");

    this.Property(t => t.MenuPai_ID)
        .IsOptional()
        .HasColumnName("MenuPai_ID");

    // Relationship
    this.HasOptional(t => t.MenuPai)
        .WithMany(t => t.MenusFilhos)
        .HasForeignKey(d => d.MenuPai_Id);
} 
```

# c# - 打印双精度值

> ID：14077590
> 
> 赞同：6
> 
> 时间：2012-12-29T00:41:23.427
> 
> 标签：c#

在我的系统上，以下代码打印“3.6”：

```
double a = 1.2;
int b = 3;

double c = a * b;

Console.WriteLine(c); 
```

但是在调试器中，我可以看到它`c`的值超过 2 位：

![在此处输入图像描述](../Images/deb01390fc80edd58cea430dab8a43c9.png)

我知道我可以用`Console.WriteLine("{0:R}", c)`. 这是显示 a 的实际值的唯一且推荐的方法`double`吗？

* * *

**更新**

使用上面的示例，我想打印`c`这样，如果用户要使用打印的值并将其插入到测试中的代码中`==`，那么比较将是正确的。在这种情况下`c == 3.5999999999999996`返回 true。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T04:34:15.200

3.999999999999996 也不是双精度的实际值；这只是四舍五入到十五位或其他值的值。没有内置方法可以显示双精度表示的实际*确切*值。这真的太糟糕了，因为每个普通的双精度都可以精确地表示为一个十进制字符串，如果能够看到这一点会很高兴。

作为一项公共服务，我在我的博客上放了一个设备的源代码：

[http://ericlippert.com/2011/02/17/looking-inside-a-double/](http://ericlippert.com/2011/02/17/looking-inside-a-double/)

请注意，它使用 Microsoft Solver Foundation 的 Rational 类。如果您没有，那么您可以免费下载它，或者编写您自己的 Rational 类；这样做是为了塑造性格。

如果您对双打如何在内部工作的主题感兴趣，请考虑查看我的方便文章存档，以解释所有这些。它在：

[http://blogs.msdn.com/b/ericlippert/archive/tags/floating+point+arithmetic/](http://blogs.msdn.com/b/ericlippert/archive/tags/floating+point+arithmetic/)

从底部开始；这些是按时间倒序排列的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-12-29T00:50:12.703

`Console.WriteLine``Double.ToString`使用[“G”格式说明符](http://msdn.microsoft.com/en-us/library/vstudio/dwhawy9k.aspx#GFormatString)的调用。这使用当前区域性来确定小数位数（1 表示“en-US”）。

如果要显示 8 位小数，可以使用[数字格式说明符](http://msdn.microsoft.com/en-us/library/vstudio/dwhawy9k.aspx#NFormatString)：

```
Console.WriteLine(c.ToString("N8")); 
```

[**标准数字格式字符串**](http://msdn.microsoft.com/en-us/library/vstudio/dwhawy9k.aspx)

**编辑**：调试器使用此方法将双精度转换为字符串：

[**_ecvt_s**](http://msdn.microsoft.com/en-us/library/ehz2dset%28v=vs.110%29.aspx)

我认为这是转换它的最便宜的方法。

我在哪里找到它：[Visual Studio 如何在调试期间显示 System.Double？](https://stackoverflow.com/a/10252030/284240)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-12-29T01:01:16.837

您也可以使用不同的方法，例如，如果您想返回 2 位小数，您可以尝试这样的方法

```
double a = 1.2;
int b = 3;
double c = a * b;
var s = string.Format("{0:0.00}", c);
Console.WriteLine(s); 
```

> 输出 = 3.60

如果你想抑制输出为 3.6 的最后一个 0，你可以这样做

```
var s = string.Format("{0:0.##}", c); 
```

> 输出 = 3.6 随意玩弄它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-12-29T00:45:47.230

```
double a = 1.2;
int b = 3;

double c = a * b;
string formatted = c.ToString("N5");
Console.WriteLine(formatted); 
```

# python - 属性解析在 Python 中是如何工作的？

> ID：14077591
> 
> 赞同：2
> 
> 时间：2012-12-29T00:41:25.313
> 
> 标签：python, oop

考虑以下代码：

```
class A(object):
    def do(self):
        print self.z

class B(A):
    def __init__(self, y):
        self.z = y

b = B(3)
b.do() 
```

为什么这行得通？执行时`b = B(3)`，设置属性 z。当`b.do()`被调用时，Python 的 MRO 会`do`在 A 类中找到该函数。但是为什么它能够访问在子类中定义的属性呢？

这个功能有用例吗？我想举个例子。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:59:31.477

它以一种非常简单的方式工作：当执行一个设置属性的语句时，它就被设置了。当执行读取属性的语句时，它会被读取。当您编写读取属性的代码时，Python 不会尝试在执行该代码时猜测该属性*是否*存在；它只是等到代码实际*执行*，如果那时该属性不存在，那么你会得到一个异常。

默认情况下，您始终可以在用户定义类的实例上设置任何属性；类通常不会定义可以设置的“允许”属性列表*（*尽管您也可以这样做），它们只是实际设置属性。当然，您只能读取存在的属性，但同样重要的是当您实际尝试读取它们时它们是否存在。*所以当你定义*一个试图读取它的函数时，属性是否存在并不重要；仅当（或是否）您实际*调用*该函数时才重要。

在您的示例中，有两个类并不重要，因为只有一个实例。由于您只创建一个实例并在一个实例上调用方法，因此`self`两种方法中的都是同一个对象。首先`__init__`是运行，它将属性设置为`self`. 然后`do`运行并从相同的`self`. 这里的所有都是它的。设置属性的位置无关紧要；一旦在实例上设置它，就可以从*任何地方*访问它：超类、子类、其他类中的代码，或者不在任何类中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T00:49:22.620

由于可以随时将新属性添加到任何对象，因此属性解析发生在执行时，而不是编译时。考虑这个例子，它可能更有启发性，来自你的：

```
class A(object):
  def do(self):
    print(self.z) # references an attribute which we have't "declared" in an __init__()

#make a new A
aa = A()

# this next line will error, as you would expect, because aa doesn't have a self.z
aa.do()

# but we can make it work now by simply doing
aa.z = -42
aa.do() 
```

第一个会对你发出嘶嘶声，但第二个会按预期打印 -42。

Python 对象只是字典。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-05-01T23:52:36.247

从对象中检索属性时（打印*self.attrname*）Python 遵循以下步骤：

1.  如果*attrname*是 objectname 的特殊（即 Python 提供的）属性，则返回它。

2.  检查*attrname*。`objectname.__class__.__dict__`_ 如果存在并且是数据描述符，则返回描述符结果。搜索同一案例的所有基地。*`objectname.__class__`*

**   检查*attrname*`objectname.__dict__`，如果找到则返回。如果 objectname 是一个类，也搜索它的基类。如果它是一个类并且在它或其基中存在描述符，则返回描述符结果。

    **   检查*attrname*。`objectname.__class__.__dict__`_ 如果存在且是非数据描述符，则返回描述符结果。如果它存在并且不是描述符，则返回它。如果它存在并且是一个数据描述符，我们就不应该在这里，因为我们会在第 2 点返回。搜索相同案例的所有基础。*`objectname.__class__`*

    **   引发属性错误

    [来源](http://www.cafepy.com/article/python_attributes_and_methods/python_attributes_and_methods.html)

    [了解**get**和**set**以及 Python 描述符](https://stackoverflow.com/questions/3798835/understanding-get-and-set-and-python-descriptors)*** 

 **** * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-12-29T00:53:46.573

由于您实例化了一个`B`对象，`B.__init__`因此被调用并添加了一个属性`z`。该属性现在存在于对象中。这不是一些奇怪的重载的神奇共享局部变量`B`方法，它以某种方式变得无法访问其他地方编写的代码。没有这样的事情。当它被传递给超类的方法时，它们都不会`self`成为不同的对象（如果发生这种情况，多态性应该如何工作？）。

也没有声明`A`对象没有这样的对象（try `o = A(); a.z = whatever`），也不需要是¹`self`的实例。事实上，根本没有任何声明。一切都是“继续尝试”；这是一种动态语言的定义（不仅仅是动态类型）。`do``A`

该对象的`z`属性始终“无处不在” ²，无论从哪个“上下文”访问它。*为*解决过程或其他几种行为定义代码的位置无关紧要³。出于同样的原因，尽管没有用 C 语言编写代码，您仍可以访问列表的方法`listobject.c`；-) 不，方法并不特殊。它们也只是对象（实际上是 type 的实例`function`）并且涉及完全相同的查找序列。

¹这是一个小小的谎言；在 Python 2 中，`A.do`将是“绑定方法”对象，如果第一个参数不满足，它实际上会引发错误`isinstance(A, <first arg>)`。

²直到它被`del`或它的功能等价物（`delattr`和朋友）之一删除。

³好吧，有名称修饰，理论上，代码可以检查堆栈，从而检查调用者代码对象，从而检查其源代码的位置。***

# php - PHP Facebook SDK 每隔一页加载就会抛出一个 OAuthException

> ID：14077594
> 
> 赞同：1
> 
> 时间：2012-12-29T00:42:36.340
> 
> 标签：php, facebook, sdk

我得到“OAuthException：必须使用活动访问令牌来查询有关当前用户的信息”一次每两个页面加载（使用任何经过身份验证的用户），正确的加载获取用户信息没有任何问题。

这是我当前的脚本：

```
 $facebook = new Facebook(array(
  'appId'  => 'XXXXXXXXXXXXXXXX',
  'secret' => 'XXXXXXXXXXXXXXXXXXXXXXXXX',
  'cookie' => true,
));

//obtiene las Variables Iniciales
$user = $facebook->getUser();

if ($user) {
  try {
    $user_profile = $facebook->api('/me');
  } catch (FacebookApiException $e) {
    error_log($e);
    $user = null;
  }
}

if ($user) {
  $logoutUrl = $facebook->getLogoutUrl(array( 'next' => ('http://xxxxx.com/Salir') ));

} else {
  $loginUrl = $facebook->getLoginUrl(array('scope' => 'email,user_birthday,user_hometown,user_location'));
} 
```

这是按钮：

```
<fb:login-button perms='email,user_birthday,user_hometown,user_location' length='long' autologoutlink='false' onlogin='fbLogin();'></fb:login-button>

<div id='fb-root'></div>
<script>
window.fbAsyncInit = function() {
FB.init({
appId: '$FBid',
cookie: true,
xfbml: true,
oauth: true
});

FB.Event.subscribe('auth.login', function(response) {
    return false;
});

FB.Event.subscribe('auth.logout', function(response) {
    return false;
});
};
(function() {var e = document.createElement('script'); e.async = true;
e.src = document.location.protocol +
'//connect.facebook.net/es_ES/all.js';
document.getElementById('fb-root').appendChild(e);
}());
</script> 
```

有谁知道为什么会这样？

感谢您的帮助：D

我为我糟糕的英语道歉。

# android - Android AsyncTask 和 NetworkOnMainThreadException

> ID：14077595
> 
> 赞同：1
> 
> 时间：2012-12-29T00:42:47.193
> 
> 标签：android, android-asynctask, networkonmainthread

我正在开发一个使用 Jsoup 的 Android 应用程序。在开发的早期，我“解决”了必须实现任何类型的线程，因为我只想在处理线程之前完成大部分代码。我现在正在尝试使用 AsyncTask，但我仍然收到 NetworkOnMainThreadException 错误。我已经阅读了大量关于 AsyncTask 的教程和 SO 帖子，但似乎仍然可以找出问题所在。当我添加 StrictMode... 代码时，除了使用 Jsoup 加载数据时 UI 锁定之外，该应用程序可以正常工作。如果有人能告诉我我在 AsyncTask 方面做错了什么，我将不胜感激。（PS 我知道有很多代码冗余需要清理，但我想让 AsyncTask 先工作）

```
public void onCreate(Bundle savedInstanceState)  {
            super.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);  

            /***This is the work around used***/
            StrictMode.ThreadPolicy policy = new     StrictMode.ThreadPolicy.Builder().permitAll().build();
            StrictMode.setThreadPolicy(policy);
            /******/  

            up = new TreeMap<Double, String[]>(); 

            c1 = "example.com/1";
            //instansiate textviews (6)
                    doc1 = doc;
            c2 = "example.com/2";
            //instansiate textviews (6)
                    doc2 = doc;
            c3 = "example.com/3";
            //instansiate textviews (6)
            doc3 = doc;

            // instansiate textviews(16)

            new Download().execute(c1,c2,c3);

   } 
        private class Download extends AsyncTask<String, Integer, String[][]> {
            @Override
            protected String[][] doInBackground(String... urls){
                out = new String[7][3];
                try {
                    doc = Jsoup.connect(urls[0]).data().get();          
                    //days, times, and cs arrays created and filled

                    String[] out1arr = {days[0], times[0], cs[0]};
                    //...all 7
                    String[] out7arr = {days[6], times[6], cs[6]};
                    String[][] outarrs = {out1arr,out2arr,out3arr,out4arr,out5arr,out6arr,out7arr};
                    for (int i= 0; i < out.length; i++){
                        out[i] = outarrs[i];
                    }
                } catch (IOException e1) {
                    e1.printStackTrace();
                }
                return (out);
            }
            @Override
            protected void onProgressUpdate(Integer... progress){
            }
            @Override
            protected void onPostExecute(String[][] result){

                Do(/*textviews(6)*/, c1, a, outa, "example1"); //a is previously instantiated double array, outa is preiously instantiated string array
                Do(/*textviews(6)*/, c2, b, outb, "example2");
                Do(/*textviews(6)*/, c3, c, outc, "example3");

                upc00.setText(getUpc()[0][0]);
                //setText for all 16
                upc32.setText(getUpc()[3][2]);

            }

            private void Do(TextView t, TextView u, TextView v, TextView w, TextView x, TextView y,String webpage, double[] darr, String[] sarr, String show){

                t.setText(doInBackground(webpage)[0][0]);
                //...all 6
                y.setText(doInBackground(webpage)[1][2]);       
                for (int i =0; i < darr.length; i++){
                    darr[i] = tis[i];
                    up.put(darr[i], out[i]);
                }
            }
        }
        private ArrayList<String[]> getMap(){
                //...
            return s;
        }
        private String[][] getUpc(){
            //...
            return upc;
        } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T07:56:08.803

框架调用`doInBackground`你不应该自己调用它。您的代码会调用`onPostExecute`UI 线程上的框架调用该调用。如此有效地您的调用在 UI 线程上运行。

将您的获取逻辑全部移到`doInBackgound`方法中。该`onPostExecute`方法应该用于将结果传递给调用者。

# objective-c - 如何在目标 c 中完成我的倒数计时器？

> ID：14077596
> 
> 赞同：1
> 
> 时间：2012-12-29T00:43:03.773
> 
> 标签：objective-c, timer, nstimer, uidatepicker

我有一个倒数计时器，用户可以在其中输入他们想要从使用倒数计时器开始的时间，就像在时钟应用程序中一样。问题是，我不知道如何让计时器真正倒计时。我已经制作了 UI 并拥有大部分代码，但我不知道`updateTimer`我所拥有的方法会发生什么。这是我的代码：

```
- (void)updateTimer
{
    //I don't know what goes here to make the timer decrease...
}

- (IBAction)btnStartPressed:(id)sender {
    pkrTime.hidden = YES; //this is the timer picker
    btnStart.hidden = YES;
    btnStop.hidden = NO;
    // Create the timer that fires every 60 sec    
    stopWatchTimer = [NSTimer scheduledTimerWithTimeInterval:1.0
                                                      target:self
                                                    selector:@selector(updateTimer)
                                                    userInfo:nil
                                                     repeats:YES];
}

- (IBAction)btnStopPressed:(id)sender {
    pkrTime.hidden = NO;
    btnStart.hidden = NO;
    btnStop.hidden = YES;
} 
```

请让我知道`updateTimer`让计时器减少的方法中的内容。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:47:53.643

您将使用变量跟踪剩余的总时间。updateTimer 方法将每秒被调用一次，每次调用 updateTimer 方法时，您将剩余时间变量减少 1（一秒）。我在下面给出了一个示例，但我已将 updateTimer 重命名为 reduceTimeLeft。

一些类.h

```
#import <UIKit/UIKit.h>

@interface SomeClass : NSObject {
    int timeLeft;
}

@property (nonatomic, strong) NSTimer *timer;

@end 
```

SomeClass.m

```
#import "SomeClass.h"

@implementation SomeClass

- (IBAction)btnStartPressed:(id)sender {
    //Start countdown with 2 minutes on the clock.
    timeLeft = 120;

    pkrTime.hidden = YES;
    btnStart.hidden = YES;
    btnStop.hidden = NO;

    //Fire this timer every second.
    self.timer = [NSTimer scheduledTimerWithTimeInterval:1.0
                                                      target:self
                                                selector:@selector(reduceTimeLeft:)
                                                    userInfo:nil
                                                     repeats:YES];
}

- (void)reduceTimeLeft:(NSTimer *)timer {
    //Countown timeleft by a second each time this function is called
    timeLeft--;
    //When timer ends stop timer, and hide stop buttons
    if (timeLeft == 0) {
        pkrTime.hidden = NO;
        btnStart.hidden = NO;
        btnStop.hidden = YES;

        [self.timer invalidate];
    }
    NSLog(@"Time Left In Seconds: %i",timeLeft);
}

- (IBAction)btnStopPressed:(id)sender {
    //Manually stop timer
    pkrTime.hidden = NO;
    btnStart.hidden = NO;
    btnStop.hidden = YES;

    [self.timer invalidate];
}

@end 
```

# python - 将 Python 3 与 Python 2 一起使用

> ID：14077599
> 
> 赞同：0
> 
> 时间：2012-12-29T00:43:12.380
> 
> 标签：python, python-3.x, python-2.x

我有一个 Python 3 文件。我想使用互联网上的开源工具（nltk），但不幸的是它只支持 Python 2。我无法将其转换为 Python 3，也无法将我的 Python 3 文件转换为 Python 2。

如果用户没有给出某个参数（在 argparse 上），那么我会在我的文件中做一些事情。但是，如果用户确实给出了某个论点，我需要使用 nltk。

**编写一个使用 nltk 的 Python 2 脚本，然后在我的 Python 3 脚本中执行该脚本**

我目前的想法是在 Python 2 中编写一个脚本，使用 nltk 执行我想要的操作，然后从我当前的 Python 3 脚本中运行它。但是，我实际上不知道该怎么做。我找到了这段代码：`os.system(command)`所以我将它修改为`os.system("python py2.py")`（其中 py2.py 是我新编写的 Python 2 文件）。我不确定这是否可行。

我也不知道这是否是解决我的问题的最有效方法。我在互联网上找不到任何关于它的信息。

传输的数据可能会非常大。目前，我的测试数据大约是6600行，utf-8。就我而言，功能性比（在一定程度上）需要多长时间更重要。

另外，我如何将值从我的 Python 2 脚本传递到我的 Python 3 脚本？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T00:50:25.373

有没有其他方法可以做到这一点？

好吧，如果您*确定*不能将脚本转换为 Python 2，那么通过运行 Python 解释器让一个脚本调用另一个脚本可能是*最好*的方法。（而且，这是 Python，最好的方法是，或者至少应该是唯一的方法。）

但是你确定吗？在[`six`](http://packages.python.org/six/)模块、[`3to2`](http://wiki.python.org/moin/3to2)工具和[`__future__`](http://docs.python.org/2/library/__future__.html)语句之间，它可能没有你想象的那么难。

无论如何，如果您*确实*需要让一个脚本调用另一个脚本，您几乎不应该使用`os.system`. 正如该函数的[文档](http://docs.python.org/3/library/os.html#os.system)所说：

> 该`subprocess`模块提供了更强大的工具来生成新进程并检索其结果；使用该模块优于使用此功能。请参阅子流程文档中的用子流程模块替换旧功能部分以获取一些有用的秘诀。

最简单的版本是这样的：

```
subprocess.check_call(["python", "py2.py"]) 
```

这将运行您的脚本，等待它完成，并在脚本返回失败时引发异常——基本上，您想用 . 做什么`os.system`，但更好。（例如，它不会产生不必要的额外外壳，它会处理错误处理等）

这假设您需要共享的任何其他数据都以某种隐式的外部方式共享（例如，通过访问具有相同名称的文件）。您最好将数据`py2.py`作为命令行参数传递和/或`stdin`，将数据作为 via 传回`stdout`，或者甚至打开显式管道或套接字来传递数据。在不了解您需要做什么的情况下，很难提出任何建议，但是文档，尤其是用[模块](http://docs.python.org/3/library/subprocess.html#replacing-older-functions-with-the-subprocess-module)[替换旧功能`subprocess`](http://docs.python.org/3/library/subprocess.html#replacing-older-functions-with-the-subprocess-module)部分对选项进行了很多讨论。

为了给您一个想法，这里有一个简单的示例：将您的文件名参数之一传递给`py2.py`，然后从 获取数据`py2.py`，`py3.py`只需`py3.py`执行以下操作：

```
py2output = subprocess.check_output(["python", "py2.py", my_args[0]]) 
```

然后在 中`py2.py`，只是`print`您想要发回的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-30T17:37:25.777

[有人听说 NLTK 3.0 何时发布](https://stackoverflow.com/questions/6501271/anyone-hear-when-nltk-3-0-will-be-out)？在SO中指出...

> 有一个 Python 3 分支：
> 
> [https://github.com/nltk/nltk/tree/nltk-py3k](https://github.com/nltk/nltk/tree/nltk-py3k)

答案是从 2011 年 7 月开始的。从那时起可能会有所改进。

我刚刚查看了[https://github.com/nltk/nltk](https://github.com/nltk/nltk)。至少有文档讨论 Python 3 端口相关的事情[https://github.com/nltk/nltk/blob/2and3/web/dev/python3porting.rst](https://github.com/nltk/nltk/blob/2and3/web/dev/python3porting.rst)。

这是您可能感兴趣的关于 NLTK 和 Python 3[的更长讨论。](https://groups.google.com/forum/#!topic/nltk-dev/BW2VkTyKoAw)

而[Porting to Python 3 中的 Grants to Assist Kivy, NLTK](http://pyfound.blogspot.hu/2012/11/grants-to-assist-kivy-nltk-in-porting.html)（3 天前发布）与该问题直接相关。

# android - 我可以在不启动应用程序的情况下测试应用程序是否可以处理意图？

> ID：14077600
> 
> 赞同：3
> 
> 时间：2012-12-29T00:43:12.977
> 
> 标签：android, android-intent

具体来说，我想弄清楚是否有一个应用程序可以处理市场意图，但我想要一个通用案例解决方案。

我知道如果你做这样的事情，你可以判断是否有一个应用程序可以处理这个意图。我正在尝试做一些实际上并没有启动意图的事情。关于我可以做什么的任何想法？

```
try
{
    String strURL="market://details?id="+thePackage;
    Intent the_intent = new Intent(Intent.ACTION_VIEW, Uri.parse(strURL));
    the_intent.addFlags( Intent.FLAG_ACTIVITY_NEW_TASK );
    startActivity(the_intent)

}
catch (ActivityNotFoundException e)
{
    String strUrl="https://play.google.com/store/search?c=apps&q="+thePackage;

    Intent the_intent = new Intent(Intent.ACTION_VIEW, Uri.parse(strUrl));
    the_intent.addFlags( Intent.FLAG_ACTIVITY_NEW_TASK );
    startActivity(the_intent)
} 
```

我想要的是一个不涉及实际启动活动的解决方案。我想这样做有几个原因，但我想我不是唯一一个想到原因的人，似乎必须有一种方法......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T00:44:55.743

使用`PackageManager`和`queryIntentActivities()`或`resolveActivity()`。前者将返回 a与要使用`List`的 an 匹配的事物。后者将返回没有匹配项或“最佳匹配项”（如果有多个匹配项，则可能是选择器活动）。`Intent``startActivity()``null``Intent`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:51:13.810

这是 CommonWare 回答的一个实际例子。

```
String strURL="market://details?id="+thePackage;
Intent the_intent = new Intent(Intent.ACTION_VIEW, Uri.parse(strURL));
the_intent.addFlags( Intent.FLAG_ACTIVITY_NEW_TASK );
Log.v(TAG,""+_context.getPackageManager().queryIntentActivities(the_intent,Intent.FLAG_ACTIVITY_NEW_TASK));
if (_context.getPackageManager().queryIntentActivities(the_intent,0).size()==0)
{
    String strUrl="https://play.google.com/store/search?c=apps&q="+thePackage;
    the_intent = new Intent(Intent.ACTION_VIEW, Uri.parse(strUrl));
    the_intent.addFlags( Intent.FLAG_ACTIVITY_NEW_TASK );
} 
```

# visual-studio-2010 - 为什么 Qt 不会在信号/插槽中引发带有无效类/类型名称的编译错误？

> ID：14077604
> 
> 赞同：1
> 
> 时间：2012-12-29T00:43:51.917
> 
> 标签：visual-studio-2010, qt

Windows 7 SP1
MSVS 2010
Qt 库 4.8.4 for Windows (VS 2010)
Visual Studio Add-in 1.1.11 for Qt4

起初，我无法弄清楚为什么这个插槽没有触发：

```
connect (lineEdit, SIGNAL(textChanged(const QString &)),
         this, SLOT(enableFindButton(const Qstring &))); 
```

一个差异清楚地表明：Qstring 应该是 QString。

我的问题：为什么编译？事实上，它会这样编译：

```
connect (lineEdit, SIGNAL(textChanged(const nonsense &)),
         this, SLOT(enableFindButton(const more_nonsense &))); 
```

这是预期的行为吗？为什么这不会引发错误？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T00:57:36.437

据我所知并了解 Qt 的工作原理，连接线在运行时工作，而不是在编译时工作。这意味着当代码流到达该部分时，将执行连接信号和插槽所需的所有操作。

记住关于 Qt 的一些重要的事情，一些调用只是宏，而不是 C++ 函数。例如，您应该在类声明中添加以启用信号和插槽机制的行“Q_OBJECT”是一个宏。此外，connect 调用是一个宏 (...)，emit 是一个宏等。一旦 MOC（一个预编译器，将 Qt 宏转换为实际代码）分析您的代码，这些调用就会扩展为实际代码。

此外，据我所知，信号/插槽机制在运行时有效，而不是在编译时有效。如果你阅读了 connect 宏的文档，它会说你放在那里的“SIGNAL”和“SLOT”宏，将你放在那里的东西转换成一个字符串，显然，采用某种格式，这可能太复杂了手动使用，因此，由于它是在那里工作的字符串，编译无法检查字符串是否正确，即在运行时检查。

我希望我糟糕的英语能让你理解我，我希望我的知识足够丰富，不会说（太多）不正确的东西。

# c++ - Most Vexing Parse 的目的是什么？

> ID：14077608
> 
> 赞同：34
> 
> 时间：2012-12-29T00:44:03.963
> 
> 标签：c++, most-vexing-parse

在[维基百科](http://en.wikipedia.org/wiki/Most_vexing_parse)上我发现了这个：

```
A a( A() ); 
```

> [This] 可以消除歧义

> 1.  类 [ ]的变量定义，采用类 [ `A`] 的匿名实例`A`或

> 2.  一个函数的函数声明，它返回一个 [ `A`] 类型的对象并接受一个（未命名的）参数，该参数是一个返回类型 [ `A`] 的函数（并且不接受输入）。

> 大多数程序员期望第一个，**但 C++ 标准要求将其解释为第二个。**

但为什么？如果 C++ 社区的大多数人都期望前一种行为，为什么不将其作为标准呢？此外，如果*不*考虑解析歧义，上述语法是一致的。

有人可以启发我吗？为什么该标准将其作为一项要求？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-12-29T00:57:06.590

**假设 MVP 不存在。**

你将如何声明一个函数？

```
A foo(); 
```

将是一个变量定义，而不是一个方法声明。你会介绍一个新的关键字吗？函数声明的语法会更尴尬吗？或者你宁愿有

```
A foo; 
```

定义一个变量和

```
A foo(); 
```

声明一个函数？

您稍微复杂的示例只是为了与这个基本示例保持一致。说*“所有可以解释为声明的东西都将被解释为声明”*而不是*“所有可以解释为声明的东西都将被解释为声明”更容易，除非它是单个变量定义，在这种情况下这是一个变量定义”*。

虽然这*可能*不是它背后的动机，但它是一件*好事*。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-12-29T01:21:17.597

对于 C++，这非常简单：因为规则是在 C 中以这种方式制定的。

在 C 语言中，歧义只出现在 a`typedef`和一些相当晦涩的代码中。几乎没有人会意外触发它——事实上，除了专门为展示这种可能性而设计的代码之外，它可能是罕见的。然而，无论好坏，这种模棱两可的可能性意味着必须有人解决它——如果没记错的话，正是丹尼斯·里奇（Dennis Ritchie）解决了这个问题，丹尼斯·里奇（Dennis Ritchie）下令任何可以被解释为声明的东西都是声明，即使作为定义也存在模棱两可的解释。

C++ 增加了使用括号进行初始化以及函数调用作为分组的能力，这将模糊性从模糊变为常见。然而，改变它需要打破来自 C 的规则。像大多数人所期望的那样解决这个特殊的歧义，而不创造更多更令人惊讶的六个可能也相当不简单，除非你愿意完全放弃与 C 的兼容性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-12-29T00:57:04.560

这是递归定义语法的副作用。

它不是故意这样设计的。它被发现并记录为最令人烦恼的解析。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-29T00:53:51.270

这只是一个猜测，但这可能是因为使用给定的方法，您可以获得两种行为：

```
A a( A() ); // this is a function declaration
A a( (A()) ); // this is a variable definition 
```

如果您要将其行为更改为变量定义，则函数声明会复杂得多。

```
typedef A subfunction_type();

A a( A() ); // this would be a variable declaration
A a( subfunction_type ); // this would be a function declaration?? 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-12-29T00:53:36.933

没有特别的原因，除了[可能] K-ballo 确定的情况。

这只是遗产。已经有了构造形式，所以当没有 ctor args 起作用时`int x;`，它似乎从来都不是需要的。`T x;`

事后看来，我想如果该语言是从头开始设计的，那么 MVP 将不存在......以及大量其他 C++ 怪事。

回想一下，C++*已经发展*了几十年，即使是现在，也只是由委员会设计的（另请参见：[camel](http://en.wikipedia.org/wiki/Design_by_committee)）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-11-25T01:36:59.523

考虑一下程序是否是这样的：

```
typedef struct A { int m; } A;
int main() { A a( A() ); } 
```

这将是有效的 C，并且 C 的语法只允许一种可能的解释：`a`被声明为函数。C 只允许使用（而不是括号）进行初始化`=`，并且不允许`A()`被解释为表达式。（函数样式转换是 C++ 独有的特性。）这不是 C 中的“令人烦恼的解析”。

正如 Wikipedia 指出的那样，C++ 的语法使这个例子变得模棱两可。但是，如果您希望 C++ 赋予该程序与 C 相同的含义，那么显然，C++ 编译器将不得不`a`像 C 编译器一样将其解释为函数。当然，C++**可以**改变这个程序的含义，`a`定义一个类型为 的变量`A`。然而，只有在有充分理由时才将与 C 的不兼容性引入 C++，我想 Stroustrup 特别希望避免此类潜在的*无声破坏，因为它们会给迁移到 C++ 的 C 用户带来极大的挫败感。*

因此，C++ 也将其解释为函数声明，而不是变量定义；更一般地说，采用的规则是，如果看起来像函数样式转换的东西可以在其句法上下文中被解释为声明，那么它应该是。通过确保不采用 C 中不可用的解释（*即*涉及函数样式转换的解释），这消除了在所有令人烦恼的解析情况下与 C 不兼容的可能性。

[Cfront 2.0 Selected Readings](http://www.softwarepreservation.org/projects/c_plus_plus/cfront/release_2.0/doc/SelectedReadings.pdf)（第 1-42 页）在表达式声明歧义的情况下提到了 C 兼容性问题，这是最令人头疼的解析的相关类型。

# charts - d3条形图在追加之前选择全部

> ID：14077609
> 
> 赞同：6
> 
> 时间：2012-12-29T00:44:07.640
> 
> 标签：charts, d3.js

我一直在了解有关 d3 可视化库的更多信息，并且我看到了一些条形图示例，它们的片段看起来像

```
chart.selectAll("rect")
.data(data)
.enter().append("rect")
.attr("y", y)
.attr("width", x)
.attr("height", y.rangeBand()); 
```

我的困惑是第一`selectAll`行。因为我们将在数据输入上附加新的矩形，所以在它们存在之前选择所有矩形的目的是什么？如果这些元素都不存在，那么 selectAll 中的内容是否重要？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T00:56:03.347

它是 D3 语言声明性的一部分。[Thinking with Joins](http://bost.ocks.org/mike/join/)一文详细解释了它。摘录：

> 但是 selectAll("circle") 是怎么回事？为什么必须选择不存在的元素才能创建新元素？笏。
> 
> 交易是这样的：与其告诉 D3 如何做某事，不如告诉 D3 你想要什么。在这种情况下，您希望圆元素与数据相对应：您希望每个基准一个圆。与其指示 D3 创建圆圈，不如告诉 D3 选择的“圆圈”应该与数据相对应，并描述如何到达那里。这个概念称为数据连接：
> 
> 此维恩图说明了数据连接。绑定到现有元素的数据会产生更新（内部）选择。未绑定的数据产生输入选择（左），未绑定的元素产生退出选择（右）。Data Enter Update Elements Exit Thinking with joins 揭示了序列背后的奥秘：
> 
> selectAll("circle") 返回空选择，因为 SVG 容器元素 (svg) 为空。这里没有魔法。
> 
> 空选择连接到数据：数据（数据）。data 方法将数据绑定到元素，产生三个虚拟选择：进入、更新和退出。输入选择包含任何缺失元素的占位符。更新选择包含绑定到数据的现有元素。任何剩余的元素最终都会出现在退出选择中以进行删除。
> 
> 由于选择为空，所有数据最终都成为 enter() 中的占位符节点。
> 
> 这与第一个示例中的附加相同，但应用于多个占位符；选择方法隐式迭代选定的元素。通过 append("circle") 将缺失的元素添加到 SVG 容器中。
> 
> 就是这样了。您希望选择“圆圈”与数据相对应，并描述了如何创建缺失的元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-01-28T14:00:54.153

1.  在您的示例`selectAll("rect")`中，首先调用。但它返回一个空选择。

2.  `data(data)`将空选择与数据绑定。它会创建新的空选择。

3.  `.enter()`标识当连接数组长于选择时需要添加的任何 DOM 元素。

4.  `append("rect")`为每个空选择附加一个矩形，该矩形不再为空

这部分有很好的解释和详细说明：[D3.js 数据绑定，它是如何工作的？](https://lucidar.me/en/d3.js/part-07-data-binding/#how-it-works)

# java - 在 C++ 中获取控制台信息

> ID：14077610
> 
> 赞同：1
> 
> 时间：2012-12-29T00:44:10.657
> 
> 标签：java, c++, c, java-native-interface

好的，我被困在如何在 C++ 中获取控制台信息。我知道如何使用 setConsoleTextAttribute 设置颜色，使用 setConsoleTitle 设置标题，但我不知道如何在方法中获取该信息并返回它。我正在做一个 jni 项目，我被困在这一部分上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T00:50:17.563

您正在寻找的两个 API 调用是 GetConsoleScreenBufferInfo 和 GetConsoleTitle，此处的文档：

[http://msdn.microsoft.com/en-us/library/windows/desktop/ms683171%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/ms683171%28v=vs.85%29.aspx) http://msdn.microsoft.com/en-us/library/windows/desktop /ms683174%28v=vs.85%29.aspx

# cmake - 如何告诉 CMake 链接到源目录中的静态库？

> ID：14077611
> 
> 赞同：114
> 
> 时间：2012-12-29T00:44:24.173
> 
> 标签：cmake, static-libraries

我有一个带有 Makefile 的小项目，我正在尝试将其转换为 CMake，主要是为了获得 CMake 的经验。出于本示例的目的，该项目包含一个源文件（C++，尽管我认为该语言不是特别相关）和一个我从其他地方复制的静态库文件。为论证起见，假设库的源代码不可用；我只有 .a 文件和相应的标题。

我手工制作的 Makefile 包含这个构建规则：

```
main: main.o libbingitup.a
    g++ -o main main.o libbingitup.a 
```

效果很好。我如何告诉 CMake 重现这个？当然，不是字面上的这个确切的 makefile，而是包含等效链接命令的东西。我尝试了明显但幼稚的方法，比如

```
add_executable(main main.cpp libbingitup.a) 
```

或者

```
add_executable(main main.cpp)
target_link_libraries(main libbingitup.a) 
```

以及与`link_directories(.)`或`add_library(bingitup STATIC IMPORTED)`等的各种事物，但到目前为止还没有任何东西可以成功连接。我应该做什么？

* * *

版本详细信息：Linux (Kubuntu 12.04) 上的 CMake 2.8.7 和 GCC 4.6.3

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2012-12-29T02:39:38.143

CMake 倾向于将完整路径传递给链接库，因此假设 libbingitup.a 在 中`${CMAKE_SOURCE_DIR}`，执行以下操作应该会成功：

```
add_executable(main main.cpp)
target_link_libraries(main ${CMAKE_SOURCE_DIR}/libbingitup.a) 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2017-01-05T21:42:01.857

如果您不想包含完整路径，则可以执行

```
add_executable(main main.cpp)
target_link_libraries(main bingitup) 
```

`bingitup`如果您在 CMake 项目中创建静态库，则与您给出的目标名称相同：

```
add_library(bingitup STATIC bingitup.cpp) 
```

CMake 会在 Linux 上自动添加`lib`到前面和末尾，在 Windows 上添加到末尾。`.a``.lib`

如果库是外部的，您可能希望使用添加到库的路径

```
link_directories(/path/to/libraries/) 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2015-07-21T16:20:19.350

我发现这很有帮助...

[http://www.cmake.org/pipermail/cmake/2011-June/045222.html](http://www.cmake.org/pipermail/cmake/2011-June/045222.html)

从他们的例子：

```
ADD_LIBRARY(boost_unit_test_framework STATIC IMPORTED)
SET_TARGET_PROPERTIES(boost_unit_test_framework PROPERTIES IMPORTED_LOCATION /usr/lib/libboost_unit_test_framework.a)
TARGET_LINK_LIBRARIES(mytarget A boost_unit_test_framework C) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-03-07T11:31:16.497

我想添加到其他评论中，项目名称是第一个参数。我有一个名为 cmakecompile 的项目，我想在其中添加 libusb，代码如下，

```
add_executable(cmakecompile main.c)
target_link_libraries(cmakecompile "D:/msys2/mingw64/lib/libusb-1.0.a") 
```

该项目只有一个 main.c 文件，target_link_libraries 中的第一个参数是**您的项目名称，**第二个参数是**库的路径**。

**请注意，这可能会有所帮助**：由于我在 Windows 下编译，因此我必须安装 msys2，因为您必须使用相同的编译器编译该库。例如，如果您获得[libusb](https://github.com/libusb/libusb/wiki)并尝试在 qt-creator 项目中使用它，它将无法工作，并且您可能会获得未引用的功能，因此我必须安装 msys2 并从 msys2 内部安装 libusb，安装 make 并创建一个 QT Cmake 项目并使用 msys2 make 从 Qt 创建者编译。

完整的 cmakelists.txt 如下

```
cmake_minimum_required(VERSION 3.5)

project(cmakecompile LANGUAGES C)

add_executable(cmakecompile main.c)
target_link_libraries(cmakecompile "D:/msys2/mingw64/lib/libusb-1.0.a") 
```

# linux - session.serialize_handler 作为 igbinary 导致“igbinary_unserialize_header：不支持的版本”

> ID：14077625
> 
> 赞同：0
> 
> 时间：2012-12-27T10:06:53.097
> 
> 标签：linux, nginx, php

我已经从 PECL 安装了 igbinary 1.1.1，将其配置为 php.ini 中 session.serialize_handler 的序列化程序，以便它显示在 phpinfo() 中。更改已经过测试 - 到目前为止一切都很好，但是在实时服务器上，我可以看到这样的警告（本机 php 序列化程序没有任何问题）：

```
PHP Warning: igbinary_unserialize_header: unsupported version: 1346458177, should be 1 or 2 in dispatcher.php on line 73
PHP Warning: session_start(): Trying to destroy uninitialized session in dispatcher.php on line 73
PHP Warning: session_start(): Failed to decode session object. Session has been destroyed in dispatcher.php on line 73 
```

这些消息并非一直出现 - 第 73 行的 session_start() 在测试期间为我工作，我还可以在访问日志中看到 ~ %80 的成功请求。

*第 73 行：*

```
session_start(); 
```

解决方案是什么？

PS 我有 Nginx 1.2.3，php5-fpm 5.3.10-1ubuntu3.4

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-28T17:07:51.563

根据我粗略的谷歌检查，我提出以下建议。

我找到的一半结果`igbinary_unserialize_header: unsupported version`表明升级到存储库中的最新版本是有效的，这让我相信这是一个未识别的错误。

另一半识别出未序列化的数据，这些数据要么最初不是由 igbinary 序列化，要么已损坏。最初没有被 igbinary 序列化在这里听起来是合理的，因为您在测试中没有遇到这个问题，但是您正在生产中。**您是否有可能尝试反序列化用户在切换到 igbinary 之前启动的会话？**

我对下一个调试步骤的建议是在某处添加一些错误处理，以将导致此错误的序列化字符串写入某处的文件。然后，您可以自己测试反序列化它们以找出问题所在。

# java - Java - 泛型类型 - 类型擦除

> ID：14077627
> 
> 赞同：6
> 
> 时间：2012-12-29T00:45:55.043
> 
> 标签：java, generics

我在oracle网站上找到了以下问答

**类型擦除后，以下类转换为什么？**

```
public class Pair<K, V> {

    public Pair(K key, V value) {
        this.key = key;
        this.value = value;
    }

    public K getKey(); { return key; }
    public V getValue(); { return value; }

    public void setKey(K key)     { this.key = key; }
    public void setValue(V value) { this.value = value; }

    private K key;
    private V value;
} 
```

**回答：**

```
public class Pair {

    public Pair(Object key, Object value) {
        this.key = key;
        this.value = value;
    }

    public Object getKey()   { return key; }
    public Object getValue() { return value; }

    public void setKey(Object key)     { this.key = key; }
    public void setValue(Object value) { this.value = value; }

    private Object key;
    private Object value;
} 
```

但是当我使用 JD-GUI 反编译类文件时，我仍然看到所有与我在实际源代码中的泛型类型相似的泛型类型。

这是否意味着泛型类型保留在类文件中？我正在使用 Java 6。

使用JD-GUI的类的反编译版本如下。我正在使用 Eclipse Helios 来编译该类。

```
public class Pair<K, V>
{
  private K key;
  private V value;

  public Pair(K key, V value)
  {
    this.key = key;
    this.value = value;
  }
  public K getKey() {
    return this.key; } 
  public V getValue() { return this.value; } 
  public void setKey(K key) {
    this.key = key; } 
  public void setValue(V value) { this.value = value;
  }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-12-29T00:51:56.793

.class 文件中保留了一些泛型类型信息 - 足以让您通过反射确定类型 Pair 是泛型的，对于具有 Pair 成员的类，泛型参数的类型是什么等等。保留此信息的事实构成了诸如[超类型标记](http://gafter.blogspot.com/2006/12/super-type-tokens.html)之类的技术的基础，这些技术允许您传递类型标记，这些类型标记保留有关其泛型参数的信息。

然而，除了反射之外，类型擦除意味着`Pair`该类的行为主要与 Oracle 网站的“答案”中的剥离版本一样。特别是，方法的实际字节码不会引用泛型类型`K`或`V`仅引用 Object，并且方法签名将接受并返回`Object`。

在这种情况下，JD-GUI 只是智能并使用存储在 .class 文件中的信息来恢复反编译输出中的通用信息，但请确保类型在字节码中被擦除。

# php - 为什么在构造函数链接中需要括号？

> ID：14077628
> 
> 赞同：9
> 
> 时间：2012-12-29T00:46:12.823
> 
> 标签：php, chaining

**为什么使用 new 关键字的表达式需要括号才能在链式执行中使用？**例如，在 AS3 中，您不需要括号。在 PHP 中，这是对解释器的一种风格帮助，还是有一个我不知道的更大原因？这是执行优先顺序问题吗？

**PHP中的构造函数链接**

感谢这个问题[Chaining a constructor with an object function call in PHP](https://stackoverflow.com/questions/482631/chaining-a-constructor-with-an-object-function-call-in-php)我想出了如何......</p>

**对象定义**

*旁白：显然魔术方法`__construct`总是隐式返回`$this`，如果您显式返回`$this`（或与此相关的任何内容），则不会发生错误/警告/异常。*

```
class Chihuahua
{
    private $food;

    function __construct( $food )
    {
        $this->food = $food;
    }

    function burp()
    {
        echo "$this->food burp!";
    }
} 
```

**作品**

```
(new Chihuahua('cake'))->burp(); 
```

**不起作用（但我希望它起作用）**

```
new Chihuahua('cake')->burp(); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T00:50:46.400

我相信这是因为解释器解析成这个，

```
new (Chihuahua('cake')->burp()); 
```

代替，

```
(new Chihuahua('cake'))->burp(); 
```

因为`->`比操作员具有更高的偏好`new`。

给你一个错误，因为这个，

```
Chihuahua('cake')->burp() 
```

不明白。希望能帮助到你。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-29T00:51:24.237

因为`new`运算符的优先级低于`->`运算符。php尝试运行`Chihuahua('cake')->burp()`前`new Chihuahua('cake')`。那就是问题所在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T00:53:04.017

不知道您为什么要尝试这样做，但有关 php.ini 的一些注意事项。首先，是的，您需要在 new Object() 语句周围使用括号将调用内联转换为实际对象。

使用上面的示例，您在调用 burp 方法后立即丢弃该对象。如果在这种情况下您需要一个对象方法来工作而不依赖于所述对象的实例，为什么不只使用静态方法呢？

编辑：在 __complex 静态方法中添加以显示如何包装构造 -> 执行 -> 处置过程。

```
class Chihuahua
{
    public static function burp( $food )
    {
        echo "$food burp!";
    }

    protected $food = '';
    public function doBurp()
    {
        echo $this->food . " burp!";
    }

    public function __construct($food)
    {
        $this->food = $food;
    }

    public static __complex( $food )
    {
        $chi = new Chihuahua($food);
        $chi->doBurp();
        unset($chi);
    }
}

Chihuahua::burp("cake");
// - or
Chihuahua::__complex("cake"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-01-27T09:26:01.030

附带说明：括号内的构造函数仅适用于 PHP v 5.4 及更高版本。参见[http://3v4l.org/ZANaO](http://3v4l.org/ZANaO)与[http://3v4l.org/m9vk9](http://3v4l.org/m9vk9)

# python - pygtk textview getbuffer 并同时写入

> ID：14077631
> 
> 赞同：1
> 
> 时间：2012-12-29T00:46:53.030
> 
> 标签：python, multithreading, textview, pygtk

我正在尝试制作一个程序（在python中），当我将它写入文件并打开到我已经创建的某个窗口时。我已经为一个可行的解决方案寻找了allarund bt似乎多线程可能是唯一的选择。

I was hoping that when option autorun is "activated" it will:

```
while 1:
    wbuffer = textview.get_buffer()
    text = wbuffer.get_text(wbuffer.get_start_iter(), wbuffer.get_end_iter())
    openfile = open(filename,"w")
    openfile.write(text)
    openfile.close() 
```

我正在使用 pygtk 并且有一个 textview 窗口，但是当我得到缓冲区时，它会永远存在。我在想我需要多线程并对其进行排队，以便一个线程在排队时写入缓冲区。

我的来源在[这里](http://pastebin.com/UN35VHDD)。（我认为声明在第 177 行。）

任何帮助深表感谢。:)

这是功能：

```
def autorun(save):
    filename = None
    chooser = gtk.FileChooserDialog("Save File...", None,
                                    gtk.FILE_CHOOSER_ACTION_SAVE,
                                    (gtk.STOCK_CANCEL, gtk.RESPONSE_CANCEL,
                                     gtk.STOCK_SAVE, gtk.RESPONSE_OK))

    response = chooser.run()
    if response == gtk.RESPONSE_OK: filename = chooser.get_filename()
    filen = filename
    addr = (filename)
    addressbar.set_text("file://" + filename)
    web.open(addr)
    chooser.destroy()
    wbuffer = textview.get_buffer()
    while 1:
      text = wbuffer.get_text(wbuffer.get_start_iter(), wbuffer.get_end_iter())
      time.sleep(1)
      openfile = open(filename,"w")
      openfile.write(text)
      openfile.close() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-30T02:01:50.393

虽然不太容易看到这里没有包含的 GTK 东西在做什么，但主要问题是控制需要返回到 gtk 主循环。否则程序将挂起。

所以如果你有一个很长的过程（比如这里的这个永恒的），那么你需要线程化它。问题是当主程序退出时你需要线程很好地退出，所以你必须围绕它重新设计一点。此外，需要正确初始化带有 gtk 的线程（看[这里](http://www.pygtk.org/docs/pygtk/gdk-functions.html#function-gdk--threads-init)）。

但是，我认为您不需要线程，而是可以将您的`changed`信号连接`TextBuffer`到将缓冲区写入目标文件的函数（如果用户已将程序置于`autorun`-mode）。一个问题是如果缓冲区变大或程序变慢，在这种情况下，您应该考虑线程化`changed`信号的回调。因此，此解决方案需要确保您不会遇到保存请求堆叠在一起的情况，因为用户打字速度比计算机保存速度快。需要一些设计思想。

**因此，最后，更简单的解决方案是：**您可能不希望每次按下按钮时都保存缓冲区。在这种情况下，您可以在[超时时](http://www.pygtk.org/pygtk2reference/gobject-functions.html#function-gobject--timeout-add)使用保存功能（它可能看起来像您的第一个没有循环的代码块） 。只是不要让超时时间太短。

# mysql - Wordpress 查询不工作 - 没有错误 - 否则查询正常

> ID：14077637
> 
> 赞同：1
> 
> 时间：2012-12-29T00:48:05.747
> 
> 标签：mysql, wordpress

我有一个要执行的 $wpdb 查询，但它没有通过并且没有抛出任何错误：

```
$followups = 
    $wpdb->get_results(
            $wpdb->prepare(
                "SELECT * FROM orders 
                WHERE status_id = %d
                AND DATEDIFF(CURDATE(), date_waiting_pickup) % 7 = %d",
                array(66, 0)
            )
        ); 
```

知道为什么吗？它在终端/直接 MySQL 中运行良好。是`DIFFDATE()`功能吗？

编辑：有趣的是，如果我删除该`$wpdb->prepare`功能并离开`$wpdb->get_results()`，它工作正常。那么，就工作方式而言，我有什么遗漏`$wpdb->prepare()`吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:13:15.437

如果你想，看起来，~~上周的~~订单......你为什么不简化它？不需要第二个`%d`，只需输入 0。

```
$followups = 
    $wpdb->get_results(
            $wpdb->prepare(
                "SELECT * FROM orders 
                WHERE status_id = %d
                AND DATEDIFF(CURDATE(), date_waiting_pickup) % 7 = 0",
                66
            )
        ); 
```

**更新**：

@dtj您正在使用`mod`(%) 运算符，它为我们提供了除法的其余部分。因此，与`0`（我的第一个假设）相比，我们从今天、1 周前、2 周前等获得订单。如果我们与 1（在第二个假设中）比较，我们将`%d`获得昨天、8 天前等的订单......

真的是你想要的吗？

**更新2**：在您编辑的问题中，您说删除`$wpdb->prepare()`所有工作正常。`prepare()`毫无疑问很有趣，但幸运的是，如果你只使用整数，你真的不需要。我的意思是做：

```
$status_id = (int) (is_numeric($status_id) ? $status_id : 0);

$followups = $wpdb->get_results("
    SELECT * FROM orders
    WHERE status_id = $status_id
    AND DATEDIFF(CURDATE(), date_waiting_pickup) % 7 = 0"); 
```

您可以确保安全查询并获得简单性和效率。在我的情况下，我只`prepare()`在`strings`涉及时使用，并且总是如图所示测试整数。

# c++ - 将我的 Visual Studio C++ 项目从 64 位移至 32 位系统

> ID：14077638
> 
> 赞同：0
> 
> 时间：2012-12-29T00:48:12.003
> 
> 标签：c++, visual-studio, dll

所以我买了一台新的台式电脑，我决定把我的项目移植到它上面。问题是我的台式机是 32 位的，而我的笔记本电脑是 64 位的。因此，我的笔记本电脑有 SysWOW64，但我的台式机没有。因此，当我尝试运行有关缺少桌面 System32 中的 .dll 的项目时，我遇到了错误。注意：我还从 2010 年升级到 Visual Studio 2012。我想知道如何设置我的项目以在我的台式计算机上查看 System32 而不是 SysWOW64。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:56:56.117

缺少的 .dll 是使用 Visual Studio 开发的应用程序所需的 Visual C++ 库。它们作为 Visual Studio 安装的一部分进行安装。要在未安装 Visual Studio 的系统上运行应用程序，您必须手动安装它们：

*   对于使用 VS 2010 构建的应用程序：[下载链接](http://www.microsoft.com/en-us/download/details.aspx?id=5555 "Microsoft Visual C++ 2010 可再发行包 (x86)")
*   对于使用 VS 2012 构建的应用程序：[下载链接](http://www.microsoft.com/en-us/download/details.aspx?id=30679 "适用于 Visual Studio 2012 Update 1 的 Visual C++ Redistributable")

* * *

编辑：丢失的 .dll 实际上是 Visual C++ 库的*调试*版本。这些不能作为单独的下载提供。要解决此问题，可以使用以下选项：

*   实用：编译*发布*版本并在目标机器上安装上面链接的发布库。
*   在目标机器上安装 Visual Studio，这也将安装*调试*库。
*   作为最后的手段，将*调试*.dll 从安装了 Visual Studio 的计算机复制到客户端计算机。

# ember.js - Ember 在遇到大型数据集时窒息

> ID：14077643
> 
> 赞同：8
> 
> 时间：2012-12-29T00:48:45.747
> 
> 标签：ember.js, ember-data

正在寻找由大型数据集导致的问题的解决方案，迫使 Ember 在尝试处理数据时锁定浏览器。

对于分页，我使用 tchak 方便的[分页 mixin](https://gist.github.com/1559628)对从后端 API 加载的大约 13,000 多个对象进行分页。

Ember Data 对象包含一个 ID、一个文本属性和多个数字属性。

问题是浏览器完成处理数据需要将近一分钟，同时使浏览器无法使用。Firefox 甚至发出警告说脚本正在耗尽所有浏览器资源并建议终止脚本。

我已经编写了自己的分页mixin，它按范围请求对象，即项目10-25，除了一个严重的限制外，它通常工作得很好：排序。为了对数据进行排序，我需要向后端发出额外的请求并重新加载对象，即使其中一些对象已经被加载。

我希望能够预先加载所有内容以简化排序过程，而无需对后端 API 进行额外请求。我正在寻找有关如何解决此问题的指导，但我对完全替代的方法持开放态度。

如果不出意外，是否可以减少 Ember 在尝试将所有 13k 对象加载到 ArrayController 时在浏览器上的资源占用？

* * *

我正在使用 Ember 1.0.0-pre2 和最新的 Ember 数据（目前为修订版 10）。

后端是 Rails 3.2.8。

* * *

**更新**我通过将数据加载到 ArrayController 属性而不是`content`. 这使加载时间从超过一分钟减少到只有几秒钟。然后，我将请求数量的项目切片并将其加载到内容中。这适用于任何数量的项目，但代价是无法轻松对数据进行排序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T19:24:06.040

我建议你看看**[Ember Table](http://addepar.github.com/ember-table/)**。该演示显示了一个包含 500 000 条记录的表，并且运行速度非常快。挖掘源代码可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-26T13:38:25.067

您不能从处理排序的数据库中查询视图吗？在查询字符串中传入排序条件 ?sortBy=name&sortAsc=true

# c# - 使用sqlite在c#上的sql查询LIKE问题

> ID：14077649
> 
> 赞同：0
> 
> 时间：2012-12-29T00:49:31.480
> 
> 标签：c#, system.data.sqlite

我在 c# 上使用 SQLite 提供程序。我正在尝试使用 SQL `select * from table where name like 'part_of_name%'`。但是这个查询不能正常工作。调试写入`System.InvalidOperationException in application System.Data.SQLite.dll`。

示例：我有`Books(id, name)`3 个项目的表：

1.  哈利·波特与魔法石
2.  哈利·波特与密室
3.  教父

在 SQLite Manager 查询`select * from Books where name like 'Harry%'`中显示了第 1 项和第 2 项，但在我的 c# 应用程序中只有第 1 项和调试异常。当我尝试时，`... like '%'`我的应用程序只显示第 1 项，但当我尝试时`... like 'God%'`，它显示第 3 项。请帮帮我。谢谢！这是代码：

```
sqliteConn.Open(); //open connection
sqliteDA.SelectCommand = new SQLiteCommand("select * from Books where name like '" + text + "%'", sqliteConn); //create SQL-query in sqlite data adapter
dataSet.Tables["Books"].Clear(); //clear our dataset.table with old info
sqliteDA.Fill(dataSet, "Books"); //fill our dataset.table with info from sqlite data adapter
sqliteConn.Close(); //close connection 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:00:47.633

您应该使用参数并将其应用于`%`参数值。尝试这样的事情，让我知道它是否有效：

```
SQLiteCommand cmd = new SQLiteCommand("select * from Books where name like @name", sqliteConn); 
cmd.Parameters.AddWithValue("@name", string.Concat(text, "%"));
sqliteDA.SelectCommand = cmd;

DataTable dataTable = new DataTable();
sqliteDA.Fill(dataTable); //just a DataTable instance 
```

# c# - 如何将文件夹（在帮助下）添加到资源以及如何使用它

> ID：14077650
> 
> 赞同：0
> 
> 时间：2012-12-29T00:49:36.253
> 
> 标签：c#, winforms, resources, system.diagnostics

我正在开发一个基本的计算器，我想在其中获得**帮助**。我已经用 XHTML 编写了它。它大约有 30 个 html 文件和 30 多个 jpg 文件（文件夹“*帮助*”中的所有内容）。

现在我想将这一切添加到我的表单中。我不知道将其添加到资源中以及如何打开“ *index.html* ”文件。我认为`System.Diagnostics.Process.Start();`它用于此类事情，但我从未使用过它。对此的激活事件将是单击“ *ToolStripMenuItem* ”。

我的下一个问题是：当我将所有文件添加到项目并发布程序（以便可以安装）时`System.Diagnostics.Process.Start();`，每个用户都可以使用吗？因为我不知道程序将安装在哪个文件夹中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:06:03.087

好的，您在这里混淆了许多不同的东西。如果您想将您的帮助作为单独的文件分发，您不需要资源。

只需在解决方案资源管理器中为您的解决方案/项目添加一个名为 help 的文件夹，然后使用 Windows 资源管理器将文件移动到其中。然后右键单击文件夹，选择添加现有项目，选择所有文件。然后在解决方案资源管理器中对它们的每个重要位，选择 properties ，并确保它们始终是复制的，或者如果更新则复制。. 现在，当您构建项目时，帮助文件将与它一起出现，但不在帮助文件夹中！然后，您可以启动 index.html（在与您的应用程序相同的文件夹中），并且关联的应用程序（几乎可以肯定是浏览器）将与该文件一起启动。

资源，意味着文件不是分开的，它们将与您的程序集一起编译，您必须提取它们以从外部启动或包含您自己的带有浏览器控件的帮助表单。必须有充分的理由去做所有这些工作......

如果你想要一个。右键单击项目，选择属性，选择资源选项卡。

# javascript - 在重新启动计时器之前显示一段时间的 Div

> ID：14077651
> 
> 赞同：1
> 
> 时间：2012-12-29T00:50:01.740
> 
> 标签：javascript, jquery, html, json

我有一个网站现在可以使用倒数计时器来显示 div。它适用于 Jquery 和一个简单的 JSON 响应，如下所示：

HTML：

```
<div class="info-block">
                <strong class="logo"><a target="_blank" href="http://example.com">example.com</a></strong>
                <div class="date-block">
                    <span class="label">next Online experience in:</span>
                    <ul class="countdown_timer">
                        <li>
                            <span class="meta">hours</span>
                            <strong class="number"><span class="counter_h">00</span> <span class="overlay">overlay</span></strong>
                        </li>
                        <li>
                            <span class="meta">minutes</span>
                            <strong class="number"><span class="counter_m">00</span> <span class="overlay">overlay</span></strong>
                        </li>
                        <li>
                            <span class="meta">seconds</span>
                            <strong class="number"><span class="counter_s">00</span> <span class="overlay">overlay</span></strong>
                        </li>
                    </ul>
                    <div class="live_now">Live Now!</div>
                    <a target="_blank" href="http://example.com"></a>
                </div>
            </div> 
```

Javascript：

```
jQuery(function() { 

  $.getQuery = function( query ) {
    query = query.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
    var expr = "[\\?&]"+query+"=([^&#]*)";
    var regex = new RegExp( expr );
    var results = regex.exec( window.location.href );
    if( results !== null ) {
        return results[1];
        return decodeURIComponent(results[1].replace(/\+/g, " "));
    } else {
        return false;
    }
  };

  var days, goLive, hours, intervalId, minutes, seconds;
  goLive = function() {
    $(".countdown_timer").hide();
    return $(".live_now").show();
  };
  days = void 0;
  hours = void 0;
  minutes = void 0;
  seconds = void 0;
  intervalId = void 0;
  return $.ajax({
    url: "http://example.org/script/next.json",
    dataType: "json",
    success: function(data) {
      var seconds_till;
      $("#churchonline_counter").show();
      if (typeof data.current_timestamp !== "undefined") {
        return goLive();
      } else if (typeof data.next_timestamp !== "undefined") {
        seconds_till = data.next_timestamp - (new Date().getTime() / 1000);
        hours = Math.floor((seconds_till % 86400) / 3600);
        minutes = Math.floor((seconds_till % 3600) / 60);
        seconds = Math.floor(seconds_till % 60);
        return intervalId = setInterval(function() {
          if (--seconds < 0) {
            seconds = 59;
            if (--minutes < 0) {
              minutes = 59;
              if (--hours < 0) {
                hours = 23;
              }
            }
          }
          $(".counter_h").html((hours.toString().length < 2 ? "0" + hours : hours));
          $(".counter_m").html((minutes.toString().length < 2 ? "0" + minutes : minutes));
          $(".counter_s").html((seconds.toString().length < 2 ? "0" + seconds : seconds));
          if (seconds === 0 && minutes === 0 && hours === 0) {
            goLive();
            return clearInterval(intervalId);
          }
        }, 1000);
      }
    }
  });
}); 
```

JSON：

```
{"next_timestamp":1356741640,"next_duration":3600,"next_title":"Title","next_description":"Description"} 
```

我的问题是：如何让 LIVE NOW div 在 JSON 代码行中所述的“next_duration”保持活动状态？它很好地解释了 JSON，完美地倒计时，在完美的时间显示隐藏的 div，然后在我刷新时它就会下降，并且在它再次刷新倒计时计时器之前不会保持隐藏的 div。

此外，在初始倒计时和刷新页面之后，倒计时无法正常工作......每次刷新页面时它都会从 24 小时开始倒计时。它没有从中断的地方继续...？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:24:01.090

由于您使用的是 jQuery，因此我建议您使用专为此类工作而设计的[jQuery Countdown 插件。](http://keith-wood.name/countdown.html)它可以立即使用，并且有很多选项并且易于使用。[这里有一个例子](http://jsfiddle.net/9WhWC/)。

```
$(function () {
    var newYear = new Date(); 
    newYear = new Date(newYear.getFullYear() + 1, 1 - 1, 1); 
    $('#defaultCountdown').countdown({until: newYear});
}); 
```

# ruby-on-rails-3 - Cancan + Devise，让管理员管理用户的最佳方式

> ID：14077653
> 
> 赞同：4
> 
> 时间：2012-12-29T00:50:10.153
> 
> 标签：ruby-on-rails-3, devise, cancan

我正在开发一个应用程序，公司管理员应该能够在其公司中创建和更新用户。（用户也可以独立创建和更新他们的帐户）。

我使用 Devise 和 Cancan 进行注册和权限管理。我配置了 Devise 以获得所需的注册和用户更新流程。我为管理视图创建了一个命名空间。

我的管理控制器 (/app/controllers/admin/base_controller.rb) 如下所示：

```
class Admin::BaseController < ApplicationController
  authorize_resource :class => false
  layout 'admin'

  def dashboard
  end
end 
```

除了我的“常规” users_controller，我还有一个控制器（/app/controllers/admin/users_controller.rb）和专用于管理员用户管理的相关视图。

```
class Admin::UsersController < Admin::BaseController
  ...
end 
```

现在，实现与设计相关的用户管理功能（此时，创建和更新用户）最简洁的方法是什么？

1.  在我的“常规”registrations_controller 和confirms_controller 中有条件（基于用户权限）来呈现和重定向不同的视图？（参见[在不同的控制器中设计表格](https://stackoverflow.com/questions/4081744/devise-form-within-a-different-controller)）

2.  或者在我的管理命名空间中创建新的控制器？如果最新的更好，要遵循的主要步骤是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T14:06:23.923

这就是你的问题，一旦你命名空间或将任何用户管理移动到另一个控制器，你就会离开设计的范围。因此，就您所在的位置而言`Admin::UsersController`，Devise 并不关心您的工作，没有您所说的“与设计相关的”管理功能。如果您愿意，您可以将您的控制器实现`Admin::UsersController`为标准的 RESTful 控制器。

这样，通过命名空间控制器创建用户，Devise 仍然会执行确认等操作。以这种方式创建和更新用户时，需要记住一件小事。如果您没有以管理员身份设置密码，则必须从 params 哈希中删除`password`and 。`password_confirmation`为此，您的`create`和`update`操作的开始将如下所示：

```
if params[:user][:password].blank?
  params[:user].delete(:password)
  params[:user].delete(:password_confirmation)
end 
```

我在许多应用程序中都采用了相同的方法，但还没有失败。

编辑

```
namespace :admin do
  resources :users
end 
```

# azure - SignalR - 无法为 HubConnection 创建 url

> ID：14077655
> 
> 赞同：0
> 
> 时间：2012-12-29T00:50:12.207
> 
> 标签：azure, visual-studio-2012, signalr, azure-web-roles

我开始在 Visual Studio 2012 上使用 SignalR，到目前为止我已经掌握了它的基本窍门，我引导自己完成了[这个](http://code.msdn.microsoft.com/windowsazure/SiteMonitR-dd4fcf77/sourcecode?fileId=65411&pathId=1807543619)示例（您可以浏览页面中的代码）。我决定要在上述示例中添加一个 REST 服务，所以我向它添加了一个基本服务并且它起作用了。

我想采取的下一步是在服务和 SignalR 之间添加一个通信，所以根据示例向我展示的内容，我只需要通过我的项目中的 url 创建一个 HubConnection（在这种情况下，示例使用网址 http:localhost:4200)。您可以检查 WorkerRoleHubConfiguration 类，它有一个具有下一行的方法：

```
return RoleEnvironment.GetConfigurationSettingValue("GUI_URL"); 
```

其中 GUI_URL 是 http:localhost:4200。

在我的服务类中，我刚刚添加了一个具有以下内容的方法：

```
var url = RoleEnvironment.GetConfigurationSettingValue("http://localhost:4200");

try
{
    HubConnection _connection = new HubConnection(url);
    IHubProxy _hub = _connection.CreateProxy("SiteMonitR");
    _hub.Invoke("displayResult");
}
catch (Exception ex)
{
    error = ex.ToString();
} 
```

但这会引发一个异常，[这个](http://pastebin.com/XdjsAku3)。

我不明白为什么我可以以与示例相同的方式获取 url，因为我所做的一切都与在 Server 类上所做的一样。

我试图实现的目标是，当访问端点并且我的系统发生变化时，SignalR 会通知连接到它的客户端。

我希望任何人都可以帮助我了解我的工作出了什么问题。

**编辑**

我在[这里](http://pastebin.com/WYUA23qZ)添加了我的 ServiceConfiguration.Local.cscfg、我的 ServiceConfiguration.Cloud.cscfg 和 ServiceDefinition.csdef 文件作为参考，我认为问题应该就在那里，但老实说我不知道​​为什么这不起作用.

**编辑 2**

我在这一行收到以下异常`var url = RoleEnvironment.GetConfigurationSettingValue("http://localhost:4200");`

例外是：

```
SEHExcetion occurred. External component has thrown an exception. 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:38:55.323

该 URL 用于 GUI - 它必须是信号器协商集线器连接的 Web 界面。在示例中，集线器（服务器）向来自配置的 URL 的连接发送更新 - 再次是 Web 界面（html 页面）。

通信逻辑需要驻留在 Server 类中，并从 worker 角色中调用。例如，在以 worker 角色调用您的服务后，调用 server.DoSomething("message") 以向服务器调用消息。该代码看起来像：

```
public Class Server 
{ ...
    public void DoSomething(string message)
    {
        _hub.Invoke("doSomething", message);
    }
    ...
} 
```

然后在 Server.Run() 添加：

```
 // whenever a DoSomething is called
    _hub.On<string>("doSomething", (message) => _hub.Invoke("doSomething", message)); 
```

在 SiteMonitRNotificationHub

```
public class SiteMonitRNotificationHub : Hub
{
    ...
    public void DoSomething(string address)
    {
        Clients.doingSomething(address);
    }
    ...
} 
```

最后在 web gui 的控制器脚本中：

```
c.siteMonitorHub
...
    .on('doingSomething', function (message) {
        c.doSomething(message);
    }) 
```

和...

```
this.doSomething= function (message) {
    // do something in your web page with message
}; 
```

# matlab - 如何在 Matlab 中的输入对话框上创建弹出剩余消息？

> ID：14077659
> 
> 赞同：0
> 
> 时间：2012-12-29T00:50:34.220
> 
> 标签：matlab

![示例图](../Images/44acf390b8eb5f397bb450ee102d0571.png)

如何创建如图所示的提醒消息，例如输入的矩阵大小必须大于 30，并且在输入满足此条件之前，只能按下对话框上的 OK 按钮。换句话说，只有满足条件，只有输入才能读入程序。

谢谢大家的帮助。

上面对话框的源代码：

prompt = {'输入矩阵大小：'，'输入颜色图名称：'};

dlg_title = '峰值函数的输入';

num_lines = 1;

def = {'20','hsv'};

答案 = inputdlg（提示，dlg_title，num_lines，def）；

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:30:35.780

提醒一下，只需设置一个工具提示属性...

对于 Ok 按钮，检查输入是否满足回调函数中的所需条件，如果满足则只接受对话框

# php - 如何每隔 x 小时调用一个链接/href？

> ID：14077664
> 
> 赞同：1
> 
> 时间：2012-12-29T00:51:14.650
> 
> 标签：php, javascript, cron

例如，有没有办法让函数“PHP/JS”或 cron 作业每 12 小时调用一次链接/href？

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:11:50.320

要每 12 小时通过 cron 作业运行 PHP 脚本，您可以执行以下操作：

```
0 */12 * * * curl -s -o /dev/null http://example.com/your-php-script.php 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T00:54:11.880

有这方面的尝试，例如

*   [https://github.com/StefanLiebenberg/cron.js](https://github.com/StefanLiebenberg/cron.js)
*   [http://elijahr.blogspot.de/2009/03/javascript-cron.html](http://elijahr.blogspot.de/2009/03/javascript-cron.html) ( [https://gist.github.com/4403566](https://gist.github.com/4403566) )

否则，如果可能的话，只编写一个传统的 cron 脚本可能会更简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T00:55:40.027

当然，您可以自己使用 cron 作业来完成，但是有一些监控服务会检查页面是否可访问并返回预期的数据，如果失败则通过电子邮件或短信发送给您。

# perl - 通过引用调用模块函数

> ID：14077666
> 
> 赞同：4
> 
> 时间：2012-12-29T00:51:49.770
> 
> 标签：perl, dynamic, module, subroutine

我正在考虑构建一个调度表来调用我编写的许多 Perl 模块。

例如，如果我有一个`Hello.pm`包含一个简单函数的包`hello()`，我想获得对该函数的代码引用。

以下不起作用：

```
my $code_ref=\&Hello->hello();
$code_ref->(); 
```

但是，如果函数 hello 从包中导出，则以下工作：

```
my code_ref=\&hello;
code_ref->(); 
```

有谁知道第一种情况的正确语法？或者这根本不可能？

最后，我想用我所有的代码引用填充一个哈希表。

#####感谢所有答案

几个答案指出的正确调用是：

```
my $code_ref=\&Hello::hello;
$code_ref->(); 
```

我想在调度表中加载 10 个不同文件中的大约 10 个模块。这使我更容易将配置作为数据加载，并与代码分开。这允许我在测试台中加载其他模块而无需修改我的代码——只需修改配置文件。Higher Order Perl 的作者 Mark Dominus 对此有一些很好的例子。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-12-29T01:42:23.943

如果要引用 Hello 模块中的 hello sub，则调用它，使用：

```
my $code_ref = \&Hello::hello;
$code_ref->(); 
```

如果要在 Hello 中调用一个名为“hello”的方法，可以这样：

```
my $method = "hello";
Hello->$method(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-12-29T09:15:25.613

`\&NAME`引用一个子。`Hello->hello()`不是子名称。作为一个表达式，它将是一个方法调用。

要获取对方法的引用，请使用`can`.

```
my $method_ref = Hello->can('hello'); 
```

如有必要，这将搜索继承树。现在您已经引用了正确的方法，您可以调用它：

```
Hello->$method_ref()
  -or-
$method_ref->('Hello') 
```

如果您需要一个无法正确调用该方法的回调，则需要创建一个可以正确调用该方法的回调。

```
my $code_ref = sub { Hello->hello(@_) }; 
```

这是它看起来完全动态的样子：

```
my $pkg         = 'Hello';  # Also works with object!
my $method_name = 'hello';
my $method_ref  = $pkg->can($method_name);

my $callback = sub { $pkg->$method_ref(@_) }; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-29T00:57:19.233

你可能想要的是

```
my $code_ref = \&hello;
$code_ref->(); 
```

# ruby - 添加单例方法并访问实例变量 - 未定义

> ID：14077673
> 
> 赞同：2
> 
> 时间：2012-12-29T00:52:36.183
> 
> 标签：ruby, metaprogramming

好的，所以我试图[解决这个难题中的第 2 步，但](http://ruby-metaprogramming.rubylearning.com/)遇到了麻烦。我的问题是在尝试访问实例变量`(@name)`甚至调用类上的方法时`(name getter)`，ruby 告诉我未定义的局部变量。对我来说，这似乎是一个范围问题。当一个动作名称和一个块作为参数给出时，问题就出现了。我相信一个单例已成功添加到实例变量中，但调用它时，ruby 告诉我“名称”是一个未定义的局部变量。有任何想法吗？知道如何以其他方式更有效地模拟该功能吗？

这是我的**Dog.rb**类：

```
class Dog
  MSGS = {:dance => 'is dancing', :poo => 'is a smelly doggy!', :laugh => 'finds this hilarious!'}
  attr_accessor :name

  def initialize(name)
    @name = name
  end

  def can(*actions)
    actions.each do |action|
      self.instance_eval do
        if block_given?
          define_singleton_method action do
            yield
          end
        else
          define_singleton_method(action) do
            name + ' ' + MSGS[action]
          end
        end
      end
    end
  end

  def method_missing(method_name,*args)
    name + " can't " + method_name.to_s
  end
end 
```

这是拼图中的 Dog_Game.rb：

```
require './dog'

lassie, fido, stimpy = %w[Lassie Fido Stimpy].collect{|name| Dog.new(name)}
lassie.can :dance, :poo, :laugh
fido.can(:poo){"#{name} is just wayyyy too smelly."} #name here is the source of the problem
stimpy.can :dance
stimpy.can(:cry){"#{name} cried AHHHH"}

p lassie.dance
p lassie.poo
p lassie.laugh
puts
p fido.dance
p fido.poo
p fido.laugh
puts
p stimpy.dance
p stimpy.poo
p stimpy.laugh
p stimpy.cry 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T02:38:31.120

`define_singleton_method`如果它是您想要的方法，则将块传递给：

```
def can(*actions, &block)
  actions.each do |action|
    if block_given?
      define_singleton_method(action, block)
    else
      define_singleton_method(action) { "#{name} #{MSGS[action]}" }
    end
  end
end 
```

这会输出您所期望的。

^(*（Delta 将 stimpy 首先证明`cry`不在其他实例上，并且`cry`每个实例都调用。）*)

```
Stimpy is dancing
Stimpy can't poo
Stimpy can't laugh
Stimpy cried AHHHH

Lassie is dancing
Lassie is a smelly doggy!
Lassie finds this hilarious!
Lassie can't cry

Fido can't dance
Fido is just wayyyy too smelly.
Fido can't laugh
Fido can't cry 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T03:19:31.350

1：你创建了一个丑陋的方法：

self.instance_eval {} == define_singleton_method(callback, &block)

你应该使用一个，但不能同时使用！

2：因为使用时范围发生了变化

```
self.instance_eval do 
   #coding
end 
```

你不能使用变量：name，所以只使用define_singleton_method！

对不起，我的英语很差！

# ios - textview 中的 NSString 属性消失

> ID：14077680
> 
> 赞同：0
> 
> 时间：2012-12-29T00:53:17.447
> 
> 标签：ios, xcode, nsstring

我认为通过 prepareSeque 方法应该将 textView 中写入的任何内容传递给下一个视图。在我在 seque 方法中使用 textField 和 textfield.text 之前工作正常。但我无法让它与 textView 一起使用。

我在 .h 文件中有一个 NSString 属性：@property (weak, nonatomic) NSString *textString; 我在 .m 文件中合成它：@synthesize textString =_textString;

在我的 textViewDidEndEditing 中，我可以看到（通过调试）文本视图中的文本已被拾取并且 textString 已设置。

*   (void)textViewDidEndEditing:(UITextView *)textView { NSString *theText = textView.text; self.textString = 文本；}

但是，当我想在我的 Seque 方法中检索 textString 时，它不包含任何文本：

```
-(void) prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender{
if ([segue.identifier isEqualToString:@"go"]) {

    ISecondViewController *vc = [segue destinationViewController];

    vc.funnyString = self.textString;
} 
```

如果我输入： self.textString =@"Hi Hi"; 在 Seque 方法中，funnyString 将与 Hi Hi 一起传递，以便该部分正常工作。

在这种情况下，我是否完全误解了 NSString 的“获取和设置”？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:01:29.203

你的问题是你一直在使用一个`weak`属性，`textString`所以`nil`当你的属性范围超出你的`textViewDidEndEditing`方法时。

为什么？因为弱引用的原理是只要`nil`你引用的对象不存在就会被设置为。这将是在`theText`您的方法结束时不存在的“”对象的情况。改为使用`strong`属性。

# java - 未知的 Java 7 功能

> ID：14077682
> 
> 赞同：0
> 
> 时间：2012-12-29T00:53:41.270
> 
> 标签：java, language-features

> **可能重复：**
> [Java 中如何使用匿名（内部）类？](https://stackoverflow.com/questions/355167/how-are-anonymous-inner-classes-used-in-java)

我刚刚在阅读 Java Puzzlers 时发现了以下功能

```
public class Main {
    public static void main(String[] args) {
        new Object() {
            void helloWorld() {
                System.out.println("Hello world!");
            }
        }.helloWorld();
    }
} 
```

我发现这非常方便。非常像封闭。问题是我找不到有关此构造的任何信息。谁能给我一个描述这个功能的链接？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T00:57:15.377

这是一个匿名内部类的例子。从 Java 1.1 开始支持它。

这可能看起来像闭包，但实际上有一些限制¹使它不如真正的闭包。然而，尽管有这些限制，匿名内部类仍然非常有用……并广泛用于 Swing 和需要轻量级回调的类似框架。

参考：

*   [Java 中如何使用匿名（内部）类？](https://stackoverflow.com/questions/355167/how-are-anonymous-inner-classes-used-in-java)
*   [http://docs.oracle.com/javase/tutorial/java/javaOO/innerclasses.html](http://docs.oracle.com/javase/tutorial/java/javaOO/innerclasses.html)
*   [http://www.javamex.com/tutorials/swing/anonymous_inner_classes.shtml](http://www.javamex.com/tutorials/swing/anonymous_inner_classes.shtml)

* * *

^(1 - 匿名内部类（或命名内部类）不像真正的闭包的原因是它不允许在封闭范围内引用可变局部变量。您可以引用实例变量或`final`局部变量，但命名非`final`局部变量（或方法参数变量）是编译错误。)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T00:56:34.367

```
new Object() {
    void helloWorld() {
        System.out.println("Hello world!");
    }
}.helloWorld(); 
```

这意味着，创建一个扩展 Object 的匿名类的实例，然后在其上调用 .helloWorld() 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:00:18.960

Java 规范 15.9.5。匿名类声明和 15.9.5.1。匿名构造函数 [http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.9.5](http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.9.5)

# python - 检查字典中的键是原子操作吗？

> ID：14077688
> 
> 赞同：3
> 
> 时间：2012-12-29T00:54:21.693
> 
> 标签：python

检查一个键是否在字典中`if key in mydict`- 一个原子操作？

如果没有，如果一个线程正在检查一个键，而另一个线程正在修改字典，是否会有任何负面影响？检查线程不会修改字典，它只是根据键的存在而有所不同。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T02:12:26.240

我认为“原子”并不是您真正感兴趣的。

如果您没有使用 CPython（或者您正在使用，但其中一个线程正在运行不在 GIL 下的 C 代码……），它绝对不是原子的，但在某些条件下它可能是安全的。

如果您使用的*是*CPython ，它在某种意义上是原子的，即`in`单个字节码操作（`COMPARE_OP 6`保证活着的对象。但它可能仍然不安全，除非在某些条件下。

首先，您在这里执行的更高级别的操作本质上是活泼的。如果线程 1 可以做`d['foo'] = 3`或`del d['foo']`同时线程 0 正在调用`'foo' in d`，则没有正确答案。这不是原子与否的问题——这里没有排序。

但是，如果您在应用程序级别确实有某种显式排序，那么就有了正确的答案，那么只有当两个线程都持有 GIL 时，您才能保证获得正确的答案。我*想*这就是你要问的，是吗？

这甚至只有在 CPython 中才有可能——即使在 CPython 中，它也等于保证`dict`当你尝试`hash`或`==`它时，你曾经放入的任何对象都不会释放 GIL，这通常是很难保证的。

现在，如果另一个线程只是替换与键关联的值，而不是更改键集怎么办？然后有*一个*正确的答案，它是并发可用的，只要`dict`实现避免改变这个操作的哈希表。至少在 2010 年 7 月 29 日之前发布的 CPython 版本中。Alex Martelli 间接保证在他对[python 字典的回答中是线程安全的？](https://stackoverflow.com/questions/3358770/python-dictionary-is-thread-safe). 因此，在这种受限情况下，您在 CPython 中是安全的——并且可能在其他实现中是安全的，但您需要在依赖它之前阅读代码。

As pointed out in the comments, the key you may end up comparing your lookup value with isn't guaranteed to be immutable, so even if the other thread doesn't do anything that changes the set of keys, it's *still* not absolutely guaranteed that you'll get the right answer. (You may have to craft a pathological key type to make this fail, but it would still be a *legal* key type.)

# c++ - 如何创建 3 状态自定义按钮？

> ID：14077689
> 
> 赞同：4
> 
> 时间：2012-12-29T00:54:21.253
> 
> 标签：c++, qt, pyqt, pyside, qpushbutton

我需要创建一个自定义按钮，它将具有对应于以下状态的 3 个不同的背景图像：

*   普通的
*   鼠标移到
*   鼠标按下

我想要按钮`QHBoxLayout`的左侧、右侧和中间（拉伸侧）有 3 个部分。

在中间尺寸内，我想要一个标签来显示文本。

我需要这个按钮也有一个“点击”事件。

我一直在做很多搜索来实现这一目标，但我真的迷失了。我尝试了很多东西，包括来自样式表的自定义小部件`QWidget`或样式`QPushButton`，但我未能为 3 个鼠标状态和单击事件实现 3 个图像。

我正在寻求帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T20:03:49.640

您可以[`border-image`](http://qt-project.org/doc/stylesheet-reference.html#border-image-prop)通过为每个状态组成一个图像来使用该属性，如下所示：

```
           | |
左图 | 中间图像 | 右图
           | |
```

然后通过将左右图像大小指定为边框切片大小和样式表的边框宽度。例如，如果右侧图像为 25 像素宽，左侧图像为 20 像素，您将拥有：

```
QPushButton {
    border-image: url(:/normal.png) 0 25 0 20 stretch stretch; 
    border-width:0 25 0 20; /* without it, only the middle images would show */
}
QPushButton:hover { 
    border-image: url(:/hover.png) 0 25 0 20 stretch stretch;
}
QPushButton:pressed { 
    border-image: url(:/pressed.png) 0 25 0 20 stretch stretch;
} 
```

这些值表示图像的顶部、右侧、底部和左侧之间的距离。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T07:30:19.140

好吧，首先，你应该有 3 个状态的 3 张图片，然后你可以使用函数**setStyleSheet**。

```
QPushButton *btn = new QPushButton;
btn->setStyleSheet("QPushButton{background:url(:/Resources/pause_nor.png);border:0px;}"
        "QPushButton:hover{background:url(:/Resources/pause_over.png);border:0px}"
        "QPushButton:pressed{background:url(:/Resources/pause_over.png); position: relative;top: 1px; left: 1px;}"); 
```

# php - 用 PHP 调用 SQL 外键数据

> ID：14077691
> 
> 赞同：3
> 
> 时间：2012-12-29T00:54:28.307
> 
> 标签：php, sql, foreign-keys, relationships

我需要更好地掌握操作和使用我需要制作的 SQL 表的过程，这样我才能继续弄清楚我应该如何制作它们并构造它们以使其工作。

如果我有一个衬衫表和另一个尺码表，并且我在衬衫表上使用外键链接到尺码表以表示该列的多个选项。我只需要在 PHP 编码中调用衬衫表吗？如果是这样，我如何告诉 PHP 收集尺寸表上每一行可用的任何选项？

如果在表中有

颈围尺寸，

汤匙领尺寸

我将它设置为 vnecks 只有 s,m,l,1x 并且勺形颈有 xs,s,m,l,1x,2x,3x。如何对 PHP 进行编码以识别我在每一行中为该列逻辑设置的差异？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T01:16:47.410

听起来您实际上需要至少三张表，一张用于衬衫，一张用于尺码，一张用于将衬衫与尺码相关联。您可以通过多种方式使用 PHP 来查询数据，但很可能您只想使用 JOIN 来同时从所有表中获取数据。

所以也许是这样的：

```
shirts table:
shirt_id (auto-incrementing primary key)
...other shirt-related fields

sizes table:
size_id (auto-incrementing primary key)
size_value (i.e. S, M, L)
...other size-related fields

shirt_sizes table:
shirt_id (foreign key to shirts table)
size_id (foreign key to sizes table)
(you have compound primary key across these two fields) 
```

你会像这样查询它

```
SELECT * (or whatever fields you need)
FROM shirts
INNER JOIN shirt_sizes ON shirts.shirt_id = shirt_sizes.shirt_id
INNER JOIN size ON shirt_sizes.size_id = sizes.size_id 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-29T01:24:14.260

具有以下表结构：

```
CREATE TABLE `shirt` (
    `id` INTEGER NOT NULL,
    `name` VARCHAR(32),
    PRIMARY KEY( `id` )
);

CREATE TABLE `size` (
    `id` INTEGER NOT NULL,
    `name` VARCHAR(4),
    PRIMARY KEY( `id` )
);

CREATE TABLE `shirt_size` (
    `shirtId` INTEGER NOT NULL,
    `sizeId` INTEGER NOT NULL,
    PRIMARY KEY( `shirtId`, `sizeId` ),
    FOREIGN KEY( `shirtId` ) REFERENCES `shirt`( `id` ),
    FOREIGN KEY( `sizeId` ) REFERENCES `size`( `id` )
); 
```

而这个数据：

```
INSERT INTO
    `shirt` ( `id`, `name` )
VALUES
    ( 1, "vneck" ),
    ( 2, "scoop neck" );

INSERT INTO
    `size` ( `id`, `name` )
VALUES
    ( 1, "xs" ), ( 2, "s" ), ( 3, "m" ),
    ( 4, "l" ), ( 5, "1x" ), ( 6, "2x" ), ( 7, "3x" );

INSERT INTO
    `shirt_size` ( `shirtId`, `sizeId` )
VALUES
    ( 1, 2 ), ( 1, 3 ), ( 1, 4 ), ( 1, 5 ),
    ( 2, 1 ), ( 2, 2 ), ( 2, 3 ), ( 2, 4 ), ( 2, 5 ), ( 2, 6 ), ( 2, 7 ); 
```

在 MySQL 中，你可以这样做：

```
SELECT
    `shirt`.`id`,
    `shirt`.`name`,
    GROUP_CONCAT( `size`.`name` ) as `sizes`
FROM
    `shirt`
JOIN
    `shirt_size`
    ON `shirt_size`.`shirtId` = `shirt`.`id`
JOIN
    `size`
    ON `size`.`id` = `shirt_size`.`sizeId`
GROUP BY `shirt`.`id`; 
```

这将导致类似：

```
+----+------------+-------------------+
| id | name       | sizes             |
+----+------------+-------------------+
|  1 | vneck      | s,m,l,1x          |
+----+------------+-------------------+
|  2 | snoop neck | xs,s,m,l,1x,2x,3x |
+----+------------+-------------------+ 
```

不确定其他[RDBMS](http://en.wikipedia.org/wiki/Relational_database_management_system "关系数据库管理系统")是否具有类似于 MySQL 的聚合函数`GROUP_CONCAT()`。如果没有，那么使用类似的东西：

```
SELECT
    `shirt`.`id`,
    `shirt`.`name` as `shirtName`,
    `size`.`name` as `sizeName`
FROM
    `shirt`
JOIN
    `shirt_size`
    ON `shirt_size`.`shirtId` = `shirt`.`id`
JOIN
    `size`
    ON `size`.`id` = `shirt_size`.`sizeId`; 
```

这将为您提供每种尺寸的多行，每件衬衫。

# sql - MVC 4 中的连接语句

> ID：14077698
> 
> 赞同：1
> 
> 时间：2012-12-29T00:55:46.560
> 
> 标签：sql

我正在尝试为我的语句找到正确的语法，但我迷路了......我拥有的是一个包含制造商名称的表格，一个包含所有不同类型卡片的表格，以及一个包含我的所有信息的表格牌。我想要做的是，一旦选择了制造商，我想在 Cards 表中查询所有具有相同制造商 ID 的条目并从那里获取不同的类型，对类型进行分组，然后将它们的名称显示给浏览器。

```
Manufacturers Table:
Id || Name

Types Table:
Id || Name

Cards Table:
Id || Manufacturer || Type || Set || Year || Number || Name || Team || Quantity || Price 
```

我有什么半作品（它多次显示相同的类型名称）：

```
var ts = db.Query(@"SELECT Types.Id, Types.Name FROM Types LEFT OUTER JOIN Cards ON Types.Id = Cards.Type WHERE Manufacturer=@0 ORDER BY Types.Name", ManId).ToList(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:16:09.320

添加`DISTINCT`到您的`SELECT`声明中。

```
var ts = db.Query(@"SELECT DISTINCT Types.Id, Types.Name FROM Types LEFT OUTER JOIN Cards ON Types.Id = Cards.Type WHERE Manufacturer=@0 ORDER BY Types.Name", ManId).ToList(); 
```

# backbone.js - 主干.js 应用程序中的 jQuery 库（砌体）

> ID：14077703
> 
> 赞同：1
> 
> 时间：2012-12-29T00:56:16.193
> 
> 标签：backbone.js

如何在backbone.js 应用程序中使用jQuery 库（砌体）？我应该将它添加到我的视图渲染方法中吗？你能举个例子吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T03:17:10.067

jQuery 插件在 Backbone 应用程序中工作得很好，因为 Backbone 在 Backbone.View 的底层使用了 jQuery

我已经写了几篇关于在 Backbone 中使用 jQuery 插件的文章，虽然我没有具体展示如何使用 Masonry，但我所经历的原则应该能让你走上让它与你的应用程序一起工作的道路。

[http://lostechies.com/derickbailey/2012/02/20/using-jquery-plugins-and-ui-controls-with-backbone/](http://lostechies.com/derickbailey/2012/02/20/using-jquery-plugins-and-ui-controls-with-backbone/)

和

[http://www.kendoui.c​​om/blogs/teamblog/posts/12-11-26/backbone_and_kendo_ui_a_beautiful_combination.aspx](http://www.kendoui.com/blogs/teamblog/posts/12-11-26/backbone_and_kendo_ui_a_beautiful_combination.aspx)

# vba - 单击时更改 PowerPoint 文本

> ID：14077704
> 
> 赞同：9
> 
> 时间：2012-12-29T00:56:31.537
> 
> 标签：vba, hyperlink, powerpoint

我有几个文本框。

他们说：

```
Fruit 1
Fruit 2
Fruit 3 
```

当我单击每一个时，文本应相应更改为：

```
Apple
Banana
Dragonfruit 
```

单击其中一个时，我希望它更改为相应的文本，但其他文本保持不变。

有什么方法可以做到这一点，而无需简单地超链接一堆幻灯片？（那将是 8 张幻灯片，顺便说一句）。我假设另一种方法必须使用 VBA 编码，但我更喜欢没有的东西。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-12-29T21:50:58.257

触发动画应该这样做。就是这样。

复制 Fruit 1 文本框，将文本更改为 Apple。将 Apple 文本框移动到 Fruit 1 的正上方，并确保它至少比 Fruit 1 宽一点。
给 Apple 的形状填充幻灯片背景。现在向 Apple 添加一个出现动画，然后在动画窗格中，计时效果，将其设置为在单击 Fruit 1 时出现在触发器上。

测试以确保它正常工作。最后，选择两个文本形状并按 Ctrl+D 以根据需要多次复制它们。将骗子中的文本更改为 Fruit 2/Banana 等。它们将保留动画，因此您无需为每个人完成所有这些步骤。

[掸掉双手] 我在这个星球上的工作已经完成。

# c# - 使用特定错误代码捕获 oledb 异常

> ID：14077708
> 
> 赞同：2
> 
> 时间：2012-12-29T00:56:45.450
> 
> 标签：c#, exception, try-catch, oledb

我正在尝试捕获重复的密钥违规行为。我可以在 Intellisense 弹出窗口中看到 System.OleDB.OleDBException，但内部异常为空。如何访问 System.OleDB.OleDBException 中的错误代码？

格雷格

```
try 
{
    MyData.ConExec(sSQL);
}
    catch (Exception ex)
{
OleDbException innerException = ex.InnerException as OleDbException;
if (innerException.ErrorCode == -2147217873)
{
    // handle exception here..
}
else
{
    throw;
}
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:06:21.437

不要声明异常的实例。如果你这样做，它肯定会返回空的。

```
try
{
    MyData.ConExec(sSQL);
}
catch (OleDbException ex)
{
    // handle excpetion here...

    if (ex.ErrorCode == -2147217873)
    {

    }
}
catch (Exception e)
{
    // if other exception will occur
} 
```

# hadoop - hadoop 多行混合记录

> ID：14077713
> 
> 赞同：1
> 
> 时间：2012-12-29T00:57:18.807
> 
> 标签：hadoop, logparser

我想解析由 fidonet mailer binkd 生成的日志文件，它们是多行的，而且更糟糕 - 混合：多个实例可以写入一个日志文件，例如：

```
 27 Dec 16:52:40 [2484] BEGIN, binkd/1.0a-545/Linux -iq /tmp/binkd.conf
    + 27 Dec 16:52:40 [2484] session with 123.45.78.9 (123.45.78.9)
    - 27 Dec 16:52:41 [2484] SYS BBSName
    - 27 Dec 16:52:41 [2484] ZYZ First LastName
    - 27 Dec 16:52:41 [2484] LOC City, Country
    - 27 Dec 16:52:41 [2484] NDL 115200,TCP,BINKP
    - 27 Dec 16:52:41 [2484] TIME Thu, 27 Dec 2012 21:53:22 +0600
    - 27 Dec 16:52:41 [2484] VER binkd/0.9.6a-173/Win32 binkp/1.1
    + 27 Dec 16:52:43 [2484] addr: 2:1234/56.78@fidonet
    - 27 Dec 16:52:43 [2484] OPT NDA CRYPT
    + 27 Dec 16:52:43 [2484] Remote supports asymmetric ND mode
    + 27 Dec 16:52:43 [2484] Remote requests CRYPT mode
    - 27 Dec 16:52:43 [2484] TRF 0 0
    *+ 27 Dec 16:52:43 [1520] done (from 2:456/78@fidonet, OK, S/R: 0/0 (0/0 bytes))*
    + 27 Dec 16:52:43 [2484] Remote has 0b of mail and 0b of files for us
    + 27 Dec 16:52:43 [2484] pwd protected session (MD5)
    - 27 Dec 16:52:43 [2484] session in CRYPT mode
    + 27 Dec 16:52:43 [2484] done (from 2:1234/56.78@fidonet, OK, S/R: 0/0 (0/0 bytes)) 
```

因此，日志文件不仅是多行的，每个会话的行数不可预测，而且还可以在其间混合多条记录，例如会话 1520 在会话 2484 的中间完成。hadoop 中解析此类的正确方向是什么一份文件？还是我应该逐行解析，然后以某种方式将它们合并到一个记录中，然后稍后使用另一组作业将这些记录写入 SQL 数据库？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-30T08:36:39.533

Hadoop 的正确方向是开发自己的输入格式，记录阅读器将逐行读取输入并生成逻辑记录。
可以说——你实际上也可以在 mapper 中做到这一点——它可能会更简单一些。缺点是它不是 hadoop 此类代码的标准打包，因此可重用性较差。

在我看来，你提到的其他方向对于 hadoop 来说并不“自然”。具体来说 - 为什么要使用所有复杂（且昂贵）的洗牌机器将已经在手的几条生产线连接在一起。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:56:59.380

首先，解析文件不是你想要做的；您正在尝试从数据中提取一些信息。

在您的情况下，您可以考虑多步 MR 作业，其中第一个 MR 作业基本上（部分）按 session_id 对您的输入进行排序（进行一些过滤？一些聚合？多个减速器？）然后减速器或下一个 MR 作业将进行实际计算。

如果不解释您试图从日志文件中提取的内容，就很难给出更明确的答案。

此外，如果您的数据很小，也许您可​​以在没有 MR 机器的情况下处理它？

# flash - AS2 onPress 仅在 PNG 影片剪辑中的非透明区域？

> ID：14077715
> 
> 赞同：0
> 
> 时间：2012-12-29T00:57:33.080
> 
> 标签：flash, actionscript, png, actionscript-2

这可能吗？我有一个不规则形状的 png，其透明度包含在影片剪辑中，但是当我在影片剪辑上使用 onPress 时，它会按下整个边界框。

```
pngMC.onPress = function() { 
```

有没有办法让它只在按下 PNG 的非透明区域时触发？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:28:16.497

我可能是错的，但我不认为 AS2 有这种能力......因为它会将整个剪辑视为位图/png 本身......如果它是透明的、半透明的或不透明的，它不会有任何区别.

我想到了一些不同的解决方法：

*   将 png 转换为矢量并实际删除那些空白区域（矢量形状将支持不规则的按钮形状）。这将如何工作取决于 png 内容。

*   创建一个蒙版并实际隐藏动画剪辑中 png 的不可见区域。这可能是最简单的，你只需要在未来记住你为什么要屏蔽已经空的区域。

*   移动到 AS3，您可以在其中指定一个单独的按钮点击区域，该区域可以是任何形状和大小，独立于按钮视觉效果（只是想我会把它扔在那里，即使它可能工作量太大）。

# javascript - jQuery-File-Upload 不一致地给出文件数据

> ID：14077719
> 
> 赞同：1
> 
> 时间：2012-12-29T00:58:15.037
> 
> 标签：javascript, jquery-file-upload

[jQuery-文件-上传](https://github.com/blueimp/jQuery-File-Upload)

上传脚本：

```
$('#fileupload').fileupload({
    url: 'api/combox_upload.php',
    type: 'POST',
    dataType: 'json',
    dropZone: $dropZone,
    singleFileUploads: true,
    done: function (e, data) {
        attachments = attachments.concat(data.result);
        refreshAttachments();
    },
    add: function(e, data) {
        var file = data.files[0];
        data.context =
            $('<li>',{'class':'file-upload-item'})
                .append($('<span>').text(file.name))
                .append(
                    $('<div>',{'class':'progressbar'})
                    .append($('<div>',{'class':'progress'}))
                ).appendTo($fileUploads);
        data.submit(); // start upload immediately
    },
    progress: function(e, data) {
        var progress = data.loaded / data.total;
        data.context.find('.progress').stop().animate({'width':(progress*100)+'%'},100,'linear');
        //data.context.find('.progress').css({'width':(progress*100)+'%'});
    }
}); 
```

在我的`api/combox_upload.php`脚本`echo json_encode($_FILES)`中，有一半时间它返回空白（我正在 Chrome 开发人员工具栏中观看 XHR 请求响应）。

这是为什么？如何修复它，使其始终提交文件？

编辑：对于较大的文件，它似乎更频繁地发生。

PHP没有正确处理多部分数据可能是一个问题吗？我注意到 XHR 请求会在文件上传开始后立即出现，但 PHP 显然还没有得到整个文件……那它是做什么的呢？当我尝试访问`$_FILES`对象时它会阻塞还是只给我一个空数组？我有什么特别的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-01-02T18:34:55.110

通过反复试验，我发现此问题仅发生在大于约 23 MiB 的文件中。我不确定这是一个通用常量还是特定于我的服务器的配置方式。

不过，我想出了如何绕过这个限制。您需要设置`singleFileUploads`为假，`true`例如`multipart`

```
$('#fileupload').fileupload({
    url: 'api/upload.php',
    type: 'POST',
    dataType: 'json',
    singleFileUploads: true,
    multipart: false,
    ... 
```

然后在您的`php`脚本中，您可以读取如下数据：

```
$handle = fopen('php://input', 'r');

$file_data = '';

while(($buffer = fgets($handle, 4096)) !== false) {
    $file_data .= $buffer;
}

fclose($handle); 
```

数组仍然是空的`$_FILES`，所以你不能从那里得到文件名，但它似乎是在`Content-Disposition`标题中设置的。我写了一个正则表达式来把它拉出来：

```
$headers = getallheaders();
$filesize = strlen($file_data);
if(isset($headers['Content-Disposition']) && preg_match('`\bfilename="((?:\\.|[^"])*)"`',$headers['Content-Disposition'], $m)) {
    $filename = urldecode($m[1]);
} else {
    $filename = 'unknown';
} 
```

# java - 不一致的数据类型：预期 NUMBER 得到 BINARY

> ID：14077721
> 
> 赞同：5
> 
> 时间：2012-12-29T00:58:34.297
> 
> 标签：java, oracle, hibernate

我是 Hibernate 的新手，我正在尝试对我创建的 oracle 数据库进行“简单”的用户插入。

我使用 Netbeans Hibernate 向导创建了所有必要的文件：hibernate.cfg.xml、hibernate、reveng.xml、Users.hbm.xml、Users.java

如果我用 oracle sql developer 插入用户，我可以从 java 代码中获取这个用户。但是，如果我尝试插入用户，则会收到错误消息：不一致的数据类型：预期的 NUMBER 得到了 BINARY。

部分用户.hbm.xml：

```
<hibernate-mapping>
  <class name="HibernateDB.Users" schema="SYSTEM" table="USERS">
    <id name="userid" type="int">
      <column name="USERID" precision="9" scale="0"/>
      <generator class="increment"/>
    </id>
    ... 
```

部分用户.java：

```
public class Users implements java.io.Serializable
{

    private int userid;
    private String username;
    private String password;
    private String firstName;
    private String lastName;
    private Serializable dateOfBirth;
    private Serializable registrationDate;
    ... 
```

部分 insertUser 方法（所有参数都是字符串）：

```
 session = HibernateUtil.currentSession();
    Transaction tx = session.beginTransaction();
    Calendar dOfBirth = Calendar.getInstance();
    dOfBirth.set(Integer.parseInt(year_of_birth), Integer.parseInt(month_of_birth), Integer.parseInt(day_of_birth));
    Calendar regDate = Calendar.getInstance();
    Timestamp dOfBirthTS = new Timestamp(dOfBirth.getTimeInMillis());
    Timestamp regDateTS = new Timestamp(regDate.getTimeInMillis());
    Users user = new Users();
    user.setUsername(username);
    user.setPassword(password);
    user.setFirstName(first_name);
    user.setLastName(last_name);
    user.setDateOfBirth(dOfBirthTS);
    user.setRegistrationDate(regDateTS);
    session.saveOrUpdate(user);
    ans = user.getUserid();
    tx.commit(); 
```

数据库中的用户表：

```
USERID NUMBER(9,0) - the primary key
USERNAME VARCHAR(200)
PASSWORD VARCHAR(200)
FIRST_NAME VARCAHR(200)
LAST_NAME VARCHAR(200)
DATE_OF_BIRTH TIMESTAMP
REGISTRATION_DATE TIMESTAMP 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-12-29T13:27:02.333

我找到了真正的问题，因此我可以解决它！

真正的问题：表有 TIMESTAMP 字段，休眠将它们生成为 Serializable，这会产生错误，因为 Serializable 不是 TIMESTAMP。

修复：我向 hibernate.reveng.xml 添加了一个映射规则：

```
<hibernate-reverse-engineering>
  <schema-selection match-schema="SYSTEM"/>
    <type-mapping> 
        <sql-type jdbc-type="OTHER" hibernate-type="java.util.Calendar" /> 
    </type-mapping>
    ... 
```

它也适用于 Date 类型，而不仅仅是 Calender（也许更多类型我没有尝试过）。

结论：不应该依赖自动生成机制。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-10-04T06:43:38.227

当我们声明一个带有`@Column`注解的 Object 类型属性时，可能会出现这个问题。

```
@Column(name="job_category")
private MiscTypeSetup jobCategory; 
```

我们应该用`@JoinColumn`注释声明。

```
@ManyToOne
@JoinColumn(name="job_category")
private MiscTypeSetup jobCategory; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-05-10T19:49:10.363

在不小心尝试使用具有空值的字段之一来持久化实体之前，我已经收到此错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T03:29:14.413

改用 Long 作为数据类型。它可能会有所帮助。

```
private Long userid; 
```

# php - 是否可以将 PDO 参数绑定到对象的成员变量？

> ID：14077724
> 
> 赞同：2
> 
> 时间：2012-12-29T00:59:07.733
> 
> 标签：php, oop, pdo, prepared-statement, pdostatement

使用[`PDOStatement::bindParam()`](http://php.net/manual/en/pdostatement.bindparam.php)，可以将参数绑定到变量——这在多次执行准备好的语句时特别有用，每个语句都有不同的参数值。例如：

```
$dbh = new PDO('mysql:dbname=foo', 'eggyal', 'password1');
$qry = $dbh->prepare('DELETE FROM bar WHERE qux = ?');
$qry->bindParam(1, $qux, PDO::PARAM_INT);

while (true) {
  $qux = ... ;
  $qry->execute();
  // etc
} 
```

我的问题是：

1.  是否可以将参数绑定到对象的成员变量？例如：

    ```
    $qry->bindParam(1, $obj->qux, PDO::PARAM_INT); 
    ```

2.  如果是这样，这样的参数绑定*到哪个 object*的成员变量：`bindParam()`调用时引用的那个，还是语句执行时引用的那个？例如：

    ```
    $obj->qux = 123;

    $obj = new stdClass();
    $obj->qux = 456;

    $qry->execute();  // which value is used for qux ? 
    ```

3.  这种行为记录在哪里（如果有的话）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T01:09:36.153

PHP 存储变量的引用以使用它。当您调用`$qry->bindParam(1, $obj->qux, PDO::PARAM_INT)`时，存储的引用是实例化类成员的引用。

When you change the member `$obj->qux`, the reference is still the same than the one stored in your `$obj`. However, if you reinstanciate `$obj` to a new class, then every references are changed, but your old object is still in memory ! So when you assign a new value to the new `$obj->qux`, it is not the same variable used, so running `$qry->execute` will use the old value.

I hope I've been clear enough.

# javascript - 获取元素外的第一个字符

> ID：14077728
> 
> 赞同：0
> 
> 时间：2012-12-29T01:00:04.333
> 
> 标签：javascript, jquery

如何在 jQuery 中获取元素之前的第一个直接字符？在这种情况下，这将返回`d`以获取之前的第一个直接字符`.cursor`：

```
<span class="input">pwd<span class="cursor">&nbsp;</span></span> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:15:12.540

由于 jQuery 忽略常规文本节点，因此您需要使用一些 DOM 来执行您正在执行的操作。我会做这样的事情：

```
var sibling = $('.cursor')[0].previousSibling.nodeValue;
console.log(sibling.charAt(sibling.length - 1)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T01:20:50.950

使用 jQuery 内容（）

```
var text=$('.input').contents().filter(function(){
        return this.nodeType==3 && $(this).next('.cursor').length
    }).text() || ' ';
var lastLetter=text.substr(-1); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:03:52.160

```
var txt = (((($('.cursor')[0] || {}).previousSibling || {}).nodeValue || "").match(/.$/) || [""])[0]; 
```

人类可读：选择“.cursor”并获取第一个匹配元素（实际节点，而不是 jQuery 对象）。获取该节点的前一个兄弟节点，它应该是一个文本节点，并获取它的节点值（文本内容）。在不一定知道字符串长度的情况下抓取最后一个字符，并返回匹配的字符串。每一步，都有一个多余的`|| {}`，`|| ""`或`|| [""]`确保下一个步骤得到预期类型的​​东西，而不是`null`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T01:15:27.603

我能想到的几件事可能与您想要做的事情很接近，首先请注意，您的目标元素在哪里以及前一个角色在哪里很重要。首先，最简单的方法就是在 .parent().html() 上使用正则表达式来获取元素开始之前的字符。

```
var content = $(".cursor").parent().html();
var lastChar = content.replace(/.*?(.?)<.*?class="cursor".*?/g, '$1'); 
```

当然，您可能需要稍微调整正则表达式以适应您的工作，但这应该可以帮助您入门。如果您想从目标（例如 pwd ）中获取前一个元素的最后一个字符，您可以在 .prev().html() 上使用 substr。

```
var content = $(".cursor").prev().html();
var lastChar = content.substr( content.length-2, 1 ); 
```

# c++ - 从单独的函数中更改 QVector 变量

> ID：14077731
> 
> 赞同：1
> 
> 时间：2012-12-29T01:00:51.110
> 
> 标签：c++, function, variables

我在deck.cpp 中有一个函数，它处理来自一副牌的随机牌：

```
QVector<card> Deck::deal_rand_cards(QVector<card> vDeck, int quantity)
{

QVector<card> vDealt;
int deckSize = vDeck.size();
card randCard;

qsrand(QTime::currentTime().msec());

for (int i=0;i<quantity;i++)
{
    int rn=rand()%deckSize;
    randCard = vDeck[rn];
    qDebug()<<vDeck.size();

    vDealt.append(randCard);

    vDeck.remove(rn);
}

return vDealt;
} 
```

我的问题是，每次从 mainwindow.cpp 运行该函数时，vDeck 都包含完整的牌组，而不是牌组减去我用该函数删除的已处理牌。

如果我两次发 3 张牌，调试打印：

> 54 53 52 54 53 52

如何更新其他函数和其他文件中使用的函数中的变量？我感觉涉及到一个指针，但我仍然不太了解这个概念。

谢谢

这是deck.h

```
#ifndef DECK_H
#define DECK_H
#include <QString>
#include <QVector>

struct card
{
    QString suit;
    QString color;
    int rank;
};

class Deck
{

private:
    int size;
    int jokers;

public:
    QVector<card> build_deck(int deckSize, int jokers);
    QVector<card> deal_rand_cards(QVector<card> vDeck, int quantity);

};

#endif // DECK_H 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:05:18.677

您需要将 vDeck 的引用传递给`deal_rand_cars`函数，目前您正在处理 vDeck 的副本。

```
QVector<card> deal_rand_cards(QVector<card> &vDeck, int quantity);
                                           ^^^ pass by reference 
```

如果您使用引用作为参数，该函数将使用原始数据而不是副本。

# ios - 关于 nsrunloop 的详细信息

> ID：14077737
> 
> 赞同：0
> 
> 时间：2012-12-29T01:01:35.777
> 
> 标签：ios, nsthread, nsrunloop

> **可能重复：**
> [了解 NSRunLoop](https://stackoverflow.com/questions/12091212/understanding-nsrunloop)

直到现在我知道每个线程都有自己的运行循环我不知道我是否想对了。我对 nsrunloop 没有一个简短的了解，但我想知道什么是 nsrunloop，它的目的是什么，以及为什么所有线程都有自己的 runloop（如果我是对的）。请帮助我了解 nsrunloop。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:14:52.627

runloop 基本上是一个扩展的 while 循环，其工作方式类似于 C 选择调用。

它负责从其来源获取事件并调度这些事件。鼠标点击、窗口移动、定时器、流事件……任何东西都可以是一个runloop源。

这就是要点。在 SO 或苹果文档中的无数骗局中阅读更多关于它的信息 :)

# r - R 中的 VLMC 封装

> ID：14077739
> 
> 赞同：1
> 
> 时间：2012-12-29T01:01:51.950
> 
> 标签：r

我正在尝试使用 R 中的 VLMC 包分析文学文本。尝试将数据放入马尔可夫链时，出现此错误：

> vlmc(txt, cutoff = 5) 中的错误：字母太大；目前限制为最多 255 个字母

有没有办法绕过这个限制？我能做些什么来解决这个问题？

# c# - 从 NAudio asioOut 写入多个 wav 文件

> ID：14077743
> 
> 赞同：2
> 
> 时间：2012-12-29T01:02:25.900
> 
> 标签：c#, wav, naudio, asio

我正在尝试录制 3-4 个音频流并将它们写入单独的 wav 文件。我正在使用 NAudio 的 asioOut 来捕获音频。起初我只是在写一个 3 或 4 通道的 wav 文件。所以我在这里搜索问题并认为我找到了[答案](https://stackoverflow.com/questions/12075062/saving-each-wav-channel-as-a-mono-channel-wav-file-using-naudio)，但我仍然无法弄清楚。现在我可以编写单独的 wav 文件，但它们在每个文件中有多个通道。

channel_1.wav --------> 有通道 1 和 2

channel_2.wav --------> 有通道 1 和 3

channel_3.wav --------> 有通道 2 和 3

我认为当我尝试解析*GetAsInterleavedSamples()*时出现问题。

这是我的 asioOut_AudioAvailable()

```
 void asioOut_AudioAvailable(object sender, AsioAudioAvailableEventArgs e)
    {     

        float[] samples = new float[2 * 44100 * GetUserSpecifiedChannelCount()];

        samples = e.GetAsInterleavedSamples();

        int offset = 0;
        while (offset < samples.Length)
        {
            for (int n = 0; n < this.writers.Length; n++)
            {
                this.writers[n].WriteSamples(samples, offset, 2);
                offset += 2;
            }
        }

    } 
```

我是新手，所以我只是在学习，任何帮助将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T08:05:52.383

如果我理解正确，您只想向每个编写器写入一个样本，因此 for 的第三个参数`WriteSamples`应该是 1，并且 offset 应该增加 1。您可能已经从正在处理的示例中复制了 +=2字节数组中的 16 位音频。

# javascript - JQuery - 动画 div 到鼠标坐标

> ID：14077744
> 
> 赞同：1
> 
> 时间：2012-12-29T01:02:55.383
> 
> 标签：javascript, jquery, jquery-animate, mouseevent

我正在尝试将 div 发送到单击鼠标时获得的一些鼠标坐标。第一部分，我得到鼠标坐标的地方工作正常——我只是很难创建动画部分。

```
$("#container").click(function(e){
   var parentOffset = $(this).parent().offset(); 
   var relX = e.pageX - parentOffset.left;
   var relY = e.pageY - parentOffset.top;

   console.log (relX);
   console.log (relY);

  $("#move").animate({left: 'relX', top: 'relY'});

}); 
```

CSS：

```
#container {
width: 500px;
height 500px;
}

#move {
width: 20px;
height: 20px;
background-color: #000;
position : absolute;
} 
```

如果有人能指出我正确的方向，那就太棒了！谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:11:29.040

改变

$("#move").animate({left: 'relX', top: 'relY'});

到

$("#move").animate({left: relX, top: relY});

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:13:24.813

就像提到的人一样，我在 jsFiddle 上添加了示例：

[http://jsfiddle.net/E64TK/](http://jsfiddle.net/E64TK/)

在CSS中你也忘记了**“：”**

```
#container {
   width: 500px;
   height{here} 500px;
} 
```

# android - 何时在 Eclipse 中使用不同的导入类型

> ID：14077750
> 
> 赞同：0
> 
> 时间：2012-12-29T01:03:37.740
> 
> 标签：android, eclipse

在处理 Android 项目时在 Eclipse 中选择 File > Import... 时，我会看到以下选项：

一般的

*   现有项目进入工作区
*   文件系统
*   现有的 Android 代码到工作区

吉特

*   来自 Git 的项目

我很清楚如何使用“来自 Git 的项目”，例如从 github 克隆到本地，然后导入到工作区。但是General下的选项的正确使用和使用场景是怎样的呢？特别是“现有项目进入工作区”与“现有 Android 代码进入工作区”有何不同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:16:31.087

**现有项目进入工作区：** 一般的 java 项目/或取决于您的 Eclipse 版本的其他语言项目（例如，不是 Android 应用程序）

**现有的 Android 代码进入工作区：** Android projekt

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:19:44.837

> “现有项目进入工作区”与“现有 Android 代码进入工作区”有何不同？

1.  **导入 > 常规 > 现有项目到 Workspace**

    这意味着您要加载 C++ 项目、Java 或 Eclipse 在您的工作区中创建的任何项目。您也可以通过这种方式导入您的**Android 项目**。

2.  **导入 > Android > 现有 Android 代码到 Workspace**

    您只想在工作区中加载 Android 项目

**更新 1：**

> 但是General下的选项的正确使用和使用场景是怎样的呢？

你不必担心它。如果您真的关心您的 git 存储库中的项目，

我建议通过 EGit (Eclipse Git) 加载该项目。您也可以通过“常规”方式加载该项目，但区别在于

You cannot perform managing branches, commits, commit changes, or else using EGit.

# php - 尖叫：（！）忽略错误抑制解析错误：语法错误，第 12 行 C:\wamp\www\tests\Variables.php 中的意外 '<'

> ID：14077753
> 
> 赞同：-1
> 
> 时间：2012-12-29T01:03:59.830
> 
> 标签：php

我正在学习 php，我正在看一些 lynda 教程。我已经安装了 wamp 服务器，但出现以下错误：

> ( ! ) SCREAM: ( ! ) 忽略错误抑制 解析错误: 语法错误，第 12 行 C:\wamp\www\tests\Variables.php 中的意外 '<'

用这个简单的代码

```
<html>
<head>
    <title>Basic</title>
</head>
<body>
<?php 
$var1 = 10;
echo $var1;
$my_variable = "hllo world";
$my_Variable = "Hello w0rld";
echo $my_Variable;
<br />
$var1 = 100;
echo $var1;
?>
</body>
</html> 
```

我想我得到这个是因为我在 php 标签中有 html 标签，当我从 php 中删除 html 标签并将其放在 php 标签之外时，它可以工作......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T01:08:49.173

您不能在 php 标签中使用 html 标签，所以只需

```
echo('<br/>'); 
```

或拆分 PHP 标签，如

```
?>
<br/>
<?php 
```

# javascript - 在多个平台/浏览器上的 webapps 中嵌入本机代码

> ID：14077755
> 
> 赞同：1
> 
> 时间：2012-12-29T01:04:35.247
> 
> 标签：javascript, web-applications, native-code

我正在考虑在 Web 应用程序中嵌入本机代码（主要用于数值计算）。目前，我知道以下用于从 javascript 访问本机代码的技术：

*   MS Windows 上 Internet Explorer 中的[ActiveX 对象](http://msdn.microsoft.com/en-us/library/ie/7sw4ddf8%28v=vs.94%29.aspx)
*   Chrome/Chromium 中的本[机客户端（Windows、OSX、Linux）](https://developers.google.com/native-client/)
*   [XPCOM](https://developer.mozilla.org/en/docs/XPCOM) for Firefox（我想也适用于所有支持的平台）

现在我有两个问题：

1.  该列表显然缺少 Safari/OSX 和移动浏览器（iOS 和 Android）。这些是否有类似的解决方案？
2.  是否有任何努力/项目将这些技术结合在一起，或者至少使跨平台解决方案的开发变得不那么复杂？（即让您定义核心接口/类并帮助您为不同的方法生成包装器）

# node.js - 连接mysql的问题

> ID：14077758
> 
> 赞同：1
> 
> 时间：2012-12-29T01:05:05.127
> 
> 标签：node.js, express

我是 node.js 和 express 框架的新手。我试图找出与外部数据库的连接，使用以下代码：

```
var mysql = require('mysql');

var client = mysql.createConnection({
    user: 'user',
    password: 'pass',
    host: 'db.myprovider.com',
    database: 'test_database'
});

module.exports = {
    getDataFromUserGps: function(callback){
        client.query("SELECT * FROM userGps", 
            function(err, results, fields) {
                if (err) return callback(err, null);
                console.log('results: ', results);
                return callback(null, results);
            }
        ); 
    }
} 
```

我在这里称呼它：

```
mysql.getDataFromUserGps(function(err, mysqlResult){
    if(err) {
         console.log('mysql error', err);
    } else {
        console.log('mysqlResult', mysqlResult);
    }
}); 
```

这是我得到的：

```
mysql error { [Error: getaddrinfo ENOENT]
    code: 'ENOTFOUND',
    errno: 'ENOTFOUND',
    syscall: 'getaddrinfo',
    fatal: true } 
```

这是我的问题。我已经阅读了有关此问题的常见解决方案，例如“开始时不使用“http””或 unix soet 可能存在的问题。但是，使用相同的配置，我可以使用 php 轻松连接，所以我想知道是否可以通过更改我的 node.js 应用程序中的 socet 以某种方式解决它？

提前致谢！

# regex - 使用 .htaccess 重定向删除查询字符串

> ID：14077762
> 
> 赞同：2
> 
> 时间：2012-12-29T01:05:51.200
> 
> 标签：regex, .htaccess, redirect, query-string

我正在尝试在网站上创建一个类似 facebook 的按钮，当人们点击链接时，我的 wordpress 主题并不能真正理解一些 facebook 复杂的查询字符串并且不显示任何内容。

这是出现“LIKE”按钮的链接：

```
http://somesite/?p=24 
```

这是facebook返回链接的方式：

> HTTP：// somesite / P = 24＆fb_action_ids = 10151164007265846＆fb_action_types = og.likes＆fb_source = timeline_og＆action_object_map = {％2210151164007265846％22％3A386632001423999}＆action_type_map = {％2210151164007265846％22％3A％22og.likes％22}＆action_ref_map = []

我设法使用 .htaccess 将它重定向到我的主页，删除所有查询字符串，但我想重定向到我的实际页面，只删除 facebook 查询字符串。到目前为止我的代码：

```
Options +FollowSymlinks  
RewriteEngine On  
RewriteCond %{QUERY_STRING} fb_action_ids  
RewriteRule ^(.*)$ $1? [R=301] 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T02:20:51.557

这应该可行，假设 Facebook 添加的查询字符串部分始终以`fb_action_ids`参数开头：

```
Options +FollowSymlinks
RewriteEngine On
RewriteCond %{QUERY_STRING} ^(.*&)?fb_action_ids=
RewriteRule ^(.*)$ $1?%1 [R=301] 
```

# bash - 尝试使用 grep 从 plist 中提取数字

> ID：14077765
> 
> 赞同：0
> 
> 时间：2012-12-29T01:06:03.043
> 
> 标签：bash, grep

我会尽量让这个问题简短。基本上，我正在编写一个 shell 脚本，并且我有一个 .plist 文件，其中包含一个我试图“提取”并放入我的 shell 脚本中的变量的整数值。

我能够将 .plist 文件的内容细化为几行，但我仍然得到一堆我不需要的字符。

我在我的 shell 脚本中删除/运行以下命令，它给了我以下结果。

```
 file_refine=`grep -C 2 CFBundleVersion $file | grep '[0-9]\{3\}'` 
```

**输出**

```
 <string>645</string> 
```

我只需要数字而不是字符串标签，但我似乎无法弄清楚。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T01:09:16.553

试试这个

```
file_refine=$(grep -C 2 CFBundleVersion $file | grep -o '[0-9]\{3\}') 
```

grep 手册页中的 -o 选项：

```
 -o, --only-matching
              Print  only  the matched (non-empty) parts of a matching line, with
              each such part on a separate output line. 
```

# java - 作业的 HBase 多表扫描

> ID：14077766
> 
> 赞同：4
> 
> 时间：2012-12-29T01:06:10.313
> 
> 标签：java, hadoop, mapreduce, nosql, hbase

我正在看以下场景。我每天都会发送一个数据文件。我将它添加到 HBase 中，名称为 file-yyyyMMdd 格式。所以在一段时间内我有很多数据库，例如

```
tempdb-20121220
tempdb-20121221
tempdb-20121222
tempdb-20121223
tempdb-20121224
tempdb-20121225 
```

现在我想做的是针对特定日期范围获取列表，如果表匹配该范围，以便我可以创建索引。我正在使用 hbase-0.90.6

就我的研究而言，TableMapReduceUtil.initTableMapperJob 只需要 1 个表名。

```
TableMapReduceUtil.initTableMapperJob(
tableName,        // input HBase table name
scan,             // Scan instance to control CF and attribute selection
HBaseIndexerMapper.class,   // mapper
null,             // mapper output key
null,             // mapper output value
job
); 
```

我已经能够获取表列表并循环运行它，但我的想法是我可以遍历所有表，扫描它（或其他东西），以便最终我可以获得用于索引目的的合并/组合结果.

实现这一目标的任何方向都会非常有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-05-19T18:21:32.983

好的，请检查`HBase 0.94.6`来源（看起来它们最适合您）。在那里你会发现[MultiTableInputFormat 类](https://hbase.apache.org/0.94/apidocs/org/apache/hadoop/hbase/mapreduce/MultiTableInputFormat.html)（按照链接查看包含示例的 JavaDoc），它可以满足你的需要。就在几天前，我有经验将这个类添加到`HBase 0.94.2`（实际上`CDH 4.2.1`）基于项目的项目中。成功。

这似乎以非常有效的方式完全满足您的需求。这里唯一的问题是您将有一个映射器处理所有数据。要区分表，您可能需要`TableSplit`从 0.94.6 中获取类，将其重命名有所不同并移植以不破坏您的环境。请检查 TableMapReduceUtil 中的差异 - 您需要手动配置扫描，以便输入格式能够理解它们的配置。

还可以考虑简单地移动到`HBase 0.94.6`- 更简单的方式，因为我无法遵循它。我花了大约 12 个工作小时来了解这里的问题/调查解决方案/了解我的 CDH 4.2.1 问题/移植所有内容。对我来说好消息是 Cloudera 打算在 CDH 4.3.0 中迁移到 0.94.6。

UPDATE1：`CDH 4.3.0`可用，它包括 HBase 0.94.6 和所有必需的基础设施。

UPDATE2：我转向其他解决方案 - 自定义输入格式，它结合了几个 HBase 表，按键混合它们的行。碰巧非常有用，尤其是在适当的按键设计下。您可以在单个映射器中获得整个聚合。我正在考虑在 github 上发布此代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-11-07T17:10:58.840

`List<scans>`也是一种方式。我也同意 MultipleTableInputFormat ：

```
import java.util.List; 
import org.apache.hadoop.conf.Configuration; 
import org.apache.hadoop.conf.Configured; 
import org.apache.hadoop.hbase.client.Scan; 
import org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil; 
import org.apache.hadoop.hbase.util.Bytes; 
import org.apache.hadoop.io.IntWritable; 
import org.apache.hadoop.io.Text; 
import org.apache.hadoop.mapreduce.Job; 
import org.apache.hadoop.util.Tool; 

 public class TestMultiScan extends Configured implements Tool { 

    @Override 
    public int run(String[] arg0) throws Exception { 
        List<Scan> scans = new ArrayList<Scan>(); 

        Scan scan1 = new Scan(); 
        scan1.setAttribute("scan.attributes.table.name", Bytes.toBytes("table1ddmmyyyy")); 
        System.out.println(scan1.getAttribute("scan.attributes.table.name")); 
        scans.add(scan1); 

        Scan scan2 = new Scan(); 
        scan2.setAttribute("scan.attributes.table.name", Bytes.toBytes("table2ddmmyyyy")); 
        System.out.println(scan2.getAttribute("scan.attributes.table.name")); 
        scans.add(scan2); 

        Configuration conf = new Configuration(); 
        Job job = new Job(conf);     
        job.setJarByClass(TestMultiScan.class); 

        TableMapReduceUtil.initTableMapperJob( 
                scans,  
                MultiTableMappter.class,  
                Text.class,  
                IntWritable.class,  
                job); 
        TableMapReduceUtil.initTableReducerJob( 
                "xxxxx", 
                MultiTableReducer.class,  
                job); 
        job.waitForCompletion(true); 
        return 0; 
    } 

    public static void main(String[] args) throws Exception { 
        TestMultiScan runJob = new TestMultiScan(); 
        runJob.run(args); 
    } 
 } 
```

通过这种方式，我们通过 HBASE 命名空间表解决了多租户需求。例如：DEV1:TABLEX(DATA INGESTED BY DEV1) UAT1:TABLEX (DATA CONSUED BY UAT1) 在映射器中，我们想要比较两个命名空间表以进一步进行。

在内部它使用了多表输入格式，如 TableMapReduceUtil.java 中所示

[![TableMapReduceUtil 内部使用 MultiTableInputFormat](../Images/de33551cc1cfcfcc45ec8f68275b9c46.png)](https://i.stack.imgur.com/3VzwQ.png)

# xslt - XSLT 基于多个分隔符将元素拆分为新元素

> ID：14077775
> 
> 赞同：1
> 
> 时间：2012-12-29T01:08:13.327
> 
> 标签：xslt

我在这里找到了一些代码，这是一个不错的开始，但它与我正在寻找的有点不同，我不确定如何继续。我想要做的是复制整个 XML 文件，通过基于多个分隔符拆分 Author 元素来创建新元素，并摆脱原始的“Author”元素名称。每个作者“集”由分号分隔，并以回车或仅回车结束，如记录 4。任何帮助将不胜感激。我是 XSLT 新手，对提供的解决方案的任何解释都会很棒，因为我想了解解决方案而不仅仅是让它工作。谢谢。

编码：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:e="http://localhost">
<xsl:output indent="yes"/>
<e:e>AuthorName</e:e>
<e:e>AuthorLocation</e:e>
<e:e>AuthorPhone</e:e>
<xsl:variable name="vElement" select="document('')/*/e:*"/>
<xsl:template match="node()|@*">
    <xsl:copy>
        <xsl:apply-templates select="node()|@*"/>
    </xsl:copy>
</xsl:template>
<xsl:template match="Author/text()" name="tokenizer">
    <xsl:param name="pString" select="string()"/>
    <xsl:param name="pPosition" select="1"/>
    <xsl:if test="$pString">
        <xsl:element name="{$vElement[$pPosition]}">
            <xsl:value-of select="normalize-space(substring-before(concat($pString,';'),';'))"/>
        </xsl:element>
        <xsl:call-template name="tokenizer">
            <xsl:with-param name="pString" select="substring-after($pString,';')"/>
            <xsl:with-param name="pPosition" select="$pPosition + 1"/>
        </xsl:call-template>
    </xsl:if>
</xsl:template> 
```

XML 文件

```
<RECORD_SET>
    <RECORD NUM="1">
        <Title>Title1</Title>
        <Author>Author Name 1; Author Location 1; Author Phone Number 1</Author>
        <Date>11/20/1976</Date>
    </RECORD>
    <RECORD NUM="2">
        <Title>Title2</Title>
        <Author>Author Name 2; Author Location 2; Author Phone Number 2
        Author Name 3; Author Location 3; Author Phone Number 3
        Author Name 4; Author Location 4; Author Phone Number 4</Author>
        <Date>10/20/2001</Date>
    </RECORD>
    <RECORD NUM="3">
        <Title>Title3</Title>
        <Author>Author Name 5; Author Location 5; Author Phone Number 5
        Author Name 6; Author Location 6; Author Phone Number 6</Author>
        <Date>09/18/1966</Date>
    </RECORD>
    <RECORD NUM="4">
        <Title>Title4</Title>
        <Author>Author Name 7
        Author Name 8</Author>
        <Date>01/18/1956</Date>
    </RECORD>
</RECORD_SET> 
```

期望的输出

```
<RECORD_SET>
    <RECORD NUM="1">
        <Title>Title1</Title>
        <AuthorName>Author Name 1</Author>
        <AuthorLocation>Author Location 1</AuthorLocation>
        <AuthorPhone>Author Phone Number 1</AuthorPhone>
        <Date>11/20/1976</Date>
    </RECORD>
    <RECORD NUM="2">
        <Title>Title2</Title>
        <AuthorName>Author Name 2</Author>
        <AuthorLocation>Author Location 2</AuthorLocation>
        <AuthorPhone>Author Phone Number 2</AuthorPhone>
        <AuthorName>Author Name 3</Author>
        <AuthorLocation>Author Location 3</AuthorLocation>
        <AuthorPhone>Author Phone Number 3</AuthorPhone>
        <AuthorName>Author Name 4</Author>
        <AuthorLocation>Author Location 4</AuthorLocation>
        <AuthorPhone>Author Phone Number 4</AuthorPhone>
        <Date>10/20/2001</Date>
    </RECORD>
    <RECORD NUM="3">
        <Title>Title3</Title>
        <AuthorName>Author Name 5</Author>
        <AuthorLocation>Author Location 5</AuthorLocation>
        <AuthorPhone>Author Phone Number 5</AuthorPhone>
        <AuthorName>Author Name 6</Author>
        <AuthorLocation>Author Location 6</AuthorLocation>
        <AuthorPhone>Author Phone Number 6</AuthorPhone>
        <Date>09/18/1966</Date>
    </RECORD>
    <RECORD NUM="4">
        <Title>Title4</Title>
        <AuthorName>Author Name 7</AuthorName>
        <AuthorName>Author Name 8</AuthorName>
        <Date>01/18/1956</Date>
    </RECORD>
</RECORD_SET> 
```

电流输出

```
<RECORD NUM="1">
    <Title>Title1</Title>
    <Author>
      <AuthorName>Author Name 1</AuthorName>
      <AuthorLocation>Author Location 1</AuthorLocation>
      <AuthorPhone>Author Phone Number 1</AuthorPhone>
    </Author>
    <Date>11/20/1976</Date>
</RECORD>
<RECORD NUM="2">
    <Title>Title2</Title>
    <Author>
      <AuthorName>Author Name 2</AuthorName>
      <AuthorLocation>Author Location 2</AuthorLocation>
      <AuthorPhone>Author Phone Number 2 Author Name 3</AuthorPhone>Author Location 3Author Phone Number 3 Author Name 4Author Location 4Author Phone Number 4
    </Author>
    <Date>10/20/2001</Date>
</RECORD>
<RECORD NUM="3">
    <Title>Title3</Title>
    <Author>
      <AuthorName>Author Name 5</AuthorName>
      <AuthorLocation>Author Location 5</AuthorLocation>
      <AuthorPhone>Author Phone Number 5 Author Name 6</AuthorPhone>Author Location 6Author Phone Number 6
    </Author>
    <Date>09/18/1966</Date>
</RECORD>
<RECORD NUM="4">
    <Title>Title4</Title>
    <Author>
      <AuthorName>Author Name 7 Author Name 8</AuthorName>
    </Author>
    <Date>01/18/1956</Date>
</RECORD> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T03:10:20.763

**这个 XSLT 2.0 转换**：

```
<xsl:stylesheet version="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>
 <xsl:strip-space elements="*"/>

 <xsl:variable name="vAuthorDataNames" select=
  "'AuthorName', 'AuthorLocation', 'AuthorPhone'"/>

 <xsl:template match="node()|@*">
  <xsl:copy>
   <xsl:apply-templates select="node()|@*"/>
  </xsl:copy>
 </xsl:template>

 <xsl:template match="Author">
  <xsl:variable name="vAuthors" select="tokenize(., '(\n(\r?))\s*')"/>

  <xsl:for-each select="$vAuthors[normalize-space(.)]">
   <xsl:variable name="vAuthorData" select="tokenize(., ';\s*')"/>

   <xsl:for-each select="$vAuthorData">
    <xsl:variable name="vPos" select="position()"/>

    <xsl:element name="{$vAuthorDataNames[$vPos]}">
     <xsl:value-of select="."/>
    </xsl:element>
   </xsl:for-each>
  </xsl:for-each>
 </xsl:template>
</xsl:stylesheet> 
```

**应用于提供的 XML 文档时：**

```
<RECORD_SET>
    <RECORD NUM="1">
        <Title>Title1</Title>
        <Author>Author Name 1; Author Location 1; Author Phone Number 1</Author>
        <Date>11/20/1976</Date>
    </RECORD>
    <RECORD NUM="2">
        <Title>Title2</Title>
        <Author>Author Name 2; Author Location 2; Author Phone Number 2
        Author Name 3; Author Location 3; Author Phone Number 3
        Author Name 4; Author Location 4; Author Phone Number 4</Author>
        <Date>10/20/2001</Date>
    </RECORD>
    <RECORD NUM="3">
        <Title>Title3</Title>
        <Author>Author Name 5; Author Location 5; Author Phone Number 5
        Author Name 6; Author Location 6; Author Phone Number 6</Author>
        <Date>09/18/1966</Date>
    </RECORD>
    <RECORD NUM="4">
        <Title>Title4</Title>
        <Author>Author Name 7
        Author Name 8</Author>
        <Date>01/18/1956</Date>
    </RECORD>
</RECORD_SET> 
```

**产生想要的正确结果：**

```
<RECORD_SET>
   <RECORD NUM="1">
      <Title>Title1</Title>
      <AuthorName>Author Name 1</AuthorName>
      <AuthorLocation>Author Location 1</AuthorLocation>
      <AuthorPhone>Author Phone Number 1</AuthorPhone>
      <Date>11/20/1976</Date>
   </RECORD>
   <RECORD NUM="2">
      <Title>Title2</Title>
      <AuthorName>Author Name 2</AuthorName>
      <AuthorLocation>Author Location 2</AuthorLocation>
      <AuthorPhone>Author Phone Number 2</AuthorPhone>
      <AuthorName>Author Name 3</AuthorName>
      <AuthorLocation>Author Location 3</AuthorLocation>
      <AuthorPhone>Author Phone Number 3</AuthorPhone>
      <AuthorName>Author Name 4</AuthorName>
      <AuthorLocation>Author Location 4</AuthorLocation>
      <AuthorPhone>Author Phone Number 4</AuthorPhone>
      <Date>10/20/2001</Date>
   </RECORD>
   <RECORD NUM="3">
      <Title>Title3</Title>
      <AuthorName>Author Name 5</AuthorName>
      <AuthorLocation>Author Location 5</AuthorLocation>
      <AuthorPhone>Author Phone Number 5</AuthorPhone>
      <AuthorName>Author Name 6</AuthorName>
      <AuthorLocation>Author Location 6</AuthorLocation>
      <AuthorPhone>Author Phone Number 6</AuthorPhone>
      <Date>09/18/1966</Date>
   </RECORD>
   <RECORD NUM="4">
      <Title>Title4</Title>
      <AuthorName>Author Name 7</AuthorName>
      <AuthorName>Author Name 8</AuthorName>
      <Date>01/18/1956</Date>
   </RECORD>
</RECORD_SET> 
```

**说明**：

正确使用 satndard XSLT 函数**[`tokenize()`](http://www.w3.org/TR/xpath-functions/#func-tokenize)**和**[`normalize-space()`](http://www.w3.org/TR/xpath/#function-normalize-space)**.

# c++ - 我想在 C++ 中使用 ifstream 和 ofstream 来模仿 C# 的 BinaryReader / BinaryWriter 功能

> ID：14077781
> 
> 赞同：1
> 
> 时间：2012-12-29T01:09:04.877
> 
> 标签：c++, ifstream, ofstream, binaryreader, binarywriter

我正在寻找一种将浮点数/整数/字符串写入文件并将它们作为浮点数/整数/字符串读取的方法。（基本上读/写为 ios::binary）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:09:04.877

最后是我自己写的。只是想与他人分享。

它可能没有经过优化，但我很难找到模仿 C# 的**BinaryReader**和**BinaryWriter**类的 C++ 代码。所以我创建了一个同时处理读写的类。

快速注意事项：

1）**“BM”**只是我的课程的前缀。

2) **BMLogging**是一个简单的辅助类：

```
cout << "bla bla bla" << endl; 
```

所以你可以忽略对 BMLogging 的调用，我保留它们是为了突出我们可以警告用户的情况。

**这是代码：**

```
#include <iostream>
#include <fstream>

using namespace std;

// Create the macro so we don't repeat the code over and over again.
#define BMBINARY_READ(reader,value) reader.read((char *)&value, sizeof(value))

enum BMBinaryIOMode
{
    None = 0,
    Read,
    Write
};

class BMBinaryIO
{
    // the output file stream to write onto a file
    ofstream writer;
    // the input file stream to read from a file
    ifstream reader;
    // the filepath of the file we're working with
    string filePath;
    // the current active mode.
    BMBinaryIOMode currentMode;

public:
    BMBinaryIO()
    {
        currentMode = BMBinaryIOMode::None;
    }

    // the destructor will be responsible for checking if we forgot to close
    // the file
    ~BMBinaryIO()
    {
        if(writer.is_open())
        {
            BMLogging::error(BMLoggingClass::BinaryIO, "You forgot to call close() after finishing with the file! Closing it...");
            writer.close();
        }

        if(reader.is_open())
        {
            BMLogging::error(BMLoggingClass::BinaryIO, "You forgot to call close() after finishing with the file! Closing it...");
            reader.close();
        }   
    }

    // opens a file with either read or write mode. Returns whether
    // the open operation was successful
    bool open(string fileFullPath, BMBinaryIOMode mode)
    {
        filePath = fileFullPath;

        BMLogging::info(BMLoggingClass::BinaryIO, "Opening file: " + filePath);

        // Write mode
        if(mode == BMBinaryIOMode::Write)
        {
            currentMode = mode;
            // check if we had a previously opened file to close it
            if(writer.is_open())
                writer.close();

            writer.open(filePath, ios::binary);
            if(!writer.is_open())
            {
                BMLogging::error(BMLoggingClass::BinaryIO, "Could not open file for write: " + filePath);
                currentMode = BMBinaryIOMode::None;
            }
        }
        // Read mode
        else if(mode == BMBinaryIOMode::Read)
        {
            currentMode = mode;
            // check if we had a previously opened file to close it
            if(reader.is_open())
                reader.close();

            reader.open(filePath, ios::binary);
            if(!reader.is_open())
            {
                BMLogging::error(BMLoggingClass::BinaryIO, "Could not open file for read: " + filePath);
                currentMode = BMBinaryIOMode::None;
            }
        }

        // if the mode is still the NONE/initial one -> we failed
        return currentMode == BMBinaryIOMode::None ? false : true;
    }

    // closes the file
    void close()
    {
        if(currentMode == BMBinaryIOMode::Write)
        {
            writer.close();
        }
        else if(currentMode == BMBinaryIOMode::Read)
        {
            reader.close();
        }
    }

    bool checkWritabilityStatus()
    {
        if(currentMode != BMBinaryIOMode::Write)
        {
            BMLogging::error(BMLoggingClass::BinaryIO, "Trying to write with a non Writable mode!");
            return false;
        }
        return true;
    }

    // Generic write method that will write any value to a file (except a string,
    // for strings use writeString instead).
    void write(void *value, size_t size)
    {
        if(!checkWritabilityStatus())
            return;

        // write the value to the file.
        writer.write((const char *)value, size);
    }

    // Writes a string to the file
    void writeString(string str)
    {
        if(!checkWritabilityStatus())
            return;

        // first add a \0 at the end of the string so we can detect
        // the end of string when reading it
        str += '\0';

        // create char pointer from string.
        char* text = (char *)(str.c_str());
        // find the length of the string.
        unsigned long size = str.size();

        // write the whole string including the null.
        writer.write((const char *)text, size);
    }

    // helper to check if we're allowed to read
    bool checkReadabilityStatus()
    {
        if(currentMode != BMBinaryIOMode::Read)
        {
            BMLogging::error(BMLoggingClass::BinaryIO, "Trying to read with a non Readable mode!");
            return false;
        }

        // check if we hit the end of the file.
        if(reader.eof())
        {
            BMLogging::error(BMLoggingClass::BinaryIO, "Trying to read but reached the end of file!");
            reader.close();
            currentMode = BMBinaryIOMode::None;
            return false;
        }

        return true;
    }

    // reads a boolean value
    bool readBoolean()
    {
        if(checkReadabilityStatus())
        {
            bool value = false;
            BMBINARY_READ(reader, value);
            return value;
        }

        return false;
    }

    // reads a character value
    char readChar()
    {
        if(checkReadabilityStatus())
        {
            char value = 0;
            BMBINARY_READ(reader, value);
            return value;
        }
        return 0;
    }

    // read an integer value
    int readInt()
    {
        if(checkReadabilityStatus())
        {
            int value = 0;
            BMBINARY_READ(reader, value);
            return value;
        }
        return 0;
    }

    // read a float value
    float readFloat()
    {
        if(checkReadabilityStatus())
        {
            float value = 0;
            BMBINARY_READ(reader, value);
            return value;
        }
        return 0;
    }   

    // read a double value
    double readDouble()
    {
        if(checkReadabilityStatus())
        {
            double value = 0;
            BMBINARY_READ(reader, value);
            return value;
        }
        return 0;
    }

    // read a string value
    string readString()
    {
        if(checkReadabilityStatus())
        {
            char c;
            string result = "";
            while((c = readChar()) != '\0')
            {
                result += c;
            }
            return result;
        }
        return "";
    }
}; 
```

**编辑：我用这些替换了上面的所有读/写方法：（也更新了使用代码）**

```
// Generic write method that will write any value to a file (except a string,
// for strings use writeString instead)
template<typename T>
void write(T &value)
{
    if(!checkWritabilityStatus())
        return;

    // write the value to the file.
    writer.write((const char *)&value, sizeof(value));
}

// Writes a string to the file
void writeString(string str)
{
    if(!checkWritabilityStatus())
        return;

    // first add a \0 at the end of the string so we can detect
    // the end of string when reading it
    str += '\0';

    // create char pointer from string.
    char* text = (char *)(str.c_str());
    // find the length of the string.
    unsigned long size = str.size();

    // write the whole string including the null.
    writer.write((const char *)text, size);
}

// reads any type of value except strings.
template<typename T>
T read()
{
    checkReadabilityStatus();

    T value;
    reader.read((char *)&value, sizeof(value));
    return value;
}

// reads any type of value except strings.
template<typename T>
void read(T &value)
{
    if(checkReadabilityStatus())
    {
        reader.read((char *)&value, sizeof(value));
    }
}

// read a string value
string readString()
{
    if(checkReadabilityStatus())
    {
        char c;
        string result = "";
        while((c = read<char>()) != '\0')
        {
            result += c;
        }
        return result;
    }
    return "";
}

// read a string value
void readString(string &result)
{
    if(checkReadabilityStatus())
    {
        char c;
        result = "";
        while((c = read<char>()) != '\0')
        {
            result += c;
        }
    }
} 
```

**这就是你将如何使用它来编写：**

```
string myPath = "somepath to the file";
BMBinaryIO binaryIO;
if(binaryIO.open(myPath, BMBinaryIOMode::Write))
{
    float value = 165;
    binaryIO.write(value);

    char valueC = 'K';
    binaryIO.write(valueC);

    double valueD = 1231.99;
    binaryIO.write(valueD);

    string valueStr = "spawnAt(100,200)";
    binaryIO.writeString(valueStr);
    valueStr = "helpAt(32,3)";
    binaryIO.writeString(valueStr);

    binaryIO.close();
} 
```

**以下是您将如何使用它来阅读：**

```
string myPath = "some path to the same file";
if(binaryIO.open(myPath, BMBinaryIOMode::Read))
{
    cout << binaryIO.read<float>() << endl;
    cout << binaryIO.read<char>() << endl;

    double valueD = 0;
    binaryIO.read(valueD); // or you could use read<double()
    cout << valueD << endl;

    cout << binaryIO.readString() << endl;
    cout << binaryIO.readString() << endl;

    binaryIO.close();
} 
```

**编辑 2：您甚至可以在 1 行中写入/读取整个结构：**

```
struct Vertex {
    float x, y;
};

Vertex vtx; vtx.x = 2.5f; vtx.y = 10.0f;

// to write it
binaryIO.write(vtx);

// to read it
Vertex vtxRead;
binaryIO.read(vtxRead); // option 1
vtxRead = binaryIO.read<Vertex>(); // option 2 
```

希望我的代码足够清晰。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T05:13:40.963

我继承了`ifstream`and `ofstream`:`ibfstream`和`obfstream`. 我做了一个小助手类，可以检测我正在编译/运行的机器的字节顺序。`ibfstream`然后我为and添加了一个标志`obfstream`，指示是否应该翻转原始类型中的字节。这些类还具有读取/写入基本类型和此类类型的数组的方法，必要时会翻转字节顺序。最后，我`ios::binary`默认为这些类设置。

我经常在一个 little-endian 机器上工作，并想编写 big-endian 文件，反之亦然。这被用在一个对各种格式的 3D 图形文件进行大量 I/O 的程序中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T05:57:50.123

我继承了`ifstream`and `ofstream`:`ibfstream`和`obfstream`. 我做了一个类来检测我正在编译/运行的机器的字节顺序。`ibfstream`然后我为and添加了一个标志`obfstream`，指示是否应该翻转原始类型中的字节。这些类还具有读取/写入基本类型和此类类型的数组的方法，必要时会翻转字节顺序。

我经常在一个 little-endian 机器上工作，并想编写 big-endian 文件，反之亦然。这被用在一个程序中，该程序对各种格式的 3D 图形文件进行了大量 I/O。

# python - 将行变量与 numrefs 列表匹配

> ID：14077794
> 
> 赞同：0
> 
> 时间：2012-12-29T01:11:15.843
> 
> 标签：python, python-2.7

我需要一些关于我的代码的帮助。以下是我目前的问题：

1.  当变量行匹配时，我需要在`numref`s 中获取匹配的值，示例如下。
2.  我不确定我`if`是否正确构建了 -statement。

代码：

```
import subprocess

def p4 (base_num):

    numrefs = ['nums/89/202089/4', 'nums/39/205739/2', 'nums/94/195594/6']
    num_ignore = [150362, 147117, 147441, 143446, 200914]
    ''''
    num_ids.txt
    202089
    205739
    195594
    202090
    202092
    202091
    202084
    202088
    202086
    202076
    202083
    206057
    206056
    '''

    with open('./num_ids.txt', 'rb') as f:
    # Iterate over the file itself
        for line in f:
            num = int(line)
            if num > base_num and num not in num_ignore and line in numrefs:
                #get the match when line matches numrefs
                #if line is 20289,it should match the value nums/89/202089/ in  num_refs and print it here,how can I do it?
                print "OVER"

def main():
    base_num=203456
    p4(base_num)

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-31T09:24:38.250

如果我正确理解了这个问题，那么您的代码失败有两个原因：

1.  标识的字符串`line`将以`\n`: 结尾，这需要`strip`在搜索 inside 之前进行 ped `numrefs`。
2.  `line in numrefs`总是会失败，因为字符串`numrefs`更长。看起来您想在这些字符串中进行搜索。

这是`p4()`解决这两个问题的版本。

```
def p4(base_num):
    numrefs = ['nums/89/202089/4', 'nums/39/205739/2', 'nums/94/195594/6']
    num_ignore = [150362, 147117, 147441, 143446, 200914]

    with open('./num_ids.txt', 'rb') as f:
        for line in f:
            text = line.strip()  # Trim trailing whitespace and newline
            num = int(text)
            if (num > base_num
                    and num not in num_ignore
                    # Check for any substring in list of strings
                    and any(text in numref for numref in numrefs)):
                print text 
```

如果您需要打印找到的`numref`字符串（如果存在），则将`if`-statement 更改为：

```
 if num > base_num and num not in num_ignore:
                result = [numref for numref in numrefs if text in numref]
                if result:
                    print result[0] 
```

这个`if`-statement 应该被提取到它自己的、*可测试*的方法中。

# php - ajax XMLHttpRequest 就绪状态

> ID：14077795
> 
> 赞同：0
> 
> 时间：2012-12-29T01:11:20.753
> 
> 标签：php, html, debugging, xmlhttprequest, readystate

我有一个带有此表单的 html 页面

```
<form id="quick-search" autocomplete="off" class="form-wrapper cf" >
    <div style="text-align: center;">
    <input id="qsearch" name="qsearch" onkeyup="liveSearch()" placeholder="Search here..." required="" type="text">
    <button  onclick='ajaxFunction()' id="submitButton">Search</button>
    </div>` 
```

这个 div 我把 ajaxFunction 的结果放在那里

```
<div id='ajaxDiv'>Your result will display here</div> 
```

当我单击按钮时，ajaxFunction 执行。只需打开一个 php 文件，我在其中进行 sql 查询，因为用户在 qsearch 输入表单中写入它。这是 JavaScript 代码：

```
function createRequestObject(){
var request_o;
var browser = navigator.appName;
if(browser == "Microsoft Internet Explorer"){
    request_o = new ActiveXObject("Microsoft.XMLHTTP");
}else{
    request_o = new XMLHttpRequest();
}
return request_o;
}

var http = createRequestObject()
function ajaxFunction(){

// Create a function that will receive data sent from the server
http .onreadystatechange = function(){
    try{
        if(http .readyState == 4){
            if(http .status==200){
            try{
                var ajaxDisplay = document.getElementById('ajaxDiv');
                ajaxDisplay.innerHTML= http .responseText;
                }catch(err){
                    // display error message
                    alert("Error reading the response: " + err.toString());
                return false;
                }
            }
        }
        else{
            alert(http .readyState+" "+http .status);
        }
    }catch(e){
        alert('Caught Expection: '+e.description+' '+http .status);
        return false;
    }
}
var par = document.getElementById('qsearch').value;
var queryString = "?par=" + par;
http.open("GET", "results3.php" + queryString, true);
http.send(null); 
} 
```

该代码运行良好，但问题是我需要单击按钮两次（当然在输入字段中使用相同的文本）以使结果文本保留在 div 中。第一次单击相同的结果，但页面自动刷新和结果（以及输入表单中的文本）消失。第二次单击页面不刷新显示没问题。通过代码中的警报，我可以看到 readyState 和状态. 产生的状态，状态是 1,0->2,200->3,200->1,0。在页面上显示的状态 3 和 1 之间的结果（显然状态 4 没有问题）但是为什么我在 4 之后有状态 1？所有这些都在 Firefox 17.0.1 中提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2013-10-10T02:07:17.877

> 我至少工作了一天，我在发布问题 10 分钟后找到了解决方案！答案就在这里 [Stop refresh with ajax , javascript , php][1] [1]: [Stop refresh with ajax , javascript , php](https://stackoverflow.com/questions/10383810/) ... 我只需要在此处添加 return false ： onclick='ajaxFunction();return false' 和现在它完美无缺！谢谢！

# python - Django，按日期范围内的指定月份和年份过滤

> ID：14077799
> 
> 赞同：53
> 
> 时间：2012-12-29T01:11:34.233
> 
> 标签：python, django

我有以下型号

```
class Destination_Deal(models.Model):
    name = models.CharField(_("Nombre"),max_length=200)

class Departure_Date(models.Model):
    date_from= models.DateField(_('Desde'))    
    date_to= models.DateField(_('Hasta'))
    destination_deal = models.ForeignKey(Destination_Deal,verbose_name = _("Oferta de Destino")) 
```

这是表中的实际数据

```
id  date_from   date_to     destination_deal_id
1   2012-11-01  2013-03-17  1
2   2012-11-01  2012-12-16  2
3   2012-09-16  2012-10-31  3
4   2012-11-01  2012-12-16  3
5   2013-01-04  2013-01-11  4 
```

如果指定的月份和年份在 date_from 和 date_to 之间，我想过滤 Destination_Deals。

**示例 1**

> 月份：9 月 (09)
> 年份：2012

**想要的出发日期结果：**
ID 3：它是唯一触及 09/2012 的数据范围

**示例 2**

> 月份：2 月 (02)
> 年份：2013

**想要的出发日期结果：**
ID 1：02/2012 在 03/2012 之前

所以，日子其实是无所谓的。如果月份和年份在 date_from 和 date_to 之间，即使相差一天也必须过滤。

我想我必须使用这样的东西，[但](https://stackoverflow.com/questions/1664636/django-date-filter-by-day-of-month?answertab=votes#tab-top)我不知道该怎么做。

提前致谢！米格尔

**---编辑---**
这是对 Aamir Adnan 答案的测试，但它没有像我预期的那样工作，因为 ID 1 也必须返回，因为它从 2012 年 11 月到 2013 年 3 月，所以 2013 年 1 月介于两者之间。

```
Departure_Date.objects.all()
[<Departure_Date: id: 1 - from: 2012-11-01 - to: 2013-03-17>,
<Departure_Date: id: 2 - from: 2012-11-01 - to: 2012-12-16>,
<Departure_Date: id: 3 - from: 2012-09-16 - to: 2012-10-31>,
<Departure_Date: id: 4 - from: 2012-11-01 - to: 2012-12-16>,
<Departure_Date: id: 5 - from: 2013-01-04 - to: 2013-01-11>]

month:1
year:2013
where = '%(year)s >= YEAR(date_from) AND %(month)s >= MONTH(date_from) \
    AND %(year)s <= YEAR(date_to) AND %(month)s <= MONTH(date_to)' % \
    {'year': year, 'month': month}
Departure_Date.objects.extra(where=[where])
[<Departure_Date: id: 5 - from: 2013-01-04 - to: 2013-01-11>] 
```

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2012-12-29T01:45:16.863

检查[文档](https://docs.djangoproject.com/en/dev/ref/models/querysets/#year)

```
year = 2012
month = 09
Departure_Date.objects.filter(date_from__year__gte=year,
                              date_from__month__gte=month,
                              date_to__year__lte=year,
                              date_to__month__lte=month) 
```

替代方法使用`.extra`：

```
where = '%(year)s >= YEAR(date_from) AND %(month)s >= MONTH(date_from) \
        AND %(year)s <= YEAR(date_to) AND %(month)s <= MONTH(date_to)' % \
        {'year': year, 'month': month}
Departure_Date.objects.extra(where=[where]) 
```

在特定情况下，上述查询不会产生所需的结果。

例如：

```
date_from='2012-11-01'
date_to='2013-03-17'
and input is
year=2013
month=1 
```

然后`%(month)s >= MONTH(date_from)`条件是错误的，因为第 1 个月 < 11 月，`date_from`但年份不同，所以`IF`这里需要 MySQL 条件：

```
where = '%(year)s >= YEAR(date_from) AND IF(%(year)s > YEAR(date_from), \
     IF(%(month)s > MONTH(date_from), %(month)s >= MONTH(date_from), %(month)s < MONTH(date_from)), \
     IF(%(month)s < MONTH(date_from), %(month)s < MONTH(date_from), %(month)s >= MONTH(date_from))) \
     AND %(year)s <= YEAR(date_to) \
     AND %(month)s <= MONTH(date_to)' % \
     {'year': year, 'month': month}
Departure_Date.objects.extra(where=[where]) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-09-19T09:50:25.883

仅使用 python 代码的解决方案。主要思想是用python构造date_from和date_to。然后这些日期可以用于`filter`with`__lte`和`__gte`：

```
import calendar
from datetime import datetime
from django.db.models import Q

def in_month_year(month, year):
    d_fmt = "{0:>02}.{1:>02}.{2}"
    date_from = datetime.strptime(
        d_fmt.format(1, month, year), '%d.%m.%Y').date()
    last_day_of_month = calendar.monthrange(year, month)[1]
    date_to = datetime.strptime(
        d_fmt.format(last_day_of_month, month, year), '%d.%m.%Y').date()
    return Departure_Date.objects.filter(
        Q(date_from__gte=date_from, date_from__lte=date_to)
         |
        Q(date_from__lt=date_from, date_to__gte=date_from)) 
```

现在这将起作用：

```
>>> Departure_Date.objects.all()
[<Departure_Date: id: 1 - from: 2012-11-01 - to: 2013-03-17>,
<Departure_Date: id: 2 - from: 2012-11-01 - to: 2012-12-16>,
<Departure_Date: id: 3 - from: 2012-09-16 - to: 2012-10-31>,
<Departure_Date: id: 4 - from: 2012-11-01 - to: 2012-12-16>,
<Departure_Date: id: 5 - from: 2013-01-04 - to: 2013-01-11>]

>>> in_month_year(month=1, year=2013)
[<Departure_Date: id: 1 - from: 2012-11-01 - to: 2013-03-17>,
<Departure_Date: id: 5 - from: 2013-01-04 - to: 2013-01-11>] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-10-10T03:44:00.363

您可以通过使用**datetime.timedelta**将日期添加到范围中的最后一个日期来解决由于对象比较中缺乏精度而导致的“阻抗不匹配” `DateTimeField/date`——如果使用**范围，可能会发生这种情况。**这就像：

 **```
import datetime

start = date(2012, 12, 11)
end = date(2012, 12, 18)
new_end = end + datetime.timedelta(days=1)

ExampleModel.objects.filter(some_datetime_field__range=[start, new_end]) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-25T12:46:05.430

您可以将 2 个过滤器与`__gte`和一起使用`__lte`：

```
import datetime as dt

start = dt.date(2012, 12, 11)
end = dt.date(2012, 12, 18)
ExampleModel.objects.filter(date_field__gte=start).filter(date_field__lte=end) 
```**

# java - 异常：反序列化期间的“java.lang.ClassCastException：class java.lang.Enum not an enum”

> ID：14077802
> 
> 赞同：0
> 
> 时间：2012-12-29T01:11:54.480
> 
> 标签：java, exception, jackson

我试图解决我在用杰克逊反序列化 EnumSet 时遇到的问题。

我有 en EnumSet 创建像

```
EnumSet set = EnumSet.of(TestEnum.Value1, TestEnum.Value2, TestEnum.Value3); 
```

并且在反序列化期间得到以下异常：

```
java.lang.ClassCastException: class java.lang.Enum not an enum
    at java.util.EnumSet.noneOf(EnumSet.java:93)
    at com.fasterxml.jackson.databind.deser.std.EnumSetDeserializer.constructSet(EnumSetDeserializer.java:123)
    at com.fasterxml.jackson.databind.deser.std.EnumSetDeserializer.deserialize(EnumSetDeserializer.java:88)
    at com.fasterxml.jackson.databind.deser.std.EnumSetDeserializer.deserialize(EnumSetDeserializer.java:18)
    at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:2575)
    at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:1805)
    at com.easycompany.providers.serialization.impl.jackson.base.JacksonSerializationProviderBase.readString(JacksonSerializationProviderBase.java:339)
    at com.easycompany.tests.serialization.base.ReadWriteStringTestBase.read(ReadWriteStringTestBase.java:33)
    at com.easycompany.tests.serialization.base.ReadWriteStringTestBase.action(ReadWriteStringTestBase.java:28)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30)
    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:76)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:195)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:63)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120) 
```

谁能帮我解决这个问题？

***由我解决**：如果有兴趣，请阅读下面的答案。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:38:09.477

我自己已经找到了解决方案。问题是方法`EnumSet.noneOf()`需要传递具体的枚举类型（在我的情况下为TestEnum），但我通过一堆通用函数调用它，结果代码它只知道它需要构造枚举，但不要知道它应该收缩哪些枚举。使用带有有效类型引用参数的杰克逊阅读器解决了这个问题。

# .net - 如何使用 .NET 正则表达式捕获重复值？

> ID：14077807
> 
> 赞同：1
> 
> 时间：2012-12-29T01:12:41.227
> 
> 标签：.net, regex

可以说我想捕捉的话

我的正则表达式

```
(\w+) (n\d+)(,\s*(n\d+))* 
```

我的意见

```
Word1 n0, n1, n2, n99 
```

1 会得到我`Word1`2 会得到我`n0`4 会得到我`n99`。有没有办法得到n1和n2？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:31:06.897

你很幸运！有，而且 AFAIK，只在 .NET 中！请参阅[此处的 MSDN 文档](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.capturecollection.aspx)。

> 如果将量词应用于捕获组，则 CaptureCollection 为每个捕获的子字符串包含一个 Capture 对象，并且 Group 对象仅提供有关最后捕获的子字符串的信息。

基本上，您遍历`CaptureCollection`成员。该页面上的示例非常有用。

# javascript - jquery - 如果 div 大于视口，则将其移动到视图顶部

> ID：14077808
> 
> 赞同：-2
> 
> 时间：2012-12-29T01:12:46.990
> 
> 标签：javascript, jquery

我有 div （就像一个层）并且对分辨率很小的访问者有问题。是否有简单的方法来测试 div 高度是否大于页面视口，如果是，将 div 移动到视口顶部？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:29:29.133

试试这个：

```
(function () {
    var viewport = window.innerWidth,
        el       = document.getElementById('myDiv'),
        widthDiv = el.style.width;

    if (widthDiv > viewport) {
    // Move the div higher
       el.style.zIndex = 999;
    }
}()) 
```

# html - 标题不会一直伸展

> ID：14077811
> 
> 赞同：0
> 
> 时间：2012-12-29T01:13:02.140
> 
> 标签：html, header

[http://gyazo.com/17f61b8da9a1dab18c69ef1810920817](http://gyazo.com/17f61b8da9a1dab18c69ef1810920817)

```
body {
    font-family: 'Courier-New', Courier, monospace;
    background-image:url('images/bg.png');
}

p {
    color: #fff;
}

a {
    text-decoration: none;
    color: #fff;
}

a:hover {
    color: #8e00d9;
}

/* Header */

header {
    background: url('images/swirl.png');
    box-shadow: 0px 1px 10px #000;

}

header h1 {
    margin: auto;
    background: url('images/logo.png') no-repeat;
    text-indent: -9999px;
    width: 380px;
    height: 120px;
}

/* Navigation Top */ 
```

我的标题没有一直延伸....

HTML

```
<!doctype html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <title>Green Cup Of Tea</title>
    </head>
    <body>
        <header>
            <h1>
                Logo here
            </h1>
            <div id="navtop">
                <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Work</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
                </ul>
            </div>
        </header>
        <div id="content">

        </div>
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T02:02:43.123

### 简单的修复建议：

1.  考虑使用重置，无论是[this](http://meyerweb.com/eric/tools/css/reset/)还是[this](http://developer.yahoo.com/yui/reset/)。

2.  如果没有，只需在顶部包含此 CSS：

    ```
     * {margin: 0; padding: 0;} 
    ```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:30:43.970

添加`padding: 0;`and`margin: 0;`它应该一直延伸。

我建议重置代码。最简单的方法是在您的 css 文件中添加此代码：

```
html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, sup, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed, 
figure, figcaption, footer, header, hgroup, 
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
    margin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure, 
footer, header, hgroup, menu, nav, section {
    display: block;
}
body {
    line-height: 1;
}
ol, ul {
    list-style: none;
}
blockquote, q {
    quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
    content: '';
    content: none;
}
table {
    border-collapse: collapse;
    border-spacing: 0;
} 
```

[资源。](http://meyerweb.com/eric/tools/css/reset/)

# java - Java：“超出了 GC 开销限制”，尽管有足够的内存可供分配

> ID：14077813
> 
> 赞同：4
> 
> 时间：2012-12-29T01:13:22.850
> 
> 标签：java, garbage-collection

我不明白如何在 JVM 使用的总内存 (Runtime.totalMemory()) 大约是可以分配的内存 (Runtime.maxMemory()) 的一半时获得此异常。任何的想法 ？

```
Total Memory : 1708MB as returned by Runtime.getRuntime().totalMemory() 
Max. Memory  : 3545MB as returned by Runtime.getRuntime().maxMemory() 

JRE : Java HotSpot(TM) 64-Bit Server VM  :  1.6.0_29   (Linux) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:45:01.627

正如 pcalcao 所提到的，JVM 告诉您它在垃圾收集上花费了太多时间，并且没有做足够的实际工作，所以它只是打算退出。

这是一种安全阀，可以避免您实际上并没有耗尽内存但足够接近以至于您确实没有取得任何进展的情况。我不会详细说明这一点 -[这个答案](https://stackoverflow.com/questions/4371505/gc-overhead-limit-exceeded)有更多细节，但我会提到一些可能适用于你的案例的事情：

如果您`SoftReference`要缓存内容，则更有可能发生这种情况-随着堆向最大大小增长，这些引用被清除并可能反复重新生成（取决于您的键循环是否触及）它们，从而导致GC不断发生的一些不良行为但总是恢复足够的内存以继续运行，因为它能够清除一些软引用——即使是 JDK 也会受到这种影响，因为它们在`Locale`类中使用了这种缓存。

如果您真的想使用 -XX:-UseGCOverheadLimit，您可以禁用此行为。尽管如此，它表明的问题是真实的——你花费不到 2% 的运行时间来做真正的工作。

你在哪里打印出这些内存值？根据您的程序的结构，它可能会生成大量垃圾并在某个内部循环中使用大部分堆，但是在您放置诊断输出的地方，垃圾已被回收。-verbose:gc 可以让您更好地了解实际的 GC 行为。

# intellij-idea - 如何强制 IntelliJ 编辑器限制行长？

> ID：14077816
> 
> 赞同：1
> 
> 时间：2012-12-29T01:14:18.117
> 
> 标签：intellij-idea

我有一个看起来像这样的文本文件：

```
a=12
 b=13
 c=14
 d =15
 e = 16
 f = 17 
```

有些数字后面有空格。有些没有。有些有标签等。

似乎当我在 InteliJ 的编辑器中时，我点击的任何地方都很好.. 可点击。

**如何通过实际行长限制它？**

![在此处输入图像描述](../Images/6913296824e05f3122b190d924135b44.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T02:05:32.063

`Settings`-> `Editor`-> `Allow placement of caret after end of line`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:03:36.800

您可以将全局代码样式设置为在赋值运算符周围放置空格，然后通过选定的文本、文件或整个项目执行全局“重新格式化代码”。

我使用 IntelliJ 12：

![在此处输入图像描述](../Images/9b1cd8e93a16f00496f8aaf4c2c076bd.png)

# visual-studio-2012 - 什么是 System.Windows.ni.dll？

> ID：14077818
> 
> 赞同：7
> 
> 时间：2012-12-29T01:14:45.293
> 
> 标签：visual-studio-2012, windows-phone, windows-phone-8

我正在开发一个使用 ScheduledTaskAgent 更新动态磁贴的 WP8 应用程序。这是一个非常简单的应用程序，真的。问题是当我直接将代码从 WP7 项目复制到 WP8 项目时，它不会启动 ScheduledTask。不仅如此，如果我正在调试并尝试启动计划任务进行测试，我会收到错误消息。

> System.Windows.ni.dll 中发生“System.InvalidOperationException”

不仅如此，它并没有给我任何堆栈查看，并说源不可用，我可以在反汇编窗口中查看反汇编，这对我来说没有任何意义。所以，这不是一个非常有用的错误，IMO。

我尝试在计划任务的构造函数中放置一个断点，但它永远不会在那里。如果我注释掉启动测试，没有错误。但是，当然，将应用程序放在我的手机中，它从未启动，一夜之间就离开了。

这是我的代码：

```
var taskName = "TileUpdater";
            var oldTask = ScheduledActionService.Find(taskName) as PeriodicTask;
            if (oldTask != null)
            {
                ScheduledActionService.Remove(taskName);
            }
            if (useLiveTile)
            {
                //GenerateTileInfo();
                PeriodicTask task = new PeriodicTask(taskName);
                task.Description = AppResources.BackgroundTaskDescription;
                oldTask = ScheduledActionService.Find(taskName) as PeriodicTask;
                if (oldTask == null)
                {
                    ScheduledActionService.Add(task);
                }
#if DEBUG
                ScheduledActionService.LaunchForTest(taskName, TimeSpan.FromSeconds(10));
#endif
            } 
```

该代码在 WP7 版本中运行良好。：/

这是在我的 WMAppManifest.xml 文件中：

```
 <ExtendedTask Name="BackgroundTask">
        <BackgroundServiceAgent Specifier="ScheduledTaskAgent"
                                Name="xxxScheduledTask"
                                Source="xxxScheduledTask"
                                Type="xxxScheduledTask.SecheduledAgent" />
    </ExtendedTask> 
```

在我的计划任务中，我唯一要做的就是调用一个生成磁贴信息的过程，更新磁贴，目前，我正在重新运行启动以进行测试，所以我可以观察它是否再次更新，尽管我已将其注释掉 - 我取消注释它以粘贴到此处，但已被注释掉。这是我的 OnInvoke 方法：

```
 GenerateTileInfo();

    #if DEBUG
        ScheduledActionService.LaunchForTest(task.ToString(), TimeSpan.FromSeconds(60));
    #endif

    NotifyComplete(); 
```

GenerateInfo 方法不会做任何会导致问题的事情，但当然，无论如何它永远不会到达那里。我确实测试了我生成的磁贴信息，并通过将该代码放在 MainPage.xaml.cs 中并暂时调用它来实现它，以查看它是否有效，并且我正在调用的代码工作正常。因此，如果我打开应用程序，磁贴就会更新。现在我需要让后台任务工作。

非常感谢任何人可以提供的任何帮助。另一个线索是，昨晚我收到一个错误，涉及无法找到 pdb 文件 - 我认为它是 Microsoft.Phone.pdb，但不管它是什么，它也引用了 System.Windows.ni.dll文件，但现在我没有得到那个 pdb 问题，只是这个 InvalidOperationException。昨晚调试符号（我不知道那是什么意思）没有加载。今天他们是。我不知道我做了什么来修复它。据我所知，可能是重新启动。

另外，我尝试创建一个新项目并将我的代码复制到一个新项目，认为我可能有一个损坏的项目文件，但我现在得到的错误与我今天早些时候得到的相同，促使我创建新的项目。

再次感谢任何帮助。谢谢。

**（编辑 - 美国东部时间 12 月 29 日上午 11:34 在此点下方添加了新评论）=============================== ====================================================**

我尝试了另一个实验。[我创建了一个新项目，并从http://www.jeffblankenburg.com/2011/11/25/31-days-of-mango-day-25-background-agents/](http://www.jeffblankenburg.com/2011/11/25/31-days-of-mango-day-25-background-agents/)复制/粘贴代码，看看我是否可以调试应用程序。我确实必须对 Jeff Blankenburg 编写的代码进行一些小的更改，因为他指出，当您添加计划任务项目时，它会自动将以下代码添加到 WMAppManifest.xml 文件中，但它没有。我是手动完成的。

我还在粘贴到 ScheduledAgent.cs 的代码中将**StandardTileData**类型更改为**FlipTileData**（因为这是 WP8 项目中的默认值）。

除此之外，Jeff 在他的文章中没有提到的唯一一件事是添加必要的 using 指令。

鉴于这个实验的结果，我想我可能会以某种方式查看我的 Visual Studio 安装已损坏。你会同意吗？我在想卸载/重新安装 VS2012 和手机 sdk 是这里的顺序，但由于需要很长时间，我想获得另一个意见。谢谢。

**更新（1/4/2012）=========================================== ======================**

卸载VS，通过注册表，然后重新安装VS2012，和手机SDK。这是我现在得到的 - 至少现在它会显示堆栈跟踪：

[本机到托管转换] System.Windows.ni.dll!MS.Internal.JoltHelper.OnUnhandledException(object sender, System.UnhandledExceptionEventArgs args) [托管到本机转换] mscorlib.ni.dll!System.Reflection.RuntimeAssembly.nLoad( System.Reflection.AssemblyName 文件名，字符串 codeBase，System.Security.Policy.Evidence assemblySecurity，System.Reflection.RuntimeAssembly locationHint，ref System.Threading.StackCrawlMark stackMark，System.IntPtr pPrivHostBinder，bool throwOnFileNotFound，bool forIntrospection，bool suppressSecurityChecks) mscorlib。 ni.dll!System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(System.Reflection.AssemblyName assemblyRef, System.Security.Policy.Evidence assemblySecurity, System.Reflection.RuntimeAssembly reqAssembly, ref System.Threading.StackCrawlMark stackMark, System.IntPtr pPrivHostBinder,bool throwOnFileNotFound, bool forIntrospection, bool suppressSecurityChecks) mscorlib.ni.dll!System.Reflection.RuntimeAssembly.InternalLoad(string assemblyString, System.Security.Policy.Evidence assemblySecurity, ref System.Threading.StackCrawlMark stackMark, System.IntPtr pPrivHostBinder, bool forIntrospection ) mscorlib.ni.dll!System.Reflection.RuntimeAssembly.InternalLoad(string assemblyString, System.Security.Policy.Evidence assemblySecurity, ref System.Threading.StackCrawlMark stackMark, bool forIntrospection) mscorlib.ni.dll!System.Reflection.Assembly。加载（字符串 assemblyString）Microsoft.Phone.ni.dll！Microsoft.Phone.BackgroundAgentActivator.LoadEntryPointAssembly（字符串 assemblyName）Microsoft.Phone.ni.dll！Microsoft.Phone.BackgroundAgentActivator.LoadAgent（字符串 assemblyName，字符串 typeName）Microsoft.Phone。 ni.dll!Microsoft.Phone。BackgroundAgentActivator.Microsoft.Phone.IBackgroundAgentActivator.CreateBackgroundAgent（字符串程序集，字符串类型信息） Microsoft.Phone.ni.dll!Microsoft.Phone.BackgroundAgentDispatcher.AgentRequest.Invoke() Microsoft.Phone.ni.dll!Microsoft.Phone.BackgroundAgentDispatcher.InvocationThread () mscorlib.ni.dll!System.Threading.ThreadHelper.ThreadStart_Context(对象状态) mscorlib.ni.dll!System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback 回调，对象状态， bool preserveSyncCtx) mscorlib.ni.dll!System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext executionContext, System.Threading.ContextCallback callback, object state, bool preserveSyncCtx) mscorlib.ni.dll!System.Threading.ExecutionContext.Run (System.Threading.ExecutionContext executionContext,System.Threading.ContextCallback 回调，对象状态）mscorlib.ni.dll!System.Threading.ThreadHelper.ThreadStart() [原生到托管转换]

还考虑到我使用的是低内存模拟器并且忘记了在低内存设备中不允许使用后台代理，但是我使用哪个模拟器（或设备）没有区别。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-01-14T10:54:12.763

经过这么长时间的斗争，我已经解决了这个问题。在将代码从一个项目复制到另一个项目时，我忘记在主项目中添加对 ScheduledTask 项目的引用。

在编写示例代码的过程中，我还学到了一些其他的东西，试图让它在我的项目之外工作。首先，当您添加一个 ScheduledTask 项目时，它似乎没有将必要的元数据添加到 WMAppManifest.xml 文件中，因此您需要手动添加它。另一件事是，在与后台代理打交道时，错误消息可能非常神秘，并且可能无法说明问题的真正含义。

从现在开始，当我在处理计划任务时看到像我在这里看到的错误（我已经看到了几个非常神秘的错误，看起来都一样，但不完全一样），这将是一个提示，以确保我'我得到了对第二个项目的引用，并确保必要的信息在 WMAppManifext.xml 中（包括拼写 - 如果拼写错误，它不会加下划线）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:56:58.350

是的，这个代码片段无法在 WP7.5 SDK 上运行。`task.ToString()`将是类型名称（“ `Microsoft.Phone.Scheduler.PeriodicTask`”），因此不是正确的值。

改变：

```
ScheduledActionService.LaunchForTest(task.ToString(), TimeSpan.FromSeconds(60)); 
```

到：

```
ScheduledActionService.LaunchForTest(task.Name, TimeSpan.FromSeconds(60)); 
```

它工作正常。

回答您的问题：*.ni.dll 是 NGENed .net dll。该框架获得了 NGEN 并部署到手机，因此您将看到的大多数异常都来自 *.ni 框架 dll。我猜你刚刚看到了一个通用的异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-01T04:45:04.067

你的进展如何？当我进入后台代理代码时，我遇到了一个非常相似的问题（System.Windows.ni.dll 中发生了“System.InvalidOperationException”……它在 WP7 中运行良好……除了现在，该应用程序仍然是 WP7我在 VS2012 下运行并安装了 WP8 SDK。

有趣的是，我有另一个运行良好的应用程序 - 完全相同的场景和环境。

你的问题解决了吗？这非常令人沮丧。

# mediawiki - 根据 MediaWiki 中的主机名显示不同的主页

> ID：14077822
> 
> 赞同：2
> 
> 时间：2012-12-29T01:15:20.763
> 
> 标签：mediawiki

我有两个域指向同一个 wiki 共享同一个数据库。

我想要这样，domainA.com 的主页是 MainPageA，而 domainB.com 的主页是 MainPageB。

据我所知，更改 MediaWiki 主页的唯一方法是编辑 MediaWiki:Mainpage，但它存储在 MySQL 数据库中。由于两个 wiki 共享同一个数据库，因此两个主页也会发生变化。

共享数据库的原因是因为所有文章都适用于两个 wiki，只是 wiki 的徽标等不同。

我可以设置某种 PHP 条件变量来设置主页吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T01:32:55.640

您可以在 wikicode 中执行此操作，方法是使您的主页源看起来像这样：

```
{{#switch:{{SERVERNAME}}
  |domainA.com={{:Main Page for domainA.com}}
  |domainB.com={{:Main Page for domainB.com}}
  |#default=<span class=error>Unrecognized domain {{SERVERNAME}}.</span>
}} 
```

甚至只是：

```
{{:Main Page for {{SERVERNAME}}}} 
```

有关详细信息，请参阅mediawiki.org 上的[帮助：魔术词](http://www.mediawiki.org/wiki/Help%3aMagic_words)。（请注意，第一个版本还需要[ParserFunctions 扩展](http://www.mediawiki.org/wiki/Help%3aExtension%3aParserFunctions)。）

附言。MediaWiki 的解析器缓存可能存在一些问题，可能导致出现错误的主页。如果是这样，一个快速而肮脏的解决方法是安装[MagicNoCache 扩展](http://www.mediawiki.org/wiki/Extension%3aMagicNoCache)并添加`__NOCACHE__`到主页。

pps。缓存问题的更好解决方案可能是确保不同站点具有单独的缓存键，方法是将以下行添加到 LocalSettings.php：

```
$wgRenderHashAppend .= "!$wgServer"; 
```

# python - 使用 Python 将我的 Windows 计算机与 wifi AP 相关联

> ID：14077835
> 
> 赞同：8
> 
> 时间：2012-12-29T01:17:16.520
> 
> 标签：python, windows, networking, pywin32, wifi

我正在尝试编写一个 python 脚本，它可以使我的计算机与无线接入点相关联，并将名称作为字符串。例如，我可能会指定我想连接到`linksys`，我的脚本会导致计算机执行此操作。

我查看了[这个](https://stackoverflow.com/questions/12126744/how-do-i-connect-disconnect-configure-a-wireless-network-in-python)问题，但无法通过查看提供的链接来理解该怎么做。

有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T07:09:07.900

我决定采纳 Paulo 的建议并尝试使用 Powershell/命令行。我找到了[一篇](http://www.hanselman.com/blog/HowToConnectToAWirelessWIFINetworkFromTheCommandLineInWindows7.aspx)关于通过命令行连接网络的文章。

从命令行，您可以执行以下操作：

```
netsh wlan connect <profile-name> [name=<ssid-name>] 
```

...其中`name=<ssid-name>`部分是可选的，并且仅当配置文件包含多个 ssid 时才必须。

但是，看起来配置文件必须已经存在于机器上才能使命令行的东西工作。我确实找到了关于以编程方式创建个人资料的[论坛帖子](http://web.archive.org/web/20130118023617/http://www.techfuels.com/wireless-networking/14222-creating-profiles-connecting-wireless-lan.html)，但我不想通过它进行拉票。

如果配置文件名称已经存在，那么您可以从 Python 执行类似于以下的操作：

```
import subprocess

def connect_to_network(name):
    process = subprocess.Popen(
        'netsh wlan connect {0}'.format(name),
        shell=True,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE)
    stdout, stderr = process.communicate()

    # Return `True` if we were able to successfully connect
    return 'Connection request was completed successfully' in stdout 
```

这是一个不完美的解决方案，我不完全确定它是否适用于所有情况，但它确实适用于我的特定情况。我想我会发布我想出的东西，以防其他人想尝试修改它以使其更好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T03:43:47.393

您链接的答案谈到从 Windows API 调用低级 C 函数。摆弄低级的东西会让我的大脑受伤。

有[一个围绕原生 C 调用的 .Net 包装器](http://managedwifi.codeplex.com/)，您可以直接从[IronPython](http://ironpython.net/)使用这个更高级别的 API 。不幸的是，它没有很好的文档记录，但是查看 C# 示例并挖掘源代码应该比调用底层 API 更容易。[这是一个非常以 Windows 为中心的解决方案，因此powershell](https://stackoverflow.com/questions/801456/connect-to-wireless-network)可能会更好地为您服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-20T18:58:50.327

我编写了一个 Python CLI 工具，用于通过命令行界面控制 Wi-Fi。这个项目中有一个库，它应该符合您的要求。

[https://github.com/changyuheng/pywinwifi](https://github.com/changyuheng/pywinwifi)

还有另一个独立的库，但我从未尝试过。

[https://github.com/reedcourty/pynetsh](https://github.com/reedcourty/pynetsh)

# php - 从数组中的单个多值行中提取一个值

> ID：14077837
> 
> 赞同：1
> 
> 时间：2012-12-29T01:17:32.417
> 
> 标签：php, regex, arrays

> **可能重复：**
> [在 PHP 中，是否有一个函数可以返回由关联数组数组中的键值组成的数组？](https://stackoverflow.com/questions/10659875/in-php-is-there-a-function-that-returns-an-array-made-up-of-the-value-of-a-key)

多个值存储在数组的一行中，如下所示：

```
Array
(
  [data] =>
     Duration: 1 Month
     Name: James Foo
     Category: Info Tech
) 
```

* * *

## 问题：

如何分别从 [data] 中提取和回显值？即只显示`Category: Info Tech`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:37:57.413

如果您更喜欢正则表达式，您可以这样做：

```
$array = array('data' =>
'Duration: 1 Month
Name: James Foo
Category: Info Tech');

function get_line($array, $line)
{
    preg_match('/' . preg_quote($line) . ': ([^\n]+)/', $array['data'], $match);
    return $match[1];
}

echo get_line($array, 'Category'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:22:21.140

```
foreach ($array as $k => $v)
    echo "Category: ".$v['Category']."\n"; 
```

# stata - 保存在磁盘上并重新加载 esttab 的估计值

> ID：14077838
> 
> 赞同：2
> 
> 时间：2012-12-29T01:17:35.863
> 
> 标签：stata

有没有办法在`eststo`命令和命令之间保存和重新加载数据`esttab`？

我想要的是以下内容：

```
eststo: quietly reg a b
estsave using foo.est, replace

***

*Some other File
estload using foo.est
esttab foo.tex 
```

任何其他让我通过反复试验来输出回归的方式的替代方案（无需重新运行它们并且必须在交互式提示下）将非常有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-01-07T21:26:52.460

Why do you need to put it to disk?

The (prefix) command `eststo` stores the results in memory until you close the file, and unless specified names each estimate consecutively (`eststo1`, `eststo2` etc.). You can re-program and re-run only part of the `do` file.

Alternatively, you could create all estimates in a `do` and call it from a secondary `do`:

```
/* .do for make tables */
do makeEstimates.do
esttab ... 
```

Elsewhere you program `makeEstimates.do`:

```
/* .do to make estimates */
quietly regress a b
estout ab 
```

You can run once, then comment out the `do makeEstimates.do` line to just work on `estout` if you do not change them.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-04-05T20:24:43.287

`estimates save`您可以使用以下命令将估计值存储在磁盘上：

```
sysuse auto, clear

quietly regress price mpg
estimates save foo1

quietly regress price trunk
estimates save foo2

quietly regress price weight
estimates save foo3 
```

上面的代码片段`3`在您当前的工作目录中创建了包含估计值的文件：

```
foo1.ster
foo2.ster
foo3.ster 
```

然后，您可以重新加载这些并以`esttab`非交互方式使用它们，并以您喜欢的任何方式使用`estimates use`命令：

```
estimates use foo2
esttab .

----------------------------
                      (1)   
                    price   
----------------------------
trunk               216.7** 
                   (2.81)   

_cons              3183.5** 
                   (2.87)   
----------------------------
N                      74   
----------------------------
t statistics in parentheses
* p<0.05, ** p<0.01, *** p<0.001 
```

```
estimates use foo1
esttab .

----------------------------
                      (1)   
                    price   
----------------------------
mpg                -238.9***
                  (-4.50)   

_cons             11253.1***
                   (9.61)   
----------------------------
N                      74   
----------------------------
t statistics in parentheses
* p<0.05, ** p<0.01, *** p<0.001 
```

```
estimates use foo3
esttab .

----------------------------
                      (1)   
                    price   
----------------------------
weight              2.044***
                   (5.42)   

_cons              -6.707   
                  (-0.01)   
----------------------------
N                      74   
----------------------------
t statistics in parentheses
* p<0.05, ** p<0.01, *** p<0.001 
```

# goto - Goto此时出乎意料 - 批处理

> ID：14077840
> 
> 赞同：4
> 
> 时间：2012-12-29T01:19:21.223
> 
> 标签：goto

我正在尝试制作基于文本的批量游戏。但是我刚开始写它时遇到了一个我以前从未遇到过的问题。

```
:menu
:: the game menu - opens when the game starts
cls
echo This game is still being made -- expermintal
echo Start Screen:
echo [1] View Changes
echo [2] Start Game
echo enter your choice:
set /p startchoice =
if %startchoice%==1 goto changes
if %startchoice%==2 goto startgame 
```

当我输入 1 或 2 时，它显示错误“此时 goto 是意外的”我该如何解决？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-12-29T01:29:15.747

你`startchoice`的设置不正确。`set /p`在您提供提示的位置使用替代语法（并删除`startchoice`赋值（ ）运算符之间的空格 - 我认为这实际上是问题的原因，但如果您使用语法`=`，您可以将批处理文件减少一行） `set /p <variable>=<Prompt>`.

`goto`我为, 和语句添加了两个目标，`echo`以便您可以看到它们已达到：

```
:menu
:: the game menu - opens when the game starts
cls
echo This game is still being made -- expermintal
echo Start Screen:
echo [1] View Changes
echo [2] Start Game
set /p startchoice=Enter your choice:

if %startchoice%==1 goto changes
if %startchoice%==2 goto startgame
:changes
echo Changes
goto end
:startgame
echo StartGame
:end 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-29T01:29:35.357

您需要在 if 比较周围加上引号，并且它不喜欢您在没有提示的情况下使用 set / p 。以下作品：

```
:menu
:: the game menu - opens when the game starts
cls
echo This game is still being made -- expermintal
echo Start Screen:
echo [1] View Changes
echo [2] Start Game
set /p startchoice = "enter your choice: "
if "%startchoice%"=="1" goto changes
if "%startchoice%"=="2" goto startgame 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:30:09.987

不要使用环境变量，试试这个：

```
CHOICE
IF %ERRORLEVEL% EQU 1 goto changes
IF %ERRORLEVEL% EQU 2 goto startgame 
```

Choice 是一个允许您输入数字或 y/n 并返回错误代码的程序。%ERRORLEVEL% 是一个保存程序最后一个错误代码的变量。

您也可以进行其他比较。

```
EQU  - equal 
NEQ - not equal 
LSS - less than 
LEQ - less than or equal 
GTR - greater than 
GEQ - greater than or equal 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2017-04-18T20:22:34.797

可能出现故障的另一个原因是您没有正确包含 SET /PM= 变量... m 和等号之间不应有空格。

# java - 如何在 Java 应用程序中测试私有构造函数？

> ID：14077842
> 
> 赞同：46
> 
> 时间：2012-12-29T01:20:24.430
> 
> 标签：java, unit-testing, junit

如果一个类包含一堆静态方法，为了确保没有人错误地初始化这个类的实例，我做了一个私有构造函数：

```
private Utils() {
} 
```

现在.. 鉴于构造函数看不到，这怎么能被测试？这完全可以被测试覆盖吗？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2012-12-29T01:25:40.033

使用反射，您*可以*调用私有构造函数：

```
Constructor<Util> c = Utils.class.getDeclaredConstructor();
c.setAccessible(true);
Utils u = c.newInstance(); // Hello sailor 
```

但是，您甚至可以做到这一点：

```
private Utils() {
    throw new UnsupportedOperationException();
} 
```

通过在构造函数中抛出异常，您可以阻止所有尝试。

我也会自己上课`final`，只是“因为”：

```
public final class Utils {
    private Utils() {
        throw new UnsupportedOperationException();
    }
} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-12-29T01:29:45.497

测试代码的意图..总是:)

例如：如果构造函数的点是私有的，那么你需要测试的是这个事实，而不是别的。

使用反射[API](http://en.wikipedia.org/wiki/Application_programming_interface)查询构造函数并验证它们是否具有私有属性集。

我会做这样的事情：

```
@Test()
public void testPrivateConstructors() {
    final Constructor<?>[] constructors = Utils.class.getDeclaredConstructors();
    for (Constructor<?> constructor : constructors) {
        assertTrue(Modifier.isPrivate(constructor.getModifiers()));
    }
} 
```

如果您想对对象构造进行适当的测试，您应该测试允许您获取构造对象的公共 API。这就是上述 API 应该存在的原因：正确构建对象，因此您应该对其进行测试:)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-12-29T01:23:40.170

```
@Test
public//
void privateConstructorTest() throws Exception {
    final Constructor<?>[] constructors = Utils.class.getDeclaredConstructors();
    // check that all constructors are 'private':
    for (final Constructor<?> constructor : constructors) {
        Assert.assertTrue(Modifier.isPrivate(constructor.getModifiers()));
    }        
    // call the private constructor:
    constructors[0].setAccessible(true);
    constructors[0].newInstance((Object[]) null);
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-12-29T01:46:46.717

> 确保没有人错误地初始化此类的实例

通常我所做的是将方法/构造函数从私有更改为默认包可见性。而且我对我的测试类使用相同的包，所以从测试中可以访问方法/构造函数，即使它不是来自外部。

要强制执行不实例化类的策略，您可以：

1.  从默认的空构造函数中抛出 UnsupportedOperationException("不要实例化此类！")。
2.  声明类抽象：如果它只包含静态方法，您可以调用静态方法但不能实例化它，除非您将其子类化。

或者同时应用 1+2，如果您的测试与目标类共享相同的包，您仍然可以子类化并运行构造函数。这应该是相当“防错”的；恶意编码人员总能找到解决方法:)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-12-29T01:34:21.430

如果您有一个私有构造函数，它会从您的代码的一些不那么私有的方法中调用。所以你测试那个方法，你的构造函数就被覆盖了。根据方法进行测试没有宗教美德。您正在寻找函数或更好的分支覆盖级别，您可以通过使用它的代码路径执行构造函数来简单地获得它。

如果该代码路径复杂且难以测试，那么您可能需要对其进行重构。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-08-11T09:39:41.927

如果在构造函数中添加异常，例如：

```
private Utils() {
    throw new UnsupportedOperationException();
} 
```

测试类中的调用`constructor.newInstance()`将抛出一个`InvocationTargetException`而不是你的`UnsupportedOperationException`，但所需的异常将包含在抛出的异常中。
如果要断言抛出的**异常**，则可以在捕获调用异常后抛出调用异常的目标。
例如，使用 jUnit 4 你可以这样做：

```
@Test(expected = UnsupportedOperationException.class)
public void utilityClassTest() throws NoSuchMethodException, IllegalAccessException, InstantiationException {
    final Constructor<Utils> constructor = Utils.class.getDeclaredConstructor();
    constructor.setAccessible(true);
    try {
        constructor.newInstance();
    } catch (InvocationTargetException e) {
        throw (UnsupportedOperationException) e.getTargetException();
    }
} 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2015-08-11T09:44:07.617

不。构造函数是私有的。这就是你所需要的。Java 强制执行其隐私。

不要测试平台。

# magento - Magento 和 urlencoded 网址

> ID：14077844
> 
> 赞同：0
> 
> 时间：2012-12-29T01:20:38.767
> 
> 标签：magento, url-rewriting

我在谷歌中有一些这样的链接：

**/%3Fcat%3D9%26dir%3Dasc%26limit%3D10%26mode%3Dlist%26order%3Dprice**

这等于这个链接（urldecoded）：

**/?cat=5&dir=desc&order=price&p=2**

如果我们通过 url **http://my-shop.com/%3Fcat%3D9%26dir%3Dasc%26limit%3D10%26mode%3Dlist%26order%3Dprice**访问，那么 Magento 会显示 404 错误

我怎样才能让 Magento 将那些错误的 url 重定向到它们各自的 urldecoded 正确的 url？

Magento 版本 1.7.0.2

谢谢你的时间

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-30T08:26:02.820

问题是网址，而不是重定向。我希望这很清楚？您必须从您的商店和谷歌中删除此网址。

在那之后，我不认为有什么好方法可以做到这一点，因为您尝试修复一个不常见的错误。

magento 方式可能是将规则添加到 htaccess 或将规则添加到 Magento 内部重写表，但两种解决方案都不处理通用规则或正则表达式，这解决了这个问题（我不确定使用 htaccess）。

所以，我会修复“错误的 url 创建”问题并在开始时破解 index.php，检查是否请求了这样的 url，对其进行解码并重定向到页面，`die();`

# c++ - 为什么在打印函数时总是输出为 1？

> ID：14077845
> 
> 赞同：4
> 
> 时间：2012-12-29T01:20:39.610
> 
> 标签：c++

我想知道为什么当我打印这个函数时我总是得到输出为 1。这是代码：

```
#include <iostream>
using namespace std;

int main() {
    int x(int());
    cout << x; // 1
} 
```

它总是打印出一个。为什么？我期待它输出 0，因为 int 默认为 0。那么为什么是 1？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T01:32:39.487

```
int x(int()); 
```

是“[最令人头疼的解析](http://en.wikipedia.org/wiki/Most_vexing_parse)”的一个案例；你认为这是一个`int`( `int x`) 的声明，初始化为 ints ( `int()`) 的默认值；相反，编译器将其解释为返回 an[作为](http://cdecl.org/)参数`int`的函数的`int`声明[此处](http://unixwiz.net/techtips/reading-cdecl.html)的类型声明）。

然后，当你这样做时：

```
cout << x; 
```

`x`这里衰减到函数指针，但是没有函数指针的重载`operator<<`；给出一些有效重载的最简单的隐式转换`operator<<`是 to `bool`，并且，由于函数指针不能有 0 ( `NULL`) 值，所以它被评估为`true`，打印为 1。

请注意，我不完全确定这样的代码是否应该在没有错误的情况下编译——您正在获取一个仅声明且未定义的函数的地址；确实，它不能被评估为除 之外的任何东西*，*`true`但原则上你应该得到一个链接器错误（这里被优化器掩盖，它删除了对 的任何引用`x`，因为它实际上并没有被使用）。

* * *

你真正想要的是：

```
int x=int(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:22:48.553

该函数正在被转换为一个值`bool`并被打印为一个`bool`值。该函数位于非零地址，因此转换产生`true`.

这是一个标准的转换序列，包括函数到指针的转换，然后是布尔转换。

遵循顺序是因为没有更好的重载`operator<<`。

# c - 错误：“Img”的存储大小未知

> ID：14077849
> 
> 赞同：0
> 
> 时间：2012-12-29T01:21:09.500
> 
> 标签：c, size, storage, typedef, pgm

我正在尝试编写一个简单的代码来读取 .PGM 文件。我写的代码是

```
#include "./netpbm/lib/pgm.h"
#include <stdio.h>

typedef unsigned int gray;

int main(int argc, char* argv[]){

    gray Maxval;
    gray* Img[];
    int row, col;

    FILE *fp;

    fp = fopen("barcode.PGM", "r");

    pm_proginit(0, &argv[0]);

    &Img[0] = pgm_readpgm(fp, &col, &row, &Maxval);
} 
```

它输出错误：“Img”的存储大小未知

任何调试建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:34:20.273

从[libpgm 的文档中](http://netpbm.sourceforge.net/doc/libpgm.html)，您似乎应该声明一个指向指针的指针：

```
gray **Img;
...
Img = pgm_readpgm(fp, &col, &row, &Maxval);
...
pgm_freearray(Img, row); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:29:07.993

您需要给该数组一个大小：

```
gray *Img[100]; 
```

由于看起来您直到在程序的后面才知道要给它什么大小，所以您可能想要研究动态分配（使用[`malloc(3)`](http://linux.die.net/man/3/malloc)and [`free(3)`](http://linux.die.net/man/3/free)）或可能是[可变长度数组](http://gcc.gnu.org/onlinedocs/gcc/Variable-Length.html)，如果您可以使用 C99 功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:29:20.257

没有什么可调试的，因为您的代码甚至无法编译。它无法编译，因为您声明`Img`为指针数组`gray`但未指定大小。因此编译器不知道数组应该有多大并抱怨。

# python - python 字典列表对多个键进行排序

> ID：14077851
> 
> 赞同：0
> 
> 时间：2012-12-29T01:21:13.047
> 
> 标签：python, sorting

我有一个字典列表，其中的键为`path`and `type`（类型 0 => 文件和类型 1 => 目录）初始看起来像这样

```
everything = [{u'path': u'/1/', u'type': 1},
     {u'path': u'/2/', u'type': 1},
     {u'path': u'/3/', u'type': 1},
     {u'path': u'/1/something/a.py', u'type': 0},
     {u'path': u'/1/something/b.py', u'type': 0},
     {u'path': u'/1/something/c.py', u'type': 0},
     {u'path': u'/1/foobar/', u'type': 1},
     {u'path': u'/2/baz/', u'type': 1},
     {u'path': u'/1/something/baz/snap/pop/a.py', u'type': 0},
     {u'path': u'/1/something/baz', u'type': 1}] 
```

我想先排序`path`然后关闭`type`所以我得到这样的东西

```
everything = [{u'path': u'/1/', u'type': 1},
     {u'path': u'/1/foobar/', u'type': 1},
     {u'path': u'/1/something/baz', u'type': 1}, # < --- I want this here
     {u'path': u'/1/something/a.py', u'type': 0},
     {u'path': u'/1/something/b.py', u'type': 0},
     {u'path': u'/1/something/baz/snap/pop/a.py', u'type': 0},
     {u'path': u'/1/something/c.py', u'type': 0},
     {u'path': u'/2/', u'type': 1},
     {u'path': u'/2/baz/', u'type': 1},
     {u'path': u'/3/', u'type': 1}] 
```

其中“某事”部分以类型 1 开头。

我想当我这样做的时候

```
everything.sort(key=lambda x: (x['path'], x['type'])) 
```

我会得到我想要的，但我得到了

```
everything = [{u'path': u'/1/', u'type': 1},
     {u'path': u'/1/foobar/', u'type': 1},
     {u'path': u'/1/something/a.py', u'type': 0},
     {u'path': u'/1/something/b.py', u'type': 0},
     {u'path': u'/1/something/baz', u'type': 1}, # < --- I don't want this here
     {u'path': u'/1/something/baz/snap/pop/a.py', u'type': 0},
     {u'path': u'/1/something/c.py', u'type': 0},
     {u'path': u'/2/', u'type': 1},
     {u'path': u'/2/baz/', u'type': 1},
     {u'path': u'/3/', u'type': 1}] 
```

有没有一种简单的方法以这种方式排序`everything`，还是我必须编写自己的排序？

编辑：

也许这将有助于解释我想要什么。

在 linux 中，当你执行 a 时，`ls -lR`你会得到一个很好的 dirs 列表和它下面列出的 dirs 中的文件。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:38:48.453

您只需要在键中包含您实际想要排序的内容。由于您似乎希望降低路径中最后一个斜杠分隔段之后的所有内容的优先级，因此您应该删除它或稍后按排序顺序移动它：

```
everything.sort(key=lambda x: (
    '/'.join(x['path'].split('/')[:-1]),
    x['type'],
    ''.join(x['path'].split('/')[-1:]),
  )
) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:40:53.333

您的排序标准非常深奥，我认为您只能通过编写[比较函数](http://wiki.python.org/moin/HowTo/Sorting#The_Old_Way_Using_the_cmp_Parameter)来做到这一点。

# android - 当手机处于睡眠状态或活动（用于启动服务）未运行时，服务不应停止

> ID：14077861
> 
> 赞同：1
> 
> 时间：2012-12-29T01:23:01.330
> 
> 标签：android, service

我想运行一项服务来收集加速度计传感器信息，并且当手机处于睡眠状态或活动（用于启动服务）未运行时它不应该停止。我必须从菜单活动向服务发送启动和停止命令。
目前我在活动的同一过程中使用捆绑服务，但问题是一旦活动关闭（按下回车键）它就会关闭。

我想知道我是否使用单独的进程，即使没有捆绑的活动（当活动关闭时）它也会恢复。

如果不是，我应该选择哪种服务模式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T02:02:02.123

您可能正在寻找 startService 而不是 bindService。

[http://developer.android.com/reference/android/content/Context.html#startService%28android.content.Intent%29](http://developer.android.com/reference/android/content/Context.html#startService%28android.content.Intent%29)

但是，即使使用 startService，也不能保证服务将“永远”和“始终”保持运行。

警告，以下选项会消耗大量电池。

您可以通过将优先级更改为 startforeground（需要通知）来增加服务不会停止的机会。

当屏幕关闭时，保持服务“始终处于活动状态”的唯一方法是将警报管理器与 RTC_WAKEUP 或 ELAPSED_REALTIME_WAKEUP 时间表一起使用。

电池少...

然而，实际上，如果没有 startForeground 并且只使用正常的 RTC 或 ELAPSED_REALTIME 警报计划，您的服务将在大部分时间运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:01:38.177

您可以在与您的应用程序相同的进程中创建一个服务，即使您的活动全部关闭，应用程序仍然可以工作，因为您的服务仍然存在，直到您调用 stopservice （系统将在被系统杀死时自动重新启动您的服务）。如果您的服务与活动执行复杂的通信，我认为您应该使用远程信使服务。在服务运行期间，您可以绑定到服务以在服务和活动之间发送和接收数据。有关服务和与服务通信的更多信息，您可以参考[这里](http://developer.android.com/reference/android/app/Service.html#RemoteMessengerServiceSample)

# actionscript-3 - 制作此游戏 AS3 的最佳方法

> ID：14077862
> 
> 赞同：0
> 
> 时间：2012-12-29T01:23:07.270
> 
> 标签：actionscript-3

我正在为 uni 制作游戏作为我单位的一部分，但我不知道最好的方法，因为我是 AS3 的新手。我有 8 位客人参加聚会，每个人都有不同的个性、爱好和兴趣。游戏是这样运行的，如果你点击一个客人并点击舞台上的任何地方，那么那个客人就会走向它。如果您点击一位客人，然后点击另一位客人，您首先点击的客人将向您第二次点击的客人移动，当他们靠近时，他们会互相交谈。

所有 8 位客人在移动方面将共享相同的功能和代码。我已经完成了点击和移动部分，但它是在 Guest01 类上完成的，但所有的客人都会有相同的。我应该为每个客人创建 8 个不同的类，还是应该使用数组来创建。我真的不知道如何开始。下面是点击和移动的代码：

```
package 
{
    import flash.display.MovieClip;
    import flash.events.Event;
    import flash.events.MouseEvent;
    import flash.filters.*;

    public class Guest01 extends MovieClip
    {
        var walkSpeed:Number = 5;
        var oldPosX;
        var oldPosY;

        var myGlow:GlowFilter = new GlowFilter();

        public function Guest01()
        {
            addEventListener(MouseEvent.MOUSE_OVER, addGlow);
        }

        public function addGlow(event:MouseEvent):void
        {
            filters = [myGlow];
            addEventListener(MouseEvent.MOUSE_OUT, removeGlow);
            addEventListener(MouseEvent.CLICK, ready);

        }

        function removeGlow(event:MouseEvent):void
        {
            filters = [];
        }

        public function ready(event:MouseEvent):void
        {
            filters = [myGlow];
            stage.addEventListener(MouseEvent.MOUSE_DOWN, walk);
            removeEventListener(MouseEvent.MOUSE_OUT, removeGlow);
        }

        function walk(event:MouseEvent):void
        {
            oldPosX = parent.mouseX;
            oldPosY = parent.mouseY;
            rotation = Math.atan2(oldPosY - y,oldPosX - x) / Math.PI * 180;
            filters = [];
            stage.removeEventListener(MouseEvent.MOUSE_DOWN, walk);
            stage.addEventListener(Event.ENTER_FRAME, loop);
        }

        function loop(event:Event):void
        {
            var dx:Number = oldPosX - x;
            var dy:Number = oldPosY - y;
            var distance:Number = Math.sqrt((dx*dx)+(dy*dy));
            if (distance<walkSpeed)
            {
                // if you are near the target, snap to it
                x = oldPosX;
                y = oldPosY;
                removeEventListener(Event.ENTER_FRAME, loop);

            }
            else
            {
                x = x+Math.cos(rotation/180*Math.PI)*walkSpeed;
                y = y+Math.sin(rotation/180*Math.PI)*walkSpeed;
            }

        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:45:04.217

> 我已经完成了点击和移动部分，但它是在 Guest01 类上完成的，但所有的客人都会有相同的。我应该为每个客人创建 8 个不同的类，还是应该使用数组来创建。

您不应该为 8 个不同的客人创建 8 个不同的类，但您应该尝试为不同的客人重复使用这些类和方法。

> 我有 8 位客人参加聚会，每个人都有不同的个性、爱好和兴趣。

您可能希望创建一个**Guest**类并将所有属性（个性、爱好等）保留为该类中的变量。您必须在开始时根据客人选择（或随机）的配置文件为不同的客人初始化类。此外，Guest 的所有方法（如 walk、glow 等）都是类本身的方法。

希望对您有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-30T01:42:13.953

只是试图从不同的帖子中回答您的问题。您需要将游戏分解为简单的动作，例如将用户从一个地方移动到另一个地方，计算用户想要移动到另一个用户时应该移动到的偏移位置，计算用于显示用户爱好和兴趣的元素的位置等。

你以前用过面向对象的语言吗？在进行诸如构建游戏之类的项目之前，您必须牢牢掌握一些基本原理。根据您上一篇文章，您的下一个重点应该是以下方法。

由于您已经编写了基于用户点击重新定位播放器的函数，您应该编写以下函数：

1.  在 clickToMove() 函数内部（或任何你称之为的函数）。编写一个 if 测试以查看重定位单击选择的是空位置还是用户在其上的位置。如果用户在场，您需要编写另一种方法来偏移要移动的玩家的位置，否则玩家将相互叠加。

我现在正在登机，很快会再次发布

# ruby-on-rails - 控制器不继承 before_filter

> ID：14077864
> 
> 赞同：2
> 
> 时间：2012-12-29T01:23:33.697
> 
> 标签：ruby-on-rails, ruby, actioncontroller

所以我有ApplicationController.rb：

```
class ApplicationController < ActionController::Base
  protect_from_forgery

  def decode_email
    params[:email] = URI::decode(params[:email])
  end
end 
```

然后是 UsersController.rb：

```
class UsersController < ApplicationController
  before_filter :decode_email, only: [:show]

  def show
    #blah blah
  end
end 
```

现在点击显示动作会导致：

```
undefined local variable or method 'decode_email' for #<UsersController:0x007fb5f216a710> 
```

为什么不继承该方法以便可以将其正确用作 before_filter？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-15T16:55:32.247

```
class ApplicationController < ActionController::Base
  protect_from_forgery

  private
    def decode_email
      params[:email] = URI::decode(params[:email])
    end
end 
```

为我工作

# pthreads - Ubuntu 11.10 Vmware 中的多线程

> ID：14077867
> 
> 赞同：0
> 
> 时间：2012-12-29T01:24:01.797
> 
> 标签：pthreads

我正在使用“pthread”库在 C++ 中编写一个多线程程序，但是当我在 Ubuntu 虚拟机上执行它时，尽管我有一个多核处理器（i7-2630QM），但我的线程似乎并没有并行运行。 . 代码太长了，所以我将用这个简单的代码来解释我的问题：

```
#include <iostream>
#include <pthread.h>
using namespace std;

void* myfunction(void* arg); //function that the thread will execute

int main()
{
    pthread_t thread;
    pthread_create(&thread, NULL, myfunction, NULL); //thread created
    for (int i=0; i<10; i++) //show "1" 10 times
         cout << "1";
    pthread_join(thread, NULL); //wait for the thread to finish executing
    return 0;
}

void* myfunction(void* arg)
{
    for (int j=0; j<10; j++) //show "2" 10 times
         cout << "2";
    return NULL;
} 
```

当我在主机操作系统（带有 VC++2010 的 Windows 7）上运行此代码时，我得到类似的结果`12212121211121212...`，这是多线程应用程序应该做的，但是当我在来宾操作系统上运行相同的代码时（Vmware 上的代码::块）我总是得到`11111111112222222222`！AFAIK 线程应该与 main() 函数并行运行，而不是顺序运行。我的VM的核数设置为4，但是程序好像只用了一个核，不知道是什么问题？是代码还是...？我在这里错过了什么吗？感谢您的帮助，提前感谢，请原谅我的英语：/

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T02:00:19.813

Windows 和 Linux CRT/STDC++ 库具有不同的同步行为。您无法通过调用`cout`. 编写一些实际的并行计算并测量经过的时间以了解发生了什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:47:46.527

使用信号量（全局或作为参数传递给我的函数）正确同步线程。由于操作系统之间的调度特性不同，您可能会遇到时间问题（这本身并不是一个真正的问题）。在调用 pthread_create 之后让第一个线程在信号量上等待，并让新线程在输入 myfunction 后立即发出信号。

此外，您的循环很短，使它们花费更长的时间。

[这里的例子](http://pages.cs.wisc.edu/~travitch/pthreads_primer.html)

# c# - 在 MYSQL 中插入 TIMESTAMP 数据？错误“MYSQL version for the right syntax to use near etc”

> ID：14077872
> 
> 赞同：1
> 
> 时间：2012-12-29T01:25:02.033
> 
> 标签：c#, mysql, sql, timestamp

我想在我的表中添加时间戳数据但出现错误我该如何解决这个问题？

![在此处输入图像描述](../Images/32fa4d0f0cd06ed56503d35412b2f674.png)

这是我的过程

```
 CREATE PROCEDURE `db`.`AddMerchantProcessor` (m_id INT, p_id INT, d TIMESTAMP)
BEGIN
    INSERT INTO `tbl_merchant_processor`(`merchant_id`, `processor_id`, `date`) VALUES(m_id, p_id, d);
END 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:29:00.067

时间戳应该用单引号括起来，例如

```
CALL AddMerchantProcessor(0, 1, '2012-01-01 00:00:00') 
```

但这不是使用`Command`对象的正确方法。查询应该被参数化。

这是一个小代码片段：

```
MySqlCommand comm = new MySqlCommand();
comm.Connection = cn;
comm.CommandType = CommandType.StoredProcedure;
comm.CommandText = "AddMerchantProcessor";
comm.Parameters.AddWithValue("m_id", m_id);
comm.Parameters.AddWithValue("p_id", p_id);
comm.Parameters.AddWithValue("d", d);
cn.Open();
comm.ExecuteNonQuery(); 
```

你需要：

*   用于自动对象处理的使用`using`语句
*   放一些`trycatch`用于适当的异常处理

来源

*   [加值](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlparametercollection.addwithvalue.aspx)
*   [添加（*要使用的首选方法*）](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlparametercollection.add.aspx)
*   [命令对象](http://msdn.microsoft.com/en-us/library/windows/desktop/ms677502%28v=vs.85%29.aspx)
*   [使用语句](http://msdn.microsoft.com/en-us/library/yh598w02%28v=vs.80%29.aspx)
*   [Try-Catch 块](http://msdn.microsoft.com/en-us/library/0yd65esw%28v=vs.80%29.aspx)

# jquery - 如何仅获得 1 个提交按钮来触发 Jquery 中的功能？

> ID：14077875
> 
> 赞同：0
> 
> 时间：2012-12-29T01:25:36.527
> 
> 标签：jquery

我在下面有四种不同类型的提交按钮：

```
<form id="QandA" action="register.php" method="post">

<input type='submit' name='submitImageBtn' class='sbtnimage' value='Upload' />

<input type='submit' name='submitVideoBtn' class='sbtnvideo' value='Upload' />

<input type='submit' name='submitAudioBtn' class='sbtnaudio' value='Upload' />

<input id="submitBtn" name="submitDetails" type="submit" value="Submit Details" />

</form> 
```

现在我在下面有一个函数，假设它可以处理单击提交按钮后发生的事情：

```
 $(function() {
    myClickHandler=function(e)
        {
            if (!validation())
                return false;

            if (!confirm("Are you sure you want to Proceed?" + "\n" ))
                return false;

            $.ajax({
                url: "insertQuestion.php",
                data: $("#QandA").serialize(),
                async: false,
                type: "POST"
            });

            return true;
        };

$('#QandA').submit(myClickHandler);

    }); 
```

现在，所有上述提交按钮都会触发上述事件。我只希望`id="submitBtn"`提交按钮触发上述功能。我不希望其他提交按钮触摸此功能。我的问题是我该怎么做？

**更新：**

```
$(function() {
$('#submitBtn').click(function(){
myClickHandler=function(e)
    {
        if (!validation())
            return false;

        if (!confirm("Are you sure you want to Proceed?" + "\n" ))
            return false;

        $.ajax({
            url: "insertQuestion.php",
            data: $("#QandA").serialize(),
            async: false,
            type: "POST"
        });

        return true;
    };
});    
}); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:28:39.193

您在哪里将点击处理程序附加到代码中的按钮？

无论如何，jQuery 的聪明之处在于它已经为您制作了简单的处理程序。您可以简单地将点击处理程序附加到这样的元素：

```
$(function() {
  $('#submitBtn').click(function(){
      //... Your code here
  });
}); 
```

[jQuery点击（）](http://api.jquery.com/click/)

完整代码：

```
$(function() {
  $('#submitBtn').click(function(){
    if (!validation())
      return false;

    if (!confirm("Are you sure you want to Proceed?" + "\n" ))
      return false;

    $.ajax({
        url: "insertQuestion.php",
        data: $("#QandA").serialize(),
        async: false,
        type: "POST"
    });
    return true;
  });
}); 
```

请注意，ajax 调用将异步执行，因此`return true`可能会在 ajax 调用返回之前被调用。请参阅[ajax()](http://api.jquery.com/jQuery.ajax/)。（您需要应用成功功能）。

# emacs - 观看 sexpr 进行编辑

> ID：14077881
> 
> 赞同：1
> 
> 时间：2012-12-29T01:26:54.340
> 
> 标签：emacs, elisp

我想告诉 Emacs`car`在缓冲区中“观察”一个特定的表单（由它标识），并在我编辑它时评估它。

我能想到的一种方法是向 中添加一个函数`post-self-insert-hook`，该函数将查找并解析目标表单并将其与之前存储的状态进行比较。

这听起来并*不太*低效，尤其是在强制执行“每秒调用次数”最大值的情况下（例如使用`current-time`）。

**是否有更高级别/更惯用的方式来实现这一目标？**这听起来像是已经解决的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T21:47:03.190

我认为最自然的方法是创建一个覆盖从表格的开头到结尾的叠加层。

Overlays 有一个[modify-hooks](http://www.gnu.org/software/emacs/manual/html_node/elisp/Overlay-Properties.html#Overlay-Properties)属性，你可以给它添加一个观察者函数。

如果您在其中严格修改缓冲区内容，则覆盖将适当收缩或扩展，但您需要决定在表单边缘编辑缓冲区时要做什么。请参阅`insert-in-front-hooks`，以及[make-overlay](http://www.gnu.org/software/emacs/manual/html_node/elisp/Managing-Overlays.html#Managing-Overlays)`insert-behind-hooks`的最后两个参数。在大多数情况下，我可能只是重新创建覆盖，只是为了确定新的界限。

关于“每秒调用次数”的事情，您可以使用[run-with-idle-timer](http://www.gnu.org/software/emacs/manual/html_node/elisp/Idle-Timers.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-03T01:29:43.140

[@Dmitry](https://stackoverflow.com/users/615245/dmitry)提到的部分内容可以变成简单的原型。标记`(message "text")`并运行`M-x``eval-on-modify-add`

```
(defun eval-on-modify-add ()
  (interactive)
  (let ((ov (make-overlay (region-beginning) (region-end))))
    (overlay-put ov 'modification-hooks '(eval-on-modify-execute))))

(defun eval-on-modify-execute (ov &optional flag &rest rv)
  (if flag
      (eval-region (overlay-start ov) (overlay-end ov))))

(message "test") 
```

# android - Android - GC 滞后于“更大”图像的列表视图滚动

> ID：14077897
> 
> 赞同：3
> 
> 时间：2012-12-29T01:29:02.000
> 
> 标签：android, image, listview, garbage-collection, lag

在列表视图中，我想在列表条目上绘制一个图像。这 20 张图像必须缩放以填充垂直模式下的宽度。手机分辨率为 480 x 800 像素 (SGS2)。图像分辨率为 400x400，大小约为 100KB。我已将图像放在可绘制文件夹中。

当我滚动列表时，它并不顺利。

我了解一些事情： - 应用程序堆大小 = 有限，首次运行时分配 = 13MB，剩下 1 MB。- 我有 GC_FOR_ALLOC 日志消息，它会使系统停止 15 毫秒。（我认为这是我在滚动方面的滞后）。- 更改代码后，我还看到 GC_CONCURRENT 消息。

有了这些 GC 消息，我知道每次滚动到新列表视图条目中的另一个图像时，我的垃圾收集就会启动。到目前为止，我可以对此进行分析，但我不知道该怎么做才能永久修复和删除 GC。我已将图像缩小到 100x100，它会将 GC 消息推迟更长的时间。但最终 GC 开始了。我确实使用 convertview 回收视图，并已经在视图中使用了持有者。

我读过关于重用图像内存的文章，但不确定我是否以及如何做到这一点。或者，在列表视图中使用这些较大的图像时，这可能是“正常的”，我需要重新考虑图像的绘制，并且只有在 scolling 结束时才开始绘制？

我应该使用 Listview 滚动图片吗？

2012-12-31_02:11 我已经实现了 setOnScrollListener，它使滚动平滑。我认为这是我必须进一步调查以解决问题的代码。

* * *

## 列表视图适配器

```
public class ListviewAdapter extends BaseAdapter {

    private static Activity activity;
    private int[] data;
    private static LayoutInflater mInflater = null;

    public ListviewAdapter(Activity a, int[] d) {
        activity = a;
        data = d;
        mInflater = (LayoutInflater) activity
                .getSystemService(Context.LAYOUT_INFLATER_SERVICE);
    }

    public int getCount() {
        return data.length;
    }

    public Object getItem(int position) {
        return position;
    }

    public long getItemId(int position) {
        return position;
    }

    public View getView(int position, View convertView, ViewGroup parent) {
        ViewHolder holder;

        if (convertView == null) {
            convertView = mInflater.inflate(R.layout.listviewitem, parent,
                    false);
            holder = new ViewHolder();

            holder.picture = (ImageView) convertView.findViewById(R.id.image);
            convertView.setTag(holder);

        } else {
            holder = (ViewHolder) convertView.getTag();
        }

        if (!MainActivity.isScrolling) {
    holder.picture.setImageResource(data[position]);
    }

        return convertView;
    }

    static class ViewHolder {
        ImageView picture;
    }

} 
```

* * *

## 列表视图 XML

```
<LinearLayout
  xmlns:android="http://schemas.android.com/apk/res/android"
  android:layout_width="fill_parent"
  android:layout_height="wrap_content">
  <ImageView
      android:id="@+id/image"
      android:src="@drawable/stub"
        android:layout_width="fill_parent"
        android:layout_height="fill_parent"
        android:contentDescription="Animal images"
        android:scaleType="fitCenter"
        android:scrollingCache="false"
        android:animationCache="false" 
        />

</LinearLayout> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:36:24.657

您一直在打开`Bitmaps`，这些占用了大量需要收集的内存，以便为`Bitmaps`接下来要加载的大量内存留出空间。

`BitmapFactory` `Options`如果加载图像不会以全尺寸显示，您可以先使用对加载图像进行二次采样。这样，您只需占用尽可能多的内存来填充您的视图，从而减少*GC*调用。

您还可以尝试在适配器中保留某种*缓存*，以避免`Bitmaps`每次都重新加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:47:09.303

有很多技术可以让 ListView 更快。请参阅[android 中的高效 ListView](https://stackoverflow.com/questions/11684520/efficient-listview-in-android)。您应该回收视图，这将减少垃圾收集。您可能还考虑在列表滚动停止之前不加载图像，请参阅[在 android 中的 Listview 上延迟加载图像（初学者级别）？](https://stackoverflow.com/questions/2912054/lazy-load-images-on-listview-in-androidbeginner-level).

# php - 如何包含一个php文件，而不是执行它？

> ID：14077901
> 
> 赞同：-1
> 
> 时间：2012-12-29T01:29:27.400
> 
> 标签：php

test.php中有函数a和函数b，会被$_GET中的"act"参数调用，如果没有"act"的值则有默认值

```
<?php
   if(isset($_GET['act'])&&$_GET['act']){
     $act=$_GET['act'];
   }else{
     $act='a';
   }
   function a(){
    echo('this is a');      
   }
   function b(){
        echo('this is b');
  }
   $act();
?> 
```

如果我运行下面的代码，它将调用 test.php 中的函数 a 和函数 b，

```
<?php
   include ("test.php");
   b();
?> 
```

它怎么能只调用函数b？我不想更改“act”的默认值，因为它将被其他系统使用谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:42:46.970

你告诉它调用两个函数。当您包含（“test.php”）时，最后的行调用函数a：

```
$act(); 
```

然后在您的其他源文件中，您显式调用 b()：

```
b(); 
```

您需要删除其中一个调用。

顺便说一句，你正在做的事情*非常*危险，没有清理你的输入。举个简单的例子，假设您的第二个源文件名为 second.php，并且用户键入以下 url：

`http://yourserver.com/second.php?act=phpinfo`

他们会打印出您的 Apache 安装数据，包括您已加载的所有模块等。他们可能会做一些更危险的事情，而我没有考虑即兴发挥。您需要一个明确的法律行动白名单，您可以实际检查和验证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T02:11:50.140

您可以在包含的文件中定义一些变量/常量，当它存在时，不要调用`$act()`

```
<?php
   if(isset($_GET['act'])
       &&
      $_GET['act'] 
       && 
      in_array($_GET['act'],array('a','b'))
   ){
     $act=$_GET['act'];
   }else{
     $act='a';
   }
   function a(){
    echo('this is a');      
   }
   function b(){
        echo('this is b');
  }
   if(!defined('FOO')){
     $act();
   }
?> 
```

…………

```
<?php
   if(!defined('FOO')){
     define('FOO',true);
   }

   include ("test.php");
   b();
?> 
```

# jquery - 同步跨域请求？

> ID：14077906
> 
> 赞同：0
> 
> 时间：2012-12-29T01:29:52.190
> 
> 标签：jquery, asp.net, ajax, web-services, cordova

我需要从 html 页面向不同域中的 web 服务接口发送请求。有时，需要同步请求。例如：使用用户名和密码登录并在webservice确认后得到响应。

但是，我使用了jsonp，发现它无法进行同步请求。（html页面和webservice都在我的控制之下）

有什么好主意吗？提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T01:40:34.060

如果您发送 header('Access-Control-Allow-Origin: *') 您可以只使用标准的非异步 $.ajax 对象。

```
<?php
    header('Access-Control-Allow-Origin: *');
?>
<html>
...
</html>
<script type="text/javascript">
    $(document).ready( function()
    {
        $("#someID").on('click', function()
        {
            var username = 'username';
            var passwd = 'password';

            $.ajax(
            {
                type:'post,
                dataType:'json',
                url:'http://yoursite.com/web-service.php',
                data:{username:username,password:passwd},
                async:false,
                success:function(data){},
                error:function(jqXhr, textStatus, errorThrown){}
            });
        });
    });
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T02:32:08.423

`async:false`已被弃用，并且有充分的理由。

您的登录函数需要重构，以便您在成功回调中使用响应数据。

您的代码需要执行以下操作：

```
$.ajax({
    /* other options*/
     success:function( response){
          if( response.status=='ok'){
             /* run sucessful login code*/
          }else{
             /* message to user*/
          }
     }

}) 
```

# android - 在本机可执行文件 (android) 中绑定 TCP 端口失败

> ID：14077907
> 
> 赞同：1
> 
> 时间：2012-12-29T01:30:02.830
> 
> 标签：android, tcp, android-ndk, video-streaming, rtmp

我正在尝试使用[rtmpgw](http://rtmpdump.mplayerhq.hu/rtmpgw.8.html)在本地端口上设置流，以便使用 videoview 或其他视频播放器访问。我已经设置了本机可执行文件并且它正在工作，但是当我使用命令对其进行测试时

```
rtmpgw --sport 8080 
```

它返回以下错误：

```
HTTP-RTMP Stream Gateway v2.4
(c) 2010 Andrej Stepanchuk, Howard Chu; license: GPL

ERROR: startStreaming, TCP bind failed for port number: 8080
ERROR: Failed to start HTTP server, exiting! 
```

这发生在我尝试过的任何端口上。如果没有`--sport`参数，它会尝试端口 80 并失败。据我了解，非特权/非 root 用户无法在 unix 中绑定低于 1024 的端口。既然这是虚拟机，有什么不同吗？本机可执行文件/静态二进制文件不会在虚拟机之外执行吗？

代码：

```
File rtmp = new File(getFilesDir() + "/rtmpgw");
ProcessBuilder pb = new ProcessBuilder("./" + rtmp.getName(), "--sport", "8080");
pb.directory(getFilesDir());
Process stream = pb.start(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-01-02T15:29:58.660

感谢您的回复。事实证明，高于端口 1024 并不是唯一的要求。它需要在[临时端口范围内](http://en.wikipedia.org/wiki/Ephemeral_port)。为了获得临时端口范围，我执行了命令

```
root@android:/ # cat /proc/sys/net/ipv4/ip_local_port_range
cat /proc/sys/net/ipv4/ip_local_port_range
32768   61000 
```

我不确定该范围在所有 android 设备上的一致性如何，但是当给定临时范围内的端口时，我的本机可执行文件成功启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-30T07:15:02.507

您的本机应用程序在 VM 之外运行，但仍受 Android 权限机制的限制。正如上面 Chris 所指出的，您可以先从 adb shell 尝试它，这在很大程度上弥补了这些限制。如果您的服务器在那里发生故障，请尝试其他一些端口号。

# objective-c - if (!someObject) (someObject != nil 的缩写) 什么时候不安全？

> ID：14077908
> 
> 赞同：3
> 
> 时间：2012-12-29T01:30:09.147
> 
> 标签：objective-c, ios, cocoa-touch

> **可能重复：（**
> [！object）和（object == nil）之间有区别吗？](https://stackoverflow.com/questions/11926047/is-there-a-difference-between-object-and-object-nil)

在 iOS（Objective C）开发中，我经常看到（并使用）以下简写：

```
if (someObject)
{
    // do something
} 
```

检查 someObject 不为零。

换句话说，与以下含义相同：

```
if (someObject != nil)
{
    // do something
} 
```

这两个 if 语句实际上是相同的还是不安全的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-12-29T01:31:41.937

两者完全相同。它们都同样安全。

此功能继承自 C，其中与零比较是隐含的。

# php - 在 APC 的键中使用变量

> ID：14077915
> 
> 赞同：0
> 
> 时间：2012-12-29T01:31:27.943
> 
> 标签：php, apc

我想做这样的事情：

> apc_store('apc-$t', $something);

但是在查看缓存时，它会显示“apc-$t”。我真的尝试了所有可能的组合 .'" 和其他东西，但没有成功。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-31T19:05:44.413

如果您使用单引号，PHP 将不会解释变量。你需要使用：

```
apc_store("apc-$t", $something); 
```

或者：

```
apc_store('apc-'.$t, $something); 
```

# multithreading - 不确定如何在 Windows 服务中处理多个定时线程

> ID：14077916
> 
> 赞同：1
> 
> 时间：2012-12-29T01:31:35.713
> 
> 标签：multithreading, c#-4.0, windows-services

这是我第一次将 Windows 服务应用程序放在一起，并且我一直在阅读一些关于以某种时间间隔运行多个任务的不同方法。一个是每天一次，另一个是每 1 分钟。

我得出的结论是使用 TimedCallBack 和 System.threating.timer 计时器。

不优雅的例子

```
private void DailyTask(object state) {
  //do something daily
}

private void IntervalTask(object state) {
  //do something else
}

private void OnStart() {
  TimedCallBack dailyTcb = DailyTask;
  TimedCallBack intervalTcb = IntervalTask;
  System.Threading.Timer dailyTimer = new Timer(dailyTcb, null, 0, 86400000);
  System.Threading.Timer intervalTimer = new Timer(intervalTcb, null, 0, 60000);
}

private void OnStop() {
  intervalTimer.Dispose();
  dailyTimer.Dispose();
} 
```

**问题**

1）定时器是否在任务完成后开始计时？如果每次运行都需要一些时间才能完成，这会慢慢导致它超过一天？我会假设我需要确定运行负 24 小时需要多长时间？

2）对于两个简单的任务来说，这是一个完美的方法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:45:01.340

计时器不会等到任务完成后才重新启动计时器。例如，如果您将计时器设置为 20 毫秒，而回调的处理时间超过 20 毫秒，那么您将在第一个完成之前获得另一个滴答声。

我看不出你的想法有什么特别不对劲的地方。但是，如果这就是您的服务所做的全部（即只是坐在那里，等待每个间隔触发一次），您可能会考虑将其设为一个简单的控制台模式程序并使用计划任务来执行它。查看 Windows 任务计划程序和 schtasks 命令行工具。

# c - 空指针解引用

> ID：14077919
> 
> 赞同：1
> 
> 时间：2012-12-29T01:32:31.537
> 
> 标签：c, pointers, void-pointers

> **可能重复：**
> [取消引用 void 指针](https://stackoverflow.com/questions/13694753/dereferencing-void-pointers)

我有一个这样的函数调用：

```
void foo(void *context)   //function prototype
..
..
..
main()
{
.
.
foo(&(ptr->block));  //where ptr->block is of type integer.
.
.
.
void foo(void *context)
{
 Here I try to use the ptr->block but am having problems. I have tried 

 if((int *)context ==1)  
  ..
  ..
} 
```

我在函数中将它类型转换回 int 以使用它。我在 foo() 函数中取消引用它是否错误？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T01:33:28.993

```
if((int *)context ==1) 
```

你想要这个：

```
if(*(int *)context ==1) 
```

您正在转换为指向的指针，`int`但您真正想要的是实际访问，`int`因此您需要取消引用该指针。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-29T01:33:52.397

您没有将其类型转换为`int`，而是将其类型转换为`int *`，然后没有取消引用它。尝试：

```
if (*(int *)context == 1) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T03:08:34.523

当您想访问该值时，仅转换指针对您没有帮助..

`(*(int*)context == 1)`会解决你的问题..

# php - jquery.each() 之后的回调？ajax功能太慢，屏幕刷新时间不够

> ID：14077920
> 
> 赞同：0
> 
> 时间：2012-12-29T01:32:37.663
> 
> 标签：php, jquery, ajax

我的应用程序中有两个 javascript/jquery 函数，总是有 refresh() 函数，它从数据库中获取数据并重绘前端视图。

一种方法是将数据发送到 PHP 函数中，该函数可以简单地插入 MySQL 数据库，然后对其进行编辑，在这里它们是（它们是相同的，所以我只发布一个）：

```
function insertedit()
{
$('.res').each(function()
{
    $.post("/controller/method/",{id: id},function(data,status,xhr)
    {
        if(status=="success")
        {
        }
    })
});     

refresh();
} 
```

当我尝试使用此功能插入数据时，一切正常，并且我的视图正在异步重绘，但是当我尝试使用它编辑数据时 - 我必须刷新页面才能看到更新的视图。我认为，该编辑操作比插入和我的刷新功能需要更多的时间，它从 SQL 中抓取数据只是抓取旧数据（未删除的记录） - 我该如何修复它？

**编辑**

```
$(function()
{
 refresh();
});

function insertedit(){
  var $promises = [];
  $('.res').each(function()
  {

    $promises.push(
    $.post("/controller/metgod/",{id, id},function(data,status,xhr)
    {
        if(status=="success")
        {
        }
    })
    );
});     

$.when.apply($, $promises).then(function() {
    refresh();
});
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T02:04:21.140

使用承诺

```
function insertedit()
{
  var $promises = [];

  $('.res').each(function(id){
    var $this = $(this);

    $promises.push(
      $.post("/controller/method/", {'id': $this.attr('id')}, function(data,status,xhr){
        $this.text(data); // success
      })
    );
  });

  $.when.apply($, $promises).then(function(){
    refresh();
  });     
} 
```

在这里查看小提琴，它可以工作[http://jsfiddle.net/69eMp/4/](http://jsfiddle.net/69eMp/4/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:42:36.163

我曾经使用过这样的解决方案，这是我的解决方案（这里有一个现场演示[）](http://jsfiddle.net/5zXdr/)：

```
/**
 * Class that will handle delayed function calls
 * @param fn     the funciton to call
 * @param ctx    the context to use as 'this' inside the function
 * @param delay  delay in millis
 */
var AsyncCall= function(fn, ctx, delay) {
   var timer = null;

   ctx   = ctx || window;
   delay = delay || 1;

   return function() {
       // prevent calling the delayed function multiple times
       if (timer) clearTimeout(timer);

       var args = arguments;

       timer = setTimeout(function() {
          timer = null;
          fn.apply(ctx, args);
       }, delay);
   };
};

// wrap the 'refresh' funciton inside the async call object with a 200 millis delay
var refreshAsync = new AsyncCall(refresh, null, 200);

function insertedit()
{
$('.res').each(function()
{
    $.post("/controller/method/",{id: id},function(data,status,xhr)
    {
        if(status=="success")
        {
        }

        // schedule calling 'refresh'
        refreshAsync();
    })
});
} 
```

首选此方法的原因是您不必刷新每个 Ajax 请求。`refresh`这样，与每次刷新相比，它只会执行更少的功能。并且 200 毫秒不是那么长，但足以让 Ajax 调用返回，并且不会被用户注意到。

# ios - 从应用委托推送视图控制器

> ID：14077932
> 
> 赞同：0
> 
> 时间：2012-12-29T01:34:06.200
> 
> 标签：ios, uiviewcontroller, nsnotificationcenter, pushviewcontroller, presentmodalviewcontroller

所以最近我不得不重新组织我的标签栏并删除一个视图控制器的标签，我仍然需要在应用程序结束时访问它。我正在使用 NSNotifications 触发应用程序委托中的一个方法，该方法基本上切换选项卡`[self.myTabBar setSelectedIndex:REC_TAB];`

像魅力一样工作。现在我无法再选择选项卡，我发现我无法从应用程序委托中推送/弹出/呈现视图控制器。

我是新手，所以任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:58:26.690

您没有理由必须从应用程序委托中执行此操作 - 如果您愿意，您可以这样做，但没有必要。从任何视图控制器，您可以使用 self.view.window.rootViewController 访问窗口的根视图控制器，并将其更改为您想要的任何内容。另一种方法是只从任何视图控制器呈现一个带有 presentViewController:animated: 的模态视图控制器。

# visual-c++ - 是否有适用于 Windows Phone 8 的应用程序认证工具包？

> ID：14077942
> 
> 赞同：0
> 
> 时间：2012-12-29T01:37:10.533
> 
> 标签：visual-c++, windows-phone-8, app-certification-kit

> **可能重复：**
> [是否有任何适用于 WP8 应用程序的认证工具包？](https://stackoverflow.com/questions/13962397/is-there-any-certification-toolkit-for-wp8-apps)

我正在尝试在我的 Windows Phone 8 应用程序中使用第 3 方 C++ 库，我希望了解该库的二进制文件是否使用了 Windows Phone 8 操作系统不支持的任何 API。对于 Windows 8 商店应用程序，我可以使用[Windows 应用程序认证工具包](http://www.microsoft.com/en-us/download/details.aspx?id=27414)来解决这个问题。Windows Phone 8 应用程序也有这样的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T02:15:36.150

请参阅同一问题的答案@[是否有任何适用于 WP8 应用程序的认证工具包？](https://stackoverflow.com/questions/13962397/is-there-any-certification-toolkit-for-wp8-apps/13962554#13962554)

我不确定该商店测试套件是否检查 C++ 二进制文件的静态验证。但是 WP8 Store Ingestion 绝对可以。

# java - 通过双击启动 Java 程序

> ID：14077943
> 
> 赞同：1
> 
> 时间：2012-12-29T01:37:34.133
> 
> 标签：java, macos, deployment, installation, executable-jar

我有一个我一直在研究的 Java 程序。我想把它展示给我的女朋友，她不知道如何使用 Java，并让她很容易这样做。我知道第一步是从命令行将其编译为 .class ，但在那之后我一无所知。

我有兴趣了解如何在 Windows 和 Mac OS 上执行此操作*（*我和我的女朋友在 Mac 上，但我的学校使用 Windows 计算机）。

我在 Oracle 上看过他们的演示，他们下载为 .jnlp，这是朝着正确方向迈出的一步吗？

具体来说，我正在寻找某种“文件”，它只是下载并启动，不涉及终端（可能是一个带有命令行的文件？）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-12-29T01:44:58.347

> 通过双击
> ..seen .. demos 启动 Java 程序，它们下载为 .jnlp，这是朝着正确方向迈出的一步吗？

标题和引用通常代表启动 Java 桌面应用程序的两种不同方式。

1.  *“下载为 .jnlp”* 即“豪华”版本，称为[Java Web Start](https://stackoverflow.com/tags/java-web-start/info)。这对开发人员（你）来说有点棘手，但对用户（你的朋友）来说却很容易。
2.  *“通过双击启动 Java 程序”*通常与可执行 Jar 相关联。（虽然 JWS 也支持“双击”——但有菜单和快捷方式。）

任何一种策略都适用于 OS X、Windows 或 *nix，但第一种策略有 JRE 版本控制（确保最终用户有 JRE，并且它是最新的以运行代码）辅助脚本和许多其他“花里胡哨” '。

## Java 网络启动

*   JWS 应用程序。通常从用户机器可访问的网页或服务器部署，因此您的朋友“浏览”到您发送给她的“在此处下载”的链接。
    *   当她到达您的网页时，`deployJava.js`她会检查她的 PC 是否有合适的最低 Java 版本来运行该应用程序。如果没有，她将被引导通过一个过程来获得它。
    *   当 JRE 被确认时（这对于那些使用较新 JRE 的人来说是不可见的），脚本会在网页中写入一个链接，默认情况下是一个按钮。
        ![在此处输入图像描述](../Images/6be0e5705e4f60098438315a6b5ddb4f.png)
*   用户单击按钮，JWS 客户端（Java 的一部分）将读取 JNLP 并开始安装应用程序。
*   如果应用程序需要超出默认沙盒的权限，则会提示用户是否允许代码运行。有关更多示例，请参阅[Java 安全对话框的外观](https://stackoverflow.com/questions/12986333/appearance-of-java-security-dialog)
    ![](../Images/81d22010148df7139940c0d093c2a1b1.png)
    ： 如果用户选择`Run`..
*   该应用程序。将被加载并出现在屏幕上（可能与添加的桌面快捷方式和开始菜单一起）。
*   要第二次及以后启动它，用户**双击**桌面快捷方式或**激活**菜单项。这就是 Starzoom（在 JNLP 中定义了一个图标）在 Windows 7 中的显示方式。
    ![在此处输入图像描述](../Images/ba80663d42cd07a5214352cc9db4ec5a.png)

## 可执行的罐子

另一个较小的选择是[executable-jar](/questions/tagged/executable-jar "显示标记为“executable-jar”的问题")。

它`manifest.mf`在 Jar 中使用 a 来指定主类。

虽然对最终用户来说体验较差，但对开发人员来说也更简单——这种权衡可能会在有限的分发中派上用场。

*   需要安装合适的 JRE 版本。
*   用户从任何来源（USB、蓝牙、网站等）获取 Jar，并将其保存在他们机器上任何方便的地方。
*   要启动它，用户**双击**Jar。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:41:33.217

您可以使用用于执行 Java 程序的 Java 命令创建一个 bat 脚本（Windows，我不使用 OSX，但我认为它是 shell 脚本）。

或者你可以把你的java类放到一个 [JAR文件中](http://docs.oracle.com/javase/tutorial/deployment/jar/build.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T02:53:49.980

尝试 NetBeans，在其中创建一个项目，然后用它构建您的代码。它自动生成几乎可以在任何平台上通过双击执行的jar文件。

# sql - 计算所有表列中的唯一值

> ID：14077949
> 
> 赞同：-3
> 
> 时间：2012-12-29T01:38:39.813
> 
> 标签：sql

为表中的所有列编译唯一值列表以及每个唯一值的记录计数的最有效的 SQLish 方法是什么？

如何区分具有重复值（例如国家或州代码）的列与包含名称和地址的列 - 在这种情况下会有太多变化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T02:06:47.697

对于任何单列，您可以执行以下操作：

```
SELECT column, COUNT(*) AS column_count
  FROM tablename
 GROUP BY column
 ORDER BY column 
```

没有一种简单的方法可以对单个语句中的所有列执行此操作；您最终会遇到最糟糕的多重外部连接，其中包含排序问题和需要解决的各种问题。（例如，每个单独的列可以有不同数量的不同值。）

您问题的后半部分（“如何区分”）令人费解。你必须知道你的数据集才能做出这种区分。

# random - 随机存取随机排列

> ID：14077953
> 
> 赞同：3
> 
> 时间：2012-12-29T01:39:02.240
> 
> 标签：random

我想生成一个非常大的伪随机排列 p：[0,n-1] -> [0,n-1]，然后计算 m 个特定值 p[i]，其中 m << n。是否有可能在 O(m) 时间内做到这一点？动机是大型并行计算，其中每个处理器只需要查看一小部分排列，但排列必须在处理器之间保持一致。

请注意，为了在并行情况下有所帮助，计算不相交的 i 值集的不同进程不应意外地为 i != j 生成 p[i] == p[j]。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-29T02:06:14.280

[编辑：有一个基于分组密码](http://blog.notdot.net/2007/9/Damn-Cool-Algorithms-Part-2-Secure-permutations-with-block-ciphers)的更聪明的算法，我认为 Geoff 会写出来。

有两种常见的算法来生成排列。Knuth 的 shuffle 本质上是顺序的，因此不是并行性的好选择。另一种是随机选择并在遇到重复时重试。随机选择在以任何顺序应用时显然是等效的，因此我提出以下简单算法：

1.  为每个`p[i]`in （并行）随机抽样候选。`[0,n-1]``i``Needed`
2.  从 中删除所有非冲突条目`Needed`，以及（可选地）从冲突中删除一些确定性选择（例如，保留`p[i]`if `i < {j | p[j] = p[i]}`）。
3.  使用新的（较小的） set 从步骤 1 重复`Needed`。

由于我们在这个过程中没有丢失熵，结果本质上相当于以某种不同的顺序进行顺序随机采样，从`i`没有碰撞的位置开始（我们只是事先不知道那个顺序）。请注意，如果我们在比较中使用计算值，例如，我们会引入偏差。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:50:43.810

一个非常低强度版本的示例：

1.  在 [0,n-1] 中生成 2k = O(1) 个随机整数 a_i,b_i，其中 a_i 与 n 互质。
2.  选择一个弱排列 wp : [0,n-1] -> [0,n-1], 说 w(i) = i 除了高位翻转之外。
3.  p[i] = b_0 + a_0 * wp(b_1 + a_1 * wp(... i ...))

# shell - Shell脚本 - 将变量的内容写入文件中的特定位置？

> ID：14077955
> 
> 赞同：0
> 
> 时间：2012-12-29T01:40:00.967
> 
> 标签：shell, scripting

我有一个正在处理的 shell 脚本，多亏了 SO，我现在有了一个具有我需要的值的变量。现在我试图弄清楚如何将变量的内容放入文件中的特定位置。

该文件如下所示：

```
 Package: com.chrisrjones.KegCop
 Name: KegCop
 Version: 0.0.1
 Architecture: iphoneos-arm
 Description: A frontend for the Kegboard Firmware
 Homepage: http://www.chrisrjones.com 
 Depiction: http://www.chrisrjones.com
 Maintainer: Chris Jones <chris.r.jones.1983@gmail.com>
 Author: Chris Jones <chris.r.jones.1983@gmail.com>
 Sponsor:
 Section: Applications 
```

基本上，我希望将变量放入文件后的输出如下所示：

```
 Package: com.chrisrjones.KegCop
 Name: KegCop
 Version: 0.0.1-645
 Architecture: iphoneos-arm
 Description: A frontend for the Kegboard Firmware
 Homepage: http://www.chrisrjones.com 
 Depiction: http://www.chrisrjones.com
 Maintainer: Chris Jones <chris.r.jones.1983@gmail.com>
 Author: Chris Jones <chris.r.jones.1983@gmail.com>
 Sponsor:
 Section: Applications 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:59:24.097

```
sed -i -e "/Version/s/$/-$VAR/" filename 
```

**编辑：**

要替换旧版本号（如果有）：

```
sed -i -e "/Version/s/\(-...\)*$/-$VAR/" filename 
```

# java - 多线程套接字服务器在其生命周期内仅处理一个请求

> ID：14077960
> 
> 赞同：-1
> 
> 时间：2012-12-29T01:41:01.187
> 
> 标签：java, sockets, serversocket, server-push

我还有一个关于我的推送服务器的问题。由于某种原因，服务器在其生命周期内只接受一个连接。即使在第一个连接关闭后，服务器也不会做任何事情。我怀疑线程没有被生成，因为它没有拒绝连接。

这是服务器的代码：http: [//docs.oracle.com/javase/tutorial/networking/sockets/examples/KKMultiServer.java](http://docs.oracle.com/javase/tutorial/networking/sockets/examples/KKMultiServer.java)

我使用了这个例子，因为它正是我所需要的。我保持此代码不变。这是我真正使用的线程......

```
import java.net.*;
import java.io.*;

public class KKMultiServerThread extends Thread {
    private Socket socket = null;

    public KKMultiServerThread(Socket socket) {
            super("KKMultiServerThread");
            this.socket = socket;
    }

    public void run() {
            try {
                    final PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
                    BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
                    String inputLine, outputLine;
                    out.println("connected");
                    boolean loggedin = false;
                    String username="";
                    String password="";
                    String deviceid="";
                    while (true) {
                    //deal with login handshake
                            if ((inputLine = in.readLine()) == null) inputLine="";
                            if (!loggedin) {
                                   Logs the user in...
                                   Also does things with files and keeps reading and writing to the client...
                    }
                    out.close();
                    in.close();
                    socket.close();
            } catch (IOException e) {
                    e.printStackTrace();
            }
    return;
    }
} 
```

可能出了什么问题？我关闭了套接字和我应该关闭的所有流，但即使那样它仍然应该工作，不是吗？

感谢您一直以来的支持！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-12-29T01:55:31.403

> if ((inputLine = in.readLine()) == null) inputLine="";

这行代码是A级的废话。如果 inputLine 为 null，则对端已关闭套接字，您必须退出循环并自行关闭套接字。目前您正在忽略 EOS 条件并永远循环。

# html - 无法让无序列表水平显示

> ID：14077963
> 
> 赞同：0
> 
> 时间：2012-12-29T01:41:49.067
> 
> 标签：html, css, listbox

我试图通过使用无序列表创建一个导航菜单，然后让它水平显示。每个 li 中都有一个 div 标签，其中包含更多 div，用于更多样式，但是，列表似乎正在下拉，尽管没有显示任何内容。这是它的 JSFiddle：http: [//jsfiddle.net/E8jqN/2/](http://jsfiddle.net/E8jqN/2/)

另外，它的html是：

```
<div id="header-right">
    <ul id="navigation">
        <li>
            <div class="nav-button">
                <div id="schools">
                </div>
            </div>
            <div class="nav-text">
                Schools
            </div>
        </li>
        <li>
            <div class="nav-button">
                <div id="professors">
                </div>
            </div>
            <div class="nav-text">
                Professors
            </div>
        </li>
        <li>
            <div class="nav-button">
                <div class="Programs">
                </div>
            </div>
            <div class="nav-text">
                Programs
            </div>
        </li>
        <li>
            <div class="nav-button">
                <div class="account">
                </div>
            </div>
            <div class="nav-text">
                My Account
            </div>
        </li>
    </ul>
</div> 
```

而CSS是：

```
#header-right{
    float: right;
    width: 366px;
    height: 64px;
    background-image:url('http://localhost/gradebyme/gradebyme/public/img/midtile2.png');
    background-repeat:repeat-x;
}

#navigation{
/*    position: relative;
    background: url('http://localhost/gradebyme/gradebyme/public/img/icontest.png');*/
    margin: 0;
    padding: 0;
    list-style: none;
}

#navigation li{
    width: 88px;
    height: 64px;
    display: inline;
}

.nav-button{
    width: 88px;
    height: 40px;
}

.nav-text{
    width: 88px;
    height: 24px;
    color:blue;
}

#schools{
    float: left;
    width: 37px;
    height: 26.75px;
/*    background-position: 0 0;*/
}

#professors{
    float: left;
    width: 37px;
    height: 26.75px;
/*    background-position: 0 -27px;*/
}

#programs{
    float: left;
    width: 37px;
    height: 26.75px;
    background-color: green;
/*    background-position: 0 -55px;*/
}

#account{
    float: left;
    width: 37px;
    height: 26.75px;
    background-color: purple;
/*    background-position: 0 -83px;*/
} 
```

我需要它来水平显示它们，然后我可以添加图标。任何帮助表示赞赏！还赞赏一般的 css 技巧，我对它很陌生。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T01:46:54.213

使用具有样式 float: left 的 div 包装导航按钮和导航文本

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-29T01:48:11.857

如果我明白你想要什么，你可以简单地在`float:left;`你的.`#navigation li`

[http://jsfiddle.net/E8jqN/7/](http://jsfiddle.net/E8jqN/7/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-29T01:48:34.337

```
#navigation li{
float: right;
width: 88px;
height: 64px;} 
```

或者

```
#navigation li{
width: 88px;
height: 64px;
display: inline-block;} 
```

# facebook - 在 Facebook 分享 URL 上，为用户提供选择图像的选项

> ID：14077972
> 
> 赞同：0
> 
> 时间：2012-12-29T01:43:35.433
> 
> 标签：facebook, share

我没有看到我正在寻找的答案，所以希望有人可以提供帮助。

我有一个 PHP 脚本，它显示来自 SQL 数据库的数据。动态元素被引入，本质上显示了工作列表的详细信息。在这个页面上，我有一个 Facebook 分享 URL。

例子：

```
<a title="Post on Facebook"
   href="http://www.facebook.com/share.php?u=http://www.mywebsite.com/joblisting/details.php?job_id=1345488636.3750">
   POST ON FACEBOOK
</a> 
```

当用户单击该链接时，他们会获得 Facebook 页面以将其发布到他们的 Facebook 页面。他们所在的页面预先填充了我的页面标题、页面描述等。

如果我的页面上有图片，那将成为 FB 帖子的默认缩略图。我还在我的元标记中设置了一个默认的 Facebook 图像，这也有效。我还在我的页面上添加了多达 10 个其他图像，以便用户可以从 10 个图像中选择 1 个作为默认缩略图。但...

**我希望能够让用户从他们的桌面上选择一个缩略图。这可能吗？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-29T04:13:21.470

在调用对话框之前，共享对话框中使用的图像需要存在于网络上的某个位置，因此您需要允许用户在弹出对话框之前将其上传到某个位置，以便执行您的建议。

# javascript - 为一个班级运行每个，但为一组运行一次

> ID：14077973
> 
> 赞同：5
> 
> 时间：2012-12-29T01:43:36.813
> 
> 标签：javascript, jquery, dom

我有很多相同类的元素。**这些元素通过属性“ data-xxx** ”进行分组

```
<div class="myclass" data-n="group1"></div>
<div class="myclass" data-n="group1"></div>
<div class="myclass" data-n="group1"></div>
.... 
<div class="myclass" data-n="group2"></div>
<div class="myclass" data-n="group2"></div>
...
<div class="myclass" data-n="group3"></div>
...
... 
```

如何在每个项目上执行一个功能，但在每个组中只使用这样的东西一次？

```
$('.myclass').each(function(){

/// My function

}); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-29T01:48:58.743

**工作示例：http: [//jsfiddle.net/5sKqU/1/](http://jsfiddle.net/5sKqU/1/)**

```
$(document).ready(function() {
    var group = {}; //an object that we're going to use as a hash  
    $('.myclass').each(function(){ 
        if (group[$(this).attr('data-n')] != true) {
            group[$(this).attr('data-n')] = true;

            //do something here once per each group
            alert('Group: '+ $(this).attr('data-n'));
        }
    }); 
}); 
```

我假设您只需要在页面加载时运行一次。如果您可以分享有关您的要求的更多信息，我可以向您展示您需要进行哪些更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-29T02:07:59.850

可能是这样的：

```
var groups = {};
$('.myclass').each(function(i, el) {
    var n = $(el).data('n');
    if(!groups[n]) {
        groups[n] = $();
    }
    groups[n] = groups[n].add(el);
});

//At this point the object `groups` has one property per group, 
//each value being a jquery collection comprising members of the group.

//Now the world's your oyster. You can loop through the groups 
//with full access to each group's members if necessary.
$.each(groups, function(groupName, jq) {
    //my function
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-29T03:20:02.067

处理完第一个元素后，您可以在所有组元素上设置某个 HTML 属性。之后，您可以检查该属性的值：

```
$('.myclass').each(function(){

  if($(this).attr("processed")!="true") {
      // process...
      $("[data-n=" + $(this).attr("data-n")).attr("processed", "true");
  } else {
     // skip, or do something else with the element
  }

}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-29T01:51:02.187

您可以使用 jQuery 属性选择器选择每个组，如下所示：

```
$( '.myclass[data-n="groupX"]' ); 
```

我不确定您的意思是不是只想将您的函数应用于每个组中的一个元素，但如果是这样，这只会给您每个组中的第一个：

```
$( '.myclass[data-n="groupX"]' ).first(); 
```

鉴于您将组标记为 1 到 N，您只需检查结果集中是否有任何内容来确定您何时遍历每个组。

# c++ - 移动鼠标区域后如何获取 qml 元素的 x,y, 值？

> ID：14077974
> 
> 赞同：2
> 
> 时间：2012-12-29T01:44:10.280
> 
> 标签：c++, qt, qml, qt5

使用Qt5官方发布——

我需要保存图像元素的 x,y 属性。这个

```
QObject* pic = rootitem1->findChild<QObject*>("image_objectName");
int x = pic->property("x").toInt(); 
```

给出属性最初设置的值，但我需要的是鼠标移动图像后的当前值。我可能遗漏了一些简单的东西，但我在上面找不到任何其他东西。真的很感激任何帮助，谢谢。

# ruby-on-rails - 按用户所属的表重定向用户

> ID：14077976
> 
> 赞同：0
> 
> 时间：2012-12-29T01:44:28.377
> 
> 标签：ruby-on-rails, redirect

我有两个表：workers_table 和 admins_table。

我有两个控制器，我使用`devise`（sign_in，sign_up ...）。

我用：

```
before_filter :authenticate_user! 
```

在工人和管理员的控制器中。

假设我有登录用户的电子邮件：

```
@email = current_user.email 
```

我想检查在哪里找到@email：

*   如果在workers表中找到它，则将他重定向到workers的index.html.erb（并且他无法进入管理员的index.html.erb）。

*   如果在 admins 表中找到，则将他重定向到 admins 的 index.html.erb（他无法进入 worker 的 index.html.erb）。

我知道如何检查用户是否属于workers_table 或admins_table。

但是我应该在哪里检查用户属于哪个表？我应该定义另一个控制器吗？

请指导我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T01:58:33.463

application_controller.rb 是定义 authenticate_user 功能的好地方

如果你有的话，另一个地方可能是 session_controller.rb

至少你可以为你的 admins_controller 添加一个 ensure_admin 方法来添加到 before_filter，如果他们不是管理员，你可以 redirect_to workers#index

我是 Rails 的新手，所以我不确定执行此操作的*传统*方式，但以上是我可以做到的方式。

# c# - 矩形不会在面板上绘制

> ID：14077988
> 
> 赞同：0
> 
> 时间：2012-12-29T01:46:50.223
> 
> 标签：c#, drawing, panel, rectangles

我需要在运行时动态创建的面板边缘绘制一个矩形。首先，我得到了十六进制代码的颜色。我正在使用我在 stackoverflow 上找到的类似问题的代码将其转换为 ARGB：

```
string color = *getting the hexa code*
int argb = Int32.Parse(color.Replace("#", ""), NumberStyles.HexNumber);
Color clr = Color.FromArgb(argb); 
```

现在，我尝试使用以下代码绘制矩形：

```
Graphics g = panel.CreateGraphics();
Pen p = new Pen(clr);
Rectangle r = new Rectangle(1, 1, 578, 38);
g.DrawRectangle(p, r); 
```

但它什么也没做，没有出现矩形。此代码包含在创建面板本身并使用一些控件（组合框、按钮等）填充它的代码的一部分中。我是否需要使用类似的东西将矩形添加到面板中`panel.Controls.Add(r);`？（试过了，当然矩形不是控件，所以它不起作用）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-29T02:08:36.707

尝试将 Graphics 绘图转移到面板绘制事件中，因为您正在动态创建这些，匿名事件处理程序应该可以轻松完成。

```
private void CreatePanel()
{
    Panel panel = new Panel();
    panel.Width = 600;
    panel.Height = 100;
    panel.Controls.Add(....);

    panel.Paint += (sender, e) =>
    {
        string color = "#FFE80000"; //*getting the hexa code*
        int argb = Int32.Parse(color.Replace("#", ""), NumberStyles.HexNumber);
        Color clr = Color.FromArgb(argb);
        Pen p = new Pen(clr);
        Rectangle r = new Rectangle(1, 1, 578, 38);
        e.Graphics.DrawRectangle(p, r);
    };

    Controls.Add(panel);
} 
```

# windows - 在 Windows 上的 Vim 中映射 alt 键

> ID：14077991
> 
> 赞同：3
> 
> 时间：2012-12-29T01:47:38.000
> 
> 标签：windows, vim

我有一个函数，我想在 Windows 上的 gVim 中映射到`Alt`+ `o`（Win7-x64 上的 7.3.46 32 位 Bram@KIBAALE 大版本），它......不工作。

我的 .vimrc 有一行内容：

```
nnoremap <A-o> :call SplitRelatedFile()<CR> 
```

然后我启动 gVim，加载文件，点击`Alt`+`o`并听到哔声。我尝试在映射中使用大写 O，我尝试在 gVim 中使用和不使用 shift，但它不起作用，我只是听到哔哔声。（我也试过`<M-o>`。）

如果我在终端中加载 Vim，它会按预期工作。如果我在新的 gVim 实例中手动执行上述行，它也可以按预期工作。只有当它出现在 .vimrc 中时它才不起作用。实际上，它出现在另一个文件中，但我的 _vimrc 只有一行读取`source x:/path/to/my.vimrc`.

当我查看输出时，`:map`无论如何我都没有将 alt 键列为 alt 键，大概是由于第 8 位解释交叉了一些东西。然而我看到的是……

```
n  <ef>        * :call SplitRelatedFile()<CR> 
```

在我手动运行`:nnoremap`gVim 之后，我看到了这个（如果这篇文章有任何字符翻译问题，第一行显示 i-umlaut 作为键）：

```
n  ï           * :call SplitRelatedFile()<CR>
n  <ef>        * :call SplitRelatedFile()<CR> 
```

所以似乎第 8 位在 Vim (GUI) 启动的不同点得到不同的解释？对于它的价值，当我`:map`在控制台 Vim 中运行时，我也得到了 i-umlaut 而不是`<ef>`行 (`o`在 ASCII 中是 0x6F 所以如果设置了高位就会是 0xEF ，所以这很有意义；i-umlaut 似乎为 0x8B）。

我尝试了一些不同的`Alt`组合键，但没有一个能在 gVim 中幸存下来，所以我很好奇是否有人有任何提示。也许我可以以某种方式将它们塞入某种“延迟加载”模块中，例如本地插件或其他东西？

我可以远离`Alt`键，但我没有功能键，不想踩踏`Ctrl`这个功能的明显键......我刚刚发现我可以用+ ，+`<A-o>`的结果替换，这确实有效（当我在我的 vimrc 中得到 i-umlaut 时）但这不是很好！对这种疯狂有什么想法吗？（哦，这对控制台 Vim 不起作用，我需要保留返回 false时的版本。）`Ctrl``v``Alt``o``Alt``has("gui")`

我现在注意到 gVim 和控制台 Vim 都将 i-umlaut 报告为 0xEF 所以......我不知道我需要做些什么来减少它的混乱。请帮帮我！

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-12-29T02:30:10.067

映射（尤其是`Alt`设置了第 8 位的组合）容易受到 的更改的影响`'encoding'`，并且在您以后修改它时可能会中断。

作为一般规则，如果您愿意`:set encoding=...`，它应该是您`.vimrc`文件中的首要内容之一。

# django - 如何让一个地理领域独一无二？

> ID：14077993
> 
> 赞同：4
> 
> 时间：2012-12-29T01:47:50.623
> 
> 标签：django, gis, postgis, geodjango, django-postgresql

我有这个模型：

```
class Marker(models.Model):
    location = models.PointField(geography=True, unique=True) 
```

当我尝试通过管理界面添加 Marker 实例时，它会引发`ValueError`：

```
File "django/core/handlers/base.py" in get_response
  111\. response = callback(request, *callback_args, **callback_kwargs)
File "django/contrib/admin/options.py" in wrapper
  366\. return self.admin_site.admin_view(view)(*args, **kwargs)
File "django/utils/decorators.py" in _wrapped_view
  91\. response = view_func(request, *args, **kwargs)
File "django/views/decorators/cache.py" in _wrapped_view_func
  89\. response = view_func(request, *args, **kwargs)
File "django/contrib/admin/sites.py" in inner
  196\. return view(request, *args, **kwargs)
File "django/utils/decorators.py" in _wrapper
  25\. return bound_func(*args, **kwargs)
File "django/utils/decorators.py" in _wrapped_view
  91\. response = view_func(request, *args, **kwargs)
File "django/utils/decorators.py" in bound_func
  21\. return func(self, *args2, **kwargs2)
File "django/db/transaction.py" in inner
  209\. return func(*args, **kwargs)
File "django/contrib/admin/options.py" in add_view
  937\. if form.is_valid():
File "django/forms/forms.py" in is_valid
  124\. return self.is_bound and not bool(self.errors)
File "django/forms/forms.py" in _get_errors
  115\. self.full_clean()
File "django/forms/forms.py" in full_clean
  272\. self._post_clean()
File "django/forms/models.py" in _post_clean
  338\. self.validate_unique()
File "django/forms/models.py" in validate_unique
  347\. self.instance.validate_unique(exclude=exclude)
File "django/db/models/base.py" in validate_unique
  633\. errors = self._perform_unique_checks(unique_checks)
File "django/db/models/base.py" in _perform_unique_checks
  724\. if qs.exists():
File "django/db/models/query.py" in exists
  565\. return self.query.has_results(using=self.db)
File "django/db/models/sql/query.py" in has_results
  441\. return bool(compiler.execute_sql(SINGLE))
File "django/db/models/sql/compiler.py" in execute_sql
  808\. sql, params = self.as_sql()
File "django/db/models/sql/compiler.py" in as_sql
  82\. where, w_params = self.query.where.as_sql(qn=qn, connection=self.connection)
File "django/db/models/sql/where.py" in as_sql
  91\. sql, params = child.as_sql(qn=qn, connection=connection)
File "django/db/models/sql/where.py" in as_sql
  94\. sql, params = self.make_atom(child, qn, connection)
File "django/contrib/gis/db/models/sql/where.py" in make_atom
  47\. spatial_sql = connection.ops.spatial_lookup_sql(data, lookup_type, params_or_value, lvalue.field, qn)
File "django/contrib/gis/db/backends/postgis/operations.py" in spatial_lookup_sql
  497\. '"%s" lookup.' % lookup_type)

Exception Type: ValueError at /admin/coremap/marker/add/
Exception Value: PostGIS geography does not support the "exact" lookup. 
```

据此[，](https://docs.djangoproject.com/en/1.4/ref/contrib/gis/model-api/#geography-type)`geography`类型确实没有字段`exact`查找。有什么方法可以在`unique`不使用的情况下完成约束`exact`？

我在用着：

*   PostgreSQL 9.1
*   地理信息系统 1.5
*   Django 1.4.3

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2017-02-24T05:07:34.647

我遇到了类似的问题，但是使用了较新版本的 Django (1.10.5)、PostGIS (2.0) 和 Postgres (9.4)（Op 的问题距此答案已有 4 年）

Django 向我提出的错误有点不同，但相关：

`ValueError: PostGIS geography does not support the "~=" function/operator.`

事实证明，在这个版本中，Django PostGIS 后端使用“~=”运算符来验证某个记录是否已经存在，但 PostGIS 不支持地理类型。不知道为什么 GeoDjango 开发人员不使用地理和几何类型都支持的“=”运算符。

所以我找到的解决方案是通过在models.py文件的顶部添加猴子补丁Django PostGIS后端（也许有更优雅的方法来做这个猴子补丁），但对我来说效果很好......

```
from django.contrib.gis.db.backends.postgis.operations import (PostGISOperator,
                                                               PostGISOperations,
                                                               BILATERAL)
PostGISOperations.gis_operators['exact'] = PostGISOperator(op='=', 
                                                           geography=True, 
                                                           raster=BILATERAL)
PostGISOperations.gis_operators['same_as'] = PostGISOperator(op='=', 
                                                             geography=True, 
                                                             raster=BILATERAL) 
```

我想如果您仍在项目中使用旧版本的 Django 和 PostGIS，您可能需要验证是否支持给定的运算符，以及在特定版本的 Django 中如何处理后端运算符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-19T01:46:57.533

我不知道您是否可以直接在 Django 中执行此操作，或者事后是否需要添加索引，但 PostgreSQL 确实支持唯一功能索引。

您可以使用以下方法强制执行独特的几何：

```
CREATE UNIQUE INDEX tbl_geometry_idx_u ON mytable(geometry_to_text(mygeom)); 
```

这将在几何列的文本表示上创建唯一索引。大小可能有限制（我不希望索引对烘烤值有效），但如果您的几何字段中有那么多点，那么您将遇到唯一约束的问题。

# c - 如何测试是否支持像 uint64_t 这样的类型？

> ID：14077999
> 
> 赞同：8
> 
> 时间：2012-12-29T01:49:04.603
> 
> 标签：c

如何测试编译器是否支持类型？说像 uint64_t。有没有什么地方可以用来学习如何测试任何给定类型的参考？

通过搜索引擎很难找到这一点。我尝试了“数据类型的 C 测试”和许多其他的东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-12-29T01:50:46.377

您可以检查：

`UINT64_MAX`宏是在 include 之后定义的`stdint.h`。

如果您不确定是否支持 c99 或更高版本，您也可以将其附在`__STDC_VERSION__`to be 中`>= 199901L`。请注意，`__STDC_VERSION__`C89/C90 中也不存在该宏。

从标准（强调我的）：

> （C99，7.18p4）“对于此处描述的实现提供的每种类型，224）应声明 typedef 名称并定义关联的宏。**相反，对于此处描述的实现未提供的每种类型，不应声明 typedef 名称也不应定义相关的宏。** ”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-29T01:50:51.417

尝试使用它——如果它不存在，你会得到一个编译器错误。喜欢的类型`uint64_t`在`stdint.h`.